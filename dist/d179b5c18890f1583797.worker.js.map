{"version":3,"file":"d179b5c18890f1583797.worker.js","mappings":"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","sources":["webpack://mvt-basic-render/./node_modules/@mapbox/geojson-area/index.js","webpack://mvt-basic-render/./node_modules/@mapbox/point-geometry/index.js","webpack://mvt-basic-render/./node_modules/@mapbox/shelf-pack/index.umd.js","webpack://mvt-basic-render/./node_modules/@mapbox/unitbezier/index.js","webpack://mvt-basic-render/./node_modules/@mapbox/vector-tile/index.js","webpack://mvt-basic-render/./node_modules/@mapbox/vector-tile/lib/vectortile.js","webpack://mvt-basic-render/./node_modules/@mapbox/vector-tile/lib/vectortilefeature.js","webpack://mvt-basic-render/./node_modules/@mapbox/vector-tile/lib/vectortilelayer.js","webpack://mvt-basic-render/./node_modules/assert/assert.js","webpack://mvt-basic-render/./node_modules/assert/node_modules/inherits/inherits_browser.js","webpack://mvt-basic-render/./node_modules/assert/node_modules/util/support/isBufferBrowser.js","webpack://mvt-basic-render/./node_modules/assert/node_modules/util/util.js","webpack://mvt-basic-render/./src/data/array_types.js","webpack://mvt-basic-render/./src/data/bucket/circle_attributes.js","webpack://mvt-basic-render/./src/data/bucket/circle_bucket.js","webpack://mvt-basic-render/./src/data/bucket/fill_attributes.js","webpack://mvt-basic-render/./src/data/bucket/fill_bucket.js","webpack://mvt-basic-render/./src/data/bucket/fill_extrusion_attributes.js","webpack://mvt-basic-render/./src/data/bucket/fill_extrusion_bucket.js","webpack://mvt-basic-render/./src/data/bucket/heatmap_bucket.js","webpack://mvt-basic-render/./src/data/bucket/line_attributes.js","webpack://mvt-basic-render/./src/data/bucket/line_bucket.js","webpack://mvt-basic-render/./src/data/bucket/symbol_attributes.js","webpack://mvt-basic-render/./src/data/bucket/symbol_bucket.js","webpack://mvt-basic-render/./src/data/dem_data.js","webpack://mvt-basic-render/./src/data/extent.js","webpack://mvt-basic-render/./src/data/feature_index.js","webpack://mvt-basic-render/./src/data/index_array_type.js","webpack://mvt-basic-render/./src/data/load_geometry.js","webpack://mvt-basic-render/./src/data/program_configuration.js","webpack://mvt-basic-render/./src/data/segment.js","webpack://mvt-basic-render/./src/geo/coordinate.js","webpack://mvt-basic-render/./src/render/glyph_atlas.js","webpack://mvt-basic-render/./src/render/image_atlas.js","webpack://mvt-basic-render/./src/shaders/encode_attribute.js","webpack://mvt-basic-render/./src/source/geojson_worker_source.js","webpack://mvt-basic-render/./src/source/geojson_wrapper.js","webpack://mvt-basic-render/./src/source/raster_dem_tile_worker_source.js","webpack://mvt-basic-render/./src/source/rtl_text_plugin.js","webpack://mvt-basic-render/./src/source/tile_id.js","webpack://mvt-basic-render/./src/source/vector_tile_worker_source.js","webpack://mvt-basic-render/./src/source/worker_tile.js","webpack://mvt-basic-render/./src/style-spec/error/validation_error.js","webpack://mvt-basic-render/./src/style-spec/expression/compound_expression.js","webpack://mvt-basic-render/./src/style-spec/expression/definitions/array.js","webpack://mvt-basic-render/./src/style-spec/expression/definitions/assertion.js","webpack://mvt-basic-render/./src/style-spec/expression/definitions/at.js","webpack://mvt-basic-render/./src/style-spec/expression/definitions/case.js","webpack://mvt-basic-render/./src/style-spec/expression/definitions/coalesce.js","webpack://mvt-basic-render/./src/style-spec/expression/definitions/coercion.js","webpack://mvt-basic-render/./src/style-spec/expression/definitions/equals.js","webpack://mvt-basic-render/./src/style-spec/expression/definitions/index.js","webpack://mvt-basic-render/./src/style-spec/expression/definitions/interpolate.js","webpack://mvt-basic-render/./src/style-spec/expression/definitions/let.js","webpack://mvt-basic-render/./src/style-spec/expression/definitions/literal.js","webpack://mvt-basic-render/./src/style-spec/expression/definitions/match.js","webpack://mvt-basic-render/./src/style-spec/expression/definitions/step.js","webpack://mvt-basic-render/./src/style-spec/expression/definitions/var.js","webpack://mvt-basic-render/./src/style-spec/expression/evaluation_context.js","webpack://mvt-basic-render/./src/style-spec/expression/index.js","webpack://mvt-basic-render/./src/style-spec/expression/is_constant.js","webpack://mvt-basic-render/./src/style-spec/expression/parsing_context.js","webpack://mvt-basic-render/./src/style-spec/expression/parsing_error.js","webpack://mvt-basic-render/./src/style-spec/expression/runtime_error.js","webpack://mvt-basic-render/./src/style-spec/expression/scope.js","webpack://mvt-basic-render/./src/style-spec/expression/stops.js","webpack://mvt-basic-render/./src/style-spec/expression/types.js","webpack://mvt-basic-render/./src/style-spec/expression/values.js","webpack://mvt-basic-render/./src/style-spec/feature_filter/index.js","webpack://mvt-basic-render/./src/style-spec/function/index.js","webpack://mvt-basic-render/./src/style-spec/group_by_layout.js","webpack://mvt-basic-render/./src/style-spec/reference/latest.js","webpack://mvt-basic-render/./src/style-spec/util/color.js","webpack://mvt-basic-render/./src/style-spec/util/color_spaces.js","webpack://mvt-basic-render/./src/style-spec/util/deep_equal.js","webpack://mvt-basic-render/./src/style-spec/util/extend.js","webpack://mvt-basic-render/./src/style-spec/util/get_type.js","webpack://mvt-basic-render/./src/style-spec/util/interpolate.js","webpack://mvt-basic-render/./src/style-spec/util/ref_properties.js","webpack://mvt-basic-render/./src/style-spec/util/result.js","webpack://mvt-basic-render/./src/style-spec/util/unbundle_jsonlint.js","webpack://mvt-basic-render/./src/style-spec/validate/validate.js","webpack://mvt-basic-render/./src/style-spec/validate/validate_array.js","webpack://mvt-basic-render/./src/style-spec/validate/validate_boolean.js","webpack://mvt-basic-render/./src/style-spec/validate/validate_color.js","webpack://mvt-basic-render/./src/style-spec/validate/validate_constants.js","webpack://mvt-basic-render/./src/style-spec/validate/validate_enum.js","webpack://mvt-basic-render/./src/style-spec/validate/validate_expression.js","webpack://mvt-basic-render/./src/style-spec/validate/validate_filter.js","webpack://mvt-basic-render/./src/style-spec/validate/validate_function.js","webpack://mvt-basic-render/./src/style-spec/validate/validate_glyphs_url.js","webpack://mvt-basic-render/./src/style-spec/validate/validate_layer.js","webpack://mvt-basic-render/./src/style-spec/validate/validate_layout_property.js","webpack://mvt-basic-render/./src/style-spec/validate/validate_light.js","webpack://mvt-basic-render/./src/style-spec/validate/validate_number.js","webpack://mvt-basic-render/./src/style-spec/validate/validate_object.js","webpack://mvt-basic-render/./src/style-spec/validate/validate_paint_property.js","webpack://mvt-basic-render/./src/style-spec/validate/validate_property.js","webpack://mvt-basic-render/./src/style-spec/validate/validate_source.js","webpack://mvt-basic-render/./src/style-spec/validate/validate_string.js","webpack://mvt-basic-render/./src/style-spec/validate_style.min.js","webpack://mvt-basic-render/./src/style/evaluation_parameters.js","webpack://mvt-basic-render/./src/style/parse_glyph_pbf.js","webpack://mvt-basic-render/./src/style/properties.js","webpack://mvt-basic-render/./src/style/query_utils.js","webpack://mvt-basic-render/./src/style/style_layer.js","webpack://mvt-basic-render/./src/style/style_layer/background_style_layer.js","webpack://mvt-basic-render/./src/style/style_layer/background_style_layer_properties.js","webpack://mvt-basic-render/./src/style/style_layer/circle_style_layer.js","webpack://mvt-basic-render/./src/style/style_layer/circle_style_layer_properties.js","webpack://mvt-basic-render/./src/style/style_layer/fill_extrusion_style_layer.js","webpack://mvt-basic-render/./src/style/style_layer/fill_extrusion_style_layer_properties.js","webpack://mvt-basic-render/./src/style/style_layer/fill_style_layer.js","webpack://mvt-basic-render/./src/style/style_layer/fill_style_layer_properties.js","webpack://mvt-basic-render/./src/style/style_layer/heatmap_style_layer.js","webpack://mvt-basic-render/./src/style/style_layer/heatmap_style_layer_properties.js","webpack://mvt-basic-render/./src/style/style_layer/hillshade_style_layer.js","webpack://mvt-basic-render/./src/style/style_layer/hillshade_style_layer_properties.js","webpack://mvt-basic-render/./src/style/style_layer/line_style_layer.js","webpack://mvt-basic-render/./src/style/style_layer/line_style_layer_properties.js","webpack://mvt-basic-render/./src/style/style_layer/raster_style_layer.js","webpack://mvt-basic-render/./src/style/style_layer/raster_style_layer_properties.js","webpack://mvt-basic-render/./src/style/style_layer/symbol_style_layer.js","webpack://mvt-basic-render/./src/style/style_layer/symbol_style_layer_properties.js","webpack://mvt-basic-render/./src/style/style_layer_index.js","webpack://mvt-basic-render/./src/style/validate_style.js","webpack://mvt-basic-render/./src/style/zoom_history.js","webpack://mvt-basic-render/./src/symbol/anchor.js","webpack://mvt-basic-render/./src/symbol/check_max_angle.js","webpack://mvt-basic-render/./src/symbol/clip_line.js","webpack://mvt-basic-render/./src/symbol/collision_feature.js","webpack://mvt-basic-render/./src/symbol/get_anchors.js","webpack://mvt-basic-render/./src/symbol/mergelines.js","webpack://mvt-basic-render/./src/symbol/opacity_state.js","webpack://mvt-basic-render/./src/symbol/quads.js","webpack://mvt-basic-render/./src/symbol/shaping.js","webpack://mvt-basic-render/./src/symbol/symbol_layout.js","webpack://mvt-basic-render/./src/symbol/symbol_size.js","webpack://mvt-basic-render/./src/symbol/transform_text.js","webpack://mvt-basic-render/./src/util/actor.js","webpack://mvt-basic-render/./src/util/ajax.js","webpack://mvt-basic-render/./src/util/browser/window.js","webpack://mvt-basic-render/./src/util/classify_rings.js","webpack://mvt-basic-render/./src/util/dictionary_coder.js","webpack://mvt-basic-render/./src/util/evented.js","webpack://mvt-basic-render/./src/util/find_pole_of_inaccessibility.js","webpack://mvt-basic-render/./src/util/image.js","webpack://mvt-basic-render/./src/util/intersection_tests.js","webpack://mvt-basic-render/./src/util/is_char_in_unicode_block.js","webpack://mvt-basic-render/./src/util/script_detection.js","webpack://mvt-basic-render/./src/util/struct_array.js","webpack://mvt-basic-render/./src/util/token.js","webpack://mvt-basic-render/./src/util/util.js","webpack://mvt-basic-render/./src/util/vectortile_to_geojson.js","webpack://mvt-basic-render/./src/util/verticalize_punctuation.js","webpack://mvt-basic-render/./src/util/web_worker_transfer.js","webpack://mvt-basic-render/./node_modules/csscolorparser/csscolorparser.js","webpack://mvt-basic-render/./node_modules/earcut/src/earcut.js","webpack://mvt-basic-render/./node_modules/geojson-rewind/index.js","webpack://mvt-basic-render/./node_modules/geojson-vt/src/simplify.js","webpack://mvt-basic-render/./node_modules/geojson-vt/src/feature.js","webpack://mvt-basic-render/./node_modules/geojson-vt/src/convert.js","webpack://mvt-basic-render/./node_modules/geojson-vt/src/clip.js","webpack://mvt-basic-render/./node_modules/geojson-vt/src/wrap.js","webpack://mvt-basic-render/./node_modules/geojson-vt/src/transform.js","webpack://mvt-basic-render/./node_modules/geojson-vt/src/tile.js","webpack://mvt-basic-render/./node_modules/geojson-vt/src/index.js","webpack://mvt-basic-render/./node_modules/grid-index/grid-index.js","webpack://mvt-basic-render/./node_modules/ieee754/index.js","webpack://mvt-basic-render/./node_modules/kdbush/src/kdbush.js","webpack://mvt-basic-render/./node_modules/kdbush/src/range.js","webpack://mvt-basic-render/./node_modules/kdbush/src/sort.js","webpack://mvt-basic-render/./node_modules/kdbush/src/within.js","webpack://mvt-basic-render/./node_modules/object-assign/index.js","webpack://mvt-basic-render/./node_modules/pbf/index.js","webpack://mvt-basic-render/./node_modules/quickselect/quickselect.js","webpack://mvt-basic-render/./node_modules/supercluster/index.js","webpack://mvt-basic-render/./node_modules/tinyqueue/index.js","webpack://mvt-basic-render/./node_modules/vt-pbf/index.js","webpack://mvt-basic-render/./node_modules/vt-pbf/lib/geojson_wrapper.js","webpack://mvt-basic-render/./node_modules/wgs84/index.js","webpack://mvt-basic-render/./node_modules/@mapbox/whoots-js/index.mjs","webpack://mvt-basic-render/webpack/bootstrap","webpack://mvt-basic-render/webpack/runtime/define property getters","webpack://mvt-basic-render/webpack/runtime/global","webpack://mvt-basic-render/webpack/runtime/hasOwnProperty shorthand","webpack://mvt-basic-render/webpack/runtime/make namespace object","webpack://mvt-basic-render/./src/source/worker.js"],"sourcesContent":["var wgs84 = require('wgs84');\n\nmodule.exports.geometry = geometry;\nmodule.exports.ring = ringArea;\n\nfunction geometry(_) {\n    var area = 0, i;\n    switch (_.type) {\n        case 'Polygon':\n            return polygonArea(_.coordinates);\n        case 'MultiPolygon':\n            for (i = 0; i < _.coordinates.length; i++) {\n                area += polygonArea(_.coordinates[i]);\n            }\n            return area;\n        case 'Point':\n        case 'MultiPoint':\n        case 'LineString':\n        case 'MultiLineString':\n            return 0;\n        case 'GeometryCollection':\n            for (i = 0; i < _.geometries.length; i++) {\n                area += geometry(_.geometries[i]);\n            }\n            return area;\n    }\n}\n\nfunction polygonArea(coords) {\n    var area = 0;\n    if (coords && coords.length > 0) {\n        area += Math.abs(ringArea(coords[0]));\n        for (var i = 1; i < coords.length; i++) {\n            area -= Math.abs(ringArea(coords[i]));\n        }\n    }\n    return area;\n}\n\n/**\n * Calculate the approximate area of the polygon were it projected onto\n *     the earth.  Note that this area will be positive if ring is oriented\n *     clockwise, otherwise it will be negative.\n *\n * Reference:\n * Robert. G. Chamberlain and William H. Duquette, \"Some Algorithms for\n *     Polygons on a Sphere\", JPL Publication 07-03, Jet Propulsion\n *     Laboratory, Pasadena, CA, June 2007 http://trs-new.jpl.nasa.gov/dspace/handle/2014/40409\n *\n * Returns:\n * {float} The approximate signed geodesic area of the polygon in square\n *     meters.\n */\n\nfunction ringArea(coords) {\n    var p1, p2, p3, lowerIndex, middleIndex, upperIndex, i,\n    area = 0,\n    coordsLength = coords.length;\n\n    if (coordsLength > 2) {\n        for (i = 0; i < coordsLength; i++) {\n            if (i === coordsLength - 2) {// i = N-2\n                lowerIndex = coordsLength - 2;\n                middleIndex = coordsLength -1;\n                upperIndex = 0;\n            } else if (i === coordsLength - 1) {// i = N-1\n                lowerIndex = coordsLength - 1;\n                middleIndex = 0;\n                upperIndex = 1;\n            } else { // i = 0 to N-3\n                lowerIndex = i;\n                middleIndex = i+1;\n                upperIndex = i+2;\n            }\n            p1 = coords[lowerIndex];\n            p2 = coords[middleIndex];\n            p3 = coords[upperIndex];\n            area += ( rad(p3[0]) - rad(p1[0]) ) * Math.sin( rad(p2[1]));\n        }\n\n        area = area * wgs84.RADIUS * wgs84.RADIUS / 2;\n    }\n\n    return area;\n}\n\nfunction rad(_) {\n    return _ * Math.PI / 180;\n}","'use strict';\n\nmodule.exports = Point;\n\n/**\n * A standalone point geometry with useful accessor, comparison, and\n * modification methods.\n *\n * @class Point\n * @param {Number} x the x-coordinate. this could be longitude or screen\n * pixels, or any other sort of unit.\n * @param {Number} y the y-coordinate. this could be latitude or screen\n * pixels, or any other sort of unit.\n * @example\n * var point = new Point(-77, 38);\n */\nfunction Point(x, y) {\n    this.x = x;\n    this.y = y;\n}\n\nPoint.prototype = {\n\n    /**\n     * Clone this point, returning a new point that can be modified\n     * without affecting the old one.\n     * @return {Point} the clone\n     */\n    clone: function() { return new Point(this.x, this.y); },\n\n    /**\n     * Add this point's x & y coordinates to another point,\n     * yielding a new point.\n     * @param {Point} p the other point\n     * @return {Point} output point\n     */\n    add:     function(p) { return this.clone()._add(p); },\n\n    /**\n     * Subtract this point's x & y coordinates to from point,\n     * yielding a new point.\n     * @param {Point} p the other point\n     * @return {Point} output point\n     */\n    sub:     function(p) { return this.clone()._sub(p); },\n\n    /**\n     * Multiply this point's x & y coordinates by point,\n     * yielding a new point.\n     * @param {Point} p the other point\n     * @return {Point} output point\n     */\n    multByPoint:    function(p) { return this.clone()._multByPoint(p); },\n\n    /**\n     * Divide this point's x & y coordinates by point,\n     * yielding a new point.\n     * @param {Point} p the other point\n     * @return {Point} output point\n     */\n    divByPoint:     function(p) { return this.clone()._divByPoint(p); },\n\n    /**\n     * Multiply this point's x & y coordinates by a factor,\n     * yielding a new point.\n     * @param {Point} k factor\n     * @return {Point} output point\n     */\n    mult:    function(k) { return this.clone()._mult(k); },\n\n    /**\n     * Divide this point's x & y coordinates by a factor,\n     * yielding a new point.\n     * @param {Point} k factor\n     * @return {Point} output point\n     */\n    div:     function(k) { return this.clone()._div(k); },\n\n    /**\n     * Rotate this point around the 0, 0 origin by an angle a,\n     * given in radians\n     * @param {Number} a angle to rotate around, in radians\n     * @return {Point} output point\n     */\n    rotate:  function(a) { return this.clone()._rotate(a); },\n\n    /**\n     * Rotate this point around p point by an angle a,\n     * given in radians\n     * @param {Number} a angle to rotate around, in radians\n     * @param {Point} p Point to rotate around\n     * @return {Point} output point\n     */\n    rotateAround:  function(a,p) { return this.clone()._rotateAround(a,p); },\n\n    /**\n     * Multiply this point by a 4x1 transformation matrix\n     * @param {Array<Number>} m transformation matrix\n     * @return {Point} output point\n     */\n    matMult: function(m) { return this.clone()._matMult(m); },\n\n    /**\n     * Calculate this point but as a unit vector from 0, 0, meaning\n     * that the distance from the resulting point to the 0, 0\n     * coordinate will be equal to 1 and the angle from the resulting\n     * point to the 0, 0 coordinate will be the same as before.\n     * @return {Point} unit vector point\n     */\n    unit:    function() { return this.clone()._unit(); },\n\n    /**\n     * Compute a perpendicular point, where the new y coordinate\n     * is the old x coordinate and the new x coordinate is the old y\n     * coordinate multiplied by -1\n     * @return {Point} perpendicular point\n     */\n    perp:    function() { return this.clone()._perp(); },\n\n    /**\n     * Return a version of this point with the x & y coordinates\n     * rounded to integers.\n     * @return {Point} rounded point\n     */\n    round:   function() { return this.clone()._round(); },\n\n    /**\n     * Return the magitude of this point: this is the Euclidean\n     * distance from the 0, 0 coordinate to this point's x and y\n     * coordinates.\n     * @return {Number} magnitude\n     */\n    mag: function() {\n        return Math.sqrt(this.x * this.x + this.y * this.y);\n    },\n\n    /**\n     * Judge whether this point is equal to another point, returning\n     * true or false.\n     * @param {Point} other the other point\n     * @return {boolean} whether the points are equal\n     */\n    equals: function(other) {\n        return this.x === other.x &&\n               this.y === other.y;\n    },\n\n    /**\n     * Calculate the distance from this point to another point\n     * @param {Point} p the other point\n     * @return {Number} distance\n     */\n    dist: function(p) {\n        return Math.sqrt(this.distSqr(p));\n    },\n\n    /**\n     * Calculate the distance from this point to another point,\n     * without the square root step. Useful if you're comparing\n     * relative distances.\n     * @param {Point} p the other point\n     * @return {Number} distance\n     */\n    distSqr: function(p) {\n        var dx = p.x - this.x,\n            dy = p.y - this.y;\n        return dx * dx + dy * dy;\n    },\n\n    /**\n     * Get the angle from the 0, 0 coordinate to this point, in radians\n     * coordinates.\n     * @return {Number} angle\n     */\n    angle: function() {\n        return Math.atan2(this.y, this.x);\n    },\n\n    /**\n     * Get the angle from this point to another point, in radians\n     * @param {Point} b the other point\n     * @return {Number} angle\n     */\n    angleTo: function(b) {\n        return Math.atan2(this.y - b.y, this.x - b.x);\n    },\n\n    /**\n     * Get the angle between this point and another point, in radians\n     * @param {Point} b the other point\n     * @return {Number} angle\n     */\n    angleWith: function(b) {\n        return this.angleWithSep(b.x, b.y);\n    },\n\n    /*\n     * Find the angle of the two vectors, solving the formula for\n     * the cross product a x b = |a||b|sin(θ) for θ.\n     * @param {Number} x the x-coordinate\n     * @param {Number} y the y-coordinate\n     * @return {Number} the angle in radians\n     */\n    angleWithSep: function(x, y) {\n        return Math.atan2(\n            this.x * y - this.y * x,\n            this.x * x + this.y * y);\n    },\n\n    _matMult: function(m) {\n        var x = m[0] * this.x + m[1] * this.y,\n            y = m[2] * this.x + m[3] * this.y;\n        this.x = x;\n        this.y = y;\n        return this;\n    },\n\n    _add: function(p) {\n        this.x += p.x;\n        this.y += p.y;\n        return this;\n    },\n\n    _sub: function(p) {\n        this.x -= p.x;\n        this.y -= p.y;\n        return this;\n    },\n\n    _mult: function(k) {\n        this.x *= k;\n        this.y *= k;\n        return this;\n    },\n\n    _div: function(k) {\n        this.x /= k;\n        this.y /= k;\n        return this;\n    },\n\n    _multByPoint: function(p) {\n        this.x *= p.x;\n        this.y *= p.y;\n        return this;\n    },\n\n    _divByPoint: function(p) {\n        this.x /= p.x;\n        this.y /= p.y;\n        return this;\n    },\n\n    _unit: function() {\n        this._div(this.mag());\n        return this;\n    },\n\n    _perp: function() {\n        var y = this.y;\n        this.y = this.x;\n        this.x = -y;\n        return this;\n    },\n\n    _rotate: function(angle) {\n        var cos = Math.cos(angle),\n            sin = Math.sin(angle),\n            x = cos * this.x - sin * this.y,\n            y = sin * this.x + cos * this.y;\n        this.x = x;\n        this.y = y;\n        return this;\n    },\n\n    _rotateAround: function(angle, p) {\n        var cos = Math.cos(angle),\n            sin = Math.sin(angle),\n            x = p.x + cos * (this.x - p.x) - sin * (this.y - p.y),\n            y = p.y + sin * (this.x - p.x) + cos * (this.y - p.y);\n        this.x = x;\n        this.y = y;\n        return this;\n    },\n\n    _round: function() {\n        this.x = Math.round(this.x);\n        this.y = Math.round(this.y);\n        return this;\n    }\n};\n\n/**\n * Construct a point from an array if necessary, otherwise if the input\n * is already a Point, or an unknown type, return it unchanged\n * @param {Array<Number>|Point|*} a any kind of input value\n * @return {Point} constructed point, or passed-through value.\n * @example\n * // this\n * var point = Point.convert([0, 1]);\n * // is equivalent to\n * var point = new Point(0, 1);\n */\nPoint.convert = function (a) {\n    if (a instanceof Point) {\n        return a;\n    }\n    if (Array.isArray(a)) {\n        return new Point(a[0], a[1]);\n    }\n    return a;\n};\n","(function (global, factory) {\n\ttypeof exports === 'object' && typeof module !== 'undefined' ? module.exports = factory() :\n\ttypeof define === 'function' && define.amd ? define(factory) :\n\t(global.ShelfPack = factory());\n}(this, (function () {\n\n/**\n * Create a new ShelfPack bin allocator.\n *\n * Uses the Shelf Best Height Fit algorithm from\n * http://clb.demon.fi/files/RectangleBinPack.pdf\n *\n * @class  ShelfPack\n * @param  {number}  [w=64]  Initial width of the sprite\n * @param  {number}  [h=64]  Initial width of the sprite\n * @param  {Object}  [options]\n * @param  {boolean} [options.autoResize=false]  If `true`, the sprite will automatically grow\n * @example\n * var sprite = new ShelfPack(64, 64, { autoResize: false });\n */\nfunction ShelfPack$1(w, h, options) {\n    options = options || {};\n    this.w = w || 64;\n    this.h = h || 64;\n    this.autoResize = !!options.autoResize;\n    this.shelves = [];\n    this.freebins = [];\n    this.stats = {};\n    this.bins = {};\n    this.maxId = 0;\n}\n\n\n/**\n * Batch pack multiple bins into the sprite.\n *\n * @param   {Object[]} bins       Array of requested bins - each object should have `width`, `height` (or `w`, `h`) properties\n * @param   {number}   bins[].w   Requested bin width\n * @param   {number}   bins[].h   Requested bin height\n * @param   {Object}   [options]\n * @param   {boolean}  [options.inPlace=false] If `true`, the supplied bin objects will be updated inplace with `x` and `y` properties\n * @returns {Bin[]}    Array of allocated Bins - each Bin is an object with `id`, `x`, `y`, `w`, `h` properties\n * @example\n * var bins = [\n *     { id: 1, w: 12, h: 12 },\n *     { id: 2, w: 12, h: 16 },\n *     { id: 3, w: 12, h: 24 }\n * ];\n * var results = sprite.pack(bins, { inPlace: false });\n */\nShelfPack$1.prototype.pack = function(bins, options) {\n    bins = [].concat(bins);\n    options = options || {};\n\n    var results = [],\n        w, h, id, allocation;\n\n    for (var i = 0; i < bins.length; i++) {\n        w  = bins[i].w || bins[i].width;\n        h  = bins[i].h || bins[i].height;\n        id = bins[i].id;\n\n        if (w && h) {\n            allocation = this.packOne(w, h, id);\n            if (!allocation) {\n                continue;\n            }\n            if (options.inPlace) {\n                bins[i].x  = allocation.x;\n                bins[i].y  = allocation.y;\n                bins[i].id = allocation.id;\n            }\n            results.push(allocation);\n        }\n    }\n\n    this.shrink();\n\n    return results;\n};\n\n\n/**\n * Pack a single bin into the sprite.\n *\n * Each bin will have a unique identitifer.\n * If no identifier is supplied in the `id` parameter, one will be created.\n * Note: The supplied `id` is used as an object index, so numeric values are fastest!\n *\n * Bins are automatically refcounted (i.e. a newly packed Bin will have a refcount of 1).\n * When a bin is no longer needed, use the `ShelfPack.unref` function to mark it\n *   as unused.  When a Bin's refcount decrements to 0, the Bin will be marked\n *   as free and its space may be reused by the packing code.\n *\n * @param    {number}         w      Width of the bin to allocate\n * @param    {number}         h      Height of the bin to allocate\n * @param    {number|string}  [id]   Unique identifier for this bin, (if unsupplied, assume it's a new bin and create an id)\n * @returns  {Bin}            Bin object with `id`, `x`, `y`, `w`, `h` properties, or `null` if allocation failed\n * @example\n * var results = sprite.packOne(12, 16, 'a');\n */\nShelfPack$1.prototype.packOne = function(w, h, id) {\n    var best = { freebin: -1, shelf: -1, waste: Infinity },\n        y = 0,\n        bin, shelf, waste, i;\n\n    // if id was supplied, attempt a lookup..\n    if (typeof id === 'string' || typeof id === 'number') {\n        bin = this.getBin(id);\n        if (bin) {              // we packed this bin already\n            this.ref(bin);\n            return bin;\n        }\n        if (typeof id === 'number') {\n            this.maxId = Math.max(id, this.maxId);\n        }\n    } else {\n        id = ++this.maxId;\n    }\n\n    // First try to reuse a free bin..\n    for (i = 0; i < this.freebins.length; i++) {\n        bin = this.freebins[i];\n\n        // exactly the right height and width, use it..\n        if (h === bin.maxh && w === bin.maxw) {\n            return this.allocFreebin(i, w, h, id);\n        }\n        // not enough height or width, skip it..\n        if (h > bin.maxh || w > bin.maxw) {\n            continue;\n        }\n        // extra height or width, minimize wasted area..\n        if (h <= bin.maxh && w <= bin.maxw) {\n            waste = (bin.maxw * bin.maxh) - (w * h);\n            if (waste < best.waste) {\n                best.waste = waste;\n                best.freebin = i;\n            }\n        }\n    }\n\n    // Next find the best shelf..\n    for (i = 0; i < this.shelves.length; i++) {\n        shelf = this.shelves[i];\n        y += shelf.h;\n\n        // not enough width on this shelf, skip it..\n        if (w > shelf.free) {\n            continue;\n        }\n        // exactly the right height, pack it..\n        if (h === shelf.h) {\n            return this.allocShelf(i, w, h, id);\n        }\n        // not enough height, skip it..\n        if (h > shelf.h) {\n            continue;\n        }\n        // extra height, minimize wasted area..\n        if (h < shelf.h) {\n            waste = (shelf.h - h) * w;\n            if (waste < best.waste) {\n                best.freebin = -1;\n                best.waste = waste;\n                best.shelf = i;\n            }\n        }\n    }\n\n    if (best.freebin !== -1) {\n        return this.allocFreebin(best.freebin, w, h, id);\n    }\n\n    if (best.shelf !== -1) {\n        return this.allocShelf(best.shelf, w, h, id);\n    }\n\n    // No free bins or shelves.. add shelf..\n    if (h <= (this.h - y) && w <= this.w) {\n        shelf = new Shelf(y, this.w, h);\n        return this.allocShelf(this.shelves.push(shelf) - 1, w, h, id);\n    }\n\n    // No room for more shelves..\n    // If `autoResize` option is set, grow the sprite as follows:\n    //  * double whichever sprite dimension is smaller (`w1` or `h1`)\n    //  * if sprite dimensions are equal, grow width before height\n    //  * accomodate very large bin requests (big `w` or `h`)\n    if (this.autoResize) {\n        var h1, h2, w1, w2;\n\n        h1 = h2 = this.h;\n        w1 = w2 = this.w;\n\n        if (w1 <= h1 || w > w1) {   // grow width..\n            w2 = Math.max(w, w1) * 2;\n        }\n        if (h1 < w1 || h > h1) {    // grow height..\n            h2 = Math.max(h, h1) * 2;\n        }\n\n        this.resize(w2, h2);\n        return this.packOne(w, h, id);  // retry\n    }\n\n    return null;\n};\n\n\n/**\n * Called by packOne() to allocate a bin by reusing an existing freebin\n *\n * @private\n * @param    {number}         index  Index into the `this.freebins` array\n * @param    {number}         w      Width of the bin to allocate\n * @param    {number}         h      Height of the bin to allocate\n * @param    {number|string}  id     Unique identifier for this bin\n * @returns  {Bin}            Bin object with `id`, `x`, `y`, `w`, `h` properties\n * @example\n * var bin = sprite.allocFreebin(0, 12, 16, 'a');\n */\nShelfPack$1.prototype.allocFreebin = function (index, w, h, id) {\n    var bin = this.freebins.splice(index, 1)[0];\n    bin.id = id;\n    bin.w = w;\n    bin.h = h;\n    bin.refcount = 0;\n    this.bins[id] = bin;\n    this.ref(bin);\n    return bin;\n};\n\n\n/**\n * Called by `packOne() to allocate bin on an existing shelf\n *\n * @private\n * @param    {number}         index  Index into the `this.shelves` array\n * @param    {number}         w      Width of the bin to allocate\n * @param    {number}         h      Height of the bin to allocate\n * @param    {number|string}  id     Unique identifier for this bin\n * @returns  {Bin}            Bin object with `id`, `x`, `y`, `w`, `h` properties\n * @example\n * var results = sprite.allocShelf(0, 12, 16, 'a');\n */\nShelfPack$1.prototype.allocShelf = function(index, w, h, id) {\n    var shelf = this.shelves[index];\n    var bin = shelf.alloc(w, h, id);\n    this.bins[id] = bin;\n    this.ref(bin);\n    return bin;\n};\n\n\n/**\n * Shrink the width/height of the sprite to the bare minimum.\n * Since shelf-pack doubles first width, then height when running out of shelf space\n * this can result in fairly large unused space both in width and height if that happens\n * towards the end of bin packing.\n */\nShelfPack$1.prototype.shrink = function() {\n    if (this.shelves.length > 0) {\n        var w2 = 0;\n        var h2 = 0;\n\n        for (var j = 0; j < this.shelves.length; j++) {\n            var shelf = this.shelves[j];\n            h2 += shelf.h;\n            w2 = Math.max(shelf.w - shelf.free, w2);\n        }\n\n        this.resize(w2, h2);\n    }\n};\n\n\n/**\n * Return a packed bin given its id, or undefined if the id is not found\n *\n * @param    {number|string}  id  Unique identifier for this bin,\n * @returns  {Bin}            The requested bin, or undefined if not yet packed\n * @example\n * var b = sprite.getBin('a');\n */\nShelfPack$1.prototype.getBin = function(id) {\n    return this.bins[id];\n};\n\n\n/**\n * Increment the ref count of a bin and update statistics.\n *\n * @param    {Bin}     bin  Bin instance\n * @returns  {number}  New refcount of the bin\n * @example\n * var bin = sprite.getBin('a');\n * sprite.ref(bin);\n */\nShelfPack$1.prototype.ref = function(bin) {\n    if (++bin.refcount === 1) {   // a new Bin.. record height in stats historgram..\n        var h = bin.h;\n        this.stats[h] = (this.stats[h] | 0) + 1;\n    }\n\n    return bin.refcount;\n};\n\n\n/**\n * Decrement the ref count of a bin and update statistics.\n * The bin will be automatically marked as free space once the refcount reaches 0.\n *\n * @param    {Bin}     bin  Bin instance\n * @returns  {number}  New refcount of the bin\n * @example\n * var bin = sprite.getBin('a');\n * sprite.unref(bin);\n */\nShelfPack$1.prototype.unref = function(bin) {\n    if (bin.refcount === 0) {\n        return 0;\n    }\n\n    if (--bin.refcount === 0) {\n        this.stats[bin.h]--;\n        delete this.bins[bin.id];\n        this.freebins.push(bin);\n    }\n\n    return bin.refcount;\n};\n\n\n/**\n * Clear the sprite.  Resets everything and resets statistics.\n *\n * @example\n * sprite.clear();\n */\nShelfPack$1.prototype.clear = function() {\n    this.shelves = [];\n    this.freebins = [];\n    this.stats = {};\n    this.bins = {};\n    this.maxId = 0;\n};\n\n\n/**\n * Resize the sprite.\n *\n * @param   {number}  w  Requested new sprite width\n * @param   {number}  h  Requested new sprite height\n * @returns {boolean} `true` if resize succeeded, `false` if failed\n * @example\n * sprite.resize(256, 256);\n */\nShelfPack$1.prototype.resize = function(w, h) {\n    this.w = w;\n    this.h = h;\n    for (var i = 0; i < this.shelves.length; i++) {\n        this.shelves[i].resize(w);\n    }\n    return true;\n};\n\n\n/**\n * Create a new Shelf.\n *\n * @private\n * @class  Shelf\n * @param  {number}  y   Top coordinate of the new shelf\n * @param  {number}  w   Width of the new shelf\n * @param  {number}  h   Height of the new shelf\n * @example\n * var shelf = new Shelf(64, 512, 24);\n */\nfunction Shelf(y, w, h) {\n    this.x = 0;\n    this.y = y;\n    this.w = this.free = w;\n    this.h = h;\n}\n\n\n/**\n * Allocate a single bin into the shelf.\n *\n * @private\n * @param   {number}         w   Width of the bin to allocate\n * @param   {number}         h   Height of the bin to allocate\n * @param   {number|string}  id  Unique id of the bin to allocate\n * @returns {Bin}            Bin object with `id`, `x`, `y`, `w`, `h` properties, or `null` if allocation failed\n * @example\n * shelf.alloc(12, 16, 'a');\n */\nShelf.prototype.alloc = function(w, h, id) {\n    if (w > this.free || h > this.h) {\n        return null;\n    }\n    var x = this.x;\n    this.x += w;\n    this.free -= w;\n    return new Bin(id, x, this.y, w, h, w, this.h);\n};\n\n\n/**\n * Resize the shelf.\n *\n * @private\n * @param   {number}  w  Requested new width of the shelf\n * @returns {boolean}    true\n * @example\n * shelf.resize(512);\n */\nShelf.prototype.resize = function(w) {\n    this.free += (w - this.w);\n    this.w = w;\n    return true;\n};\n\n\n/**\n * Create a new Bin object.\n *\n * @class  Bin\n * @param  {number|string}  id      Unique id of the bin\n * @param  {number}         x       Left coordinate of the bin\n * @param  {number}         y       Top coordinate of the bin\n * @param  {number}         w       Width of the bin\n * @param  {number}         h       Height of the bin\n * @param  {number}         [maxw]  Max width of the bin (defaults to `w` if not provided)\n * @param  {number}         [maxh]  Max height of the bin (defaults to `h` if not provided)\n * @example\n * var bin = new Bin('a', 0, 0, 12, 16);\n */\nfunction Bin(id, x, y, w, h, maxw, maxh) {\n    this.id = id;\n    this.x  = x;\n    this.y  = y;\n    this.w  = w;\n    this.h  = h;\n    this.maxw = maxw || w;\n    this.maxh = maxh || h;\n    this.refcount = 0;\n}\n\nreturn ShelfPack$1;\n\n})));\n","/*\n * Copyright (C) 2008 Apple Inc. All Rights Reserved.\n *\n * Redistribution and use in source and binary forms, with or without\n * modification, are permitted provided that the following conditions\n * are met:\n * 1. Redistributions of source code must retain the above copyright\n *    notice, this list of conditions and the following disclaimer.\n * 2. Redistributions in binary form must reproduce the above copyright\n *    notice, this list of conditions and the following disclaimer in the\n *    documentation and/or other materials provided with the distribution.\n *\n * THIS SOFTWARE IS PROVIDED BY APPLE INC. ``AS IS'' AND ANY\n * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE\n * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR\n * PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL APPLE INC. OR\n * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,\n * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,\n * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR\n * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY\n * OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\n * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n *\n * Ported from Webkit\n * http://svn.webkit.org/repository/webkit/trunk/Source/WebCore/platform/graphics/UnitBezier.h\n */\n\nmodule.exports = UnitBezier;\n\nfunction UnitBezier(p1x, p1y, p2x, p2y) {\n    // Calculate the polynomial coefficients, implicit first and last control points are (0,0) and (1,1).\n    this.cx = 3.0 * p1x;\n    this.bx = 3.0 * (p2x - p1x) - this.cx;\n    this.ax = 1.0 - this.cx - this.bx;\n\n    this.cy = 3.0 * p1y;\n    this.by = 3.0 * (p2y - p1y) - this.cy;\n    this.ay = 1.0 - this.cy - this.by;\n\n    this.p1x = p1x;\n    this.p1y = p2y;\n    this.p2x = p2x;\n    this.p2y = p2y;\n}\n\nUnitBezier.prototype.sampleCurveX = function(t) {\n    // `ax t^3 + bx t^2 + cx t' expanded using Horner's rule.\n    return ((this.ax * t + this.bx) * t + this.cx) * t;\n};\n\nUnitBezier.prototype.sampleCurveY = function(t) {\n    return ((this.ay * t + this.by) * t + this.cy) * t;\n};\n\nUnitBezier.prototype.sampleCurveDerivativeX = function(t) {\n    return (3.0 * this.ax * t + 2.0 * this.bx) * t + this.cx;\n};\n\nUnitBezier.prototype.solveCurveX = function(x, epsilon) {\n    if (typeof epsilon === 'undefined') epsilon = 1e-6;\n\n    var t0, t1, t2, x2, i;\n\n    // First try a few iterations of Newton's method -- normally very fast.\n    for (t2 = x, i = 0; i < 8; i++) {\n\n        x2 = this.sampleCurveX(t2) - x;\n        if (Math.abs(x2) < epsilon) return t2;\n\n        var d2 = this.sampleCurveDerivativeX(t2);\n        if (Math.abs(d2) < 1e-6) break;\n\n        t2 = t2 - x2 / d2;\n    }\n\n    // Fall back to the bisection method for reliability.\n    t0 = 0.0;\n    t1 = 1.0;\n    t2 = x;\n\n    if (t2 < t0) return t0;\n    if (t2 > t1) return t1;\n\n    while (t0 < t1) {\n\n        x2 = this.sampleCurveX(t2);\n        if (Math.abs(x2 - x) < epsilon) return t2;\n\n        if (x > x2) {\n            t0 = t2;\n        } else {\n            t1 = t2;\n        }\n\n        t2 = (t1 - t0) * 0.5 + t0;\n    }\n\n    // Failure.\n    return t2;\n};\n\nUnitBezier.prototype.solve = function(x, epsilon) {\n    return this.sampleCurveY(this.solveCurveX(x, epsilon));\n};\n","module.exports.VectorTile = require('./lib/vectortile.js');\nmodule.exports.VectorTileFeature = require('./lib/vectortilefeature.js');\nmodule.exports.VectorTileLayer = require('./lib/vectortilelayer.js');\n","'use strict';\n\nvar VectorTileLayer = require('./vectortilelayer');\n\nmodule.exports = VectorTile;\n\nfunction VectorTile(pbf, end) {\n    this.layers = pbf.readFields(readTile, {}, end);\n}\n\nfunction readTile(tag, layers, pbf) {\n    if (tag === 3) {\n        var layer = new VectorTileLayer(pbf, pbf.readVarint() + pbf.pos);\n        if (layer.length) layers[layer.name] = layer;\n    }\n}\n\n","'use strict';\n\nvar Point = require('@mapbox/point-geometry');\n\nmodule.exports = VectorTileFeature;\n\nfunction VectorTileFeature(pbf, end, extent, keys, values) {\n    // Public\n    this.properties = {};\n    this.extent = extent;\n    this.type = 0;\n\n    // Private\n    this._pbf = pbf;\n    this._geometry = -1;\n    this._keys = keys;\n    this._values = values;\n\n    pbf.readFields(readFeature, this, end);\n}\n\nfunction readFeature(tag, feature, pbf) {\n    if (tag == 1) feature.id = pbf.readVarint();\n    else if (tag == 2) readTag(pbf, feature);\n    else if (tag == 3) feature.type = pbf.readVarint();\n    else if (tag == 4) feature._geometry = pbf.pos;\n}\n\nfunction readTag(pbf, feature) {\n    var end = pbf.readVarint() + pbf.pos;\n\n    while (pbf.pos < end) {\n        var key = feature._keys[pbf.readVarint()],\n            value = feature._values[pbf.readVarint()];\n        feature.properties[key] = value;\n    }\n}\n\nVectorTileFeature.types = ['Unknown', 'Point', 'LineString', 'Polygon'];\n\nVectorTileFeature.prototype.loadGeometry = function() {\n    var pbf = this._pbf;\n    pbf.pos = this._geometry;\n\n    var end = pbf.readVarint() + pbf.pos,\n        cmd = 1,\n        length = 0,\n        x = 0,\n        y = 0,\n        lines = [],\n        line;\n\n    while (pbf.pos < end) {\n        if (length <= 0) {\n            var cmdLen = pbf.readVarint();\n            cmd = cmdLen & 0x7;\n            length = cmdLen >> 3;\n        }\n\n        length--;\n\n        if (cmd === 1 || cmd === 2) {\n            x += pbf.readSVarint();\n            y += pbf.readSVarint();\n\n            if (cmd === 1) { // moveTo\n                if (line) lines.push(line);\n                line = [];\n            }\n\n            line.push(new Point(x, y));\n\n        } else if (cmd === 7) {\n\n            // Workaround for https://github.com/mapbox/mapnik-vector-tile/issues/90\n            if (line) {\n                line.push(line[0].clone()); // closePolygon\n            }\n\n        } else {\n            throw new Error('unknown command ' + cmd);\n        }\n    }\n\n    if (line) lines.push(line);\n\n    return lines;\n};\n\nVectorTileFeature.prototype.bbox = function() {\n    var pbf = this._pbf;\n    pbf.pos = this._geometry;\n\n    var end = pbf.readVarint() + pbf.pos,\n        cmd = 1,\n        length = 0,\n        x = 0,\n        y = 0,\n        x1 = Infinity,\n        x2 = -Infinity,\n        y1 = Infinity,\n        y2 = -Infinity;\n\n    while (pbf.pos < end) {\n        if (length <= 0) {\n            var cmdLen = pbf.readVarint();\n            cmd = cmdLen & 0x7;\n            length = cmdLen >> 3;\n        }\n\n        length--;\n\n        if (cmd === 1 || cmd === 2) {\n            x += pbf.readSVarint();\n            y += pbf.readSVarint();\n            if (x < x1) x1 = x;\n            if (x > x2) x2 = x;\n            if (y < y1) y1 = y;\n            if (y > y2) y2 = y;\n\n        } else if (cmd !== 7) {\n            throw new Error('unknown command ' + cmd);\n        }\n    }\n\n    return [x1, y1, x2, y2];\n};\n\nVectorTileFeature.prototype.toGeoJSON = function(x, y, z) {\n    var size = this.extent * Math.pow(2, z),\n        x0 = this.extent * x,\n        y0 = this.extent * y,\n        coords = this.loadGeometry(),\n        type = VectorTileFeature.types[this.type],\n        i, j;\n\n    function project(line) {\n        for (var j = 0; j < line.length; j++) {\n            var p = line[j], y2 = 180 - (p.y + y0) * 360 / size;\n            line[j] = [\n                (p.x + x0) * 360 / size - 180,\n                360 / Math.PI * Math.atan(Math.exp(y2 * Math.PI / 180)) - 90\n            ];\n        }\n    }\n\n    switch (this.type) {\n    case 1:\n        var points = [];\n        for (i = 0; i < coords.length; i++) {\n            points[i] = coords[i][0];\n        }\n        coords = points;\n        project(coords);\n        break;\n\n    case 2:\n        for (i = 0; i < coords.length; i++) {\n            project(coords[i]);\n        }\n        break;\n\n    case 3:\n        coords = classifyRings(coords);\n        for (i = 0; i < coords.length; i++) {\n            for (j = 0; j < coords[i].length; j++) {\n                project(coords[i][j]);\n            }\n        }\n        break;\n    }\n\n    if (coords.length === 1) {\n        coords = coords[0];\n    } else {\n        type = 'Multi' + type;\n    }\n\n    var result = {\n        type: \"Feature\",\n        geometry: {\n            type: type,\n            coordinates: coords\n        },\n        properties: this.properties\n    };\n\n    if ('id' in this) {\n        result.id = this.id;\n    }\n\n    return result;\n};\n\n// classifies an array of rings into polygons with outer rings and holes\n\nfunction classifyRings(rings) {\n    var len = rings.length;\n\n    if (len <= 1) return [rings];\n\n    var polygons = [],\n        polygon,\n        ccw;\n\n    for (var i = 0; i < len; i++) {\n        var area = signedArea(rings[i]);\n        if (area === 0) continue;\n\n        if (ccw === undefined) ccw = area < 0;\n\n        if (ccw === area < 0) {\n            if (polygon) polygons.push(polygon);\n            polygon = [rings[i]];\n\n        } else {\n            polygon.push(rings[i]);\n        }\n    }\n    if (polygon) polygons.push(polygon);\n\n    return polygons;\n}\n\nfunction signedArea(ring) {\n    var sum = 0;\n    for (var i = 0, len = ring.length, j = len - 1, p1, p2; i < len; j = i++) {\n        p1 = ring[i];\n        p2 = ring[j];\n        sum += (p2.x - p1.x) * (p1.y + p2.y);\n    }\n    return sum;\n}\n","'use strict';\n\nvar VectorTileFeature = require('./vectortilefeature.js');\n\nmodule.exports = VectorTileLayer;\n\nfunction VectorTileLayer(pbf, end) {\n    // Public\n    this.version = 1;\n    this.name = null;\n    this.extent = 4096;\n    this.length = 0;\n\n    // Private\n    this._pbf = pbf;\n    this._keys = [];\n    this._values = [];\n    this._features = [];\n\n    pbf.readFields(readLayer, this, end);\n\n    this.length = this._features.length;\n}\n\nfunction readLayer(tag, layer, pbf) {\n    if (tag === 15) layer.version = pbf.readVarint();\n    else if (tag === 1) layer.name = pbf.readString();\n    else if (tag === 5) layer.extent = pbf.readVarint();\n    else if (tag === 2) layer._features.push(pbf.pos);\n    else if (tag === 3) layer._keys.push(pbf.readString());\n    else if (tag === 4) layer._values.push(readValueMessage(pbf));\n}\n\nfunction readValueMessage(pbf) {\n    var value = null,\n        end = pbf.readVarint() + pbf.pos;\n\n    while (pbf.pos < end) {\n        var tag = pbf.readVarint() >> 3;\n\n        value = tag === 1 ? pbf.readString() :\n            tag === 2 ? pbf.readFloat() :\n            tag === 3 ? pbf.readDouble() :\n            tag === 4 ? pbf.readVarint64() :\n            tag === 5 ? pbf.readVarint() :\n            tag === 6 ? pbf.readSVarint() :\n            tag === 7 ? pbf.readBoolean() : null;\n    }\n\n    return value;\n}\n\n// return feature `i` from this layer as a `VectorTileFeature`\nVectorTileLayer.prototype.feature = function(i) {\n    if (i < 0 || i >= this._features.length) throw new Error('feature index out of bounds');\n\n    this._pbf.pos = this._features[i];\n\n    var end = this._pbf.readVarint() + this._pbf.pos;\n    return new VectorTileFeature(this._pbf, end, this.extent, this._keys, this._values);\n};\n","'use strict';\n\nvar objectAssign = require('object-assign');\n\n// compare and isBuffer taken from https://github.com/feross/buffer/blob/680e9e5e488f22aac27599a57dc844a6315928dd/index.js\n// original notice:\n\n/*!\n * The buffer module from node.js, for the browser.\n *\n * @author   Feross Aboukhadijeh <feross@feross.org> <http://feross.org>\n * @license  MIT\n */\nfunction compare(a, b) {\n  if (a === b) {\n    return 0;\n  }\n\n  var x = a.length;\n  var y = b.length;\n\n  for (var i = 0, len = Math.min(x, y); i < len; ++i) {\n    if (a[i] !== b[i]) {\n      x = a[i];\n      y = b[i];\n      break;\n    }\n  }\n\n  if (x < y) {\n    return -1;\n  }\n  if (y < x) {\n    return 1;\n  }\n  return 0;\n}\nfunction isBuffer(b) {\n  if (global.Buffer && typeof global.Buffer.isBuffer === 'function') {\n    return global.Buffer.isBuffer(b);\n  }\n  return !!(b != null && b._isBuffer);\n}\n\n// based on node assert, original notice:\n// NB: The URL to the CommonJS spec is kept just for tradition.\n//     node-assert has evolved a lot since then, both in API and behavior.\n\n// http://wiki.commonjs.org/wiki/Unit_Testing/1.0\n//\n// THIS IS NOT TESTED NOR LIKELY TO WORK OUTSIDE V8!\n//\n// Originally from narwhal.js (http://narwhaljs.org)\n// Copyright (c) 2009 Thomas Robinson <280north.com>\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the 'Software'), to\n// deal in the Software without restriction, including without limitation the\n// rights to use, copy, modify, merge, publish, distribute, sublicense, and/or\n// sell copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n//\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED 'AS IS', WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN\n// ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION\n// WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.\n\nvar util = require('util/');\nvar hasOwn = Object.prototype.hasOwnProperty;\nvar pSlice = Array.prototype.slice;\nvar functionsHaveNames = (function () {\n  return function foo() {}.name === 'foo';\n}());\nfunction pToString (obj) {\n  return Object.prototype.toString.call(obj);\n}\nfunction isView(arrbuf) {\n  if (isBuffer(arrbuf)) {\n    return false;\n  }\n  if (typeof global.ArrayBuffer !== 'function') {\n    return false;\n  }\n  if (typeof ArrayBuffer.isView === 'function') {\n    return ArrayBuffer.isView(arrbuf);\n  }\n  if (!arrbuf) {\n    return false;\n  }\n  if (arrbuf instanceof DataView) {\n    return true;\n  }\n  if (arrbuf.buffer && arrbuf.buffer instanceof ArrayBuffer) {\n    return true;\n  }\n  return false;\n}\n// 1. The assert module provides functions that throw\n// AssertionError's when particular conditions are not met. The\n// assert module must conform to the following interface.\n\nvar assert = module.exports = ok;\n\n// 2. The AssertionError is defined in assert.\n// new assert.AssertionError({ message: message,\n//                             actual: actual,\n//                             expected: expected })\n\nvar regex = /\\s*function\\s+([^\\(\\s]*)\\s*/;\n// based on https://github.com/ljharb/function.prototype.name/blob/adeeeec8bfcc6068b187d7d9fb3d5bb1d3a30899/implementation.js\nfunction getName(func) {\n  if (!util.isFunction(func)) {\n    return;\n  }\n  if (functionsHaveNames) {\n    return func.name;\n  }\n  var str = func.toString();\n  var match = str.match(regex);\n  return match && match[1];\n}\nassert.AssertionError = function AssertionError(options) {\n  this.name = 'AssertionError';\n  this.actual = options.actual;\n  this.expected = options.expected;\n  this.operator = options.operator;\n  if (options.message) {\n    this.message = options.message;\n    this.generatedMessage = false;\n  } else {\n    this.message = getMessage(this);\n    this.generatedMessage = true;\n  }\n  var stackStartFunction = options.stackStartFunction || fail;\n  if (Error.captureStackTrace) {\n    Error.captureStackTrace(this, stackStartFunction);\n  } else {\n    // non v8 browsers so we can have a stacktrace\n    var err = new Error();\n    if (err.stack) {\n      var out = err.stack;\n\n      // try to strip useless frames\n      var fn_name = getName(stackStartFunction);\n      var idx = out.indexOf('\\n' + fn_name);\n      if (idx >= 0) {\n        // once we have located the function frame\n        // we need to strip out everything before it (and its line)\n        var next_line = out.indexOf('\\n', idx + 1);\n        out = out.substring(next_line + 1);\n      }\n\n      this.stack = out;\n    }\n  }\n};\n\n// assert.AssertionError instanceof Error\nutil.inherits(assert.AssertionError, Error);\n\nfunction truncate(s, n) {\n  if (typeof s === 'string') {\n    return s.length < n ? s : s.slice(0, n);\n  } else {\n    return s;\n  }\n}\nfunction inspect(something) {\n  if (functionsHaveNames || !util.isFunction(something)) {\n    return util.inspect(something);\n  }\n  var rawname = getName(something);\n  var name = rawname ? ': ' + rawname : '';\n  return '[Function' +  name + ']';\n}\nfunction getMessage(self) {\n  return truncate(inspect(self.actual), 128) + ' ' +\n         self.operator + ' ' +\n         truncate(inspect(self.expected), 128);\n}\n\n// At present only the three keys mentioned above are used and\n// understood by the spec. Implementations or sub modules can pass\n// other keys to the AssertionError's constructor - they will be\n// ignored.\n\n// 3. All of the following functions must throw an AssertionError\n// when a corresponding condition is not met, with a message that\n// may be undefined if not provided.  All assertion methods provide\n// both the actual and expected values to the assertion error for\n// display purposes.\n\nfunction fail(actual, expected, message, operator, stackStartFunction) {\n  throw new assert.AssertionError({\n    message: message,\n    actual: actual,\n    expected: expected,\n    operator: operator,\n    stackStartFunction: stackStartFunction\n  });\n}\n\n// EXTENSION! allows for well behaved errors defined elsewhere.\nassert.fail = fail;\n\n// 4. Pure assertion tests whether a value is truthy, as determined\n// by !!guard.\n// assert.ok(guard, message_opt);\n// This statement is equivalent to assert.equal(true, !!guard,\n// message_opt);. To test strictly for the value true, use\n// assert.strictEqual(true, guard, message_opt);.\n\nfunction ok(value, message) {\n  if (!value) fail(value, true, message, '==', assert.ok);\n}\nassert.ok = ok;\n\n// 5. The equality assertion tests shallow, coercive equality with\n// ==.\n// assert.equal(actual, expected, message_opt);\n\nassert.equal = function equal(actual, expected, message) {\n  if (actual != expected) fail(actual, expected, message, '==', assert.equal);\n};\n\n// 6. The non-equality assertion tests for whether two objects are not equal\n// with != assert.notEqual(actual, expected, message_opt);\n\nassert.notEqual = function notEqual(actual, expected, message) {\n  if (actual == expected) {\n    fail(actual, expected, message, '!=', assert.notEqual);\n  }\n};\n\n// 7. The equivalence assertion tests a deep equality relation.\n// assert.deepEqual(actual, expected, message_opt);\n\nassert.deepEqual = function deepEqual(actual, expected, message) {\n  if (!_deepEqual(actual, expected, false)) {\n    fail(actual, expected, message, 'deepEqual', assert.deepEqual);\n  }\n};\n\nassert.deepStrictEqual = function deepStrictEqual(actual, expected, message) {\n  if (!_deepEqual(actual, expected, true)) {\n    fail(actual, expected, message, 'deepStrictEqual', assert.deepStrictEqual);\n  }\n};\n\nfunction _deepEqual(actual, expected, strict, memos) {\n  // 7.1. All identical values are equivalent, as determined by ===.\n  if (actual === expected) {\n    return true;\n  } else if (isBuffer(actual) && isBuffer(expected)) {\n    return compare(actual, expected) === 0;\n\n  // 7.2. If the expected value is a Date object, the actual value is\n  // equivalent if it is also a Date object that refers to the same time.\n  } else if (util.isDate(actual) && util.isDate(expected)) {\n    return actual.getTime() === expected.getTime();\n\n  // 7.3 If the expected value is a RegExp object, the actual value is\n  // equivalent if it is also a RegExp object with the same source and\n  // properties (`global`, `multiline`, `lastIndex`, `ignoreCase`).\n  } else if (util.isRegExp(actual) && util.isRegExp(expected)) {\n    return actual.source === expected.source &&\n           actual.global === expected.global &&\n           actual.multiline === expected.multiline &&\n           actual.lastIndex === expected.lastIndex &&\n           actual.ignoreCase === expected.ignoreCase;\n\n  // 7.4. Other pairs that do not both pass typeof value == 'object',\n  // equivalence is determined by ==.\n  } else if ((actual === null || typeof actual !== 'object') &&\n             (expected === null || typeof expected !== 'object')) {\n    return strict ? actual === expected : actual == expected;\n\n  // If both values are instances of typed arrays, wrap their underlying\n  // ArrayBuffers in a Buffer each to increase performance\n  // This optimization requires the arrays to have the same type as checked by\n  // Object.prototype.toString (aka pToString). Never perform binary\n  // comparisons for Float*Arrays, though, since e.g. +0 === -0 but their\n  // bit patterns are not identical.\n  } else if (isView(actual) && isView(expected) &&\n             pToString(actual) === pToString(expected) &&\n             !(actual instanceof Float32Array ||\n               actual instanceof Float64Array)) {\n    return compare(new Uint8Array(actual.buffer),\n                   new Uint8Array(expected.buffer)) === 0;\n\n  // 7.5 For all other Object pairs, including Array objects, equivalence is\n  // determined by having the same number of owned properties (as verified\n  // with Object.prototype.hasOwnProperty.call), the same set of keys\n  // (although not necessarily the same order), equivalent values for every\n  // corresponding key, and an identical 'prototype' property. Note: this\n  // accounts for both named and indexed properties on Arrays.\n  } else if (isBuffer(actual) !== isBuffer(expected)) {\n    return false;\n  } else {\n    memos = memos || {actual: [], expected: []};\n\n    var actualIndex = memos.actual.indexOf(actual);\n    if (actualIndex !== -1) {\n      if (actualIndex === memos.expected.indexOf(expected)) {\n        return true;\n      }\n    }\n\n    memos.actual.push(actual);\n    memos.expected.push(expected);\n\n    return objEquiv(actual, expected, strict, memos);\n  }\n}\n\nfunction isArguments(object) {\n  return Object.prototype.toString.call(object) == '[object Arguments]';\n}\n\nfunction objEquiv(a, b, strict, actualVisitedObjects) {\n  if (a === null || a === undefined || b === null || b === undefined)\n    return false;\n  // if one is a primitive, the other must be same\n  if (util.isPrimitive(a) || util.isPrimitive(b))\n    return a === b;\n  if (strict && Object.getPrototypeOf(a) !== Object.getPrototypeOf(b))\n    return false;\n  var aIsArgs = isArguments(a);\n  var bIsArgs = isArguments(b);\n  if ((aIsArgs && !bIsArgs) || (!aIsArgs && bIsArgs))\n    return false;\n  if (aIsArgs) {\n    a = pSlice.call(a);\n    b = pSlice.call(b);\n    return _deepEqual(a, b, strict);\n  }\n  var ka = objectKeys(a);\n  var kb = objectKeys(b);\n  var key, i;\n  // having the same number of owned properties (keys incorporates\n  // hasOwnProperty)\n  if (ka.length !== kb.length)\n    return false;\n  //the same set of keys (although not necessarily the same order),\n  ka.sort();\n  kb.sort();\n  //~~~cheap key test\n  for (i = ka.length - 1; i >= 0; i--) {\n    if (ka[i] !== kb[i])\n      return false;\n  }\n  //equivalent values for every corresponding key, and\n  //~~~possibly expensive deep test\n  for (i = ka.length - 1; i >= 0; i--) {\n    key = ka[i];\n    if (!_deepEqual(a[key], b[key], strict, actualVisitedObjects))\n      return false;\n  }\n  return true;\n}\n\n// 8. The non-equivalence assertion tests for any deep inequality.\n// assert.notDeepEqual(actual, expected, message_opt);\n\nassert.notDeepEqual = function notDeepEqual(actual, expected, message) {\n  if (_deepEqual(actual, expected, false)) {\n    fail(actual, expected, message, 'notDeepEqual', assert.notDeepEqual);\n  }\n};\n\nassert.notDeepStrictEqual = notDeepStrictEqual;\nfunction notDeepStrictEqual(actual, expected, message) {\n  if (_deepEqual(actual, expected, true)) {\n    fail(actual, expected, message, 'notDeepStrictEqual', notDeepStrictEqual);\n  }\n}\n\n\n// 9. The strict equality assertion tests strict equality, as determined by ===.\n// assert.strictEqual(actual, expected, message_opt);\n\nassert.strictEqual = function strictEqual(actual, expected, message) {\n  if (actual !== expected) {\n    fail(actual, expected, message, '===', assert.strictEqual);\n  }\n};\n\n// 10. The strict non-equality assertion tests for strict inequality, as\n// determined by !==.  assert.notStrictEqual(actual, expected, message_opt);\n\nassert.notStrictEqual = function notStrictEqual(actual, expected, message) {\n  if (actual === expected) {\n    fail(actual, expected, message, '!==', assert.notStrictEqual);\n  }\n};\n\nfunction expectedException(actual, expected) {\n  if (!actual || !expected) {\n    return false;\n  }\n\n  if (Object.prototype.toString.call(expected) == '[object RegExp]') {\n    return expected.test(actual);\n  }\n\n  try {\n    if (actual instanceof expected) {\n      return true;\n    }\n  } catch (e) {\n    // Ignore.  The instanceof check doesn't work for arrow functions.\n  }\n\n  if (Error.isPrototypeOf(expected)) {\n    return false;\n  }\n\n  return expected.call({}, actual) === true;\n}\n\nfunction _tryBlock(block) {\n  var error;\n  try {\n    block();\n  } catch (e) {\n    error = e;\n  }\n  return error;\n}\n\nfunction _throws(shouldThrow, block, expected, message) {\n  var actual;\n\n  if (typeof block !== 'function') {\n    throw new TypeError('\"block\" argument must be a function');\n  }\n\n  if (typeof expected === 'string') {\n    message = expected;\n    expected = null;\n  }\n\n  actual = _tryBlock(block);\n\n  message = (expected && expected.name ? ' (' + expected.name + ').' : '.') +\n            (message ? ' ' + message : '.');\n\n  if (shouldThrow && !actual) {\n    fail(actual, expected, 'Missing expected exception' + message);\n  }\n\n  var userProvidedMessage = typeof message === 'string';\n  var isUnwantedException = !shouldThrow && util.isError(actual);\n  var isUnexpectedException = !shouldThrow && actual && !expected;\n\n  if ((isUnwantedException &&\n      userProvidedMessage &&\n      expectedException(actual, expected)) ||\n      isUnexpectedException) {\n    fail(actual, expected, 'Got unwanted exception' + message);\n  }\n\n  if ((shouldThrow && actual && expected &&\n      !expectedException(actual, expected)) || (!shouldThrow && actual)) {\n    throw actual;\n  }\n}\n\n// 11. Expected to throw an error:\n// assert.throws(block, Error_opt, message_opt);\n\nassert.throws = function(block, /*optional*/error, /*optional*/message) {\n  _throws(true, block, error, message);\n};\n\n// EXTENSION! This is annoying to write outside this module.\nassert.doesNotThrow = function(block, /*optional*/error, /*optional*/message) {\n  _throws(false, block, error, message);\n};\n\nassert.ifError = function(err) { if (err) throw err; };\n\n// Expose a strict only variant of assert\nfunction strict(value, message) {\n  if (!value) fail(value, true, message, '==', strict);\n}\nassert.strict = objectAssign(strict, assert, {\n  equal: assert.strictEqual,\n  deepEqual: assert.deepStrictEqual,\n  notEqual: assert.notStrictEqual,\n  notDeepEqual: assert.notDeepStrictEqual\n});\nassert.strict.strict = assert.strict;\n\nvar objectKeys = Object.keys || function (obj) {\n  var keys = [];\n  for (var key in obj) {\n    if (hasOwn.call(obj, key)) keys.push(key);\n  }\n  return keys;\n};\n","if (typeof Object.create === 'function') {\n  // implementation from standard node.js 'util' module\n  module.exports = function inherits(ctor, superCtor) {\n    ctor.super_ = superCtor\n    ctor.prototype = Object.create(superCtor.prototype, {\n      constructor: {\n        value: ctor,\n        enumerable: false,\n        writable: true,\n        configurable: true\n      }\n    });\n  };\n} else {\n  // old school shim for old browsers\n  module.exports = function inherits(ctor, superCtor) {\n    ctor.super_ = superCtor\n    var TempCtor = function () {}\n    TempCtor.prototype = superCtor.prototype\n    ctor.prototype = new TempCtor()\n    ctor.prototype.constructor = ctor\n  }\n}\n","module.exports = function isBuffer(arg) {\n  return arg && typeof arg === 'object'\n    && typeof arg.copy === 'function'\n    && typeof arg.fill === 'function'\n    && typeof arg.readUInt8 === 'function';\n}","// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\nvar formatRegExp = /%[sdj%]/g;\nexports.format = function(f) {\n  if (!isString(f)) {\n    var objects = [];\n    for (var i = 0; i < arguments.length; i++) {\n      objects.push(inspect(arguments[i]));\n    }\n    return objects.join(' ');\n  }\n\n  var i = 1;\n  var args = arguments;\n  var len = args.length;\n  var str = String(f).replace(formatRegExp, function(x) {\n    if (x === '%%') return '%';\n    if (i >= len) return x;\n    switch (x) {\n      case '%s': return String(args[i++]);\n      case '%d': return Number(args[i++]);\n      case '%j':\n        try {\n          return JSON.stringify(args[i++]);\n        } catch (_) {\n          return '[Circular]';\n        }\n      default:\n        return x;\n    }\n  });\n  for (var x = args[i]; i < len; x = args[++i]) {\n    if (isNull(x) || !isObject(x)) {\n      str += ' ' + x;\n    } else {\n      str += ' ' + inspect(x);\n    }\n  }\n  return str;\n};\n\n\n// Mark that a method should not be used.\n// Returns a modified function which warns once by default.\n// If --no-deprecation is set, then it is a no-op.\nexports.deprecate = function(fn, msg) {\n  // Allow for deprecating things in the process of starting up.\n  if (isUndefined(global.process)) {\n    return function() {\n      return exports.deprecate(fn, msg).apply(this, arguments);\n    };\n  }\n\n  if (process.noDeprecation === true) {\n    return fn;\n  }\n\n  var warned = false;\n  function deprecated() {\n    if (!warned) {\n      if (process.throwDeprecation) {\n        throw new Error(msg);\n      } else if (process.traceDeprecation) {\n        console.trace(msg);\n      } else {\n        console.error(msg);\n      }\n      warned = true;\n    }\n    return fn.apply(this, arguments);\n  }\n\n  return deprecated;\n};\n\n\nvar debugs = {};\nvar debugEnviron;\nexports.debuglog = function(set) {\n  if (isUndefined(debugEnviron))\n    debugEnviron = process.env.NODE_DEBUG || '';\n  set = set.toUpperCase();\n  if (!debugs[set]) {\n    if (new RegExp('\\\\b' + set + '\\\\b', 'i').test(debugEnviron)) {\n      var pid = process.pid;\n      debugs[set] = function() {\n        var msg = exports.format.apply(exports, arguments);\n        console.error('%s %d: %s', set, pid, msg);\n      };\n    } else {\n      debugs[set] = function() {};\n    }\n  }\n  return debugs[set];\n};\n\n\n/**\n * Echos the value of a value. Trys to print the value out\n * in the best way possible given the different types.\n *\n * @param {Object} obj The object to print out.\n * @param {Object} opts Optional options object that alters the output.\n */\n/* legacy: obj, showHidden, depth, colors*/\nfunction inspect(obj, opts) {\n  // default options\n  var ctx = {\n    seen: [],\n    stylize: stylizeNoColor\n  };\n  // legacy...\n  if (arguments.length >= 3) ctx.depth = arguments[2];\n  if (arguments.length >= 4) ctx.colors = arguments[3];\n  if (isBoolean(opts)) {\n    // legacy...\n    ctx.showHidden = opts;\n  } else if (opts) {\n    // got an \"options\" object\n    exports._extend(ctx, opts);\n  }\n  // set default options\n  if (isUndefined(ctx.showHidden)) ctx.showHidden = false;\n  if (isUndefined(ctx.depth)) ctx.depth = 2;\n  if (isUndefined(ctx.colors)) ctx.colors = false;\n  if (isUndefined(ctx.customInspect)) ctx.customInspect = true;\n  if (ctx.colors) ctx.stylize = stylizeWithColor;\n  return formatValue(ctx, obj, ctx.depth);\n}\nexports.inspect = inspect;\n\n\n// http://en.wikipedia.org/wiki/ANSI_escape_code#graphics\ninspect.colors = {\n  'bold' : [1, 22],\n  'italic' : [3, 23],\n  'underline' : [4, 24],\n  'inverse' : [7, 27],\n  'white' : [37, 39],\n  'grey' : [90, 39],\n  'black' : [30, 39],\n  'blue' : [34, 39],\n  'cyan' : [36, 39],\n  'green' : [32, 39],\n  'magenta' : [35, 39],\n  'red' : [31, 39],\n  'yellow' : [33, 39]\n};\n\n// Don't use 'blue' not visible on cmd.exe\ninspect.styles = {\n  'special': 'cyan',\n  'number': 'yellow',\n  'boolean': 'yellow',\n  'undefined': 'grey',\n  'null': 'bold',\n  'string': 'green',\n  'date': 'magenta',\n  // \"name\": intentionally not styling\n  'regexp': 'red'\n};\n\n\nfunction stylizeWithColor(str, styleType) {\n  var style = inspect.styles[styleType];\n\n  if (style) {\n    return '\\u001b[' + inspect.colors[style][0] + 'm' + str +\n           '\\u001b[' + inspect.colors[style][1] + 'm';\n  } else {\n    return str;\n  }\n}\n\n\nfunction stylizeNoColor(str, styleType) {\n  return str;\n}\n\n\nfunction arrayToHash(array) {\n  var hash = {};\n\n  array.forEach(function(val, idx) {\n    hash[val] = true;\n  });\n\n  return hash;\n}\n\n\nfunction formatValue(ctx, value, recurseTimes) {\n  // Provide a hook for user-specified inspect functions.\n  // Check that value is an object with an inspect function on it\n  if (ctx.customInspect &&\n      value &&\n      isFunction(value.inspect) &&\n      // Filter out the util module, it's inspect function is special\n      value.inspect !== exports.inspect &&\n      // Also filter out any prototype objects using the circular check.\n      !(value.constructor && value.constructor.prototype === value)) {\n    var ret = value.inspect(recurseTimes, ctx);\n    if (!isString(ret)) {\n      ret = formatValue(ctx, ret, recurseTimes);\n    }\n    return ret;\n  }\n\n  // Primitive types cannot have properties\n  var primitive = formatPrimitive(ctx, value);\n  if (primitive) {\n    return primitive;\n  }\n\n  // Look up the keys of the object.\n  var keys = Object.keys(value);\n  var visibleKeys = arrayToHash(keys);\n\n  if (ctx.showHidden) {\n    keys = Object.getOwnPropertyNames(value);\n  }\n\n  // IE doesn't make error fields non-enumerable\n  // http://msdn.microsoft.com/en-us/library/ie/dww52sbt(v=vs.94).aspx\n  if (isError(value)\n      && (keys.indexOf('message') >= 0 || keys.indexOf('description') >= 0)) {\n    return formatError(value);\n  }\n\n  // Some type of object without properties can be shortcutted.\n  if (keys.length === 0) {\n    if (isFunction(value)) {\n      var name = value.name ? ': ' + value.name : '';\n      return ctx.stylize('[Function' + name + ']', 'special');\n    }\n    if (isRegExp(value)) {\n      return ctx.stylize(RegExp.prototype.toString.call(value), 'regexp');\n    }\n    if (isDate(value)) {\n      return ctx.stylize(Date.prototype.toString.call(value), 'date');\n    }\n    if (isError(value)) {\n      return formatError(value);\n    }\n  }\n\n  var base = '', array = false, braces = ['{', '}'];\n\n  // Make Array say that they are Array\n  if (isArray(value)) {\n    array = true;\n    braces = ['[', ']'];\n  }\n\n  // Make functions say that they are functions\n  if (isFunction(value)) {\n    var n = value.name ? ': ' + value.name : '';\n    base = ' [Function' + n + ']';\n  }\n\n  // Make RegExps say that they are RegExps\n  if (isRegExp(value)) {\n    base = ' ' + RegExp.prototype.toString.call(value);\n  }\n\n  // Make dates with properties first say the date\n  if (isDate(value)) {\n    base = ' ' + Date.prototype.toUTCString.call(value);\n  }\n\n  // Make error with message first say the error\n  if (isError(value)) {\n    base = ' ' + formatError(value);\n  }\n\n  if (keys.length === 0 && (!array || value.length == 0)) {\n    return braces[0] + base + braces[1];\n  }\n\n  if (recurseTimes < 0) {\n    if (isRegExp(value)) {\n      return ctx.stylize(RegExp.prototype.toString.call(value), 'regexp');\n    } else {\n      return ctx.stylize('[Object]', 'special');\n    }\n  }\n\n  ctx.seen.push(value);\n\n  var output;\n  if (array) {\n    output = formatArray(ctx, value, recurseTimes, visibleKeys, keys);\n  } else {\n    output = keys.map(function(key) {\n      return formatProperty(ctx, value, recurseTimes, visibleKeys, key, array);\n    });\n  }\n\n  ctx.seen.pop();\n\n  return reduceToSingleString(output, base, braces);\n}\n\n\nfunction formatPrimitive(ctx, value) {\n  if (isUndefined(value))\n    return ctx.stylize('undefined', 'undefined');\n  if (isString(value)) {\n    var simple = '\\'' + JSON.stringify(value).replace(/^\"|\"$/g, '')\n                                             .replace(/'/g, \"\\\\'\")\n                                             .replace(/\\\\\"/g, '\"') + '\\'';\n    return ctx.stylize(simple, 'string');\n  }\n  if (isNumber(value))\n    return ctx.stylize('' + value, 'number');\n  if (isBoolean(value))\n    return ctx.stylize('' + value, 'boolean');\n  // For some reason typeof null is \"object\", so special case here.\n  if (isNull(value))\n    return ctx.stylize('null', 'null');\n}\n\n\nfunction formatError(value) {\n  return '[' + Error.prototype.toString.call(value) + ']';\n}\n\n\nfunction formatArray(ctx, value, recurseTimes, visibleKeys, keys) {\n  var output = [];\n  for (var i = 0, l = value.length; i < l; ++i) {\n    if (hasOwnProperty(value, String(i))) {\n      output.push(formatProperty(ctx, value, recurseTimes, visibleKeys,\n          String(i), true));\n    } else {\n      output.push('');\n    }\n  }\n  keys.forEach(function(key) {\n    if (!key.match(/^\\d+$/)) {\n      output.push(formatProperty(ctx, value, recurseTimes, visibleKeys,\n          key, true));\n    }\n  });\n  return output;\n}\n\n\nfunction formatProperty(ctx, value, recurseTimes, visibleKeys, key, array) {\n  var name, str, desc;\n  desc = Object.getOwnPropertyDescriptor(value, key) || { value: value[key] };\n  if (desc.get) {\n    if (desc.set) {\n      str = ctx.stylize('[Getter/Setter]', 'special');\n    } else {\n      str = ctx.stylize('[Getter]', 'special');\n    }\n  } else {\n    if (desc.set) {\n      str = ctx.stylize('[Setter]', 'special');\n    }\n  }\n  if (!hasOwnProperty(visibleKeys, key)) {\n    name = '[' + key + ']';\n  }\n  if (!str) {\n    if (ctx.seen.indexOf(desc.value) < 0) {\n      if (isNull(recurseTimes)) {\n        str = formatValue(ctx, desc.value, null);\n      } else {\n        str = formatValue(ctx, desc.value, recurseTimes - 1);\n      }\n      if (str.indexOf('\\n') > -1) {\n        if (array) {\n          str = str.split('\\n').map(function(line) {\n            return '  ' + line;\n          }).join('\\n').substr(2);\n        } else {\n          str = '\\n' + str.split('\\n').map(function(line) {\n            return '   ' + line;\n          }).join('\\n');\n        }\n      }\n    } else {\n      str = ctx.stylize('[Circular]', 'special');\n    }\n  }\n  if (isUndefined(name)) {\n    if (array && key.match(/^\\d+$/)) {\n      return str;\n    }\n    name = JSON.stringify('' + key);\n    if (name.match(/^\"([a-zA-Z_][a-zA-Z_0-9]*)\"$/)) {\n      name = name.substr(1, name.length - 2);\n      name = ctx.stylize(name, 'name');\n    } else {\n      name = name.replace(/'/g, \"\\\\'\")\n                 .replace(/\\\\\"/g, '\"')\n                 .replace(/(^\"|\"$)/g, \"'\");\n      name = ctx.stylize(name, 'string');\n    }\n  }\n\n  return name + ': ' + str;\n}\n\n\nfunction reduceToSingleString(output, base, braces) {\n  var numLinesEst = 0;\n  var length = output.reduce(function(prev, cur) {\n    numLinesEst++;\n    if (cur.indexOf('\\n') >= 0) numLinesEst++;\n    return prev + cur.replace(/\\u001b\\[\\d\\d?m/g, '').length + 1;\n  }, 0);\n\n  if (length > 60) {\n    return braces[0] +\n           (base === '' ? '' : base + '\\n ') +\n           ' ' +\n           output.join(',\\n  ') +\n           ' ' +\n           braces[1];\n  }\n\n  return braces[0] + base + ' ' + output.join(', ') + ' ' + braces[1];\n}\n\n\n// NOTE: These type checking functions intentionally don't use `instanceof`\n// because it is fragile and can be easily faked with `Object.create()`.\nfunction isArray(ar) {\n  return Array.isArray(ar);\n}\nexports.isArray = isArray;\n\nfunction isBoolean(arg) {\n  return typeof arg === 'boolean';\n}\nexports.isBoolean = isBoolean;\n\nfunction isNull(arg) {\n  return arg === null;\n}\nexports.isNull = isNull;\n\nfunction isNullOrUndefined(arg) {\n  return arg == null;\n}\nexports.isNullOrUndefined = isNullOrUndefined;\n\nfunction isNumber(arg) {\n  return typeof arg === 'number';\n}\nexports.isNumber = isNumber;\n\nfunction isString(arg) {\n  return typeof arg === 'string';\n}\nexports.isString = isString;\n\nfunction isSymbol(arg) {\n  return typeof arg === 'symbol';\n}\nexports.isSymbol = isSymbol;\n\nfunction isUndefined(arg) {\n  return arg === void 0;\n}\nexports.isUndefined = isUndefined;\n\nfunction isRegExp(re) {\n  return isObject(re) && objectToString(re) === '[object RegExp]';\n}\nexports.isRegExp = isRegExp;\n\nfunction isObject(arg) {\n  return typeof arg === 'object' && arg !== null;\n}\nexports.isObject = isObject;\n\nfunction isDate(d) {\n  return isObject(d) && objectToString(d) === '[object Date]';\n}\nexports.isDate = isDate;\n\nfunction isError(e) {\n  return isObject(e) &&\n      (objectToString(e) === '[object Error]' || e instanceof Error);\n}\nexports.isError = isError;\n\nfunction isFunction(arg) {\n  return typeof arg === 'function';\n}\nexports.isFunction = isFunction;\n\nfunction isPrimitive(arg) {\n  return arg === null ||\n         typeof arg === 'boolean' ||\n         typeof arg === 'number' ||\n         typeof arg === 'string' ||\n         typeof arg === 'symbol' ||  // ES6 symbol\n         typeof arg === 'undefined';\n}\nexports.isPrimitive = isPrimitive;\n\nexports.isBuffer = require('./support/isBuffer');\n\nfunction objectToString(o) {\n  return Object.prototype.toString.call(o);\n}\n\n\nfunction pad(n) {\n  return n < 10 ? '0' + n.toString(10) : n.toString(10);\n}\n\n\nvar months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep',\n              'Oct', 'Nov', 'Dec'];\n\n// 26 Feb 16:19:34\nfunction timestamp() {\n  var d = new Date();\n  var time = [pad(d.getHours()),\n              pad(d.getMinutes()),\n              pad(d.getSeconds())].join(':');\n  return [d.getDate(), months[d.getMonth()], time].join(' ');\n}\n\n\n// log is just a thin wrapper to console.log that prepends a timestamp\nexports.log = function() {\n  console.log('%s - %s', timestamp(), exports.format.apply(exports, arguments));\n};\n\n\n/**\n * Inherit the prototype methods from one constructor into another.\n *\n * The Function.prototype.inherits from lang.js rewritten as a standalone\n * function (not on Function.prototype). NOTE: If this file is to be loaded\n * during bootstrapping this function needs to be rewritten using some native\n * functions as prototype setup using normal JavaScript does not work as\n * expected during bootstrapping (see mirror.js in r114903).\n *\n * @param {function} ctor Constructor function which needs to inherit the\n *     prototype.\n * @param {function} superCtor Constructor function to inherit prototype from.\n */\nexports.inherits = require('inherits');\n\nexports._extend = function(origin, add) {\n  // Don't do anything if add isn't an object\n  if (!add || !isObject(add)) return origin;\n\n  var keys = Object.keys(add);\n  var i = keys.length;\n  while (i--) {\n    origin[keys[i]] = add[keys[i]];\n  }\n  return origin;\n};\n\nfunction hasOwnProperty(obj, prop) {\n  return Object.prototype.hasOwnProperty.call(obj, prop);\n}\n","// This file is generated. Edit build/generate-struct-arrays.js, then run `yarn run codegen`.\n// @flow\n\nconst assert = require('assert');\nconst {StructArray} = require('../util/struct_array');\nconst {Struct} = require('../util/struct_array');\nconst {register} = require('../util/web_worker_transfer');\nconst Point = require('@mapbox/point-geometry');\n\n\r\n/**\r\n * Implementation of the StructArray layout:\r\n * [0]: Int16[2]\r\n *\r\n * @private\r\n */\r\nclass StructArrayLayout2i4 extends StructArray {\r\n    uint8: Uint8Array;\r\n    int16: Int16Array;\r\n\r\n    _refreshViews() {\r\n        this.uint8 = new Uint8Array(this.arrayBuffer);\r\n        this.int16 = new Int16Array(this.arrayBuffer);\r\n    }\r\n\r\n    emplaceBack(v0: number, v1: number) {\r\n        const i = this.length;\r\n        this.resize(i + 1);\r\n        const o2 = i * 2;\r\n        this.int16[o2 + 0] = v0;\r\n        this.int16[o2 + 1] = v1;\r\n        return i;\r\n    }\r\n\r\n}\r\n\r\nStructArrayLayout2i4.prototype.bytesPerElement = 4;\r\nregister('StructArrayLayout2i4', StructArrayLayout2i4);\r\n\n\r\n/**\r\n * Implementation of the StructArray layout:\r\n * [0]: Int16[4]\r\n *\r\n * @private\r\n */\r\nclass StructArrayLayout4i8 extends StructArray {\r\n    uint8: Uint8Array;\r\n    int16: Int16Array;\r\n\r\n    _refreshViews() {\r\n        this.uint8 = new Uint8Array(this.arrayBuffer);\r\n        this.int16 = new Int16Array(this.arrayBuffer);\r\n    }\r\n\r\n    emplaceBack(v0: number, v1: number, v2: number, v3: number) {\r\n        const i = this.length;\r\n        this.resize(i + 1);\r\n        const o2 = i * 4;\r\n        this.int16[o2 + 0] = v0;\r\n        this.int16[o2 + 1] = v1;\r\n        this.int16[o2 + 2] = v2;\r\n        this.int16[o2 + 3] = v3;\r\n        return i;\r\n    }\r\n\r\n}\r\n\r\nStructArrayLayout4i8.prototype.bytesPerElement = 8;\r\nregister('StructArrayLayout4i8', StructArrayLayout4i8);\r\n\n\r\n/**\r\n * Implementation of the StructArray layout:\r\n * [0]: Int16[2]\r\n * [4]: Int16[4]\r\n *\r\n * @private\r\n */\r\nclass StructArrayLayout2i4i12 extends StructArray {\r\n    uint8: Uint8Array;\r\n    int16: Int16Array;\r\n\r\n    _refreshViews() {\r\n        this.uint8 = new Uint8Array(this.arrayBuffer);\r\n        this.int16 = new Int16Array(this.arrayBuffer);\r\n    }\r\n\r\n    emplaceBack(v0: number, v1: number, v2: number, v3: number, v4: number, v5: number) {\r\n        const i = this.length;\r\n        this.resize(i + 1);\r\n        const o2 = i * 6;\r\n        this.int16[o2 + 0] = v0;\r\n        this.int16[o2 + 1] = v1;\r\n        this.int16[o2 + 2] = v2;\r\n        this.int16[o2 + 3] = v3;\r\n        this.int16[o2 + 4] = v4;\r\n        this.int16[o2 + 5] = v5;\r\n        return i;\r\n    }\r\n\r\n}\r\n\r\nStructArrayLayout2i4i12.prototype.bytesPerElement = 12;\r\nregister('StructArrayLayout2i4i12', StructArrayLayout2i4i12);\r\n\n\r\n/**\r\n * Implementation of the StructArray layout:\r\n * [0]: Int16[4]\r\n * [8]: Uint8[4]\r\n *\r\n * @private\r\n */\r\nclass StructArrayLayout4i4ub12 extends StructArray {\r\n    uint8: Uint8Array;\r\n    int16: Int16Array;\r\n\r\n    _refreshViews() {\r\n        this.uint8 = new Uint8Array(this.arrayBuffer);\r\n        this.int16 = new Int16Array(this.arrayBuffer);\r\n    }\r\n\r\n    emplaceBack(v0: number, v1: number, v2: number, v3: number, v4: number, v5: number, v6: number, v7: number) {\r\n        const i = this.length;\r\n        this.resize(i + 1);\r\n        const o2 = i * 6;\r\n        const o1 = i * 12;\r\n        this.int16[o2 + 0] = v0;\r\n        this.int16[o2 + 1] = v1;\r\n        this.int16[o2 + 2] = v2;\r\n        this.int16[o2 + 3] = v3;\r\n        this.uint8[o1 + 8] = v4;\r\n        this.uint8[o1 + 9] = v5;\r\n        this.uint8[o1 + 10] = v6;\r\n        this.uint8[o1 + 11] = v7;\r\n        return i;\r\n    }\r\n\r\n}\r\n\r\nStructArrayLayout4i4ub12.prototype.bytesPerElement = 12;\r\nregister('StructArrayLayout4i4ub12', StructArrayLayout4i4ub12);\r\n\n\r\n/**\r\n * Implementation of the StructArray layout:\r\n * [0]: Int16[4]\r\n * [8]: Uint16[4]\r\n *\r\n * @private\r\n */\r\nclass StructArrayLayout4i4ui16 extends StructArray {\r\n    uint8: Uint8Array;\r\n    int16: Int16Array;\r\n    uint16: Uint16Array;\r\n\r\n    _refreshViews() {\r\n        this.uint8 = new Uint8Array(this.arrayBuffer);\r\n        this.int16 = new Int16Array(this.arrayBuffer);\r\n        this.uint16 = new Uint16Array(this.arrayBuffer);\r\n    }\r\n\r\n    emplaceBack(v0: number, v1: number, v2: number, v3: number, v4: number, v5: number, v6: number, v7: number) {\r\n        const i = this.length;\r\n        this.resize(i + 1);\r\n        const o2 = i * 8;\r\n        this.int16[o2 + 0] = v0;\r\n        this.int16[o2 + 1] = v1;\r\n        this.int16[o2 + 2] = v2;\r\n        this.int16[o2 + 3] = v3;\r\n        this.uint16[o2 + 4] = v4;\r\n        this.uint16[o2 + 5] = v5;\r\n        this.uint16[o2 + 6] = v6;\r\n        this.uint16[o2 + 7] = v7;\r\n        return i;\r\n    }\r\n\r\n}\r\n\r\nStructArrayLayout4i4ui16.prototype.bytesPerElement = 16;\r\nregister('StructArrayLayout4i4ui16', StructArrayLayout4i4ui16);\r\n\n\r\n/**\r\n * Implementation of the StructArray layout:\r\n * [0]: Float32[3]\r\n *\r\n * @private\r\n */\r\nclass StructArrayLayout3f12 extends StructArray {\r\n    uint8: Uint8Array;\r\n    float32: Float32Array;\r\n\r\n    _refreshViews() {\r\n        this.uint8 = new Uint8Array(this.arrayBuffer);\r\n        this.float32 = new Float32Array(this.arrayBuffer);\r\n    }\r\n\r\n    emplaceBack(v0: number, v1: number, v2: number) {\r\n        const i = this.length;\r\n        this.resize(i + 1);\r\n        const o4 = i * 3;\r\n        this.float32[o4 + 0] = v0;\r\n        this.float32[o4 + 1] = v1;\r\n        this.float32[o4 + 2] = v2;\r\n        return i;\r\n    }\r\n\r\n}\r\n\r\nStructArrayLayout3f12.prototype.bytesPerElement = 12;\r\nregister('StructArrayLayout3f12', StructArrayLayout3f12);\r\n\n\r\n/**\r\n * Implementation of the StructArray layout:\r\n * [0]: Uint32[1]\r\n *\r\n * @private\r\n */\r\nclass StructArrayLayout1ul4 extends StructArray {\r\n    uint8: Uint8Array;\r\n    uint32: Uint32Array;\r\n\r\n    _refreshViews() {\r\n        this.uint8 = new Uint8Array(this.arrayBuffer);\r\n        this.uint32 = new Uint32Array(this.arrayBuffer);\r\n    }\r\n\r\n    emplaceBack(v0: number) {\r\n        const i = this.length;\r\n        this.resize(i + 1);\r\n        const o4 = i * 1;\r\n        this.uint32[o4 + 0] = v0;\r\n        return i;\r\n    }\r\n\r\n}\r\n\r\nStructArrayLayout1ul4.prototype.bytesPerElement = 4;\r\nregister('StructArrayLayout1ul4', StructArrayLayout1ul4);\r\n\n\r\n/**\r\n * Implementation of the StructArray layout:\r\n * [0]: Int16[6]\r\n * [12]: Uint32[1]\r\n * [16]: Uint16[2]\r\n * [20]: Int16[2]\r\n *\r\n * @private\r\n */\r\nclass StructArrayLayout6i1ul2ui2i24 extends StructArray {\r\n    uint8: Uint8Array;\r\n    int16: Int16Array;\r\n    uint32: Uint32Array;\r\n    uint16: Uint16Array;\r\n\r\n    _refreshViews() {\r\n        this.uint8 = new Uint8Array(this.arrayBuffer);\r\n        this.int16 = new Int16Array(this.arrayBuffer);\r\n        this.uint32 = new Uint32Array(this.arrayBuffer);\r\n        this.uint16 = new Uint16Array(this.arrayBuffer);\r\n    }\r\n\r\n    emplaceBack(v0: number, v1: number, v2: number, v3: number, v4: number, v5: number, v6: number, v7: number, v8: number, v9: number, v10: number) {\r\n        const i = this.length;\r\n        this.resize(i + 1);\r\n        const o2 = i * 12;\r\n        const o4 = i * 6;\r\n        this.int16[o2 + 0] = v0;\r\n        this.int16[o2 + 1] = v1;\r\n        this.int16[o2 + 2] = v2;\r\n        this.int16[o2 + 3] = v3;\r\n        this.int16[o2 + 4] = v4;\r\n        this.int16[o2 + 5] = v5;\r\n        this.uint32[o4 + 3] = v6;\r\n        this.uint16[o2 + 8] = v7;\r\n        this.uint16[o2 + 9] = v8;\r\n        this.int16[o2 + 10] = v9;\r\n        this.int16[o2 + 11] = v10;\r\n        return i;\r\n    }\r\n\r\n}\r\n\r\nStructArrayLayout6i1ul2ui2i24.prototype.bytesPerElement = 24;\r\nregister('StructArrayLayout6i1ul2ui2i24', StructArrayLayout6i1ul2ui2i24);\r\n\n\r\n/**\r\n * Implementation of the StructArray layout:\r\n * [0]: Int16[2]\r\n * [4]: Int16[2]\r\n * [8]: Int16[2]\r\n *\r\n * @private\r\n */\r\nclass StructArrayLayout2i2i2i12 extends StructArray {\r\n    uint8: Uint8Array;\r\n    int16: Int16Array;\r\n\r\n    _refreshViews() {\r\n        this.uint8 = new Uint8Array(this.arrayBuffer);\r\n        this.int16 = new Int16Array(this.arrayBuffer);\r\n    }\r\n\r\n    emplaceBack(v0: number, v1: number, v2: number, v3: number, v4: number, v5: number) {\r\n        const i = this.length;\r\n        this.resize(i + 1);\r\n        const o2 = i * 6;\r\n        this.int16[o2 + 0] = v0;\r\n        this.int16[o2 + 1] = v1;\r\n        this.int16[o2 + 2] = v2;\r\n        this.int16[o2 + 3] = v3;\r\n        this.int16[o2 + 4] = v4;\r\n        this.int16[o2 + 5] = v5;\r\n        return i;\r\n    }\r\n\r\n}\r\n\r\nStructArrayLayout2i2i2i12.prototype.bytesPerElement = 12;\r\nregister('StructArrayLayout2i2i2i12', StructArrayLayout2i2i2i12);\r\n\n\r\n/**\r\n * Implementation of the StructArray layout:\r\n * [0]: Uint8[2]\r\n *\r\n * @private\r\n */\r\nclass StructArrayLayout2ub4 extends StructArray {\r\n    uint8: Uint8Array;\r\n\r\n    _refreshViews() {\r\n        this.uint8 = new Uint8Array(this.arrayBuffer);\r\n    }\r\n\r\n    emplaceBack(v0: number, v1: number) {\r\n        const i = this.length;\r\n        this.resize(i + 1);\r\n        const o1 = i * 4;\r\n        this.uint8[o1 + 0] = v0;\r\n        this.uint8[o1 + 1] = v1;\r\n        return i;\r\n    }\r\n\r\n}\r\n\r\nStructArrayLayout2ub4.prototype.bytesPerElement = 4;\r\nregister('StructArrayLayout2ub4', StructArrayLayout2ub4);\r\n\n\r\n/**\r\n * Implementation of the StructArray layout:\r\n * [0]: Int16[2]\r\n * [4]: Uint16[2]\r\n * [8]: Uint32[3]\r\n * [20]: Uint16[3]\r\n * [28]: Float32[2]\r\n * [36]: Uint8[2]\r\n *\r\n * @private\r\n */\r\nclass StructArrayLayout2i2ui3ul3ui2f2ub40 extends StructArray {\r\n    uint8: Uint8Array;\r\n    int16: Int16Array;\r\n    uint16: Uint16Array;\r\n    uint32: Uint32Array;\r\n    float32: Float32Array;\r\n\r\n    _refreshViews() {\r\n        this.uint8 = new Uint8Array(this.arrayBuffer);\r\n        this.int16 = new Int16Array(this.arrayBuffer);\r\n        this.uint16 = new Uint16Array(this.arrayBuffer);\r\n        this.uint32 = new Uint32Array(this.arrayBuffer);\r\n        this.float32 = new Float32Array(this.arrayBuffer);\r\n    }\r\n\r\n    emplaceBack(v0: number, v1: number, v2: number, v3: number, v4: number, v5: number, v6: number, v7: number, v8: number, v9: number, v10: number, v11: number, v12: number, v13: number) {\r\n        const i = this.length;\r\n        this.resize(i + 1);\r\n        const o2 = i * 20;\r\n        const o4 = i * 10;\r\n        const o1 = i * 40;\r\n        this.int16[o2 + 0] = v0;\r\n        this.int16[o2 + 1] = v1;\r\n        this.uint16[o2 + 2] = v2;\r\n        this.uint16[o2 + 3] = v3;\r\n        this.uint32[o4 + 2] = v4;\r\n        this.uint32[o4 + 3] = v5;\r\n        this.uint32[o4 + 4] = v6;\r\n        this.uint16[o2 + 10] = v7;\r\n        this.uint16[o2 + 11] = v8;\r\n        this.uint16[o2 + 12] = v9;\r\n        this.float32[o4 + 7] = v10;\r\n        this.float32[o4 + 8] = v11;\r\n        this.uint8[o1 + 36] = v12;\r\n        this.uint8[o1 + 37] = v13;\r\n        return i;\r\n    }\r\n\r\n}\r\n\r\nStructArrayLayout2i2ui3ul3ui2f2ub40.prototype.bytesPerElement = 40;\r\nregister('StructArrayLayout2i2ui3ul3ui2f2ub40', StructArrayLayout2i2ui3ul3ui2f2ub40);\r\n\n\r\n/**\r\n * Implementation of the StructArray layout:\r\n * [0]: Float32[1]\r\n *\r\n * @private\r\n */\r\nclass StructArrayLayout1f4 extends StructArray {\r\n    uint8: Uint8Array;\r\n    float32: Float32Array;\r\n\r\n    _refreshViews() {\r\n        this.uint8 = new Uint8Array(this.arrayBuffer);\r\n        this.float32 = new Float32Array(this.arrayBuffer);\r\n    }\r\n\r\n    emplaceBack(v0: number) {\r\n        const i = this.length;\r\n        this.resize(i + 1);\r\n        const o4 = i * 1;\r\n        this.float32[o4 + 0] = v0;\r\n        return i;\r\n    }\r\n\r\n}\r\n\r\nStructArrayLayout1f4.prototype.bytesPerElement = 4;\r\nregister('StructArrayLayout1f4', StructArrayLayout1f4);\r\n\n\r\n/**\r\n * Implementation of the StructArray layout:\r\n * [0]: Int16[3]\r\n *\r\n * @private\r\n */\r\nclass StructArrayLayout3i6 extends StructArray {\r\n    uint8: Uint8Array;\r\n    int16: Int16Array;\r\n\r\n    _refreshViews() {\r\n        this.uint8 = new Uint8Array(this.arrayBuffer);\r\n        this.int16 = new Int16Array(this.arrayBuffer);\r\n    }\r\n\r\n    emplaceBack(v0: number, v1: number, v2: number) {\r\n        const i = this.length;\r\n        this.resize(i + 1);\r\n        const o2 = i * 3;\r\n        this.int16[o2 + 0] = v0;\r\n        this.int16[o2 + 1] = v1;\r\n        this.int16[o2 + 2] = v2;\r\n        return i;\r\n    }\r\n\r\n}\r\n\r\nStructArrayLayout3i6.prototype.bytesPerElement = 6;\r\nregister('StructArrayLayout3i6', StructArrayLayout3i6);\r\n\n\r\n/**\r\n * Implementation of the StructArray layout:\r\n * [0]: Uint32[1]\r\n * [4]: Uint16[2]\r\n *\r\n * @private\r\n */\r\nclass StructArrayLayout1ul2ui8 extends StructArray {\r\n    uint8: Uint8Array;\r\n    uint32: Uint32Array;\r\n    uint16: Uint16Array;\r\n\r\n    _refreshViews() {\r\n        this.uint8 = new Uint8Array(this.arrayBuffer);\r\n        this.uint32 = new Uint32Array(this.arrayBuffer);\r\n        this.uint16 = new Uint16Array(this.arrayBuffer);\r\n    }\r\n\r\n    emplaceBack(v0: number, v1: number, v2: number) {\r\n        const i = this.length;\r\n        this.resize(i + 1);\r\n        const o4 = i * 2;\r\n        const o2 = i * 4;\r\n        this.uint32[o4 + 0] = v0;\r\n        this.uint16[o2 + 2] = v1;\r\n        this.uint16[o2 + 3] = v2;\r\n        return i;\r\n    }\r\n\r\n}\r\n\r\nStructArrayLayout1ul2ui8.prototype.bytesPerElement = 8;\r\nregister('StructArrayLayout1ul2ui8', StructArrayLayout1ul2ui8);\r\n\n\r\n/**\r\n * Implementation of the StructArray layout:\r\n * [0]: Uint16[3]\r\n *\r\n * @private\r\n */\r\nclass StructArrayLayout3ui6 extends StructArray {\r\n    uint8: Uint8Array;\r\n    uint16: Uint16Array;\r\n\r\n    _refreshViews() {\r\n        this.uint8 = new Uint8Array(this.arrayBuffer);\r\n        this.uint16 = new Uint16Array(this.arrayBuffer);\r\n    }\r\n\r\n    emplaceBack(v0: number, v1: number, v2: number) {\r\n        const i = this.length;\r\n        this.resize(i + 1);\r\n        const o2 = i * 3;\r\n        this.uint16[o2 + 0] = v0;\r\n        this.uint16[o2 + 1] = v1;\r\n        this.uint16[o2 + 2] = v2;\r\n        return i;\r\n    }\r\n\r\n}\r\n\r\nStructArrayLayout3ui6.prototype.bytesPerElement = 6;\r\nregister('StructArrayLayout3ui6', StructArrayLayout3ui6);\r\n\n\r\n/**\r\n * Implementation of the StructArray layout:\r\n * [0]: Uint16[2]\r\n *\r\n * @private\r\n */\r\nclass StructArrayLayout2ui4 extends StructArray {\r\n    uint8: Uint8Array;\r\n    uint16: Uint16Array;\r\n\r\n    _refreshViews() {\r\n        this.uint8 = new Uint8Array(this.arrayBuffer);\r\n        this.uint16 = new Uint16Array(this.arrayBuffer);\r\n    }\r\n\r\n    emplaceBack(v0: number, v1: number) {\r\n        const i = this.length;\r\n        this.resize(i + 1);\r\n        const o2 = i * 2;\r\n        this.uint16[o2 + 0] = v0;\r\n        this.uint16[o2 + 1] = v1;\r\n        return i;\r\n    }\r\n\r\n}\r\n\r\nStructArrayLayout2ui4.prototype.bytesPerElement = 4;\r\nregister('StructArrayLayout2ui4', StructArrayLayout2ui4);\r\n\n\r\n/**\r\n * Implementation of the StructArray layout:\r\n * [0]: Float32[2]\r\n *\r\n * @private\r\n */\r\nclass StructArrayLayout2f8 extends StructArray {\r\n    uint8: Uint8Array;\r\n    float32: Float32Array;\r\n\r\n    _refreshViews() {\r\n        this.uint8 = new Uint8Array(this.arrayBuffer);\r\n        this.float32 = new Float32Array(this.arrayBuffer);\r\n    }\r\n\r\n    emplaceBack(v0: number, v1: number) {\r\n        const i = this.length;\r\n        this.resize(i + 1);\r\n        const o4 = i * 2;\r\n        this.float32[o4 + 0] = v0;\r\n        this.float32[o4 + 1] = v1;\r\n        return i;\r\n    }\r\n\r\n}\r\n\r\nStructArrayLayout2f8.prototype.bytesPerElement = 8;\r\nregister('StructArrayLayout2f8', StructArrayLayout2f8);\r\n\n\r\n/**\r\n * Implementation of the StructArray layout:\r\n * [0]: Float32[4]\r\n *\r\n * @private\r\n */\r\nclass StructArrayLayout4f16 extends StructArray {\r\n    uint8: Uint8Array;\r\n    float32: Float32Array;\r\n\r\n    _refreshViews() {\r\n        this.uint8 = new Uint8Array(this.arrayBuffer);\r\n        this.float32 = new Float32Array(this.arrayBuffer);\r\n    }\r\n\r\n    emplaceBack(v0: number, v1: number, v2: number, v3: number) {\r\n        const i = this.length;\r\n        this.resize(i + 1);\r\n        const o4 = i * 4;\r\n        this.float32[o4 + 0] = v0;\r\n        this.float32[o4 + 1] = v1;\r\n        this.float32[o4 + 2] = v2;\r\n        this.float32[o4 + 3] = v3;\r\n        return i;\r\n    }\r\n\r\n}\r\n\r\nStructArrayLayout4f16.prototype.bytesPerElement = 16;\r\nregister('StructArrayLayout4f16', StructArrayLayout4f16);\r\n\n\nclass CollisionBoxStruct extends Struct {\r\n    _structArray: CollisionBoxArray;\r\n    anchorPointX: number;\r\n    anchorPointY: number;\r\n    x1: number;\r\n    y1: number;\r\n    x2: number;\r\n    y2: number;\r\n    featureIndex: number;\r\n    sourceLayerIndex: number;\r\n    bucketIndex: number;\r\n    radius: number;\r\n    signedDistanceFromAnchor: number;\r\n    anchorPoint: Point;\r\n    get anchorPointX() { return this._structArray.int16[this._pos2 + 0]; }\r\n    set anchorPointX(x) { this._structArray.int16[this._pos2 + 0] = x; }\r\n    get anchorPointY() { return this._structArray.int16[this._pos2 + 1]; }\r\n    set anchorPointY(x) { this._structArray.int16[this._pos2 + 1] = x; }\r\n    get x1() { return this._structArray.int16[this._pos2 + 2]; }\r\n    set x1(x) { this._structArray.int16[this._pos2 + 2] = x; }\r\n    get y1() { return this._structArray.int16[this._pos2 + 3]; }\r\n    set y1(x) { this._structArray.int16[this._pos2 + 3] = x; }\r\n    get x2() { return this._structArray.int16[this._pos2 + 4]; }\r\n    set x2(x) { this._structArray.int16[this._pos2 + 4] = x; }\r\n    get y2() { return this._structArray.int16[this._pos2 + 5]; }\r\n    set y2(x) { this._structArray.int16[this._pos2 + 5] = x; }\r\n    get featureIndex() { return this._structArray.uint32[this._pos4 + 3]; }\r\n    set featureIndex(x) { this._structArray.uint32[this._pos4 + 3] = x; }\r\n    get sourceLayerIndex() { return this._structArray.uint16[this._pos2 + 8]; }\r\n    set sourceLayerIndex(x) { this._structArray.uint16[this._pos2 + 8] = x; }\r\n    get bucketIndex() { return this._structArray.uint16[this._pos2 + 9]; }\r\n    set bucketIndex(x) { this._structArray.uint16[this._pos2 + 9] = x; }\r\n    get radius() { return this._structArray.int16[this._pos2 + 10]; }\r\n    set radius(x) { this._structArray.int16[this._pos2 + 10] = x; }\r\n    get signedDistanceFromAnchor() { return this._structArray.int16[this._pos2 + 11]; }\r\n    set signedDistanceFromAnchor(x) { this._structArray.int16[this._pos2 + 11] = x; }\r\n    get anchorPoint() { return new Point(this.anchorPointX, this.anchorPointY); }\r\n}\r\n\r\nCollisionBoxStruct.prototype.size = 24;\r\n\r\nexport type CollisionBox = CollisionBoxStruct;\r\n\r\n\r\n/**\r\n * @private\r\n */\r\nclass CollisionBoxArray extends StructArrayLayout6i1ul2ui2i24 {\r\n    /**\r\n     * Return the CollisionBoxStruct at the given location in the array.\r\n     * @param {number} index The index of the element.\r\n     */\r\n    get(index: number): CollisionBoxStruct {\r\n        assert(!this.isTransferred);\r\n        return new CollisionBoxStruct(this, index);\r\n    }\r\n}\r\n\r\nregister('CollisionBoxArray', CollisionBoxArray);\r\n\nclass PlacedSymbolStruct extends Struct {\r\n    _structArray: PlacedSymbolArray;\r\n    anchorX: number;\r\n    anchorY: number;\r\n    glyphStartIndex: number;\r\n    numGlyphs: number;\r\n    vertexStartIndex: number;\r\n    lineStartIndex: number;\r\n    lineLength: number;\r\n    segment: number;\r\n    lowerSize: number;\r\n    upperSize: number;\r\n    lineOffsetX: number;\r\n    lineOffsetY: number;\r\n    writingMode: number;\r\n    hidden: number;\r\n    get anchorX() { return this._structArray.int16[this._pos2 + 0]; }\r\n    set anchorX(x) { this._structArray.int16[this._pos2 + 0] = x; }\r\n    get anchorY() { return this._structArray.int16[this._pos2 + 1]; }\r\n    set anchorY(x) { this._structArray.int16[this._pos2 + 1] = x; }\r\n    get glyphStartIndex() { return this._structArray.uint16[this._pos2 + 2]; }\r\n    set glyphStartIndex(x) { this._structArray.uint16[this._pos2 + 2] = x; }\r\n    get numGlyphs() { return this._structArray.uint16[this._pos2 + 3]; }\r\n    set numGlyphs(x) { this._structArray.uint16[this._pos2 + 3] = x; }\r\n    get vertexStartIndex() { return this._structArray.uint32[this._pos4 + 2]; }\r\n    set vertexStartIndex(x) { this._structArray.uint32[this._pos4 + 2] = x; }\r\n    get lineStartIndex() { return this._structArray.uint32[this._pos4 + 3]; }\r\n    set lineStartIndex(x) { this._structArray.uint32[this._pos4 + 3] = x; }\r\n    get lineLength() { return this._structArray.uint32[this._pos4 + 4]; }\r\n    set lineLength(x) { this._structArray.uint32[this._pos4 + 4] = x; }\r\n    get segment() { return this._structArray.uint16[this._pos2 + 10]; }\r\n    set segment(x) { this._structArray.uint16[this._pos2 + 10] = x; }\r\n    get lowerSize() { return this._structArray.uint16[this._pos2 + 11]; }\r\n    set lowerSize(x) { this._structArray.uint16[this._pos2 + 11] = x; }\r\n    get upperSize() { return this._structArray.uint16[this._pos2 + 12]; }\r\n    set upperSize(x) { this._structArray.uint16[this._pos2 + 12] = x; }\r\n    get lineOffsetX() { return this._structArray.float32[this._pos4 + 7]; }\r\n    set lineOffsetX(x) { this._structArray.float32[this._pos4 + 7] = x; }\r\n    get lineOffsetY() { return this._structArray.float32[this._pos4 + 8]; }\r\n    set lineOffsetY(x) { this._structArray.float32[this._pos4 + 8] = x; }\r\n    get writingMode() { return this._structArray.uint8[this._pos1 + 36]; }\r\n    set writingMode(x) { this._structArray.uint8[this._pos1 + 36] = x; }\r\n    get hidden() { return this._structArray.uint8[this._pos1 + 37]; }\r\n    set hidden(x) { this._structArray.uint8[this._pos1 + 37] = x; }\r\n}\r\n\r\nPlacedSymbolStruct.prototype.size = 40;\r\n\r\nexport type PlacedSymbol = PlacedSymbolStruct;\r\n\r\n\r\n/**\r\n * @private\r\n */\r\nclass PlacedSymbolArray extends StructArrayLayout2i2ui3ul3ui2f2ub40 {\r\n    /**\r\n     * Return the PlacedSymbolStruct at the given location in the array.\r\n     * @param {number} index The index of the element.\r\n     */\r\n    get(index: number): PlacedSymbolStruct {\r\n        assert(!this.isTransferred);\r\n        return new PlacedSymbolStruct(this, index);\r\n    }\r\n}\r\n\r\nregister('PlacedSymbolArray', PlacedSymbolArray);\r\n\nclass GlyphOffsetStruct extends Struct {\r\n    _structArray: GlyphOffsetArray;\r\n    offsetX: number;\r\n    get offsetX() { return this._structArray.float32[this._pos4 + 0]; }\r\n    set offsetX(x) { this._structArray.float32[this._pos4 + 0] = x; }\r\n}\r\n\r\nGlyphOffsetStruct.prototype.size = 4;\r\n\r\nexport type GlyphOffset = GlyphOffsetStruct;\r\n\r\n\r\n/**\r\n * @private\r\n */\r\nclass GlyphOffsetArray extends StructArrayLayout1f4 {\r\n    getoffsetX(index: number) { return this.float32[index * 1 + 0]; }\r\n    /**\r\n     * Return the GlyphOffsetStruct at the given location in the array.\r\n     * @param {number} index The index of the element.\r\n     */\r\n    get(index: number): GlyphOffsetStruct {\r\n        assert(!this.isTransferred);\r\n        return new GlyphOffsetStruct(this, index);\r\n    }\r\n}\r\n\r\nregister('GlyphOffsetArray', GlyphOffsetArray);\r\n\nclass SymbolLineVertexStruct extends Struct {\r\n    _structArray: SymbolLineVertexArray;\r\n    x: number;\r\n    y: number;\r\n    tileUnitDistanceFromAnchor: number;\r\n    get x() { return this._structArray.int16[this._pos2 + 0]; }\r\n    set x(x) { this._structArray.int16[this._pos2 + 0] = x; }\r\n    get y() { return this._structArray.int16[this._pos2 + 1]; }\r\n    set y(x) { this._structArray.int16[this._pos2 + 1] = x; }\r\n    get tileUnitDistanceFromAnchor() { return this._structArray.int16[this._pos2 + 2]; }\r\n    set tileUnitDistanceFromAnchor(x) { this._structArray.int16[this._pos2 + 2] = x; }\r\n}\r\n\r\nSymbolLineVertexStruct.prototype.size = 6;\r\n\r\nexport type SymbolLineVertex = SymbolLineVertexStruct;\r\n\r\n\r\n/**\r\n * @private\r\n */\r\nclass SymbolLineVertexArray extends StructArrayLayout3i6 {\r\n    getx(index: number) { return this.int16[index * 3 + 0]; }\r\n    gety(index: number) { return this.int16[index * 3 + 1]; }\r\n    gettileUnitDistanceFromAnchor(index: number) { return this.int16[index * 3 + 2]; }\r\n    /**\r\n     * Return the SymbolLineVertexStruct at the given location in the array.\r\n     * @param {number} index The index of the element.\r\n     */\r\n    get(index: number): SymbolLineVertexStruct {\r\n        assert(!this.isTransferred);\r\n        return new SymbolLineVertexStruct(this, index);\r\n    }\r\n}\r\n\r\nregister('SymbolLineVertexArray', SymbolLineVertexArray);\r\n\nclass FeatureIndexStruct extends Struct {\r\n    _structArray: FeatureIndexArray;\r\n    featureIndex: number;\r\n    sourceLayerIndex: number;\r\n    bucketIndex: number;\r\n    get featureIndex() { return this._structArray.uint32[this._pos4 + 0]; }\r\n    set featureIndex(x) { this._structArray.uint32[this._pos4 + 0] = x; }\r\n    get sourceLayerIndex() { return this._structArray.uint16[this._pos2 + 2]; }\r\n    set sourceLayerIndex(x) { this._structArray.uint16[this._pos2 + 2] = x; }\r\n    get bucketIndex() { return this._structArray.uint16[this._pos2 + 3]; }\r\n    set bucketIndex(x) { this._structArray.uint16[this._pos2 + 3] = x; }\r\n}\r\n\r\nFeatureIndexStruct.prototype.size = 8;\r\n\r\nexport type FeatureIndex = FeatureIndexStruct;\r\n\r\n\r\n/**\r\n * @private\r\n */\r\nclass FeatureIndexArray extends StructArrayLayout1ul2ui8 {\r\n    /**\r\n     * Return the FeatureIndexStruct at the given location in the array.\r\n     * @param {number} index The index of the element.\r\n     */\r\n    get(index: number): FeatureIndexStruct {\r\n        assert(!this.isTransferred);\r\n        return new FeatureIndexStruct(this, index);\r\n    }\r\n}\r\n\r\nregister('FeatureIndexArray', FeatureIndexArray);\r\n\n\nmodule.exports = {\n    StructArrayLayout2i4,\n    StructArrayLayout4i8,\n    StructArrayLayout2i4i12,\n    StructArrayLayout4i4ub12,\n    StructArrayLayout4i4ui16,\n    StructArrayLayout3f12,\n    StructArrayLayout1ul4,\n    StructArrayLayout6i1ul2ui2i24,\n    StructArrayLayout2i2i2i12,\n    StructArrayLayout2ub4,\n    StructArrayLayout2i2ui3ul3ui2f2ub40,\n    StructArrayLayout1f4,\n    StructArrayLayout3i6,\n    StructArrayLayout1ul2ui8,\n    StructArrayLayout3ui6,\n    StructArrayLayout2ui4,\n    StructArrayLayout2f8,\n    StructArrayLayout4f16,\n    PosArray: StructArrayLayout2i4,\n    RasterBoundsArray: StructArrayLayout4i8,\n    CircleLayoutArray: StructArrayLayout2i4,\n    FillLayoutArray: StructArrayLayout2i4,\n    FillExtrusionLayoutArray: StructArrayLayout2i4i12,\n    HeatmapLayoutArray: StructArrayLayout2i4,\n    LineLayoutArray: StructArrayLayout4i4ub12,\n    SymbolLayoutArray: StructArrayLayout4i4ui16,\n    SymbolDynamicLayoutArray: StructArrayLayout3f12,\n    SymbolOpacityArray: StructArrayLayout1ul4,\n    CollisionBoxLayoutArray: StructArrayLayout2i2i2i12,\n    CollisionCircleLayoutArray: StructArrayLayout2i2i2i12,\n    CollisionVertexArray: StructArrayLayout2ub4,\n    TriangleIndexArray: StructArrayLayout3ui6,\n    LineIndexArray: StructArrayLayout2ui4,\n    CollisionBoxArray,\n    PlacedSymbolArray,\n    GlyphOffsetArray,\n    SymbolLineVertexArray,\n    FeatureIndexArray\n};\n","// @flow\r\nconst {createLayout} = require('../../util/struct_array');\r\nmodule.exports = createLayout([\r\n    {name: 'a_pos', components: 2, type: 'Int16'}\r\n], 4);\r\n","// @flow\r\n\r\nconst {CircleLayoutArray} = require('../array_types');\r\nconst layoutAttributes = require('./circle_attributes').members;\r\nconst {SegmentVector} = require('../segment');\r\nconst {ProgramConfigurationSet} = require('../program_configuration');\r\nconst {TriangleIndexArray} = require('../index_array_type');\r\nconst loadGeometry = require('../load_geometry');\r\nconst EXTENT = require('../extent');\r\nconst {register} = require('../../util/web_worker_transfer');\r\n\r\nimport type {\r\n    Bucket,\r\n    BucketParameters,\r\n    IndexedFeature,\r\n    PopulateParameters\r\n} from '../bucket';\r\nimport type CircleStyleLayer from '../../style/style_layer/circle_style_layer';\r\nimport type HeatmapStyleLayer from '../../style/style_layer/heatmap_style_layer';\r\nimport type Context from '../../gl/context';\r\nimport type IndexBuffer from '../../gl/index_buffer';\r\nimport type VertexBuffer from '../../gl/vertex_buffer';\r\nimport type Point from '@mapbox/point-geometry';\r\n\r\nfunction addCircleVertex(layoutVertexArray, x, y, extrudeX, extrudeY) {\r\n    layoutVertexArray.emplaceBack(\r\n        (x * 2) + ((extrudeX + 1) / 2),\r\n        (y * 2) + ((extrudeY + 1) / 2));\r\n}\r\n\r\n\r\n/**\r\n * Circles are represented by two triangles.\r\n *\r\n * Each corner has a pos that is the center of the circle and an extrusion\r\n * vector that is where it points.\r\n * @private\r\n */\r\nclass CircleBucket<Layer: CircleStyleLayer | HeatmapStyleLayer> implements Bucket {\r\n    index: number;\r\n    zoom: number;\r\n    overscaling: number;\r\n    layerIds: Array<string>;\r\n    layers: Array<Layer>;\r\n\r\n    layoutVertexArray: CircleLayoutArray;\r\n    layoutVertexBuffer: VertexBuffer;\r\n\r\n    indexArray: TriangleIndexArray;\r\n    indexBuffer: IndexBuffer;\r\n\r\n    programConfigurations: ProgramConfigurationSet<Layer>;\r\n    segments: SegmentVector;\r\n    uploaded: boolean;\r\n\r\n    constructor(options: BucketParameters<Layer>) {\r\n        this.zoom = options.zoom;\r\n        this.overscaling = options.overscaling;\r\n        this.layers = options.layers;\r\n        this.layerIds = this.layers.map(layer => layer.id);\r\n        this.index = options.index;\r\n\r\n        this.layoutVertexArray = new CircleLayoutArray();\r\n        this.indexArray = new TriangleIndexArray();\r\n        this.segments = new SegmentVector();\r\n        this.programConfigurations = new ProgramConfigurationSet(layoutAttributes, options.layers, options.zoom);\r\n    }\r\n\r\n    populate(features: Array<IndexedFeature>, options: PopulateParameters) {\r\n        for (const {feature, index, sourceLayerIndex} of features) {\r\n            if (this.layers[0]._featureFilter({zoom: this.zoom}, feature)) {\r\n                const geometry = loadGeometry(feature);\r\n                this.addFeature(feature, geometry);\r\n                options.featureIndex.insert(feature, geometry, index, sourceLayerIndex, this.index);\r\n            }\r\n        }\r\n    }\r\n\r\n    isEmpty() {\r\n        return this.layoutVertexArray.length === 0;\r\n    }\r\n\r\n    upload(context: Context) {\r\n        this.layoutVertexBuffer = context.createVertexBuffer(this.layoutVertexArray, layoutAttributes);\r\n        this.indexBuffer = context.createIndexBuffer(this.indexArray);\r\n        this.programConfigurations.upload(context);\r\n    }\r\n\r\n    destroy() {\r\n        if (!this.layoutVertexBuffer) return;\r\n        this.layoutVertexBuffer.destroy();\r\n        this.indexBuffer.destroy();\r\n        this.programConfigurations.destroy();\r\n        this.segments.destroy();\r\n    }\r\n\r\n    addFeature(feature: VectorTileFeature, geometry: Array<Array<Point>>) {\r\n        for (const ring of geometry) {\r\n            for (const point of ring) {\r\n                const x = point.x;\r\n                const y = point.y;\r\n\r\n                // Do not include points that are outside the tile boundaries.\r\n                if (x < 0 || x >= EXTENT || y < 0 || y >= EXTENT) continue;\r\n\r\n                // this geometry will be of the Point type, and we'll derive\r\n                // two triangles from it.\r\n                //\r\n                // ┌─────────┐\r\n                // │ 3     2 │\r\n                // │         │\r\n                // │ 0     1 │\r\n                // └─────────┘\r\n\r\n                const segment = this.segments.prepareSegment(4, this.layoutVertexArray, this.indexArray);\r\n                const index = segment.vertexLength;\r\n\r\n                addCircleVertex(this.layoutVertexArray, x, y, -1, -1);\r\n                addCircleVertex(this.layoutVertexArray, x, y, 1, -1);\r\n                addCircleVertex(this.layoutVertexArray, x, y, 1, 1);\r\n                addCircleVertex(this.layoutVertexArray, x, y, -1, 1);\r\n\r\n                this.indexArray.emplaceBack(index, index + 1, index + 2);\r\n                this.indexArray.emplaceBack(index, index + 3, index + 2);\r\n\r\n                segment.vertexLength += 4;\r\n                segment.primitiveLength += 2;\r\n            }\r\n        }\r\n\r\n        this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length, feature);\r\n    }\r\n}\r\n\r\nregister('CircleBucket', CircleBucket, {omit: ['layers']});\r\n\r\nmodule.exports = CircleBucket;\r\n","// @flow\r\nconst {createLayout} = require('../../util/struct_array');\r\nmodule.exports = createLayout([\r\n    {name: 'a_pos', components: 2, type: 'Int16'}\r\n], 4);\r\n","// @flow\r\n\r\nconst {FillLayoutArray} = require('../array_types');\r\nconst layoutAttributes = require('./fill_attributes').members;\r\nconst {SegmentVector} = require('../segment');\r\nconst {ProgramConfigurationSet} = require('../program_configuration');\r\nconst {LineIndexArray, TriangleIndexArray} = require('../index_array_type');\r\nconst loadGeometry = require('../load_geometry');\r\nconst earcut = require('earcut');\r\nconst classifyRings = require('../../util/classify_rings');\r\nconst assert = require('assert');\r\nconst EARCUT_MAX_RINGS = 500;\r\nconst {register} = require('../../util/web_worker_transfer');\r\n\r\nimport type {\r\n    Bucket,\r\n    BucketParameters,\r\n    IndexedFeature,\r\n    PopulateParameters\r\n} from '../bucket';\r\nimport type FillStyleLayer from '../../style/style_layer/fill_style_layer';\r\nimport type Context from '../../gl/context';\r\nimport type IndexBuffer from '../../gl/index_buffer';\r\nimport type VertexBuffer from '../../gl/vertex_buffer';\r\nimport type Point from '@mapbox/point-geometry';\r\n\r\nclass FillBucket implements Bucket {\r\n    index: number;\r\n    zoom: number;\r\n    overscaling: number;\r\n    layers: Array<FillStyleLayer>;\r\n    layerIds: Array<string>;\r\n\r\n    layoutVertexArray: FillLayoutArray;\r\n    layoutVertexBuffer: VertexBuffer;\r\n\r\n    indexArray: TriangleIndexArray;\r\n    indexBuffer: IndexBuffer;\r\n\r\n    indexArray2: LineIndexArray;\r\n    indexBuffer2: IndexBuffer;\r\n\r\n    programConfigurations: ProgramConfigurationSet<FillStyleLayer>;\r\n    segments: SegmentVector;\r\n    segments2: SegmentVector;\r\n    uploaded: boolean;\r\n\r\n    constructor(options: BucketParameters<FillStyleLayer>) {\r\n        this.zoom = options.zoom;\r\n        this.overscaling = options.overscaling;\r\n        this.layers = options.layers;\r\n        this.layerIds = this.layers.map(layer => layer.id);\r\n        this.index = options.index;\r\n\r\n        this.layoutVertexArray = new FillLayoutArray();\r\n        this.indexArray = new TriangleIndexArray();\r\n        this.indexArray2 = new LineIndexArray();\r\n        this.programConfigurations = new ProgramConfigurationSet(layoutAttributes, options.layers, options.zoom);\r\n        this.segments = new SegmentVector();\r\n        this.segments2 = new SegmentVector();\r\n    }\r\n\r\n    populate(features: Array<IndexedFeature>, options: PopulateParameters) {\r\n        for (const {feature, index, sourceLayerIndex} of features) {\r\n            if (this.layers[0]._featureFilter({zoom: this.zoom}, feature)) {\r\n                const geometry = loadGeometry(feature);\r\n                this.addFeature(feature, geometry);\r\n                options.featureIndex.insert(feature, geometry, index, sourceLayerIndex, this.index);\r\n            }\r\n        }\r\n    }\r\n\r\n    isEmpty() {\r\n        return this.layoutVertexArray.length === 0;\r\n    }\r\n\r\n    upload(context: Context) {\r\n        this.layoutVertexBuffer = context.createVertexBuffer(this.layoutVertexArray, layoutAttributes);\r\n        this.indexBuffer = context.createIndexBuffer(this.indexArray);\r\n        this.indexBuffer2 = context.createIndexBuffer(this.indexArray2);\r\n        this.programConfigurations.upload(context);\r\n    }\r\n\r\n    destroy() {\r\n        if (!this.layoutVertexBuffer) return;\r\n        this.layoutVertexBuffer.destroy();\r\n        this.indexBuffer.destroy();\r\n        this.indexBuffer2.destroy();\r\n        this.programConfigurations.destroy();\r\n        this.segments.destroy();\r\n        this.segments2.destroy();\r\n    }\r\n\r\n    addFeature(feature: VectorTileFeature, geometry: Array<Array<Point>>) {\r\n        for (const polygon of classifyRings(geometry, EARCUT_MAX_RINGS)) {\r\n            let numVertices = 0;\r\n            for (const ring of polygon) {\r\n                numVertices += ring.length;\r\n            }\r\n\r\n            const triangleSegment = this.segments.prepareSegment(numVertices, this.layoutVertexArray, this.indexArray);\r\n            const triangleIndex = triangleSegment.vertexLength;\r\n\r\n            const flattened = [];\r\n            const holeIndices = [];\r\n\r\n            for (const ring of polygon) {\r\n                if (ring.length === 0) {\r\n                    continue;\r\n                }\r\n\r\n                if (ring !== polygon[0]) {\r\n                    holeIndices.push(flattened.length / 2);\r\n                }\r\n\r\n                const lineSegment = this.segments2.prepareSegment(ring.length, this.layoutVertexArray, this.indexArray2);\r\n                const lineIndex = lineSegment.vertexLength;\r\n\r\n                this.layoutVertexArray.emplaceBack(ring[0].x, ring[0].y);\r\n                this.indexArray2.emplaceBack(lineIndex + ring.length - 1, lineIndex);\r\n                flattened.push(ring[0].x);\r\n                flattened.push(ring[0].y);\r\n\r\n                for (let i = 1; i < ring.length; i++) {\r\n                    this.layoutVertexArray.emplaceBack(ring[i].x, ring[i].y);\r\n                    this.indexArray2.emplaceBack(lineIndex + i - 1, lineIndex + i);\r\n                    flattened.push(ring[i].x);\r\n                    flattened.push(ring[i].y);\r\n                }\r\n\r\n                lineSegment.vertexLength += ring.length;\r\n                lineSegment.primitiveLength += ring.length;\r\n            }\r\n\r\n            const indices = earcut(flattened, holeIndices);\r\n            assert(indices.length % 3 === 0);\r\n\r\n            for (let i = 0; i < indices.length; i += 3) {\r\n                this.indexArray.emplaceBack(\r\n                    triangleIndex + indices[i],\r\n                    triangleIndex + indices[i + 1],\r\n                    triangleIndex + indices[i + 2]);\r\n            }\r\n\r\n            triangleSegment.vertexLength += numVertices;\r\n            triangleSegment.primitiveLength += indices.length / 3;\r\n        }\r\n\r\n        this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length, feature);\r\n    }\r\n}\r\n\r\nregister('FillBucket', FillBucket, {omit: ['layers']});\r\n\r\nmodule.exports = FillBucket;\r\n","// @flow\r\nconst {createLayout} = require('../../util/struct_array');\r\nmodule.exports = createLayout([\r\n    {name: 'a_pos',          components: 2, type: 'Int16'},\r\n    {name: 'a_normal_ed',    components: 4, type: 'Int16'},\r\n], 4);\r\n","// @flow\r\n\r\nconst {FillExtrusionLayoutArray} = require('../array_types');\r\nconst layoutAttributes = require('./fill_extrusion_attributes').members;\r\nconst {SegmentVector, MAX_VERTEX_ARRAY_LENGTH} = require('../segment');\r\nconst {ProgramConfigurationSet} = require('../program_configuration');\r\nconst {TriangleIndexArray} = require('../index_array_type');\r\nconst loadGeometry = require('../load_geometry');\r\nconst EXTENT = require('../extent');\r\nconst earcut = require('earcut');\r\nconst classifyRings = require('../../util/classify_rings');\r\nconst assert = require('assert');\r\nconst EARCUT_MAX_RINGS = 500;\r\nconst {register} = require('../../util/web_worker_transfer');\r\n\r\nimport type {\r\n    Bucket,\r\n    BucketParameters,\r\n    IndexedFeature,\r\n    PopulateParameters\r\n} from '../bucket';\r\nimport type FillExtrusionStyleLayer from '../../style/style_layer/fill_extrusion_style_layer';\r\nimport type Context from '../../gl/context';\r\nimport type IndexBuffer from '../../gl/index_buffer';\r\nimport type VertexBuffer from '../../gl/vertex_buffer';\r\nimport type Point from '@mapbox/point-geometry';\r\n\r\nconst FACTOR = Math.pow(2, 13);\r\n\r\nfunction addVertex(vertexArray, x, y, nx, ny, nz, t, e) {\r\n    vertexArray.emplaceBack(\r\n        // a_pos\r\n        x,\r\n        y,\r\n        // a_normal_ed: 3-component normal and 1-component edgedistance\r\n        Math.floor(nx * FACTOR) * 2 + t,\r\n        ny * FACTOR * 2,\r\n        nz * FACTOR * 2,\r\n        // edgedistance (used for wrapping patterns around extrusion sides)\r\n        Math.round(e)\r\n    );\r\n}\r\n\r\n\r\nclass FillExtrusionBucket implements Bucket {\r\n    index: number;\r\n    zoom: number;\r\n    overscaling: number;\r\n    layers: Array<FillExtrusionStyleLayer>;\r\n    layerIds: Array<string>;\r\n\r\n    layoutVertexArray: FillExtrusionLayoutArray;\r\n    layoutVertexBuffer: VertexBuffer;\r\n\r\n    indexArray: TriangleIndexArray;\r\n    indexBuffer: IndexBuffer;\r\n\r\n    programConfigurations: ProgramConfigurationSet<FillExtrusionStyleLayer>;\r\n    segments: SegmentVector;\r\n    uploaded: boolean;\r\n\r\n    constructor(options: BucketParameters<FillExtrusionStyleLayer>) {\r\n        this.zoom = options.zoom;\r\n        this.overscaling = options.overscaling;\r\n        this.layers = options.layers;\r\n        this.layerIds = this.layers.map(layer => layer.id);\r\n        this.index = options.index;\r\n\r\n        this.layoutVertexArray = new FillExtrusionLayoutArray();\r\n        this.indexArray = new TriangleIndexArray();\r\n        this.programConfigurations = new ProgramConfigurationSet(layoutAttributes, options.layers, options.zoom);\r\n        this.segments = new SegmentVector();\r\n    }\r\n\r\n    populate(features: Array<IndexedFeature>, options: PopulateParameters) {\r\n        for (const {feature, index, sourceLayerIndex} of features) {\r\n            if (this.layers[0]._featureFilter({zoom: this.zoom}, feature)) {\r\n                const geometry = loadGeometry(feature);\r\n                this.addFeature(feature, geometry);\r\n                options.featureIndex.insert(feature, geometry, index, sourceLayerIndex, this.index);\r\n            }\r\n        }\r\n    }\r\n\r\n    isEmpty() {\r\n        return this.layoutVertexArray.length === 0;\r\n    }\r\n\r\n    upload(context: Context) {\r\n        this.layoutVertexBuffer = context.createVertexBuffer(this.layoutVertexArray, layoutAttributes);\r\n        this.indexBuffer = context.createIndexBuffer(this.indexArray);\r\n        this.programConfigurations.upload(context);\r\n    }\r\n\r\n    destroy() {\r\n        if (!this.layoutVertexBuffer) return;\r\n        this.layoutVertexBuffer.destroy();\r\n        this.indexBuffer.destroy();\r\n        this.programConfigurations.destroy();\r\n        this.segments.destroy();\r\n    }\r\n\r\n    addFeature(feature: VectorTileFeature, geometry: Array<Array<Point>>) {\r\n        for (const polygon of classifyRings(geometry, EARCUT_MAX_RINGS)) {\r\n            let numVertices = 0;\r\n            for (const ring of polygon) {\r\n                numVertices += ring.length;\r\n            }\r\n            let segment = this.segments.prepareSegment(4, this.layoutVertexArray, this.indexArray);\r\n\r\n            for (const ring of polygon) {\r\n                if (ring.length === 0) {\r\n                    continue;\r\n                }\r\n\r\n                if (isEntirelyOutside(ring)) {\r\n                    continue;\r\n                }\r\n\r\n                let edgeDistance = 0;\r\n\r\n                for (let p = 0; p < ring.length; p++) {\r\n                    const p1 = ring[p];\r\n\r\n                    if (p >= 1) {\r\n                        const p2 = ring[p - 1];\r\n\r\n                        if (!isBoundaryEdge(p1, p2)) {\r\n                            if (segment.vertexLength + 4 > MAX_VERTEX_ARRAY_LENGTH) {\r\n                                segment = this.segments.prepareSegment(4, this.layoutVertexArray, this.indexArray);\r\n                            }\r\n\r\n                            const perp = p1.sub(p2)._perp()._unit();\r\n                            const dist = p2.dist(p1);\r\n                            if (edgeDistance + dist > 32768) edgeDistance = 0;\r\n\r\n                            addVertex(this.layoutVertexArray, p1.x, p1.y, perp.x, perp.y, 0, 0, edgeDistance);\r\n                            addVertex(this.layoutVertexArray, p1.x, p1.y, perp.x, perp.y, 0, 1, edgeDistance);\r\n\r\n                            edgeDistance += dist;\r\n\r\n                            addVertex(this.layoutVertexArray, p2.x, p2.y, perp.x, perp.y, 0, 0, edgeDistance);\r\n                            addVertex(this.layoutVertexArray, p2.x, p2.y, perp.x, perp.y, 0, 1, edgeDistance);\r\n\r\n                            const bottomRight = segment.vertexLength;\r\n\r\n                            this.indexArray.emplaceBack(bottomRight, bottomRight + 1, bottomRight + 2);\r\n                            this.indexArray.emplaceBack(bottomRight + 1, bottomRight + 2, bottomRight + 3);\r\n\r\n                            segment.vertexLength += 4;\r\n                            segment.primitiveLength += 2;\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n\r\n            if (segment.vertexLength + numVertices > MAX_VERTEX_ARRAY_LENGTH) {\r\n                segment = this.segments.prepareSegment(numVertices, this.layoutVertexArray, this.indexArray);\r\n            }\r\n\r\n            const flattened = [];\r\n            const holeIndices = [];\r\n            const triangleIndex = segment.vertexLength;\r\n\r\n            for (const ring of polygon) {\r\n                if (ring.length === 0) {\r\n                    continue;\r\n                }\r\n\r\n                if (ring !== polygon[0]) {\r\n                    holeIndices.push(flattened.length / 2);\r\n                }\r\n\r\n                for (let i = 0; i < ring.length; i++) {\r\n                    const p = ring[i];\r\n\r\n                    addVertex(this.layoutVertexArray, p.x, p.y, 0, 0, 1, 1, 0);\r\n\r\n                    flattened.push(p.x);\r\n                    flattened.push(p.y);\r\n                }\r\n            }\r\n\r\n            const indices = earcut(flattened, holeIndices);\r\n            assert(indices.length % 3 === 0);\r\n\r\n            for (let j = 0; j < indices.length; j += 3) {\r\n                this.indexArray.emplaceBack(\r\n                    triangleIndex + indices[j],\r\n                    triangleIndex + indices[j + 1],\r\n                    triangleIndex + indices[j + 2]);\r\n            }\r\n\r\n            segment.primitiveLength += indices.length / 3;\r\n            segment.vertexLength += numVertices;\r\n        }\r\n\r\n        this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length, feature);\r\n    }\r\n}\r\n\r\nregister('FillExtrusionBucket', FillExtrusionBucket, {omit: ['layers']});\r\n\r\nmodule.exports = FillExtrusionBucket;\r\n\r\nfunction isBoundaryEdge(p1, p2) {\r\n    return (p1.x === p2.x && (p1.x < 0 || p1.x > EXTENT)) ||\r\n        (p1.y === p2.y && (p1.y < 0 || p1.y > EXTENT));\r\n}\r\n\r\nfunction isEntirelyOutside(ring) {\r\n    return ring.every(p => p.x < 0) ||\r\n        ring.every(p => p.x > EXTENT) ||\r\n        ring.every(p => p.y < 0) ||\r\n        ring.every(p => p.y > EXTENT);\r\n}\r\n","// @flow\r\n\r\nconst CircleBucket = require('./circle_bucket');\r\nconst {register} = require('../../util/web_worker_transfer');\r\n\r\nimport type HeatmapStyleLayer from '../../style/style_layer/heatmap_style_layer';\r\n\r\nclass HeatmapBucket extends CircleBucket<HeatmapStyleLayer> {\r\n    // Needed for flow to accept omit: ['layers'] below, due to\r\n    // https://github.com/facebook/flow/issues/4262\r\n    layers: Array<HeatmapStyleLayer>;\r\n}\r\n\r\nregister('HeatmapBucket', HeatmapBucket, {omit: ['layers']});\r\n\r\nmodule.exports = HeatmapBucket;\r\n","// @flow\r\nconst {createLayout} = require('../../util/struct_array');\r\nmodule.exports = createLayout([\r\n    {name: 'a_pos_normal', components: 4, type: 'Int16'},\r\n    {name: 'a_data', components: 4, type: 'Uint8'}\r\n], 4);\r\n","// @flow\r\n\r\nconst {LineLayoutArray} = require('../array_types');\r\nconst layoutAttributes = require('./line_attributes').members;\r\nconst {SegmentVector} = require('../segment');\r\nconst {ProgramConfigurationSet} = require('../program_configuration');\r\nconst {TriangleIndexArray} = require('../index_array_type');\r\nconst loadGeometry = require('../load_geometry');\r\nconst EXTENT = require('../extent');\r\nconst vectorTileFeatureTypes = require('@mapbox/vector-tile').VectorTileFeature.types;\r\nconst {register} = require('../../util/web_worker_transfer');\r\n\r\nimport type {\r\n    Bucket,\r\n    BucketParameters,\r\n    IndexedFeature,\r\n    PopulateParameters\r\n} from '../bucket';\r\nimport type LineStyleLayer from '../../style/style_layer/line_style_layer';\r\nimport type Point from '@mapbox/point-geometry';\r\nimport type {Segment} from '../segment';\r\nimport type Context from '../../gl/context';\r\nimport type IndexBuffer from '../../gl/index_buffer';\r\nimport type VertexBuffer from '../../gl/vertex_buffer';\r\n\r\n// NOTE ON EXTRUDE SCALE:\r\n// scale the extrusion vector so that the normal length is this value.\r\n// contains the \"texture\" normals (-1..1). this is distinct from the extrude\r\n// normals for line joins, because the x-value remains 0 for the texture\r\n// normal array, while the extrude normal actually moves the vertex to create\r\n// the acute/bevelled line join.\r\nconst EXTRUDE_SCALE = 63;\r\n\r\n/*\r\n * Sharp corners cause dashed lines to tilt because the distance along the line\r\n * is the same at both the inner and outer corners. To improve the appearance of\r\n * dashed lines we add extra points near sharp corners so that a smaller part\r\n * of the line is tilted.\r\n *\r\n * COS_HALF_SHARP_CORNER controls how sharp a corner has to be for us to add an\r\n * extra vertex. The default is 75 degrees.\r\n *\r\n * The newly created vertices are placed SHARP_CORNER_OFFSET pixels from the corner.\r\n */\r\nconst COS_HALF_SHARP_CORNER = Math.cos(75 / 2 * (Math.PI / 180));\r\nconst SHARP_CORNER_OFFSET = 15;\r\n\r\n// The number of bits that is used to store the line distance in the buffer.\r\nconst LINE_DISTANCE_BUFFER_BITS = 15;\r\n\r\n// We don't have enough bits for the line distance as we'd like to have, so\r\n// use this value to scale the line distance (in tile units) down to a smaller\r\n// value. This lets us store longer distances while sacrificing precision.\r\nconst LINE_DISTANCE_SCALE = 1 / 2;\r\n\r\n// The maximum line distance, in tile units, that fits in the buffer.\r\nconst MAX_LINE_DISTANCE = Math.pow(2, LINE_DISTANCE_BUFFER_BITS - 1) / LINE_DISTANCE_SCALE;\r\n\r\nfunction addLineVertex(layoutVertexBuffer, point: Point, extrude: Point, round: boolean, up: boolean, dir: number, linesofar: number) {\r\n    layoutVertexBuffer.emplaceBack(\r\n        // a_pos_normal\r\n        point.x,\r\n        point.y,\r\n        round ? 1 : 0,\r\n        up ? 1 : -1,\r\n        // a_data\r\n        // add 128 to store a byte in an unsigned byte\r\n        Math.round(EXTRUDE_SCALE * extrude.x) + 128,\r\n        Math.round(EXTRUDE_SCALE * extrude.y) + 128,\r\n        // Encode the -1/0/1 direction value into the first two bits of .z of a_data.\r\n        // Combine it with the lower 6 bits of `linesofar` (shifted by 2 bites to make\r\n        // room for the direction value). The upper 8 bits of `linesofar` are placed in\r\n        // the `w` component. `linesofar` is scaled down by `LINE_DISTANCE_SCALE` so that\r\n        // we can store longer distances while sacrificing precision.\r\n        ((dir === 0 ? 0 : (dir < 0 ? -1 : 1)) + 1) | (((linesofar * LINE_DISTANCE_SCALE) & 0x3F) << 2),\r\n        (linesofar * LINE_DISTANCE_SCALE) >> 6);\r\n}\r\n\r\n\r\n/**\r\n * @private\r\n */\r\nclass LineBucket implements Bucket {\r\n    distance: number;\r\n    e1: number;\r\n    e2: number;\r\n    e3: number;\r\n\r\n    index: number;\r\n    zoom: number;\r\n    overscaling: number;\r\n    layers: Array<LineStyleLayer>;\r\n    layerIds: Array<string>;\r\n\r\n    layoutVertexArray: LineLayoutArray;\r\n    layoutVertexBuffer: VertexBuffer;\r\n\r\n    indexArray: TriangleIndexArray;\r\n    indexBuffer: IndexBuffer;\r\n\r\n    programConfigurations: ProgramConfigurationSet<LineStyleLayer>;\r\n    segments: SegmentVector;\r\n    uploaded: boolean;\r\n\r\n    constructor(options: BucketParameters<LineStyleLayer>) {\r\n        this.zoom = options.zoom;\r\n        this.overscaling = options.overscaling;\r\n        this.layers = options.layers;\r\n        this.layerIds = this.layers.map(layer => layer.id);\r\n        this.index = options.index;\r\n\r\n        this.layoutVertexArray = new LineLayoutArray();\r\n        this.indexArray = new TriangleIndexArray();\r\n        this.programConfigurations = new ProgramConfigurationSet(layoutAttributes, options.layers, options.zoom);\r\n        this.segments = new SegmentVector();\r\n    }\r\n\r\n    populate(features: Array<IndexedFeature>, options: PopulateParameters) {\r\n        for (const {feature, index, sourceLayerIndex} of features) {\r\n            if (this.layers[0]._featureFilter({zoom: this.zoom}, feature)) {\r\n                const geometry = loadGeometry(feature);\r\n                this.addFeature(feature, geometry);\r\n                options.featureIndex.insert(feature, geometry, index, sourceLayerIndex, this.index);\r\n            }\r\n        }\r\n    }\r\n\r\n    isEmpty() {\r\n        return this.layoutVertexArray.length === 0;\r\n    }\r\n\r\n    upload(context: Context) {\r\n        this.layoutVertexBuffer = context.createVertexBuffer(this.layoutVertexArray, layoutAttributes);\r\n        this.indexBuffer = context.createIndexBuffer(this.indexArray);\r\n        this.programConfigurations.upload(context);\r\n    }\r\n\r\n    destroy() {\r\n        if (!this.layoutVertexBuffer) return;\r\n        this.layoutVertexBuffer.destroy();\r\n        this.indexBuffer.destroy();\r\n        this.programConfigurations.destroy();\r\n        this.segments.destroy();\r\n    }\r\n\r\n    addFeature(feature: VectorTileFeature, geometry: Array<Array<Point>>) {\r\n        const layout = this.layers[0].layout;\r\n        const join = layout.get('line-join').evaluate(feature);\r\n        const cap = layout.get('line-cap');\r\n        const miterLimit = layout.get('line-miter-limit');\r\n        const roundLimit = layout.get('line-round-limit');\r\n\r\n        for (const line of geometry) {\r\n            this.addLine(line, feature, join, cap, miterLimit, roundLimit);\r\n        }\r\n    }\r\n\r\n    addLine(vertices: Array<Point>, feature: VectorTileFeature, join: string, cap: string, miterLimit: number, roundLimit: number) {\r\n        const isPolygon = vectorTileFeatureTypes[feature.type] === 'Polygon';\r\n\r\n        // If the line has duplicate vertices at the ends, adjust start/length to remove them.\r\n        let len = vertices.length;\r\n        while (len >= 2 && vertices[len - 1].equals(vertices[len - 2])) {\r\n            len--;\r\n        }\r\n        let first = 0;\r\n        while (first < len - 1 && vertices[first].equals(vertices[first + 1])) {\r\n            first++;\r\n        }\r\n\r\n        // Ignore invalid geometry.\r\n        if (len < (isPolygon ? 3 : 2)) return;\r\n\r\n        if (join === 'bevel') miterLimit = 1.05;\r\n\r\n        const sharpCornerOffset = SHARP_CORNER_OFFSET * (EXTENT / (512 * this.overscaling));\r\n\r\n        const firstVertex = vertices[first];\r\n\r\n        // we could be more precise, but it would only save a negligible amount of space\r\n        const segment = this.segments.prepareSegment(len * 10, this.layoutVertexArray, this.indexArray);\r\n\r\n        this.distance = 0;\r\n\r\n        const beginCap = cap,\r\n            endCap = isPolygon ? 'butt' : cap;\r\n        let startOfLine = true;\r\n        let currentVertex;\r\n        let prevVertex = ((undefined: any): Point);\r\n        let nextVertex = ((undefined: any): Point);\r\n        let prevNormal = ((undefined: any): Point);\r\n        let nextNormal = ((undefined: any): Point);\r\n        let offsetA;\r\n        let offsetB;\r\n\r\n        // the last three vertices added\r\n        this.e1 = this.e2 = this.e3 = -1;\r\n\r\n        if (isPolygon) {\r\n            currentVertex = vertices[len - 2];\r\n            nextNormal = firstVertex.sub(currentVertex)._unit()._perp();\r\n        }\r\n\r\n        for (let i = first; i < len; i++) {\r\n\r\n            nextVertex = isPolygon && i === len - 1 ?\r\n                vertices[first + 1] : // if the line is closed, we treat the last vertex like the first\r\n                vertices[i + 1]; // just the next vertex\r\n\r\n            // if two consecutive vertices exist, skip the current one\r\n            if (nextVertex && vertices[i].equals(nextVertex)) continue;\r\n\r\n            if (nextNormal) prevNormal = nextNormal;\r\n            if (currentVertex) prevVertex = currentVertex;\r\n\r\n            currentVertex = vertices[i];\r\n\r\n            // Calculate the normal towards the next vertex in this line. In case\r\n            // there is no next vertex, pretend that the line is continuing straight,\r\n            // meaning that we are just using the previous normal.\r\n            nextNormal = nextVertex ? nextVertex.sub(currentVertex)._unit()._perp() : prevNormal;\r\n\r\n            // If we still don't have a previous normal, this is the beginning of a\r\n            // non-closed line, so we're doing a straight \"join\".\r\n            prevNormal = prevNormal || nextNormal;\r\n\r\n            // Determine the normal of the join extrusion. It is the angle bisector\r\n            // of the segments between the previous line and the next line.\r\n            // In the case of 180° angles, the prev and next normals cancel each other out:\r\n            // prevNormal + nextNormal = (0, 0), its magnitude is 0, so the unit vector would be\r\n            // undefined. In that case, we're keeping the joinNormal at (0, 0), so that the cosHalfAngle\r\n            // below will also become 0 and miterLength will become Infinity.\r\n            let joinNormal = prevNormal.add(nextNormal);\r\n            if (joinNormal.x !== 0 || joinNormal.y !== 0) {\r\n                joinNormal._unit();\r\n            }\r\n            /*  joinNormal     prevNormal\r\n             *             ↖      ↑\r\n             *                .________. prevVertex\r\n             *                |\r\n             * nextNormal  ←  |  currentVertex\r\n             *                |\r\n             *     nextVertex !\r\n             *\r\n             */\r\n\r\n            // Calculate the length of the miter (the ratio of the miter to the width).\r\n            // Find the cosine of the angle between the next and join normals\r\n            // using dot product. The inverse of that is the miter length.\r\n            const cosHalfAngle = joinNormal.x * nextNormal.x + joinNormal.y * nextNormal.y;\r\n            const miterLength = cosHalfAngle !== 0 ? 1 / cosHalfAngle : Infinity;\r\n\r\n            const isSharpCorner = cosHalfAngle < COS_HALF_SHARP_CORNER && prevVertex && nextVertex;\r\n\r\n            if (isSharpCorner && i > first) {\r\n                const prevSegmentLength = currentVertex.dist(prevVertex);\r\n                if (prevSegmentLength > 2 * sharpCornerOffset) {\r\n                    const newPrevVertex = currentVertex.sub(currentVertex.sub(prevVertex)._mult(sharpCornerOffset / prevSegmentLength)._round());\r\n                    this.distance += newPrevVertex.dist(prevVertex);\r\n                    this.addCurrentVertex(newPrevVertex, this.distance, prevNormal.mult(1), 0, 0, false, segment);\r\n                    prevVertex = newPrevVertex;\r\n                }\r\n            }\r\n\r\n            // The join if a middle vertex, otherwise the cap.\r\n            const middleVertex = prevVertex && nextVertex;\r\n            let currentJoin = middleVertex ? join : nextVertex ? beginCap : endCap;\r\n\r\n            if (middleVertex && currentJoin === 'round') {\r\n                if (miterLength < roundLimit) {\r\n                    currentJoin = 'miter';\r\n                } else if (miterLength <= 2) {\r\n                    currentJoin = 'fakeround';\r\n                }\r\n            }\r\n\r\n            if (currentJoin === 'miter' && miterLength > miterLimit) {\r\n                currentJoin = 'bevel';\r\n            }\r\n\r\n            if (currentJoin === 'bevel') {\r\n                // The maximum extrude length is 128 / 63 = 2 times the width of the line\r\n                // so if miterLength >= 2 we need to draw a different type of bevel here.\r\n                if (miterLength > 2) currentJoin = 'flipbevel';\r\n\r\n                // If the miterLength is really small and the line bevel wouldn't be visible,\r\n                // just draw a miter join to save a triangle.\r\n                if (miterLength < miterLimit) currentJoin = 'miter';\r\n            }\r\n\r\n            // Calculate how far along the line the currentVertex is\r\n            if (prevVertex) this.distance += currentVertex.dist(prevVertex);\r\n\r\n            if (currentJoin === 'miter') {\r\n\r\n                joinNormal._mult(miterLength);\r\n                this.addCurrentVertex(currentVertex, this.distance, joinNormal, 0, 0, false, segment);\r\n\r\n            } else if (currentJoin === 'flipbevel') {\r\n                // miter is too big, flip the direction to make a beveled join\r\n\r\n                if (miterLength > 100) {\r\n                    // Almost parallel lines\r\n                    joinNormal = nextNormal.clone().mult(-1);\r\n\r\n                } else {\r\n                    const direction = prevNormal.x * nextNormal.y - prevNormal.y * nextNormal.x > 0 ? -1 : 1;\r\n                    const bevelLength = miterLength * prevNormal.add(nextNormal).mag() / prevNormal.sub(nextNormal).mag();\r\n                    joinNormal._perp()._mult(bevelLength * direction);\r\n                }\r\n                this.addCurrentVertex(currentVertex, this.distance, joinNormal, 0, 0, false, segment);\r\n                this.addCurrentVertex(currentVertex, this.distance, joinNormal.mult(-1), 0, 0, false, segment);\r\n\r\n            } else if (currentJoin === 'bevel' || currentJoin === 'fakeround') {\r\n                const lineTurnsLeft = (prevNormal.x * nextNormal.y - prevNormal.y * nextNormal.x) > 0;\r\n                const offset = -Math.sqrt(miterLength * miterLength - 1);\r\n                if (lineTurnsLeft) {\r\n                    offsetB = 0;\r\n                    offsetA = offset;\r\n                } else {\r\n                    offsetA = 0;\r\n                    offsetB = offset;\r\n                }\r\n\r\n                // Close previous segment with a bevel\r\n                if (!startOfLine) {\r\n                    this.addCurrentVertex(currentVertex, this.distance, prevNormal, offsetA, offsetB, false, segment);\r\n                }\r\n\r\n                if (currentJoin === 'fakeround') {\r\n                    // The join angle is sharp enough that a round join would be visible.\r\n                    // Bevel joins fill the gap between segments with a single pie slice triangle.\r\n                    // Create a round join by adding multiple pie slices. The join isn't actually round, but\r\n                    // it looks like it is at the sizes we render lines at.\r\n\r\n                    // Add more triangles for sharper angles.\r\n                    // This math is just a good enough approximation. It isn't \"correct\".\r\n                    const n = Math.floor((0.5 - (cosHalfAngle - 0.5)) * 8);\r\n                    let approxFractionalJoinNormal;\r\n\r\n                    for (let m = 0; m < n; m++) {\r\n                        approxFractionalJoinNormal = nextNormal.mult((m + 1) / (n + 1))._add(prevNormal)._unit();\r\n                        this.addPieSliceVertex(currentVertex, this.distance, approxFractionalJoinNormal, lineTurnsLeft, segment);\r\n                    }\r\n\r\n                    this.addPieSliceVertex(currentVertex, this.distance, joinNormal, lineTurnsLeft, segment);\r\n\r\n                    for (let k = n - 1; k >= 0; k--) {\r\n                        approxFractionalJoinNormal = prevNormal.mult((k + 1) / (n + 1))._add(nextNormal)._unit();\r\n                        this.addPieSliceVertex(currentVertex, this.distance, approxFractionalJoinNormal, lineTurnsLeft, segment);\r\n                    }\r\n                }\r\n\r\n                // Start next segment\r\n                if (nextVertex) {\r\n                    this.addCurrentVertex(currentVertex, this.distance, nextNormal, -offsetA, -offsetB, false, segment);\r\n                }\r\n\r\n            } else if (currentJoin === 'butt') {\r\n                if (!startOfLine) {\r\n                    // Close previous segment with a butt\r\n                    this.addCurrentVertex(currentVertex, this.distance, prevNormal, 0, 0, false, segment);\r\n                }\r\n\r\n                // Start next segment with a butt\r\n                if (nextVertex) {\r\n                    this.addCurrentVertex(currentVertex, this.distance, nextNormal, 0, 0, false, segment);\r\n                }\r\n\r\n            } else if (currentJoin === 'square') {\r\n\r\n                if (!startOfLine) {\r\n                    // Close previous segment with a square cap\r\n                    this.addCurrentVertex(currentVertex, this.distance, prevNormal, 1, 1, false, segment);\r\n\r\n                    // The segment is done. Unset vertices to disconnect segments.\r\n                    this.e1 = this.e2 = -1;\r\n                }\r\n\r\n                // Start next segment\r\n                if (nextVertex) {\r\n                    this.addCurrentVertex(currentVertex, this.distance, nextNormal, -1, -1, false, segment);\r\n                }\r\n\r\n            } else if (currentJoin === 'round') {\r\n\r\n                if (!startOfLine) {\r\n                    // Close previous segment with butt\r\n                    this.addCurrentVertex(currentVertex, this.distance, prevNormal, 0, 0, false, segment);\r\n\r\n                    // Add round cap or linejoin at end of segment\r\n                    this.addCurrentVertex(currentVertex, this.distance, prevNormal, 1, 1, true, segment);\r\n\r\n                    // The segment is done. Unset vertices to disconnect segments.\r\n                    this.e1 = this.e2 = -1;\r\n                }\r\n\r\n\r\n                // Start next segment with a butt\r\n                if (nextVertex) {\r\n                    // Add round cap before first segment\r\n                    this.addCurrentVertex(currentVertex, this.distance, nextNormal, -1, -1, true, segment);\r\n\r\n                    this.addCurrentVertex(currentVertex, this.distance, nextNormal, 0, 0, false, segment);\r\n                }\r\n            }\r\n\r\n            if (isSharpCorner && i < len - 1) {\r\n                const nextSegmentLength = currentVertex.dist(nextVertex);\r\n                if (nextSegmentLength > 2 * sharpCornerOffset) {\r\n                    const newCurrentVertex = currentVertex.add(nextVertex.sub(currentVertex)._mult(sharpCornerOffset / nextSegmentLength)._round());\r\n                    this.distance += newCurrentVertex.dist(currentVertex);\r\n                    this.addCurrentVertex(newCurrentVertex, this.distance, nextNormal.mult(1), 0, 0, false, segment);\r\n                    currentVertex = newCurrentVertex;\r\n                }\r\n            }\r\n\r\n            startOfLine = false;\r\n        }\r\n\r\n        this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length, feature);\r\n    }\r\n\r\n    /**\r\n     * Add two vertices to the buffers.\r\n     *\r\n     * @param {Object} currentVertex the line vertex to add buffer vertices for\r\n     * @param {number} distance the distance from the beginning of the line to the vertex\r\n     * @param {number} endLeft extrude to shift the left vertex along the line\r\n     * @param {number} endRight extrude to shift the left vertex along the line\r\n     * @param {boolean} round whether this is a round cap\r\n     * @private\r\n     */\r\n    addCurrentVertex(currentVertex: Point,\r\n                     distance: number,\r\n                     normal: Point,\r\n                     endLeft: number,\r\n                     endRight: number,\r\n                     round: boolean,\r\n                     segment: Segment) {\r\n        let extrude;\r\n        const layoutVertexArray = this.layoutVertexArray;\r\n        const indexArray = this.indexArray;\r\n\r\n        extrude = normal.clone();\r\n        if (endLeft) extrude._sub(normal.perp()._mult(endLeft));\r\n        addLineVertex(layoutVertexArray, currentVertex, extrude, round, false, endLeft, distance);\r\n        this.e3 = segment.vertexLength++;\r\n        if (this.e1 >= 0 && this.e2 >= 0) {\r\n            indexArray.emplaceBack(this.e1, this.e2, this.e3);\r\n            segment.primitiveLength++;\r\n        }\r\n        this.e1 = this.e2;\r\n        this.e2 = this.e3;\r\n\r\n        extrude = normal.mult(-1);\r\n        if (endRight) extrude._sub(normal.perp()._mult(endRight));\r\n        addLineVertex(layoutVertexArray, currentVertex, extrude, round, true, -endRight, distance);\r\n        this.e3 = segment.vertexLength++;\r\n        if (this.e1 >= 0 && this.e2 >= 0) {\r\n            indexArray.emplaceBack(this.e1, this.e2, this.e3);\r\n            segment.primitiveLength++;\r\n        }\r\n        this.e1 = this.e2;\r\n        this.e2 = this.e3;\r\n\r\n        // There is a maximum \"distance along the line\" that we can store in the buffers.\r\n        // When we get close to the distance, reset it to zero and add the vertex again with\r\n        // a distance of zero. The max distance is determined by the number of bits we allocate\r\n        // to `linesofar`.\r\n        if (distance > MAX_LINE_DISTANCE / 2) {\r\n            this.distance = 0;\r\n            this.addCurrentVertex(currentVertex, this.distance, normal, endLeft, endRight, round, segment);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Add a single new vertex and a triangle using two previous vertices.\r\n     * This adds a pie slice triangle near a join to simulate round joins\r\n     *\r\n     * @param currentVertex the line vertex to add buffer vertices for\r\n     * @param distance the distance from the beggining of the line to the vertex\r\n     * @param extrude the offset of the new vertex from the currentVertex\r\n     * @param lineTurnsLeft whether the line is turning left or right at this angle\r\n     * @private\r\n     */\r\n    addPieSliceVertex(currentVertex: Point,\r\n                      distance: number,\r\n                      extrude: Point,\r\n                      lineTurnsLeft: boolean,\r\n                      segment: Segment) {\r\n        extrude = extrude.mult(lineTurnsLeft ? -1 : 1);\r\n        const layoutVertexArray = this.layoutVertexArray;\r\n        const indexArray = this.indexArray;\r\n\r\n        addLineVertex(layoutVertexArray, currentVertex, extrude, false, lineTurnsLeft, 0, distance);\r\n        this.e3 = segment.vertexLength++;\r\n        if (this.e1 >= 0 && this.e2 >= 0) {\r\n            indexArray.emplaceBack(this.e1, this.e2, this.e3);\r\n            segment.primitiveLength++;\r\n        }\r\n\r\n        if (lineTurnsLeft) {\r\n            this.e2 = this.e3;\r\n        } else {\r\n            this.e1 = this.e3;\r\n        }\r\n    }\r\n}\r\n\r\nregister('LineBucket', LineBucket, {omit: ['layers']});\r\n\r\nmodule.exports = LineBucket;\r\n","// @flow\r\n\r\nconst {createLayout} = require('../../util/struct_array');\r\nimport type {StructArrayLayout} from '../../util/struct_array';\r\n\r\nconst symbolLayoutAttributes = createLayout([\r\n    {name: 'a_pos_offset',  components: 4, type: 'Int16'},\r\n    {name: 'a_data',        components: 4, type: 'Uint16'}\r\n]);\r\n\r\nconst dynamicLayoutAttributes = createLayout([\r\n    { name: 'a_projected_pos', components: 3, type: 'Float32' }\r\n], 4);\r\n\r\nconst placementOpacityAttributes = createLayout([\r\n    { name: 'a_fade_opacity', components: 1, type: 'Uint32' }\r\n], 4);\r\n\r\nconst collisionVertexAttributes = createLayout([\r\n    { name: 'a_placed', components: 2, type: 'Uint8' }\r\n], 4);\r\n\r\nconst symbolAttributes: {[string]: StructArrayLayout} = {\r\n    symbolLayoutAttributes,\r\n    dynamicLayoutAttributes,\r\n    placementOpacityAttributes,\r\n    collisionVertexAttributes,\r\n    collisionBox: createLayout([\r\n        // the box is centered around the anchor point\r\n        { type: 'Int16', name: 'anchorPointX' },\r\n        { type: 'Int16', name: 'anchorPointY' },\r\n\r\n        // distances to the edges from the anchor\r\n        { type: 'Int16', name: 'x1' },\r\n        { type: 'Int16', name: 'y1' },\r\n        { type: 'Int16', name: 'x2' },\r\n        { type: 'Int16', name: 'y2' },\r\n\r\n        // the index of the feature in the original vectortile\r\n        { type: 'Uint32', name: 'featureIndex' },\r\n        // the source layer the feature appears in\r\n        { type: 'Uint16', name: 'sourceLayerIndex' },\r\n        // the bucket the feature appears in\r\n        { type: 'Uint16', name: 'bucketIndex' },\r\n\r\n        // collision circles for lines store their distance to the anchor in tile units\r\n        // so that they can be ignored if the projected label doesn't extend into\r\n        // the box area\r\n        { type: 'Int16', name: 'radius' },\r\n        { type: 'Int16', name: 'signedDistanceFromAnchor' }\r\n    ]),\r\n    collisionBoxLayout: createLayout([ // used to render collision boxes for debugging purposes\r\n        {name: 'a_pos',        components: 2, type: 'Int16'},\r\n        {name: 'a_anchor_pos', components: 2, type: 'Int16'},\r\n        {name: 'a_extrude',    components: 2, type: 'Int16'}\r\n    ], 4),\r\n    collisionCircleLayout: createLayout([ // used to render collision circles for debugging purposes\r\n        {name: 'a_pos',        components: 2, type: 'Int16'},\r\n        {name: 'a_anchor_pos', components: 2, type: 'Int16'},\r\n        {name: 'a_extrude',    components: 2, type: 'Int16'}\r\n    ], 4),\r\n    placement: createLayout([\r\n        { type: 'Int16', name: 'anchorX' },\r\n        { type: 'Int16', name: 'anchorY' },\r\n        { type: 'Uint16', name: 'glyphStartIndex' },\r\n        { type: 'Uint16', name: 'numGlyphs' },\r\n        { type: 'Uint32', name: 'vertexStartIndex' },\r\n        { type: 'Uint32', name: 'lineStartIndex' },\r\n        { type: 'Uint32', name: 'lineLength' },\r\n        { type: 'Uint16', name: 'segment' },\r\n        { type: 'Uint16', name: 'lowerSize' },\r\n        { type: 'Uint16', name: 'upperSize' },\r\n        { type: 'Float32', name: 'lineOffsetX' },\r\n        { type: 'Float32', name: 'lineOffsetY' },\r\n        { type: 'Uint8', name: 'writingMode' },\r\n        { type: 'Uint8', name: 'hidden' }\r\n    ]),\r\n    glyphOffset: createLayout([\r\n        { type: 'Float32', name: 'offsetX' }\r\n    ]),\r\n    lineVertex: createLayout([\r\n        { type: 'Int16', name: 'x' },\r\n        { type: 'Int16', name: 'y' },\r\n        { type: 'Int16', name: 'tileUnitDistanceFromAnchor' }\r\n    ])\r\n};\r\n\r\nmodule.exports = symbolAttributes;\r\n","// @flow\r\n\r\nconst {\r\n    symbolLayoutAttributes,\r\n    collisionVertexAttributes,\r\n    collisionBoxLayout,\r\n    collisionCircleLayout,\r\n    dynamicLayoutAttributes\r\n} = require('./symbol_attributes');\r\n\r\nconst {\r\n    SymbolLayoutArray,\r\n    SymbolDynamicLayoutArray,\r\n    SymbolOpacityArray,\r\n    CollisionBoxLayoutArray,\r\n    CollisionCircleLayoutArray,\r\n    CollisionVertexArray,\r\n    PlacedSymbolArray,\r\n    GlyphOffsetArray,\r\n    SymbolLineVertexArray\r\n} = require('../array_types');\r\n\r\nconst Point = require('@mapbox/point-geometry');\r\nconst {SegmentVector} = require('../segment');\r\nconst {ProgramConfigurationSet} = require('../program_configuration');\r\nconst {TriangleIndexArray, LineIndexArray} = require('../index_array_type');\r\nconst transformText = require('../../symbol/transform_text');\r\nconst mergeLines = require('../../symbol/mergelines');\r\nconst scriptDetection = require('../../util/script_detection');\r\nconst loadGeometry = require('../load_geometry');\r\nconst vectorTileFeatureTypes = require('@mapbox/vector-tile').VectorTileFeature.types;\r\nconst verticalizePunctuation = require('../../util/verticalize_punctuation');\r\nconst Anchor = require('../../symbol/anchor');\r\nconst {getSizeData} = require('../../symbol/symbol_size');\r\nconst {register} = require('../../util/web_worker_transfer');\r\n\r\nimport type {Feature as ExpressionFeature} from '../../style-spec/expression';\r\nimport type {\r\n    Bucket,\r\n    BucketParameters,\r\n    IndexedFeature,\r\n    PopulateParameters\r\n} from '../bucket';\r\nimport type {CollisionBoxArray, CollisionBox} from '../array_types';\r\nimport type { StructArray, StructArrayMember } from '../../util/struct_array';\r\nimport type SymbolStyleLayer from '../../style/style_layer/symbol_style_layer';\r\nimport type Context from '../../gl/context';\r\nimport type IndexBuffer from '../../gl/index_buffer';\r\nimport type VertexBuffer from '../../gl/vertex_buffer';\r\nimport type {SymbolQuad} from '../../symbol/quads';\r\nimport type {SizeData} from '../../symbol/symbol_size';\r\n\r\nexport type SingleCollisionBox = {\r\n    x1: number;\r\n    y1: number;\r\n    x2: number;\r\n    y2: number;\r\n    anchorPointX: number;\r\n    anchorPointY: number;\r\n};\r\n\r\nexport type CollisionArrays = {\r\n    textBox?: SingleCollisionBox;\r\n    iconBox?: SingleCollisionBox;\r\n    textCircles?: Array<number>;\r\n};\r\n\r\nexport type SymbolInstance = {\r\n    key: string,\r\n    textBoxStartIndex: number,\r\n    textBoxEndIndex: number,\r\n    iconBoxStartIndex: number,\r\n    iconBoxEndIndex: number,\r\n    textOffset: [number, number],\r\n    iconOffset: [number, number],\r\n    anchor: Anchor,\r\n    line: Array<Point>,\r\n    featureIndex: number,\r\n    feature: ExpressionFeature,\r\n    textCollisionFeature?: {boxStartIndex: number, boxEndIndex: number},\r\n    iconCollisionFeature?: {boxStartIndex: number, boxEndIndex: number},\r\n    placedTextSymbolIndices: Array<number>;\r\n    numGlyphVertices: number;\r\n    numVerticalGlyphVertices: number;\r\n    numIconVertices: number;\r\n    // Populated/modified on foreground during placement\r\n    isDuplicate: boolean;\r\n    crossTileID: number;\r\n    collisionArrays?: CollisionArrays;\r\n    placedText?: boolean;\r\n    placedIcon?: boolean;\r\n    hidden?: boolean;\r\n};\r\n\r\nexport type SymbolFeature = {|\r\n    text: string | void,\r\n    icon: string | void,\r\n    index: number,\r\n    sourceLayerIndex: number,\r\n    geometry: Array<Array<Point>>,\r\n    properties: Object,\r\n    type: 'Point' | 'LineString' | 'Polygon',\r\n    id?: any\r\n|};\r\n\r\n// Opacity arrays are frequently updated but don't contain a lot of information, so we pack them\r\n// tight. Each Uint32 is actually four duplicate Uint8s for the four corners of a glyph\r\n// 7 bits are for the current opacity, and the lowest bit is the target opacity\r\n\r\n// actually defined in symbol_attributes.js\r\n// const placementOpacityAttributes = [\r\n//     { name: 'a_fade_opacity', components: 1, type: 'Uint32' }\r\n// ];\r\nconst shaderOpacityAttributes = [\r\n    { name: 'a_fade_opacity', components: 1, type: 'Uint8', offset: 0 }\r\n];\r\n\r\nfunction addVertex(array, anchorX, anchorY, ox, oy, tx, ty, sizeVertex) {\r\n    array.emplaceBack(\r\n        // a_pos_offset\r\n        anchorX,\r\n        anchorY,\r\n        Math.round(ox * 64),\r\n        Math.round(oy * 64),\r\n\r\n        // a_data\r\n        tx, // x coordinate of symbol on glyph atlas texture\r\n        ty, // y coordinate of symbol on glyph atlas texture\r\n        sizeVertex ? sizeVertex[0] : 0,\r\n        sizeVertex ? sizeVertex[1] : 0\r\n    );\r\n}\r\n\r\nfunction addDynamicAttributes(dynamicLayoutVertexArray: StructArray, p: Point, angle: number) {\r\n    dynamicLayoutVertexArray.emplaceBack(p.x, p.y, angle);\r\n    dynamicLayoutVertexArray.emplaceBack(p.x, p.y, angle);\r\n    dynamicLayoutVertexArray.emplaceBack(p.x, p.y, angle);\r\n    dynamicLayoutVertexArray.emplaceBack(p.x, p.y, angle);\r\n}\r\n\r\nclass SymbolBuffers {\r\n    layoutVertexArray: SymbolLayoutArray;\r\n    layoutVertexBuffer: VertexBuffer;\r\n\r\n    indexArray: TriangleIndexArray;\r\n    indexBuffer: IndexBuffer;\r\n\r\n    programConfigurations: ProgramConfigurationSet<SymbolStyleLayer>;\r\n    segments: SegmentVector;\r\n\r\n    dynamicLayoutVertexArray: SymbolDynamicLayoutArray;\r\n    dynamicLayoutVertexBuffer: VertexBuffer;\r\n\r\n    opacityVertexArray: SymbolOpacityArray;\r\n    opacityVertexBuffer: VertexBuffer;\r\n\r\n    collisionVertexArray: CollisionVertexArray;\r\n    collisionVertexBuffer: VertexBuffer;\r\n\r\n    placedSymbolArray: PlacedSymbolArray;\r\n\r\n    constructor(programConfigurations: ProgramConfigurationSet<SymbolStyleLayer>) {\r\n        this.layoutVertexArray = new SymbolLayoutArray();\r\n        this.indexArray = new TriangleIndexArray();\r\n        this.programConfigurations = programConfigurations;\r\n        this.segments = new SegmentVector();\r\n        this.dynamicLayoutVertexArray = new SymbolDynamicLayoutArray();\r\n        this.opacityVertexArray = new SymbolOpacityArray();\r\n        this.placedSymbolArray = new PlacedSymbolArray();\r\n    }\r\n\r\n    upload(context: Context, dynamicIndexBuffer: boolean) {\r\n        this.layoutVertexBuffer = context.createVertexBuffer(this.layoutVertexArray, symbolLayoutAttributes.members);\r\n        this.indexBuffer = context.createIndexBuffer(this.indexArray, dynamicIndexBuffer);\r\n        this.programConfigurations.upload(context);\r\n        this.dynamicLayoutVertexBuffer = context.createVertexBuffer(this.dynamicLayoutVertexArray, dynamicLayoutAttributes.members, true);\r\n        this.opacityVertexBuffer = context.createVertexBuffer(this.opacityVertexArray, shaderOpacityAttributes, true);\r\n        // This is a performance hack so that we can write to opacityVertexArray with uint32s\r\n        // even though the shaders read uint8s\r\n        this.opacityVertexBuffer.itemSize = 1;\r\n    }\r\n\r\n    destroy() {\r\n        if (!this.layoutVertexBuffer) return;\r\n        this.layoutVertexBuffer.destroy();\r\n        this.indexBuffer.destroy();\r\n        this.programConfigurations.destroy();\r\n        this.segments.destroy();\r\n        this.dynamicLayoutVertexBuffer.destroy();\r\n        this.opacityVertexBuffer.destroy();\r\n    }\r\n}\r\n\r\nregister('SymbolBuffers', SymbolBuffers);\r\n\r\nclass CollisionBuffers {\r\n    layoutVertexArray: StructArray;\r\n    layoutAttributes: Array<StructArrayMember>;\r\n    layoutVertexBuffer: VertexBuffer;\r\n\r\n    indexArray: TriangleIndexArray | LineIndexArray;\r\n    indexBuffer: IndexBuffer;\r\n\r\n    segments: SegmentVector;\r\n\r\n    collisionVertexArray: CollisionVertexArray;\r\n    collisionVertexBuffer: VertexBuffer;\r\n\r\n    constructor(LayoutArray: Class<StructArray>,\r\n                layoutAttributes: Array<StructArrayMember>,\r\n                IndexArray: Class<TriangleIndexArray | LineIndexArray>) {\r\n        this.layoutVertexArray = new LayoutArray();\r\n        this.layoutAttributes = layoutAttributes;\r\n        this.indexArray = new IndexArray();\r\n        this.segments = new SegmentVector();\r\n        this.collisionVertexArray = new CollisionVertexArray();\r\n    }\r\n\r\n    upload(context: Context) {\r\n        this.layoutVertexBuffer = context.createVertexBuffer(this.layoutVertexArray, this.layoutAttributes);\r\n        this.indexBuffer = context.createIndexBuffer(this.indexArray);\r\n        this.collisionVertexBuffer = context.createVertexBuffer(this.collisionVertexArray, collisionVertexAttributes.members, true);\r\n    }\r\n\r\n    destroy() {\r\n        if (!this.layoutVertexBuffer) return;\r\n        this.layoutVertexBuffer.destroy();\r\n        this.indexBuffer.destroy();\r\n        this.segments.destroy();\r\n        this.collisionVertexBuffer.destroy();\r\n    }\r\n}\r\n\r\nregister('CollisionBuffers', CollisionBuffers);\r\n\r\n/**\r\n * Unlike other buckets, which simply implement #addFeature with type-specific\r\n * logic for (essentially) triangulating feature geometries, SymbolBucket\r\n * requires specialized behavior:\r\n *\r\n * 1. WorkerTile#parse(), the logical owner of the bucket creation process,\r\n *    calls SymbolBucket#populate(), which resolves text and icon tokens on\r\n *    each feature, adds each glyphs and symbols needed to the passed-in\r\n *    collections options.glyphDependencies and options.iconDependencies, and\r\n *    stores the feature data for use in subsequent step (this.features).\r\n *\r\n * 2. WorkerTile asynchronously requests from the main thread all of the glyphs\r\n *    and icons needed (by this bucket and any others). When glyphs and icons\r\n *    have been received, the WorkerTile creates a CollisionIndex and invokes:\r\n *\r\n * 3. performSymbolLayout(bucket, stacks, icons) perform texts shaping and\r\n *    layout on a Symbol Bucket. This step populates:\r\n *      `this.symbolInstances`: metadata on generated symbols\r\n *      `this.collisionBoxArray`: collision data for use by foreground\r\n *      `this.text`: SymbolBuffers for text symbols\r\n *      `this.icons`: SymbolBuffers for icons\r\n *      `this.collisionBox`: Debug SymbolBuffers for collision boxes\r\n *      `this.collisionCircle`: Debug SymbolBuffers for collision circles\r\n *    The results are sent to the foreground for rendering\r\n *\r\n * 4. performSymbolPlacement(bucket, collisionIndex) is run on the foreground,\r\n *    and uses the CollisionIndex along with current camera settings to determine\r\n *    which symbols can actually show on the map. Collided symbols are hidden\r\n *    using a dynamic \"OpacityVertexArray\".\r\n *\r\n * @private\r\n */\r\nclass SymbolBucket implements Bucket {\r\n    static MAX_GLYPHS: number;\r\n    static addDynamicAttributes: typeof addDynamicAttributes;\r\n\r\n    collisionBoxArray: CollisionBoxArray;\r\n    zoom: number;\r\n    overscaling: number;\r\n    layers: Array<SymbolStyleLayer>;\r\n    layerIds: Array<string>;\r\n    index: number;\r\n    sdfIcons: boolean;\r\n    iconsNeedLinear: boolean;\r\n    bucketInstanceId: number;\r\n    justReloaded: boolean;\r\n\r\n    textSizeData: SizeData;\r\n    iconSizeData: SizeData;\r\n\r\n    glyphOffsetArray: GlyphOffsetArray;\r\n    lineVertexArray: SymbolLineVertexArray;\r\n    features: Array<SymbolFeature>;\r\n    symbolInstances: Array<SymbolInstance>;\r\n    pixelRatio: number;\r\n    tilePixelRatio: number;\r\n    compareText: {[string]: Array<Point>};\r\n    fadeStartTime: number;\r\n    sortFeaturesByY: boolean;\r\n    sortedAngle: number;\r\n\r\n    text: SymbolBuffers;\r\n    icon: SymbolBuffers;\r\n    collisionBox: CollisionBuffers;\r\n    collisionCircle: CollisionBuffers;\r\n    uploaded: boolean;\r\n\r\n    constructor(options: BucketParameters<SymbolStyleLayer>) {\r\n        this.collisionBoxArray = options.collisionBoxArray;\r\n        this.zoom = options.zoom;\r\n        this.overscaling = options.overscaling;\r\n        this.layers = options.layers;\r\n        this.layerIds = this.layers.map(layer => layer.id);\r\n        this.index = options.index;\r\n        this.pixelRatio = options.pixelRatio;\r\n\r\n        const layer = this.layers[0];\r\n        const unevaluatedLayoutValues = layer._unevaluatedLayout._values;\r\n\r\n        this.textSizeData = getSizeData(this.zoom, unevaluatedLayoutValues['text-size']);\r\n        this.iconSizeData = getSizeData(this.zoom, unevaluatedLayoutValues['icon-size']);\r\n\r\n        const layout = this.layers[0].layout;\r\n        this.sortFeaturesByY = layout.get('text-allow-overlap') || layout.get('icon-allow-overlap') ||\r\n            layout.get('text-ignore-placement') || layout.get('icon-ignore-placement');\r\n    }\r\n\r\n    createArrays() {\r\n        this.text = new SymbolBuffers(new ProgramConfigurationSet(symbolLayoutAttributes.members, this.layers, this.zoom, property => /^text/.test(property)));\r\n        this.icon = new SymbolBuffers(new ProgramConfigurationSet(symbolLayoutAttributes.members, this.layers, this.zoom, property => /^icon/.test(property)));\r\n        this.collisionBox = new CollisionBuffers(CollisionBoxLayoutArray, collisionBoxLayout.members, LineIndexArray);\r\n        this.collisionCircle = new CollisionBuffers(CollisionCircleLayoutArray, collisionCircleLayout.members, TriangleIndexArray);\r\n\r\n        this.glyphOffsetArray = new GlyphOffsetArray();\r\n        this.lineVertexArray = new SymbolLineVertexArray();\r\n    }\r\n\r\n    populate(features: Array<IndexedFeature>, options: PopulateParameters) {\r\n        const layer = this.layers[0];\r\n        const layout = layer.layout;\r\n\r\n        const textFont = layout.get('text-font');\r\n        const textField = layout.get('text-field');\r\n        const iconImage = layout.get('icon-image');\r\n        const hasText =\r\n            (textField.value.kind !== 'constant' || textField.value.value.length > 0) &&\r\n            (textFont.value.kind !== 'constant' || textFont.value.value.length > 0);\r\n        const hasIcon = iconImage.value.kind !== 'constant' || iconImage.value.value && iconImage.value.value.length > 0;\r\n\r\n        this.features = [];\r\n\r\n        if (!hasText && !hasIcon) {\r\n            return;\r\n        }\r\n\r\n        const icons = options.iconDependencies;\r\n        const stacks = options.glyphDependencies;\r\n        const globalProperties =  {zoom: this.zoom};\r\n\r\n        for (const {feature, index, sourceLayerIndex} of features) {\r\n            if (!layer._featureFilter(globalProperties, feature)) {\r\n                continue;\r\n            }\r\n\r\n            let text;\r\n            if (hasText) {\r\n                text = layer.getValueAndResolveTokens('text-field', feature);\r\n                text = transformText(text, layer, feature);\r\n            }\r\n\r\n            let icon;\r\n            if (hasIcon) {\r\n                icon = layer.getValueAndResolveTokens('icon-image', feature);\r\n            }\r\n\r\n            if (!text && !icon) {\r\n                continue;\r\n            }\r\n\r\n            const symbolFeature: SymbolFeature = {\r\n                text,\r\n                icon,\r\n                index,\r\n                sourceLayerIndex,\r\n                geometry: loadGeometry(feature),\r\n                properties: feature.properties,\r\n                type: vectorTileFeatureTypes[feature.type]\r\n            };\r\n            if (typeof feature.id !== 'undefined') {\r\n                symbolFeature.id = feature.id;\r\n            }\r\n            this.features.push(symbolFeature);\r\n\r\n            if (icon) {\r\n                icons[icon] = true;\r\n            }\r\n\r\n            if (text) {\r\n                const fontStack = textFont.evaluate(feature).join(',');\r\n                const stack = stacks[fontStack] = stacks[fontStack] || {};\r\n                const textAlongLine = layout.get('text-rotation-alignment') === 'map' && layout.get('symbol-placement') === 'line';\r\n                const allowsVerticalWritingMode = scriptDetection.allowsVerticalWritingMode(text);\r\n                for (let i = 0; i < text.length; i++) {\r\n                    stack[text.charCodeAt(i)] = true;\r\n                    if (textAlongLine && allowsVerticalWritingMode) {\r\n                        const verticalChar = verticalizePunctuation.lookup[text.charAt(i)];\r\n                        if (verticalChar) {\r\n                            stack[verticalChar.charCodeAt(0)] = true;\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n        if (layout.get('symbol-placement') === 'line') {\r\n            // Merge adjacent lines with the same text to improve labelling.\r\n            // It's better to place labels on one long line than on many short segments.\r\n            this.features = mergeLines(this.features);\r\n        }\r\n    }\r\n\r\n\r\n    isEmpty() {\r\n        return this.symbolInstances.length === 0;\r\n    }\r\n\r\n    upload(context: Context) {\r\n        this.text.upload(context, this.sortFeaturesByY);\r\n        this.icon.upload(context, this.sortFeaturesByY);\r\n        this.collisionBox.upload(context);\r\n        this.collisionCircle.upload(context);\r\n    }\r\n\r\n    destroy() {\r\n        this.text.destroy();\r\n        this.icon.destroy();\r\n        this.collisionBox.destroy();\r\n        this.collisionCircle.destroy();\r\n    }\r\n\r\n    addToLineVertexArray(anchor: Anchor, line: any) {\r\n        const lineStartIndex = this.lineVertexArray.length;\r\n        if (anchor.segment !== undefined) {\r\n            let sumForwardLength = anchor.dist(line[anchor.segment + 1]);\r\n            let sumBackwardLength = anchor.dist(line[anchor.segment]);\r\n            const vertices = {};\r\n            for (let i = anchor.segment + 1; i < line.length; i++) {\r\n                vertices[i] = { x: line[i].x, y: line[i].y, tileUnitDistanceFromAnchor: sumForwardLength };\r\n                if (i < line.length - 1) {\r\n                    sumForwardLength += line[i + 1].dist(line[i]);\r\n                }\r\n            }\r\n            for (let i = anchor.segment || 0; i >= 0; i--) {\r\n                vertices[i] = { x: line[i].x, y: line[i].y, tileUnitDistanceFromAnchor: sumBackwardLength };\r\n                if (i > 0) {\r\n                    sumBackwardLength += line[i - 1].dist(line[i]);\r\n                }\r\n            }\r\n            for (let i = 0; i < line.length; i++) {\r\n                const vertex = vertices[i];\r\n                this.lineVertexArray.emplaceBack(vertex.x, vertex.y, vertex.tileUnitDistanceFromAnchor);\r\n            }\r\n        }\r\n        return {\r\n            lineStartIndex: lineStartIndex,\r\n            lineLength: this.lineVertexArray.length - lineStartIndex\r\n        };\r\n    }\r\n\r\n    addSymbols(arrays: SymbolBuffers,\r\n               quads: Array<SymbolQuad>,\r\n               sizeVertex: any,\r\n               lineOffset: [number, number],\r\n               alongLine: boolean,\r\n               feature: ExpressionFeature,\r\n               writingMode: any,\r\n               labelAnchor: Anchor,\r\n               lineStartIndex: number,\r\n               lineLength: number) {\r\n        const indexArray = arrays.indexArray;\r\n        const layoutVertexArray = arrays.layoutVertexArray;\r\n        const dynamicLayoutVertexArray = arrays.dynamicLayoutVertexArray;\r\n\r\n        const segment = arrays.segments.prepareSegment(4 * quads.length, arrays.layoutVertexArray, arrays.indexArray);\r\n        const glyphOffsetArrayStart = this.glyphOffsetArray.length;\r\n        const vertexStartIndex = segment.vertexLength;\r\n\r\n        for (const symbol of quads) {\r\n\r\n            const tl = symbol.tl,\r\n                tr = symbol.tr,\r\n                bl = symbol.bl,\r\n                br = symbol.br,\r\n                tex = symbol.tex;\r\n\r\n            const index = segment.vertexLength;\r\n\r\n            const y = symbol.glyphOffset[1];\r\n            addVertex(layoutVertexArray, labelAnchor.x, labelAnchor.y, tl.x, y + tl.y, tex.x, tex.y, sizeVertex);\r\n            addVertex(layoutVertexArray, labelAnchor.x, labelAnchor.y, tr.x, y + tr.y, tex.x + tex.w, tex.y, sizeVertex);\r\n            addVertex(layoutVertexArray, labelAnchor.x, labelAnchor.y, bl.x, y + bl.y, tex.x, tex.y + tex.h, sizeVertex);\r\n            addVertex(layoutVertexArray, labelAnchor.x, labelAnchor.y, br.x, y + br.y, tex.x + tex.w, tex.y + tex.h, sizeVertex);\r\n\r\n            addDynamicAttributes(dynamicLayoutVertexArray, labelAnchor, 0);\r\n\r\n            indexArray.emplaceBack(index, index + 1, index + 2);\r\n            indexArray.emplaceBack(index + 1, index + 2, index + 3);\r\n\r\n            segment.vertexLength += 4;\r\n            segment.primitiveLength += 2;\r\n\r\n            this.glyphOffsetArray.emplaceBack(symbol.glyphOffset[0]);\r\n        }\r\n\r\n        arrays.placedSymbolArray.emplaceBack(labelAnchor.x, labelAnchor.y,\r\n            glyphOffsetArrayStart, this.glyphOffsetArray.length - glyphOffsetArrayStart, vertexStartIndex,\r\n            lineStartIndex, lineLength, (labelAnchor.segment: any),\r\n            sizeVertex ? sizeVertex[0] : 0, sizeVertex ? sizeVertex[1] : 0,\r\n            lineOffset[0], lineOffset[1],\r\n            writingMode, (false: any));\r\n\r\n        arrays.programConfigurations.populatePaintArrays(arrays.layoutVertexArray.length, feature);\r\n    }\r\n\r\n    _addCollisionDebugVertex(layoutVertexArray: StructArray, collisionVertexArray: StructArray, point: Point, anchor: Point, extrude: Point) {\r\n        collisionVertexArray.emplaceBack(0, 0);\r\n        return layoutVertexArray.emplaceBack(\r\n            // pos\r\n            point.x,\r\n            point.y,\r\n            // a_anchor_pos\r\n            anchor.x,\r\n            anchor.y,\r\n            // extrude\r\n            Math.round(extrude.x),\r\n            Math.round(extrude.y));\r\n    }\r\n\r\n\r\n    addCollisionDebugVertices(x1: number, y1: number, x2: number, y2: number, arrays: CollisionBuffers, boxAnchorPoint: Point, symbolInstance: SymbolInstance, isCircle: boolean) {\r\n        const segment = arrays.segments.prepareSegment(4, arrays.layoutVertexArray, arrays.indexArray);\r\n        const index = segment.vertexLength;\r\n\r\n        const layoutVertexArray = arrays.layoutVertexArray;\r\n        const collisionVertexArray = arrays.collisionVertexArray;\r\n\r\n        this._addCollisionDebugVertex(layoutVertexArray, collisionVertexArray, boxAnchorPoint, symbolInstance.anchor, new Point(x1, y1));\r\n        this._addCollisionDebugVertex(layoutVertexArray, collisionVertexArray, boxAnchorPoint, symbolInstance.anchor, new Point(x2, y1));\r\n        this._addCollisionDebugVertex(layoutVertexArray, collisionVertexArray, boxAnchorPoint, symbolInstance.anchor, new Point(x2, y2));\r\n        this._addCollisionDebugVertex(layoutVertexArray, collisionVertexArray, boxAnchorPoint, symbolInstance.anchor, new Point(x1, y2));\r\n\r\n        segment.vertexLength += 4;\r\n        if (isCircle) {\r\n            const indexArray: TriangleIndexArray = (arrays.indexArray: any);\r\n            indexArray.emplaceBack(index, index + 1, index + 2);\r\n            indexArray.emplaceBack(index, index + 2, index + 3);\r\n\r\n            segment.primitiveLength += 2;\r\n        } else {\r\n            const indexArray: LineIndexArray = (arrays.indexArray: any);\r\n            indexArray.emplaceBack(index, index + 1);\r\n            indexArray.emplaceBack(index + 1, index + 2);\r\n            indexArray.emplaceBack(index + 2, index + 3);\r\n            indexArray.emplaceBack(index + 3, index);\r\n\r\n            segment.primitiveLength += 4;\r\n        }\r\n    }\r\n\r\n    generateCollisionDebugBuffers() {\r\n        for (const symbolInstance of this.symbolInstances) {\r\n            symbolInstance.textCollisionFeature = {boxStartIndex: symbolInstance.textBoxStartIndex, boxEndIndex: symbolInstance.textBoxEndIndex};\r\n            symbolInstance.iconCollisionFeature = {boxStartIndex: symbolInstance.iconBoxStartIndex, boxEndIndex: symbolInstance.iconBoxEndIndex};\r\n\r\n            for (let i = 0; i < 2; i++) {\r\n                const feature = symbolInstance[i === 0 ? 'textCollisionFeature' : 'iconCollisionFeature'];\r\n                if (!feature) continue;\r\n\r\n                for (let b = feature.boxStartIndex; b < feature.boxEndIndex; b++) {\r\n                    const box: CollisionBox = (this.collisionBoxArray.get(b): any);\r\n                    const x1 = box.x1;\r\n                    const y1 = box.y1;\r\n                    const x2 = box.x2;\r\n                    const y2 = box.y2;\r\n\r\n                    // If the radius > 0, this collision box is actually a circle\r\n                    // The data we add to the buffers is exactly the same, but we'll render with a different shader.\r\n                    const isCircle = box.radius > 0;\r\n                    this.addCollisionDebugVertices(x1, y1, x2, y2, isCircle ? this.collisionCircle : this.collisionBox, box.anchorPoint, symbolInstance, isCircle);\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    // These flat arrays are meant to be quicker to iterate over than the source\r\n    // CollisionBoxArray\r\n    deserializeCollisionBoxes(collisionBoxArray: CollisionBoxArray, textStartIndex: number, textEndIndex: number, iconStartIndex: number, iconEndIndex: number): CollisionArrays {\r\n        const collisionArrays = {};\r\n        for (let k = textStartIndex; k < textEndIndex; k++) {\r\n            const box: CollisionBox = (collisionBoxArray.get(k): any);\r\n            if (box.radius === 0) {\r\n                collisionArrays.textBox = { x1: box.x1, y1: box.y1, x2: box.x2, y2: box.y2, anchorPointX: box.anchorPointX, anchorPointY: box.anchorPointY };\r\n\r\n                break; // Only one box allowed per instance\r\n            } else {\r\n                if (!collisionArrays.textCircles) {\r\n                    collisionArrays.textCircles = [];\r\n                }\r\n                const used = 1; // May be updated at collision detection time\r\n                collisionArrays.textCircles.push(box.anchorPointX, box.anchorPointY, box.radius, box.signedDistanceFromAnchor, used);\r\n            }\r\n        }\r\n        for (let k = iconStartIndex; k < iconEndIndex; k++) {\r\n            // An icon can only have one box now, so this indexing is a bit vestigial...\r\n            const box: CollisionBox = (collisionBoxArray.get(k): any);\r\n            if (box.radius === 0) {\r\n                collisionArrays.iconBox = { x1: box.x1, y1: box.y1, x2: box.x2, y2: box.y2, anchorPointX: box.anchorPointX, anchorPointY: box.anchorPointY };\r\n                break; // Only one box allowed per instance\r\n            }\r\n        }\r\n        return collisionArrays;\r\n    }\r\n\r\n    hasTextData() {\r\n        return this.text.segments.get().length > 0;\r\n    }\r\n\r\n    hasIconData() {\r\n        return this.icon.segments.get().length > 0;\r\n    }\r\n\r\n    hasCollisionBoxData() {\r\n        return this.collisionBox.segments.get().length > 0;\r\n    }\r\n\r\n    hasCollisionCircleData() {\r\n        return this.collisionCircle.segments.get().length > 0;\r\n    }\r\n\r\n    sortFeatures(angle: number) {\r\n        if (!this.sortFeaturesByY) return;\r\n\r\n        if (this.sortedAngle === angle) return;\r\n        this.sortedAngle = angle;\r\n\r\n        // The current approach to sorting doesn't sort across segments so don't try.\r\n        // Sorting within segments separately seemed not to be worth the complexity.\r\n        if (this.text.segments.get().length > 1 || this.icon.segments.get().length > 1) return;\r\n\r\n        // If the symbols are allowed to overlap sort them by their vertical screen position.\r\n        // The index array buffer is rewritten to reference the (unchanged) vertices in the\r\n        // sorted order.\r\n\r\n        // To avoid sorting the actual symbolInstance array we sort an array of indexes.\r\n        const symbolInstanceIndexes = [];\r\n        for (let i = 0; i < this.symbolInstances.length; i++) {\r\n            symbolInstanceIndexes.push(i);\r\n        }\r\n\r\n        const sin = Math.sin(angle),\r\n            cos = Math.cos(angle);\r\n\r\n        symbolInstanceIndexes.sort((aIndex, bIndex) => {\r\n            const a = this.symbolInstances[aIndex];\r\n            const b = this.symbolInstances[bIndex];\r\n            const aRotated = (sin * a.anchor.x + cos * a.anchor.y) | 0;\r\n            const bRotated = (sin * b.anchor.x + cos * b.anchor.y) | 0;\r\n            return (aRotated - bRotated) || (b.featureIndex - a.featureIndex);\r\n        });\r\n\r\n        this.text.indexArray.clear();\r\n        this.icon.indexArray.clear();\r\n\r\n        for (const i of symbolInstanceIndexes) {\r\n            const symbolInstance = this.symbolInstances[i];\r\n\r\n            for (const placedTextSymbolIndex of symbolInstance.placedTextSymbolIndices) {\r\n                const placedSymbol = this.text.placedSymbolArray.get(placedTextSymbolIndex);\r\n\r\n                const endIndex = placedSymbol.vertexStartIndex + placedSymbol.numGlyphs * 4;\r\n                for (let vertexIndex = placedSymbol.vertexStartIndex; vertexIndex < endIndex; vertexIndex += 4) {\r\n                    this.text.indexArray.emplaceBack(vertexIndex, vertexIndex + 1, vertexIndex + 2);\r\n                    this.text.indexArray.emplaceBack(vertexIndex + 1, vertexIndex + 2, vertexIndex + 3);\r\n                }\r\n            }\r\n\r\n            const placedIcon = this.icon.placedSymbolArray.get(i);\r\n            if (placedIcon.numGlyphs) {\r\n                const vertexIndex = placedIcon.vertexStartIndex;\r\n                this.icon.indexArray.emplaceBack(vertexIndex, vertexIndex + 1, vertexIndex + 2);\r\n                this.icon.indexArray.emplaceBack(vertexIndex + 1, vertexIndex + 2, vertexIndex + 3);\r\n            }\r\n        }\r\n\r\n        if (this.text.indexBuffer) this.text.indexBuffer.updateData(this.text.indexArray);\r\n        if (this.icon.indexBuffer) this.icon.indexBuffer.updateData(this.icon.indexArray);\r\n    }\r\n}\r\n\r\nregister('SymbolBucket', SymbolBucket, {\r\n    omit: ['layers', 'collisionBoxArray', 'features', 'compareText'],\r\n    shallow: ['symbolInstances']\r\n});\r\n\r\n// this constant is based on the size of StructArray indexes used in a symbol\r\n// bucket--namely, glyphOffsetArrayStart\r\n// eg the max valid UInt16 is 65,535\r\n// See https://github.com/mapbox/mapbox-gl-js/issues/2907 for motivation\r\n// lineStartIndex and textBoxStartIndex could potentially be concerns\r\n// but we expect there to be many fewer boxes/lines than glyphs\r\nSymbolBucket.MAX_GLYPHS = 65535;\r\n\r\nSymbolBucket.addDynamicAttributes = addDynamicAttributes;\r\n\r\nmodule.exports = SymbolBucket;\r\n","// @flow\r\nconst {RGBAImage} = require('../util/image');\r\nconst util = require('../util/util');\r\nconst {register} = require('../util/web_worker_transfer');\r\n\r\nclass Level {\r\n    dim: number;\r\n    border: number;\r\n    stride: number;\r\n    data: Int32Array;\r\n\r\n    constructor(dim: number, border: number, data: ?Int32Array) {\r\n        if (dim <= 0) throw new RangeError('Level must have positive dimension');\r\n        this.dim = dim;\r\n        this.border = border;\r\n        this.stride = this.dim + 2 * this.border;\r\n        this.data = data || new Int32Array((this.dim + 2 * this.border) * (this.dim + 2 * this.border));\r\n    }\r\n\r\n    set(x: number, y: number, value: number) {\r\n        this.data[this._idx(x, y)] = value + 65536;\r\n    }\r\n\r\n    get(x: number, y: number) {\r\n        return this.data[this._idx(x, y)] - 65536;\r\n    }\r\n\r\n    _idx(x: number, y: number) {\r\n        if (x < -this.border || x >= this.dim + this.border ||  y < -this.border || y >= this.dim + this.border) throw new RangeError('out of range source coordinates for DEM data');\r\n        return (y + this.border) * this.stride + (x + this.border);\r\n    }\r\n}\r\n\r\nregister('Level', Level);\r\n\r\n// DEMData is a data structure for decoding, backfilling, and storing elevation data for processing in the hillshade shaders\r\n// data can be populated either from a pngraw image tile or from serliazed data sent back from a worker. When data is initially\r\n// loaded from a image tile, we decode the pixel values using the mapbox terrain-rgb tileset decoding formula, but we store the\r\n// elevation data in a Level as an Int32 value. we add 65536 (2^16) to eliminate negative values and enable the use of\r\n// integer overflow when creating the texture used in the hillshadePrepare step.\r\n\r\n// DEMData also handles the backfilling of data from a tile's neighboring tiles. This is necessary because we use a pixel's 8\r\n// surrounding pixel values to compute the slope at that pixel, and we cannot accurately calculate the slope at pixels on a\r\n// tile's edge without backfilling from neighboring tiles.\r\n\r\nclass DEMData {\r\n    uid: string;\r\n    scale: number;\r\n    level: Level;\r\n    loaded: boolean;\r\n\r\n    constructor(uid: string, scale: ?number, data: ?Level) {\r\n        this.uid = uid;\r\n        this.scale = scale || 1;\r\n        // if no data is provided, use a temporary empty level to satisfy flow\r\n        this.level = data || new Level(256, 512);\r\n        this.loaded = !!data;\r\n    }\r\n\r\n    loadFromImage(data: RGBAImage) {\r\n        if (data.height !== data.width) throw new RangeError('DEM tiles must be square');\r\n\r\n        // Build level 0\r\n        const level = this.level = new Level(data.width, data.width / 2);\r\n        const pixels = data.data;\r\n\r\n        // unpack\r\n        for (let y = 0; y < level.dim; y++) {\r\n            for (let x = 0; x < level.dim; x++) {\r\n                const i = y * level.dim + x;\r\n                const j = i * 4;\r\n                // decoding per https://blog.mapbox.com/global-elevation-data-6689f1d0ba65\r\n                level.set(x, y, this.scale * ((pixels[j] * 256 * 256 + pixels[j + 1] * 256.0 + pixels[j + 2]) / 10.0 - 10000.0));\r\n            }\r\n        }\r\n\r\n        // in order to avoid flashing seams between tiles, here we are initially populating a 1px border of pixels around the image\r\n        // with the data of the nearest pixel from the image. this data is eventually replaced when the tile's neighboring\r\n        // tiles are loaded and the accurate data can be backfilled using DEMData#backfillBorder\r\n        for (let x = 0; x < level.dim; x++) {\r\n            // left vertical border\r\n            level.set(-1, x, level.get(0, x));\r\n            // right vertical border\r\n            level.set(level.dim, x, level.get(level.dim - 1, x));\r\n            // left horizontal border\r\n            level.set(x, -1, level.get(x, 0));\r\n            // right horizontal border\r\n            level.set(x, level.dim, level.get(x, level.dim - 1));\r\n        }\r\n        // corners\r\n        level.set(-1, -1, level.get(0, 0));\r\n        level.set(level.dim, -1, level.get(level.dim - 1, 0));\r\n        level.set(-1, level.dim, level.get(0, level.dim - 1));\r\n        level.set(level.dim, level.dim, level.get(level.dim - 1, level.dim - 1));\r\n        this.loaded = true;\r\n    }\r\n\r\n    getPixels() {\r\n        return new RGBAImage({width: this.level.dim + 2 * this.level.border, height: this.level.dim + 2 * this.level.border}, new Uint8Array(this.level.data.buffer));\r\n    }\r\n\r\n    backfillBorder(borderTile: DEMData, dx: number, dy: number) {\r\n        const t = this.level;\r\n        const o = borderTile.level;\r\n\r\n        if (t.dim !== o.dim) throw new Error('level mismatch (dem dimension)');\r\n\r\n        let _xMin = dx * t.dim,\r\n            _xMax = dx * t.dim + t.dim,\r\n            _yMin = dy * t.dim,\r\n            _yMax = dy * t.dim + t.dim;\r\n\r\n        switch (dx) {\r\n        case -1:\r\n            _xMin = _xMax - 1;\r\n            break;\r\n        case 1:\r\n            _xMax = _xMin + 1;\r\n            break;\r\n        }\r\n\r\n        switch (dy) {\r\n        case -1:\r\n            _yMin = _yMax - 1;\r\n            break;\r\n        case 1:\r\n            _yMax = _yMin + 1;\r\n            break;\r\n        }\r\n\r\n        const xMin = util.clamp(_xMin, -t.border, t.dim + t.border);\r\n        const xMax = util.clamp(_xMax, -t.border, t.dim + t.border);\r\n        const yMin = util.clamp(_yMin, -t.border, t.dim + t.border);\r\n        const yMax = util.clamp(_yMax, -t.border, t.dim + t.border);\r\n\r\n        const ox = -dx * t.dim;\r\n        const oy = -dy * t.dim;\r\n        for (let y = yMin; y < yMax; y++) {\r\n            for (let x = xMin; x < xMax; x++) {\r\n                t.set(x, y, o.get(x + ox, y + oy));\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nregister('DEMData', DEMData);\r\nmodule.exports = {DEMData, Level};\r\n\r\n","// @flow\r\n\r\n/**\r\n * The maximum value of a coordinate in the internal tile coordinate system. Coordinates of\r\n * all source features normalized to this extent upon load.\r\n *\r\n * The value is a consequence of the following:\r\n *\r\n * * Vertex buffer store positions as signed 16 bit integers.\r\n * * One bit is lost for signedness to support tile buffers.\r\n * * One bit is lost because the line vertex buffer used to pack 1 bit of other data into the int.\r\n *   This is no longer the case but we're reserving this bit anyway.\r\n * * One bit is lost to support features extending past the extent on the right edge of the tile.\r\n * * This leaves us with 2^13 = 8192\r\n *\r\n * @private\r\n * @readonly\r\n */\r\nmodule.exports = 8192;\r\n","// @flow\r\n\r\nconst Point = require('@mapbox/point-geometry');\r\nconst loadGeometry = require('./load_geometry');\r\nconst EXTENT = require('./extent');\r\nconst featureFilter = require('../style-spec/feature_filter');\r\nconst Grid = require('grid-index');\r\nconst DictionaryCoder = require('../util/dictionary_coder');\r\nconst vt = require('@mapbox/vector-tile');\r\nconst Protobuf = require('pbf');\r\nconst GeoJSONFeature = require('../util/vectortile_to_geojson');\r\nconst arraysIntersect = require('../util/util').arraysIntersect;\r\nconst {OverscaledTileID} = require('../source/tile_id');\r\nconst {register} = require('../util/web_worker_transfer');\r\n\r\nimport type CollisionIndex from '../symbol/collision_index';\r\nimport type StyleLayer from '../style/style_layer';\r\nimport type {FeatureFilter} from '../style-spec/feature_filter';\r\nimport type {CollisionBoxArray} from './array_types';\r\n\r\nconst {FeatureIndexArray} = require('./array_types');\r\n\r\ntype QueryParameters = {\r\n    scale: number,\r\n    bearing: number,\r\n    tileSize: number,\r\n    queryGeometry: Array<Array<Point>>,\r\n    additionalRadius: number,\r\n    params: {\r\n        filter: FilterSpecification,\r\n        layers: Array<string>,\r\n    },\r\n    collisionBoxArray: CollisionBoxArray,\r\n    sourceID: string,\r\n    bucketInstanceIds: { [number]: boolean },\r\n    collisionIndex: CollisionIndex\r\n}\r\n\r\nclass FeatureIndex {\r\n    tileID: OverscaledTileID;\r\n    overscaling: number;\r\n    x: number;\r\n    y: number;\r\n    z: number;\r\n    grid: Grid;\r\n    featureIndexArray: FeatureIndexArray;\r\n\r\n    rawTileData: ArrayBuffer;\r\n    bucketLayerIDs: Array<Array<string>>;\r\n\r\n    vtLayers: {[string]: VectorTileLayer};\r\n    sourceLayerCoder: DictionaryCoder;\r\n\r\n    collisionIndex: CollisionIndex;\r\n\r\n    constructor(tileID: OverscaledTileID,\r\n                overscaling: number,\r\n                grid?: Grid,\r\n                featureIndexArray?: FeatureIndexArray) {\r\n        this.tileID = tileID;\r\n        this.overscaling = overscaling;\r\n        this.x = tileID.canonical.x;\r\n        this.y = tileID.canonical.y;\r\n        this.z = tileID.canonical.z;\r\n        this.grid = grid || new Grid(EXTENT, 16, 0);\r\n        this.featureIndexArray = featureIndexArray || new FeatureIndexArray();\r\n    }\r\n\r\n    insert(feature: VectorTileFeature, geometry: Array<Array<Point>>, featureIndex: number, sourceLayerIndex: number, bucketIndex: number) {\r\n        const key = this.featureIndexArray.length;\r\n        this.featureIndexArray.emplaceBack(featureIndex, sourceLayerIndex, bucketIndex);\r\n\r\n        for (let r = 0; r < geometry.length; r++) {\r\n            const ring = geometry[r];\r\n\r\n            const bbox = [Infinity, Infinity, -Infinity, -Infinity];\r\n            for (let i = 0; i < ring.length; i++) {\r\n                const p = ring[i];\r\n                bbox[0] = Math.min(bbox[0], p.x);\r\n                bbox[1] = Math.min(bbox[1], p.y);\r\n                bbox[2] = Math.max(bbox[2], p.x);\r\n                bbox[3] = Math.max(bbox[3], p.y);\r\n            }\r\n\r\n            this.grid.insert(key, bbox[0], bbox[1], bbox[2], bbox[3]);\r\n        }\r\n    }\r\n\r\n    // Finds features in this tile at a particular position.\r\n    query(args: QueryParameters, styleLayers: {[string]: StyleLayer}) {\r\n        if (!this.vtLayers) {\r\n            this.vtLayers = new vt.VectorTile(new Protobuf(this.rawTileData)).layers;\r\n            this.sourceLayerCoder = new DictionaryCoder(this.vtLayers ? Object.keys(this.vtLayers).sort() : ['_geojsonTileLayer']);\r\n        }\r\n\r\n        const result = {};\r\n\r\n        const params = args.params || {},\r\n            pixelsToTileUnits = EXTENT / args.tileSize / args.scale,\r\n            filter = featureFilter(params.filter);\r\n\r\n        const queryGeometry = args.queryGeometry;\r\n        const additionalRadius = args.additionalRadius * pixelsToTileUnits;\r\n\r\n        let minX = Infinity;\r\n        let minY = Infinity;\r\n        let maxX = -Infinity;\r\n        let maxY = -Infinity;\r\n        for (let i = 0; i < queryGeometry.length; i++) {\r\n            const ring = queryGeometry[i];\r\n            for (let k = 0; k < ring.length; k++) {\r\n                const p = ring[k];\r\n                minX = Math.min(minX, p.x);\r\n                minY = Math.min(minY, p.y);\r\n                maxX = Math.max(maxX, p.x);\r\n                maxY = Math.max(maxY, p.y);\r\n            }\r\n        }\r\n\r\n        const matching = this.grid.query(minX - additionalRadius, minY - additionalRadius, maxX + additionalRadius, maxY + additionalRadius);\r\n        matching.sort(topDownFeatureComparator);\r\n        this.filterMatching(result, matching, this.featureIndexArray, queryGeometry, filter, params.layers, styleLayers, args.bearing, pixelsToTileUnits);\r\n\r\n        const matchingSymbols = args.collisionIndex ?\r\n            args.collisionIndex.queryRenderedSymbols(queryGeometry, this.tileID, EXTENT / args.tileSize, args.collisionBoxArray, args.sourceID, args.bucketInstanceIds) :\r\n            [];\r\n        matchingSymbols.sort();\r\n        this.filterMatching(result, matchingSymbols, args.collisionBoxArray, queryGeometry, filter, params.layers, styleLayers, args.bearing, pixelsToTileUnits);\r\n\r\n        return result;\r\n    }\r\n\r\n    filterMatching(\r\n        result: {[string]: Array<{ featureIndex: number, feature: GeoJSONFeature }>},\r\n        matching: Array<any>,\r\n        array: FeatureIndexArray | CollisionBoxArray,\r\n        queryGeometry: Array<Array<Point>>,\r\n        filter: FeatureFilter,\r\n        filterLayerIDs: Array<string>,\r\n        styleLayers: {[string]: StyleLayer},\r\n        bearing: number,\r\n        pixelsToTileUnits: number\r\n    ) {\r\n        let previousIndex;\r\n        for (let k = 0; k < matching.length; k++) {\r\n            const index = matching[k];\r\n\r\n            // don't check the same feature more than once\r\n            if (index === previousIndex) continue;\r\n            previousIndex = index;\r\n\r\n            const match = array.get(index);\r\n\r\n            const layerIDs = this.bucketLayerIDs[match.bucketIndex];\r\n            if (filterLayerIDs && !arraysIntersect(filterLayerIDs, layerIDs)) continue;\r\n\r\n            const sourceLayerName = this.sourceLayerCoder.decode(match.sourceLayerIndex);\r\n            const sourceLayer = this.vtLayers[sourceLayerName];\r\n            const feature = sourceLayer.feature(match.featureIndex);\r\n\r\n            if (!filter({zoom: this.tileID.overscaledZ}, feature)) continue;\r\n\r\n            let geometry = null;\r\n\r\n            for (let l = 0; l < layerIDs.length; l++) {\r\n                const layerID = layerIDs[l];\r\n\r\n                if (filterLayerIDs && filterLayerIDs.indexOf(layerID) < 0) {\r\n                    continue;\r\n                }\r\n\r\n                const styleLayer = styleLayers[layerID];\r\n                if (!styleLayer) continue;\r\n\r\n                if (styleLayer.type !== 'symbol') {\r\n                    // all symbols already match the style\r\n                    if (!geometry) {\r\n                        geometry = loadGeometry(feature);\r\n                    }\r\n                    if (!styleLayer.queryIntersectsFeature(queryGeometry, feature, geometry, this.z, bearing, pixelsToTileUnits)) {\r\n                        continue;\r\n                    }\r\n                }\r\n\r\n                const geojsonFeature = new GeoJSONFeature(feature, this.z, this.x, this.y);\r\n                (geojsonFeature: any).layer = styleLayer.serialize();\r\n                let layerResult = result[layerID];\r\n                if (layerResult === undefined) {\r\n                    layerResult = result[layerID] = [];\r\n                }\r\n                layerResult.push({ featureIndex: index, feature: geojsonFeature });\r\n            }\r\n        }\r\n    }\r\n\r\n    hasLayer(id: string) {\r\n        for (const layerIDs of this.bucketLayerIDs) {\r\n            for (const layerID of layerIDs) {\r\n                if (id === layerID) return true;\r\n            }\r\n        }\r\n\r\n        return false;\r\n    }\r\n}\r\n\r\nregister(\r\n    'FeatureIndex',\r\n    FeatureIndex,\r\n    { omit: ['rawTileData', 'sourceLayerCoder', 'collisionIndex'] }\r\n);\r\n\r\nmodule.exports = FeatureIndex;\r\n\r\nfunction topDownFeatureComparator(a, b) {\r\n    return b - a;\r\n}\r\n","// @flow\r\n\r\n/**\r\n * An index array stores Uint16 indicies of vertexes in a corresponding vertex array. We use\r\n * two kinds of index arrays: arrays storing groups of three indicies, forming triangles; and\r\n * arrays storing pairs of indicies, forming line segments.\r\n * @private\r\n */\r\nmodule.exports = {\r\n    LineIndexArray: require('./array_types').LineIndexArray,\r\n    TriangleIndexArray: require('./array_types').TriangleIndexArray\r\n};\r\n","// @flow\r\n\r\nconst util = require('../util/util');\r\nconst EXTENT = require('./extent');\r\n\r\nimport type Point from '@mapbox/point-geometry';\r\n\r\n// These bounds define the minimum and maximum supported coordinate values.\r\n// While visible coordinates are within [0, EXTENT], tiles may theoretically\r\n// contain cordinates within [-Infinity, Infinity]. Our range is limited by the\r\n// number of bits used to represent the coordinate.\r\nfunction createBounds(bits) {\r\n    return {\r\n        min: -1 * Math.pow(2, bits - 1),\r\n        max: Math.pow(2, bits - 1) - 1\r\n    };\r\n}\r\n\r\nconst bounds = createBounds(16);\r\n\r\n/**\r\n * Loads a geometry from a VectorTileFeature and scales it to the common extent\r\n * used internally.\r\n * @param {VectorTileFeature} feature\r\n * @private\r\n */\r\nmodule.exports = function loadGeometry(feature: VectorTileFeature): Array<Array<Point>> {\r\n    const scale = EXTENT / feature.extent;\r\n    const geometry = feature.loadGeometry();\r\n    for (let r = 0; r < geometry.length; r++) {\r\n        const ring = geometry[r];\r\n        for (let p = 0; p < ring.length; p++) {\r\n            const point = ring[p];\r\n            // round here because mapbox-gl-native uses integers to represent\r\n            // points and we need to do the same to avoid renering differences.\r\n            point.x = Math.round(point.x * scale);\r\n            point.y = Math.round(point.y * scale);\r\n\r\n            if (point.x < bounds.min || point.x > bounds.max || point.y < bounds.min || point.y > bounds.max) {\r\n                util.warnOnce('Geometry exceeds allowed extent, reduce your vector tile buffer size');\r\n            }\r\n        }\r\n    }\r\n    return geometry;\r\n};\r\n","// @flow\r\n\r\nimport type {GlobalProperties} from \"../style-spec/expression/index\";\r\n\r\nconst packUint8ToFloat = require('../shaders/encode_attribute').packUint8ToFloat;\r\nconst Color = require('../style-spec/util/color');\r\nconst {register} = require('../util/web_worker_transfer');\r\nconst {PossiblyEvaluatedPropertyValue} = require('../style/properties');\r\nconst {\r\n    StructArrayLayout1f4,\r\n    StructArrayLayout2f8,\r\n    StructArrayLayout4f16\r\n} = require('./array_types');\r\n\r\nimport type Context from '../gl/context';\r\nimport type {TypedStyleLayer} from '../style/style_layer/typed_style_layer';\r\nimport type {StructArray, StructArrayMember} from '../util/struct_array';\r\nimport type VertexBuffer from '../gl/vertex_buffer';\r\nimport type Program from '../render/program';\r\nimport type {Feature, SourceExpression, CompositeExpression} from '../style-spec/expression';\r\nimport type {PossiblyEvaluated} from '../style/properties';\r\n\r\nfunction packColor(color: Color): [number, number] {\r\n    return [\r\n        packUint8ToFloat(255 * color.r, 255 * color.g),\r\n        packUint8ToFloat(255 * color.b, 255 * color.a)\r\n    ];\r\n}\r\n\r\n/**\r\n *  `Binder` is the interface definition for the strategies for constructing,\r\n *  uploading, and binding paint property data as GLSL attributes.\r\n *\r\n *  It has three implementations, one for each of the three strategies we use:\r\n *\r\n *  * For _constant_ properties -- those whose value is a constant, or the constant\r\n *    result of evaluating a camera expression at a particular camera position -- we\r\n *    don't need a vertex buffer, and instead use a uniform.\r\n *  * For data expressions, we use a vertex buffer with a single attribute value,\r\n *    the evaluated result of the source function for the given feature.\r\n *  * For composite expressions, we use a vertex buffer with two attributes: min and\r\n *    max values covering the range of zooms at which we expect the tile to be\r\n *    displayed. These values are calculated by evaluating the composite expression for\r\n *    the given feature at strategically chosen zoom levels. In addition to this\r\n *    attribute data, we also use a uniform value which the shader uses to interpolate\r\n *    between the min and max value at the final displayed zoom level. The use of a\r\n *    uniform allows us to cheaply update the value on every frame.\r\n *\r\n *  Note that the shader source varies depending on whether we're using a uniform or\r\n *  attribute. We dynamically compile shaders at runtime to accomodate this.\r\n *\r\n * @private\r\n */\r\ninterface Binder<T> {\r\n    statistics: { max: number };\r\n\r\n    populatePaintArray(length: number, feature: Feature): void;\r\n    upload(Context): void;\r\n    destroy(): void;\r\n\r\n    defines(): Array<string>;\r\n\r\n    setUniforms(context: Context,\r\n                program: Program,\r\n                globals: GlobalProperties,\r\n                currentValue: PossiblyEvaluatedPropertyValue<T>): void;\r\n}\r\n\r\nclass ConstantBinder<T> implements Binder<T> {\r\n    value: T;\r\n    name: string;\r\n    type: string;\r\n    statistics: { max: number };\r\n\r\n    constructor(value: T, name: string, type: string) {\r\n        this.value = value;\r\n        this.name = name;\r\n        this.type = type;\r\n        this.statistics = { max: -Infinity };\r\n    }\r\n\r\n    defines() {\r\n        return [`#define HAS_UNIFORM_u_${this.name}`];\r\n    }\r\n\r\n    populatePaintArray() {}\r\n    upload() {}\r\n    destroy() {}\r\n\r\n    setUniforms(context: Context,\r\n                program: Program,\r\n                globals: GlobalProperties,\r\n                currentValue: PossiblyEvaluatedPropertyValue<T>) {\r\n        const value: any = currentValue.constantOr(this.value);\r\n        const gl = context.gl;\r\n        if (this.type === 'color') {\r\n            gl.uniform4f(program.uniforms[`u_${this.name}`], value.r, value.g, value.b, value.a);\r\n        } else {\r\n            gl.uniform1f(program.uniforms[`u_${this.name}`], value);\r\n        }\r\n    }\r\n}\r\n\r\nclass SourceExpressionBinder<T> implements Binder<T> {\r\n    expression: SourceExpression;\r\n    name: string;\r\n    type: string;\r\n    statistics: { max: number };\r\n\r\n    paintVertexArray: StructArray;\r\n    paintVertexAttributes: Array<StructArrayMember>;\r\n    paintVertexBuffer: ?VertexBuffer;\r\n\r\n    constructor(expression: SourceExpression, name: string, type: string) {\r\n        this.expression = expression;\r\n        this.name = name;\r\n        this.type = type;\r\n        this.statistics = { max: -Infinity };\r\n        const PaintVertexArray = type === 'color' ? StructArrayLayout2f8 : StructArrayLayout1f4;\r\n        this.paintVertexAttributes = [{\r\n            name: `a_${name}`,\r\n            type: 'Float32',\r\n            components: type === 'color' ? 2 : 1,\r\n            offset: 0\r\n        }];\r\n        this.paintVertexArray = new PaintVertexArray();\r\n    }\r\n\r\n    defines() {\r\n        return [];\r\n    }\r\n\r\n    populatePaintArray(length: number, feature: Feature) {\r\n        const paintArray = this.paintVertexArray;\r\n\r\n        const start = paintArray.length;\r\n        paintArray.reserve(length);\r\n\r\n        const value = this.expression.evaluate({zoom: 0}, feature);\r\n\r\n        if (this.type === 'color') {\r\n            const color = packColor(value);\r\n            for (let i = start; i < length; i++) {\r\n                paintArray.emplaceBack(color[0], color[1]);\r\n            }\r\n        } else {\r\n            for (let i = start; i < length; i++) {\r\n                paintArray.emplaceBack(value);\r\n            }\r\n\r\n            this.statistics.max = Math.max(this.statistics.max, value);\r\n        }\r\n    }\r\n\r\n    upload(context: Context) {\r\n        if (this.paintVertexArray) {\r\n            this.paintVertexBuffer = context.createVertexBuffer(this.paintVertexArray, this.paintVertexAttributes);\r\n        }\r\n    }\r\n\r\n    destroy() {\r\n        if (this.paintVertexBuffer) {\r\n            this.paintVertexBuffer.destroy();\r\n        }\r\n    }\r\n\r\n    setUniforms(context: Context, program: Program) {\r\n        context.gl.uniform1f(program.uniforms[`a_${this.name}_t`], 0);\r\n    }\r\n}\r\n\r\nclass CompositeExpressionBinder<T> implements Binder<T> {\r\n    expression: CompositeExpression;\r\n    name: string;\r\n    type: string;\r\n    useIntegerZoom: boolean;\r\n    zoom: number;\r\n    statistics: { max: number };\r\n\r\n    paintVertexArray: StructArray;\r\n    paintVertexAttributes: Array<StructArrayMember>;\r\n    paintVertexBuffer: ?VertexBuffer;\r\n\r\n    constructor(expression: CompositeExpression, name: string, type: string, useIntegerZoom: boolean, zoom: number) {\r\n        this.expression = expression;\r\n        this.name = name;\r\n        this.type = type;\r\n        this.useIntegerZoom = useIntegerZoom;\r\n        this.zoom = zoom;\r\n        this.statistics = { max: -Infinity };\r\n        const PaintVertexArray = type === 'color' ? StructArrayLayout4f16 : StructArrayLayout2f8;\r\n        this.paintVertexAttributes = [{\r\n            name: `a_${name}`,\r\n            type: 'Float32',\r\n            components: type === 'color' ? 4 : 2,\r\n            offset: 0\r\n        }];\r\n        this.paintVertexArray = new PaintVertexArray();\r\n    }\r\n\r\n    defines() {\r\n        return [];\r\n    }\r\n\r\n    populatePaintArray(length: number, feature: Feature) {\r\n        const paintArray = this.paintVertexArray;\r\n\r\n        const start = paintArray.length;\r\n        paintArray.reserve(length);\r\n\r\n        const min = this.expression.evaluate({zoom: this.zoom    }, feature);\r\n        const max = this.expression.evaluate({zoom: this.zoom + 1}, feature);\r\n\r\n        if (this.type === 'color') {\r\n            const minColor = packColor(min);\r\n            const maxColor = packColor(max);\r\n            for (let i = start; i < length; i++) {\r\n                paintArray.emplaceBack(minColor[0], minColor[1], maxColor[0], maxColor[1]);\r\n            }\r\n        } else {\r\n            for (let i = start; i < length; i++) {\r\n                paintArray.emplaceBack(min, max);\r\n            }\r\n\r\n            this.statistics.max = Math.max(this.statistics.max, min, max);\r\n        }\r\n    }\r\n\r\n    upload(context: Context) {\r\n        if (this.paintVertexArray) {\r\n            this.paintVertexBuffer = context.createVertexBuffer(this.paintVertexArray, this.paintVertexAttributes);\r\n        }\r\n    }\r\n\r\n    destroy() {\r\n        if (this.paintVertexBuffer) {\r\n            this.paintVertexBuffer.destroy();\r\n        }\r\n    }\r\n\r\n    interpolationFactor(currentZoom: number) {\r\n        if (this.useIntegerZoom) {\r\n            return this.expression.interpolationFactor(Math.floor(currentZoom), this.zoom, this.zoom + 1);\r\n        } else {\r\n            return this.expression.interpolationFactor(currentZoom, this.zoom, this.zoom + 1);\r\n        }\r\n    }\r\n\r\n    setUniforms(context: Context, program: Program, globals: GlobalProperties) {\r\n        context.gl.uniform1f(program.uniforms[`a_${this.name}_t`], this.interpolationFactor(globals.zoom));\r\n    }\r\n}\r\n\r\n/**\r\n * ProgramConfiguration contains the logic for binding style layer properties and tile\r\n * layer feature data into GL program uniforms and vertex attributes.\r\n *\r\n * Non-data-driven property values are bound to shader uniforms. Data-driven property\r\n * values are bound to vertex attributes. In order to support a uniform GLSL syntax over\r\n * both, [Mapbox GL Shaders](https://github.com/mapbox/mapbox-gl-shaders) defines a `#pragma`\r\n * abstraction, which ProgramConfiguration is responsible for implementing. At runtime,\r\n * it examines the attributes of a particular layer, combines this with fixed knowledge\r\n * about how layers of the particular type are implemented, and determines which uniforms\r\n * and vertex attributes will be required. It can then substitute the appropriate text\r\n * into the shader source code, create and link a program, and bind the uniforms and\r\n * vertex attributes in preparation for drawing.\r\n *\r\n * When a vector tile is parsed, this same configuration information is used to\r\n * populate the attribute buffers needed for data-driven styling using the zoom\r\n * level and feature property data.\r\n *\r\n * @private\r\n */\r\nclass ProgramConfiguration {\r\n    binders: { [string]: Binder<any> };\r\n    cacheKey: string;\r\n    layoutAttributes: Array<StructArrayMember>;\r\n\r\n    _buffers: Array<VertexBuffer>;\r\n\r\n    constructor() {\r\n        this.binders = {};\r\n        this.cacheKey = '';\r\n\r\n        this._buffers = [];\r\n    }\r\n\r\n    static createDynamic<Layer: TypedStyleLayer>(layer: Layer, zoom: number, filterProperties: (string) => boolean) {\r\n        const self = new ProgramConfiguration();\r\n        const keys = [];\r\n\r\n        for (const property in layer.paint._values) {\r\n            if (!filterProperties(property)) continue;\r\n            const value = layer.paint.get(property);\r\n            if (!(value instanceof PossiblyEvaluatedPropertyValue) || !value.property.specification['property-function']) {\r\n                continue;\r\n            }\r\n            const name = paintAttributeName(property, layer.type);\r\n            const type = value.property.specification.type;\r\n            const useIntegerZoom = value.property.useIntegerZoom;\r\n\r\n            if (value.value.kind === 'constant') {\r\n                self.binders[property] = new ConstantBinder(value.value, name, type);\r\n                keys.push(`/u_${name}`);\r\n            } else if (value.value.kind === 'source') {\r\n                self.binders[property] = new SourceExpressionBinder(value.value, name, type);\r\n                keys.push(`/a_${name}`);\r\n            } else {\r\n                self.binders[property] = new CompositeExpressionBinder(value.value, name, type, useIntegerZoom, zoom);\r\n                keys.push(`/z_${name}`);\r\n            }\r\n        }\r\n\r\n        self.cacheKey = keys.sort().join('');\r\n\r\n        return self;\r\n    }\r\n\r\n    populatePaintArrays(length: number, feature: Feature) {\r\n        for (const property in this.binders) {\r\n            this.binders[property].populatePaintArray(length, feature);\r\n        }\r\n    }\r\n\r\n    defines(): Array<string> {\r\n        const result = [];\r\n        for (const property in this.binders) {\r\n            result.push.apply(result, this.binders[property].defines());\r\n        }\r\n        return result;\r\n    }\r\n\r\n    setUniforms<Properties: Object>(context: Context, program: Program, properties: PossiblyEvaluated<Properties>, globals: GlobalProperties) {\r\n        for (const property in this.binders) {\r\n            const binder = this.binders[property];\r\n            binder.setUniforms(context, program, globals, properties.get(property));\r\n        }\r\n    }\r\n\r\n    getPaintVertexBuffers(): Array<VertexBuffer> {\r\n        return this._buffers;\r\n    }\r\n\r\n    upload(context: Context) {\r\n        for (const property in this.binders) {\r\n            this.binders[property].upload(context);\r\n        }\r\n\r\n        const buffers = [];\r\n        for (const property in this.binders) {\r\n            const binder = this.binders[property];\r\n            if ((binder instanceof SourceExpressionBinder ||\r\n                binder instanceof CompositeExpressionBinder) &&\r\n                binder.paintVertexBuffer\r\n            ) {\r\n                buffers.push(binder.paintVertexBuffer);\r\n            }\r\n        }\r\n        this._buffers = buffers;\r\n    }\r\n\r\n    destroy() {\r\n        for (const property in this.binders) {\r\n            this.binders[property].destroy();\r\n        }\r\n    }\r\n}\r\n\r\nclass ProgramConfigurationSet<Layer: TypedStyleLayer> {\r\n    programConfigurations: {[string]: ProgramConfiguration};\r\n\r\n    constructor(layoutAttributes: Array<StructArrayMember>, layers: $ReadOnlyArray<Layer>, zoom: number, filterProperties: (string) => boolean = () => true) {\r\n        this.programConfigurations = {};\r\n        for (const layer of layers) {\r\n            this.programConfigurations[layer.id] = ProgramConfiguration.createDynamic(layer, zoom, filterProperties);\r\n            this.programConfigurations[layer.id].layoutAttributes = layoutAttributes;\r\n        }\r\n    }\r\n\r\n    populatePaintArrays(length: number, feature: Feature) {\r\n        for (const key in this.programConfigurations) {\r\n            this.programConfigurations[key].populatePaintArrays(length, feature);\r\n        }\r\n    }\r\n\r\n    get(layerId: string) {\r\n        return this.programConfigurations[layerId];\r\n    }\r\n\r\n    upload(context: Context) {\r\n        for (const layerId in this.programConfigurations) {\r\n            this.programConfigurations[layerId].upload(context);\r\n        }\r\n    }\r\n\r\n    destroy() {\r\n        for (const layerId in this.programConfigurations) {\r\n            this.programConfigurations[layerId].destroy();\r\n        }\r\n    }\r\n}\r\n\r\n// paint property arrays\r\nfunction paintAttributeName(property, type) {\r\n    const attributeNameExceptions = {\r\n        'text-opacity': 'opacity',\r\n        'icon-opacity': 'opacity',\r\n        'text-color': 'fill_color',\r\n        'icon-color': 'fill_color',\r\n        'text-halo-color': 'halo_color',\r\n        'icon-halo-color': 'halo_color',\r\n        'text-halo-blur': 'halo_blur',\r\n        'icon-halo-blur': 'halo_blur',\r\n        'text-halo-width': 'halo_width',\r\n        'icon-halo-width': 'halo_width',\r\n        'line-gap-width': 'gapwidth'\r\n    };\r\n    return attributeNameExceptions[property] ||\r\n        property.replace(`${type}-`, '').replace(/-/g, '_');\r\n}\r\n\r\nregister('ConstantBinder', ConstantBinder);\r\nregister('SourceExpressionBinder', SourceExpressionBinder);\r\nregister('CompositeExpressionBinder', CompositeExpressionBinder);\r\nregister('ProgramConfiguration', ProgramConfiguration, {omit: ['_buffers']});\r\nregister('ProgramConfigurationSet', ProgramConfigurationSet);\r\n\r\nmodule.exports = {\r\n    ProgramConfiguration,\r\n    ProgramConfigurationSet\r\n};\r\n","// @flow\r\n\r\nconst {warnOnce} = require('../util/util');\r\nconst {register} = require('../util/web_worker_transfer');\r\n\r\nimport type VertexArrayObject from '../render/vertex_array_object';\r\nimport type {StructArray} from '../util/struct_array';\r\n\r\nconst MAX_VERTEX_ARRAY_LENGTH = Math.pow(2, 16) - 1;\r\n\r\nexport type Segment = {\r\n    vertexOffset: number,\r\n    primitiveOffset: number,\r\n    vertexLength: number,\r\n    primitiveLength: number,\r\n    vaos: {[string]: VertexArrayObject}\r\n}\r\n\r\nclass SegmentVector {\r\n    segments: Array<Segment>;\r\n\r\n    constructor(segments?: Array<Segment> = []) {\r\n        this.segments = segments;\r\n    }\r\n\r\n    prepareSegment(numVertices: number, layoutVertexArray: StructArray, indexArray: StructArray): Segment {\r\n        let segment: Segment = this.segments[this.segments.length - 1];\r\n        if (numVertices > MAX_VERTEX_ARRAY_LENGTH) warnOnce(`Max vertices per segment is ${MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${numVertices}`);\r\n        if (!segment || segment.vertexLength + numVertices > module.exports.MAX_VERTEX_ARRAY_LENGTH) {\r\n            segment = ({\r\n                vertexOffset: layoutVertexArray.length,\r\n                primitiveOffset: indexArray.length,\r\n                vertexLength: 0,\r\n                primitiveLength: 0\r\n            }: any);\r\n            this.segments.push(segment);\r\n        }\r\n        return segment;\r\n    }\r\n\r\n    get() {\r\n        return this.segments;\r\n    }\r\n\r\n    destroy() {\r\n        for (const segment of this.segments) {\r\n            for (const k in segment.vaos) {\r\n                segment.vaos[k].destroy();\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nregister('SegmentVector', SegmentVector);\r\n\r\nmodule.exports = {\r\n    SegmentVector,\r\n\r\n    /**\r\n     * The maximum size of a vertex array. This limit is imposed by WebGL's 16 bit\r\n     * addressing of vertex buffers.\r\n     * @private\r\n     * @readonly\r\n     */\r\n    MAX_VERTEX_ARRAY_LENGTH: MAX_VERTEX_ARRAY_LENGTH\r\n};\r\n","// @flow\r\n\r\n/**\r\n * A coordinate is a column, row, zoom combination, often used\r\n * as the data component of a tile.\r\n *\r\n * @param {number} column\r\n * @param {number} row\r\n * @param {number} zoom\r\n * @private\r\n */\r\nclass Coordinate {\r\n    column: number;\r\n    row: number;\r\n    zoom: number;\r\n    constructor(column: number, row: number, zoom: number) {\r\n        this.column = column;\r\n        this.row = row;\r\n        this.zoom = zoom;\r\n    }\r\n\r\n    /**\r\n     * Create a clone of this coordinate that can be mutated without\r\n     * changing the original coordinate\r\n     *\r\n     * @returns {Coordinate} clone\r\n     * @private\r\n     * var coord = new Coordinate(0, 0, 0);\r\n     * var c2 = coord.clone();\r\n     * // since coord is cloned, modifying a property of c2 does\r\n     * // not modify it.\r\n     * c2.zoom = 2;\r\n     */\r\n    clone() {\r\n        return new Coordinate(this.column, this.row, this.zoom);\r\n    }\r\n\r\n    /**\r\n     * Zoom this coordinate to a given zoom level. This returns a new\r\n     * coordinate object, not mutating the old one.\r\n     *\r\n     * @param {number} zoom\r\n     * @returns {Coordinate} zoomed coordinate\r\n     * @private\r\n     * @example\r\n     * var coord = new Coordinate(0, 0, 0);\r\n     * var c2 = coord.zoomTo(1);\r\n     * c2 // equals new Coordinate(0, 0, 1);\r\n     */\r\n    zoomTo(zoom: number) { return this.clone()._zoomTo(zoom); }\r\n\r\n    /**\r\n     * Subtract the column and row values of this coordinate from those\r\n     * of another coordinate. The other coordinat will be zoomed to the\r\n     * same level as `this` before the subtraction occurs\r\n     *\r\n     * @param {Coordinate} c other coordinate\r\n     * @returns {Coordinate} result\r\n     * @private\r\n     */\r\n    sub(c: Coordinate) { return this.clone()._sub(c); }\r\n\r\n    _zoomTo(zoom: number) {\r\n        const scale = Math.pow(2, zoom - this.zoom);\r\n        this.column *= scale;\r\n        this.row *= scale;\r\n        this.zoom = zoom;\r\n        return this;\r\n    }\r\n\r\n    _sub(c: Coordinate) {\r\n        c = c.zoomTo(this.zoom);\r\n        this.column -= c.column;\r\n        this.row -= c.row;\r\n        return this;\r\n    }\r\n}\r\n\r\nmodule.exports = Coordinate;\r\n","// @flow\r\n\r\nconst ShelfPack = require('@mapbox/shelf-pack');\r\nconst {AlphaImage} = require('../util/image');\r\n\r\nimport type {GlyphMetrics, StyleGlyph} from '../style/style_glyph';\r\n\r\nconst padding = 1;\r\n\r\ntype Rect = {\r\n    x: number,\r\n    y: number,\r\n    w: number,\r\n    h: number\r\n};\r\n\r\nexport type GlyphPosition = {\r\n    rect: Rect,\r\n    metrics: GlyphMetrics\r\n};\r\n\r\nexport type GlyphAtlas = {\r\n    image: AlphaImage,\r\n    positions: {[string]: {[number]: GlyphPosition}}\r\n};\r\n\r\nfunction makeGlyphAtlas(stacks: {[string]: {[number]: ?StyleGlyph}}): GlyphAtlas {\r\n    const image = new AlphaImage({width: 0, height: 0});\r\n    const positions = {};\r\n\r\n    const pack = new ShelfPack(0, 0, {autoResize: true});\r\n\r\n    for (const stack in stacks) {\r\n        const glyphs = stacks[stack];\r\n        const stackPositions = positions[stack] = {};\r\n\r\n        for (const id in glyphs) {\r\n            const src = glyphs[+id];\r\n            if (src && src.bitmap.width !== 0 && src.bitmap.height !== 0) {\r\n                const bin = pack.packOne(\r\n                    src.bitmap.width + 2 * padding,\r\n                    src.bitmap.height + 2 * padding);\r\n\r\n                image.resize({\r\n                    width: pack.w,\r\n                    height: pack.h\r\n                });\r\n\r\n                AlphaImage.copy(\r\n                    src.bitmap,\r\n                    image,\r\n                    { x: 0, y: 0 },\r\n                    {\r\n                        x: bin.x + padding,\r\n                        y: bin.y + padding\r\n                    },\r\n                    src.bitmap);\r\n\r\n                stackPositions[id] = { rect: bin, metrics: src.metrics };\r\n            }\r\n        }\r\n    }\r\n\r\n    pack.shrink();\r\n    image.resize({\r\n        width: pack.w,\r\n        height: pack.h\r\n    });\r\n\r\n    return {image, positions};\r\n}\r\n\r\nmodule.exports = {\r\n    makeGlyphAtlas\r\n};\r\n","// @flow\r\n\r\nconst ShelfPack = require('@mapbox/shelf-pack');\r\nconst {RGBAImage} = require('../util/image');\r\n\r\nimport type {StyleImage} from '../style/style_image';\r\n\r\nconst padding = 1;\r\n\r\ntype Rect = {\r\n    x: number,\r\n    y: number,\r\n    w: number,\r\n    h: number\r\n};\r\n\r\nexport type ImagePosition = {\r\n    pixelRatio: number,\r\n    textureRect: Rect,\r\n    tl: [number, number],\r\n    br: [number, number],\r\n    displaySize: [number, number]\r\n};\r\n\r\n// This wants to be a class, but is sent to workers, so must be a plain JSON blob.\r\nfunction imagePosition(rect: Rect, {pixelRatio}: StyleImage): ImagePosition {\r\n    const textureRect = {\r\n        x: rect.x + padding,\r\n        y: rect.y + padding,\r\n        w: rect.w - padding * 2,\r\n        h: rect.h - padding * 2\r\n    };\r\n    return {\r\n        pixelRatio,\r\n        textureRect,\r\n\r\n        // Redundant calculated members.\r\n        tl: [\r\n            textureRect.x,\r\n            textureRect.y\r\n        ],\r\n        br: [\r\n            textureRect.x + textureRect.w,\r\n            textureRect.y + textureRect.h\r\n        ],\r\n        displaySize: [\r\n            textureRect.w / pixelRatio,\r\n            textureRect.h / pixelRatio\r\n        ]\r\n    };\r\n}\r\n\r\nexport type ImageAtlas = {\r\n    image: RGBAImage,\r\n    positions: {[string]: ImagePosition}\r\n};\r\n\r\nfunction makeImageAtlas(images: {[string]: StyleImage}): ImageAtlas {\r\n    const image = new RGBAImage({width: 0, height: 0});\r\n    const positions = {};\r\n\r\n    const pack = new ShelfPack(0, 0, {autoResize: true});\r\n\r\n    for (const id in images) {\r\n        const src = images[id];\r\n\r\n        const bin = pack.packOne(\r\n            src.data.width + 2 * padding,\r\n            src.data.height + 2 * padding);\r\n\r\n        image.resize({\r\n            width: pack.w,\r\n            height: pack.h\r\n        });\r\n\r\n        RGBAImage.copy(\r\n            src.data,\r\n            image,\r\n            { x: 0, y: 0 },\r\n            {\r\n                x: bin.x + padding,\r\n                y: bin.y + padding\r\n            },\r\n            src.data);\r\n\r\n        positions[id] = imagePosition(bin, src);\r\n    }\r\n\r\n    pack.shrink();\r\n    image.resize({\r\n        width: pack.w,\r\n        height: pack.h\r\n    });\r\n\r\n    return {image, positions};\r\n}\r\n\r\nmodule.exports = {\r\n    imagePosition,\r\n    makeImageAtlas\r\n};\r\n","// @flow\r\n\r\nconst util = require('../util/util');\r\n\r\n/**\r\n * Packs two numbers, interpreted as 8-bit unsigned integers, into a single\r\n * float.  Unpack them in the shader using the `unpack_float()` function,\r\n * defined in _prelude.vertex.glsl\r\n *\r\n * @private\r\n */\r\nexports.packUint8ToFloat = function pack(a: number, b: number) {\r\n    // coerce a and b to 8-bit ints\r\n    a = util.clamp(Math.floor(a), 0, 255);\r\n    b = util.clamp(Math.floor(b), 0, 255);\r\n    return 256 * a + b;\r\n};\r\n\r\n","// @flow\r\n\r\nconst ajax = require('../util/ajax');\r\nconst rewind = require('geojson-rewind');\r\nconst GeoJSONWrapper = require('./geojson_wrapper');\r\nconst vtpbf = require('vt-pbf');\r\nconst supercluster = require('supercluster');\r\nconst geojsonvt = require('geojson-vt').default;\r\n\r\nconst VectorTileWorkerSource = require('./vector_tile_worker_source');\r\n\r\nimport type {\r\n    WorkerTileParameters,\r\n    WorkerTileCallback,\r\n} from '../source/worker_source';\r\n\r\nimport type Actor from '../util/actor';\r\nimport type StyleLayerIndex from '../style/style_layer_index';\r\n\r\nimport type {LoadVectorDataCallback} from './vector_tile_worker_source';\r\nimport type {RequestParameters} from '../util/ajax';\r\nimport type { Callback } from '../types/callback';\r\n\r\nexport type GeoJSON = Object;\r\n\r\nexport type LoadGeoJSONParameters = {\r\n    request?: RequestParameters,\r\n    data?: string,\r\n    source: string,\r\n    superclusterOptions?: Object,\r\n    geojsonVtOptions?: Object\r\n};\r\n\r\nexport type LoadGeoJSON = (params: LoadGeoJSONParameters, callback: Callback<mixed>) => void;\r\n\r\nexport interface GeoJSONIndex {\r\n}\r\n\r\nfunction loadGeoJSONTile(params: WorkerTileParameters, callback: LoadVectorDataCallback) {\r\n    const source = params.source,\r\n        canonical = params.tileID.canonical;\r\n\r\n    if (!this._geoJSONIndexes[source]) {\r\n        return callback(null, null);  // we couldn't load the file\r\n    }\r\n\r\n    const geoJSONTile = this._geoJSONIndexes[source].getTile(canonical.z, canonical.x, canonical.y);\r\n    if (!geoJSONTile) {\r\n        return callback(null, null); // nothing in the given tile\r\n    }\r\n\r\n    const geojsonWrapper = new GeoJSONWrapper(geoJSONTile.features);\r\n\r\n    // Encode the geojson-vt tile into binary vector tile form form.  This\r\n    // is a convenience that allows `FeatureIndex` to operate the same way\r\n    // across `VectorTileSource` and `GeoJSONSource` data.\r\n    let pbf = vtpbf(geojsonWrapper);\r\n    if (pbf.byteOffset !== 0 || pbf.byteLength !== pbf.buffer.byteLength) {\r\n        // Compatibility with node Buffer (https://github.com/mapbox/pbf/issues/35)\r\n        pbf = new Uint8Array(pbf);\r\n    }\r\n\r\n    callback(null, {\r\n        vectorTile: geojsonWrapper,\r\n        rawData: pbf.buffer\r\n    });\r\n}\r\n\r\n/**\r\n * The {@link WorkerSource} implementation that supports {@link GeoJSONSource}.\r\n * This class is designed to be easily reused to support custom source types\r\n * for data formats that can be parsed/converted into an in-memory GeoJSON\r\n * representation.  To do so, create it with\r\n * `new GeoJSONWorkerSource(actor, layerIndex, customLoadGeoJSONFunction)`.\r\n * For a full example, see [mapbox-gl-topojson](https://github.com/developmentseed/mapbox-gl-topojson).\r\n *\r\n * @private\r\n */\r\nclass GeoJSONWorkerSource extends VectorTileWorkerSource {\r\n    _geoJSONIndexes: { [string]: GeoJSONIndex };\r\n    loadGeoJSON: LoadGeoJSON;\r\n\r\n    /**\r\n     * @param [loadGeoJSON] Optional method for custom loading/parsing of\r\n     * GeoJSON based on parameters passed from the main-thread Source.\r\n     * See {@link GeoJSONWorkerSource#loadGeoJSON}.\r\n     */\r\n    constructor(actor: Actor, layerIndex: StyleLayerIndex, loadGeoJSON: ?LoadGeoJSON) {\r\n        super(actor, layerIndex, loadGeoJSONTile);\r\n        if (loadGeoJSON) {\r\n            this.loadGeoJSON = loadGeoJSON;\r\n        }\r\n        // object mapping source ids to geojson-vt-like tile indexes\r\n        this._geoJSONIndexes = {};\r\n    }\r\n\r\n    /**\r\n     * Fetches (if appropriate), parses, and index geojson data into tiles. This\r\n     * preparatory method must be called before {@link GeoJSONWorkerSource#loadTile}\r\n     * can correctly serve up tiles.\r\n     *\r\n     * Defers to {@link GeoJSONWorkerSource#loadGeoJSON} for the fetching/parsing,\r\n     * expecting `callback(error, data)` to be called with either an error or a\r\n     * parsed GeoJSON object.\r\n     * @param params\r\n     * @param params.source The id of the source.\r\n     * @param callback\r\n     */\r\n    loadData(params: LoadGeoJSONParameters, callback: Callback<void>) {\r\n        this.loadGeoJSON(params, (err, data) => {\r\n            if (err || !data) {\r\n                return callback(err);\r\n            } else if (typeof data !== 'object') {\r\n                return callback(new Error(\"Input data is not a valid GeoJSON object.\"));\r\n            } else {\r\n                rewind(data, true);\r\n\r\n                try {\r\n                    this._geoJSONIndexes[params.source] = params.cluster ?\r\n                        supercluster(params.superclusterOptions).load(data.features) :\r\n                        geojsonvt(data, params.geojsonVtOptions);\r\n                } catch (err) {\r\n                    return callback(err);\r\n                }\r\n\r\n                this.loaded[params.source] = {};\r\n                callback(null);\r\n            }\r\n        });\r\n    }\r\n\r\n    /**\r\n    * Implements {@link WorkerSource#reloadTile}.\r\n    *\r\n    * If the tile is loaded, uses the implementation in VectorTileWorkerSource.\r\n    * Otherwise, such as after a setData() call, we load the tile fresh.\r\n    *\r\n    * @param params\r\n    * @param params.source The id of the source for which we're loading this tile.\r\n    * @param params.uid The UID for this tile.\r\n    */\r\n    reloadTile(params: WorkerTileParameters, callback: WorkerTileCallback) {\r\n        const loaded = this.loaded[params.source],\r\n            uid = params.uid;\r\n\r\n        if (loaded && loaded[uid]) {\r\n            return super.reloadTile(params, callback);\r\n        } else {\r\n            return this.loadTile(params, callback);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Fetch and parse GeoJSON according to the given params.  Calls `callback`\r\n     * with `(err, data)`, where `data` is a parsed GeoJSON object.\r\n     *\r\n     * GeoJSON is loaded and parsed from `params.url` if it exists, or else\r\n     * expected as a literal (string or object) `params.data`.\r\n     *\r\n     * @param params\r\n     * @param [params.url] A URL to the remote GeoJSON data.\r\n     * @param [params.data] Literal GeoJSON data. Must be provided if `params.url` is not.\r\n     */\r\n    loadGeoJSON(params: LoadGeoJSONParameters, callback: Callback<mixed>) {\r\n        // Because of same origin issues, urls must either include an explicit\r\n        // origin or absolute path.\r\n        // ie: /foo/bar.json or http://example.com/bar.json\r\n        // but not ../foo/bar.json\r\n        if (params.request) {\r\n            ajax.getJSON(params.request, callback);\r\n        } else if (typeof params.data === 'string') {\r\n            try {\r\n                return callback(null, JSON.parse(params.data));\r\n            } catch (e) {\r\n                return callback(new Error(\"Input data is not a valid GeoJSON object.\"));\r\n            }\r\n        } else {\r\n            return callback(new Error(\"Input data is not a valid GeoJSON object.\"));\r\n        }\r\n    }\r\n\r\n    removeSource(params: {source: string}, callback: Callback<mixed>) {\r\n        if (this._geoJSONIndexes[params.source]) {\r\n            delete this._geoJSONIndexes[params.source];\r\n        }\r\n        callback();\r\n    }\r\n}\r\n\r\nmodule.exports = GeoJSONWorkerSource;\r\n","// @flow\r\n\r\nconst Point = require('@mapbox/point-geometry');\r\nconst toGeoJSON = require('@mapbox/vector-tile').VectorTileFeature.prototype.toGeoJSON;\r\nconst EXTENT = require('../data/extent');\r\n\r\n// The feature type used by geojson-vt and supercluster. Should be extracted to\r\n// global type and used in module definitions for those two modules.\r\ntype Feature = {\r\n    type: 1,\r\n    id: mixed,\r\n    tags: {[string]: string | number | boolean},\r\n    geometry: Array<[number, number]>,\r\n} | {\r\n    type: 2 | 3,\r\n    id: mixed,\r\n    tags: {[string]: string | number | boolean},\r\n    geometry: Array<Array<[number, number]>>,\r\n}\r\n\r\nclass FeatureWrapper implements VectorTileFeature {\r\n    _feature: Feature;\r\n\r\n    extent: number;\r\n    type: 1 | 2 | 3;\r\n    id: number;\r\n    properties: {[string]: string | number | boolean};\r\n\r\n    constructor(feature: Feature) {\r\n        this._feature = feature;\r\n\r\n        this.extent = EXTENT;\r\n        this.type = feature.type;\r\n        this.properties = feature.tags;\r\n\r\n        // If the feature has a top-level `id` property, copy it over, but only\r\n        // if it can be coerced to an integer, because this wrapper is used for\r\n        // serializing geojson feature data into vector tile PBF data, and the\r\n        // vector tile spec only supports integer values for feature ids --\r\n        // allowing non-integer values here results in a non-compliant PBF\r\n        // that causes an exception when it is parsed with vector-tile-js\r\n        if ('id' in feature && !isNaN(feature.id)) {\r\n            this.id = parseInt(feature.id, 10);\r\n        }\r\n    }\r\n\r\n    loadGeometry() {\r\n        if (this._feature.type === 1) {\r\n            const geometry = [];\r\n            for (const point of this._feature.geometry) {\r\n                geometry.push([new Point(point[0], point[1])]);\r\n            }\r\n            return geometry;\r\n        } else {\r\n            const geometry = [];\r\n            for (const ring of this._feature.geometry) {\r\n                const newRing = [];\r\n                for (const point of ring) {\r\n                    newRing.push(new Point(point[0], point[1]));\r\n                }\r\n                geometry.push(newRing);\r\n            }\r\n            return geometry;\r\n        }\r\n    }\r\n\r\n    toGeoJSON(x: number, y: number, z: number) {\r\n        return toGeoJSON.call(this, x, y, z);\r\n    }\r\n}\r\n\r\nclass GeoJSONWrapper implements VectorTile, VectorTileLayer {\r\n    layers: {[string]: VectorTileLayer};\r\n    name: string;\r\n    extent: number;\r\n    length: number;\r\n    _features: Array<Feature>;\r\n\r\n    constructor(features: Array<Feature>) {\r\n        this.layers = { '_geojsonTileLayer': this };\r\n        this.name = '_geojsonTileLayer';\r\n        this.extent = EXTENT;\r\n        this.length = features.length;\r\n        this._features = features;\r\n    }\r\n\r\n    feature(i: number): VectorTileFeature {\r\n        return new FeatureWrapper(this._features[i]);\r\n    }\r\n}\r\n\r\nmodule.exports = GeoJSONWrapper;\r\n","// @flow\r\n\r\nconst {DEMData} = require('../data/dem_data');\r\n\r\nimport type Actor from '../util/actor';\r\nimport type {\r\n    WorkerDEMTileParameters,\r\n    WorkerDEMTileCallback,\r\n    TileParameters\r\n} from './worker_source';\r\n\r\n\r\nclass RasterDEMTileWorkerSource {\r\n    actor: Actor;\r\n    loading: {[string]: {[string]: DEMData}};\r\n    loaded: {[string]: {[string]: DEMData}};\r\n\r\n    constructor() {\r\n        this.loading = {};\r\n        this.loaded = {};\r\n    }\r\n\r\n    loadTile(params: WorkerDEMTileParameters, callback: WorkerDEMTileCallback) {\r\n        const source = params.source,\r\n            uid = params.uid;\r\n\r\n        if (!this.loading[source])\r\n            this.loading[source] = {};\r\n\r\n        const dem = new DEMData(uid);\r\n        this.loading[source][uid] = dem;\r\n        dem.loadFromImage(params.rawImageData);\r\n        delete this.loading[source][uid];\r\n\r\n        this.loaded[source] = this.loaded[source] || {};\r\n        this.loaded[source][uid] = dem;\r\n        callback(null, dem);\r\n    }\r\n\r\n    removeTile(params: TileParameters) {\r\n        const loaded = this.loaded[params.source],\r\n            uid = params.uid;\r\n        if (loaded && loaded[uid]) {\r\n            delete loaded[uid];\r\n        }\r\n    }\r\n}\r\n\r\nmodule.exports = RasterDEMTileWorkerSource;\r\n","// @flow\r\n\r\nconst ajax = require('../util/ajax');\r\nconst Evented = require('../util/evented');\r\nconst window = require('../util/window');\r\n\r\nlet pluginRequested = false;\r\nlet pluginBlobURL = null;\r\n\r\nmodule.exports.evented = new Evented();\r\n\r\ntype ErrorCallback = (error: Error) => void;\r\n\r\nmodule.exports.registerForPluginAvailability = function(\r\n    callback: (args: {pluginBlobURL: string, errorCallback: ErrorCallback}) => void\r\n) {\r\n    if (pluginBlobURL) {\r\n        callback({ pluginBlobURL: pluginBlobURL, errorCallback: module.exports.errorCallback});\r\n    } else {\r\n        module.exports.evented.once('pluginAvailable', callback);\r\n    }\r\n    return callback;\r\n};\r\n\r\n// Exposed so it can be stubbed out by tests\r\nmodule.exports.createBlobURL = function(response: Object) {\r\n    return window.URL.createObjectURL(new window.Blob([response.data], {type: \"text/javascript\"}));\r\n};\r\n// Only exposed for tests\r\nmodule.exports.clearRTLTextPlugin = function() {\r\n    pluginRequested = false;\r\n    pluginBlobURL = null;\r\n};\r\n\r\nmodule.exports.setRTLTextPlugin = function(pluginURL: string, callback: ErrorCallback) {\r\n    if (pluginRequested) {\r\n        throw new Error('setRTLTextPlugin cannot be called multiple times.');\r\n    }\r\n    pluginRequested = true;\r\n    module.exports.errorCallback = callback;\r\n    ajax.getArrayBuffer({ url: pluginURL }, (err, response) => {\r\n        if (err) {\r\n            callback(err);\r\n        } else if (response) {\r\n            pluginBlobURL = module.exports.createBlobURL(response);\r\n            module.exports.evented.fire('pluginAvailable', { pluginBlobURL: pluginBlobURL, errorCallback: callback });\r\n        }\r\n    });\r\n};\r\n\r\nmodule.exports.applyArabicShaping = (null: ?Function);\r\nmodule.exports.processBidirectionalText = (null: ?(string, Array<number>) => Array<string>);\r\n","// @flow\n\nconst WhooTS = require('@mapbox/whoots-js');\nconst assert = require('assert');\nconst {register} = require('../util/web_worker_transfer');\nconst Coordinate = require('../geo/coordinate');\n\nclass CanonicalTileID {\n    z: number;\n    x: number;\n    y: number;\n    key: number;\n\n    constructor(z: number, x: number, y: number) {\n        assert(z >= 0 && z <= 25);\n        assert(x >= 0 && x < Math.pow(2, z + 1));\n        assert(y >= 0 && y < Math.pow(2, z));\n        this.z = z;\n        this.x = x;\n        this.y = y;\n        this.key = calculateKey(0, z, x, y);\n    }\n\n    equals(id: CanonicalTileID) {\n        return this.z === id.z && this.x === id.x && this.y === id.y;\n    }\n\n    // given a list of urls, choose a url template and return a tile URL\n    url(urls: Array<string>, scheme: ?string) {\n        const bbox = WhooTS.getTileBBox(this.x, this.y, this.z);\n        const quadkey = getQuadkey(this.z, this.x, this.y);\n\n        return urls[(this.x + this.y) % urls.length]\n            .replace('{prefix}', (this.x % 16).toString(16) + (this.y % 16).toString(16))\n            .replace('{z}', String(this.z))\n            .replace('{x}', String(this.x))\n            .replace('{y}', String(scheme === 'tms' ? (Math.pow(2, this.z) - this.y - 1) : this.y))\n            .replace('{quadkey}', quadkey)\n            .replace('{bbox-epsg-3857}', bbox);\n    }\n}\n\nclass UnwrappedTileID {\n    wrap: number;\n    canonical: CanonicalTileID;\n    key: number;\n\n    constructor(wrap: number, canonical: CanonicalTileID, posMatrix) {\n        this.wrap = wrap;\n        this.canonical = canonical;\n        this.key = calculateKey(wrap, canonical.z, canonical.x, canonical.y);\n        this.posMatrix = posMatrix;\n    }\n}\n\nclass OverscaledTileID {\n    overscaledZ: number;\n    wrap: number;\n    canonical: CanonicalTileID;\n    key: number;\n    posMatrix: Float32Array;\n\n    constructor(overscaledZ: number, wrap: number, z: number, x: number, y: number) {\n        assert(overscaledZ >= z);\n        this.overscaledZ = overscaledZ;\n        this.wrap = wrap;\n        this.canonical = new CanonicalTileID(z, +x, +y);\n        this.key = calculateKey(wrap, overscaledZ, x, y);\n    }\n\n    scaledTo(targetZ: number) {\n        assert(targetZ <= this.overscaledZ);\n        const zDifference = this.canonical.z - targetZ;\n        if (targetZ > this.canonical.z) {\n            return new OverscaledTileID(targetZ, this.wrap, this.canonical.z, this.canonical.x, this.canonical.y);\n        } else {\n            return new OverscaledTileID(targetZ, this.wrap, targetZ, this.canonical.x >> zDifference, this.canonical.y >> zDifference);\n        }\n    }\n\n    isChildOf(parent: OverscaledTileID) {\n        const zDifference = this.canonical.z - parent.canonical.z;\n        // We're first testing for z == 0, to avoid a 32 bit shift, which is undefined.\n        return parent.overscaledZ === 0 || (\n            parent.overscaledZ < this.overscaledZ &&\n                parent.canonical.x === (this.canonical.x >> zDifference) &&\n                parent.canonical.y === (this.canonical.y >> zDifference));\n    }\n\n    children(sourceMaxZoom: number) {\n        if (this.overscaledZ >= sourceMaxZoom) {\n            // return a single tile coord representing a an overscaled tile\n            return [new OverscaledTileID(this.overscaledZ + 1, this.wrap, this.canonical.z, this.canonical.x, this.canonical.y)];\n        }\n\n        const z = this.canonical.z + 1;\n        const x = this.canonical.x * 2;\n        const y = this.canonical.y * 2;\n        return [\n            new OverscaledTileID(z, this.wrap, z, x, y),\n            new OverscaledTileID(z, this.wrap, z, x + 1, y),\n            new OverscaledTileID(z, this.wrap, z, x, y + 1),\n            new OverscaledTileID(z, this.wrap, z, x + 1, y + 1)\n        ];\n    }\n\n    isLessThan(rhs: OverscaledTileID) {\n        if (this.wrap < rhs.wrap) return true;\n        if (this.wrap > rhs.wrap) return false;\n\n        if (this.overscaledZ < rhs.overscaledZ) return true;\n        if (this.overscaledZ > rhs.overscaledZ) return false;\n\n        if (this.canonical.x < rhs.canonical.x) return true;\n        if (this.canonical.x > rhs.canonical.x) return false;\n\n        if (this.canonical.y < rhs.canonical.y) return true;\n        return false;\n    }\n\n    wrapped() {\n        return new OverscaledTileID(this.overscaledZ, 0, this.canonical.z, this.canonical.x, this.canonical.y);\n    }\n\n    overscaleFactor() {\n        return Math.pow(2, this.overscaledZ - this.canonical.z);\n    }\n\n    toUnwrapped() {\n        return new UnwrappedTileID(this.wrap, this.canonical, this.posMatrix);\n    }\n\n    toString() {\n        return `${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`;\n    }\n\n    toCoordinate() {\n        return new Coordinate(this.canonical.x + Math.pow(2, this.wrap), this.canonical.y, this.canonical.z);\n    }\n}\n\nfunction calculateKey(wrap: number, z: number, x: number, y: number) {\n    wrap *= 2;\n    if (wrap < 0) wrap = wrap * -1 - 1;\n    const dim = 1 << z;\n    return ((dim * dim * wrap + dim * y + x) * 32) + z;\n}\n\n\nfunction getQuadkey(z, x, y) {\n    let quadkey = '', mask;\n    for (let i = z; i > 0; i--) {\n        mask = 1 << (i - 1);\n        quadkey += ((x & mask ? 1 : 0) + (y & mask ? 2 : 0));\n    }\n    return quadkey;\n}\n\nregister('CanonicalTileID', CanonicalTileID);\nregister('OverscaledTileID', OverscaledTileID, {omit: ['posMatrix']});\n\nmodule.exports = {\n    CanonicalTileID: CanonicalTileID,\n    OverscaledTileID: OverscaledTileID,\n    UnwrappedTileID: UnwrappedTileID\n};\n","// @flow\r\n\r\nconst ajax = require('../util/ajax');\r\nconst vt = require('@mapbox/vector-tile');\r\nconst Protobuf = require('pbf');\r\nconst WorkerTile = require('./worker_tile');\r\nconst util = require('../util/util');\r\n\r\nimport type {\r\n    WorkerSource,\r\n    WorkerTileParameters,\r\n    WorkerTileCallback,\r\n    TileParameters\r\n} from '../source/worker_source';\r\n\r\nimport type Actor from '../util/actor';\r\nimport type StyleLayerIndex from '../style/style_layer_index';\r\nimport type {Callback} from '../types/callback';\r\n\r\nexport type LoadVectorTileResult = {\r\n    vectorTile: VectorTile;\r\n    rawData: ArrayBuffer;\r\n    expires?: any;\r\n    cacheControl?: any;\r\n};\r\n\r\n/**\r\n * @callback LoadVectorDataCallback\r\n * @param error\r\n * @param vectorTile\r\n * @private\r\n */\r\nexport type LoadVectorDataCallback = Callback<?LoadVectorTileResult>;\r\n\r\nexport type AbortVectorData = () => void;\r\nexport type LoadVectorData = (params: WorkerTileParameters, callback: LoadVectorDataCallback) => ?AbortVectorData;\r\n\r\n/**\r\n * @private\r\n */\r\nfunction loadVectorTile(params: WorkerTileParameters, callback: LoadVectorDataCallback) {\r\n    const xhr = ajax.getArrayBuffer(params.request, (err, response) => {\r\n        if (err) {\r\n            callback(err);\r\n        } else if (response) {\r\n            callback(null, {\r\n                vectorTile: new vt.VectorTile(new Protobuf(response.data)),\r\n                rawData: response.data,\r\n                cacheControl: response.cacheControl,\r\n                expires: response.expires\r\n            });\r\n        }\r\n    });\r\n    return () => {\r\n        xhr.abort();\r\n        callback();\r\n    };\r\n}\r\n\r\n/**\r\n * The {@link WorkerSource} implementation that supports {@link VectorTileSource}.\r\n * This class is designed to be easily reused to support custom source types\r\n * for data formats that can be parsed/converted into an in-memory VectorTile\r\n * representation.  To do so, create it with\r\n * `new VectorTileWorkerSource(actor, styleLayers, customLoadVectorDataFunction)`.\r\n *\r\n * @private\r\n */\r\nclass VectorTileWorkerSource implements WorkerSource {\r\n    actor: Actor;\r\n    layerIndex: StyleLayerIndex;\r\n    loadVectorData: LoadVectorData;\r\n    loading: { [string]: { [string]: WorkerTile } };\r\n    loaded: { [string]: { [string]: WorkerTile } };\r\n\r\n    /**\r\n     * @param [loadVectorData] Optional method for custom loading of a VectorTile\r\n     * object based on parameters passed from the main-thread Source. See\r\n     * {@link VectorTileWorkerSource#loadTile}. The default implementation simply\r\n     * loads the pbf at `params.url`.\r\n     */\r\n    constructor(actor: Actor, layerIndex: StyleLayerIndex, loadVectorData: ?LoadVectorData) {\r\n        this.actor = actor;\r\n        this.layerIndex = layerIndex;\r\n        this.loadVectorData = loadVectorData || loadVectorTile;\r\n        this.loading = {};\r\n        this.loaded = {};\r\n    }\r\n\r\n    /**\r\n     * Implements {@link WorkerSource#loadTile}. Delegates to\r\n     * {@link VectorTileWorkerSource#loadVectorData} (which by default expects\r\n     * a `params.url` property) for fetching and producing a VectorTile object.\r\n     */\r\n    loadTile(params: WorkerTileParameters, callback: WorkerTileCallback) {\r\n        const source = params.source,\r\n            uid = params.uid;\r\n\r\n        if (!this.loading[source])\r\n            this.loading[source] = {};\r\n\r\n        const workerTile = this.loading[source][uid] = new WorkerTile(params);\r\n        workerTile.abort = this.loadVectorData(params, (err, response) => {\r\n            delete this.loading[source][uid];\r\n\r\n            if (err || !response) {\r\n                return callback(err);\r\n            }\r\n\r\n            const rawTileData = response.rawData;\r\n            const cacheControl = {};\r\n            if (response.expires) cacheControl.expires = response.expires;\r\n            if (response.cacheControl) cacheControl.cacheControl = response.cacheControl;\r\n\r\n            workerTile.vectorTile = response.vectorTile;\r\n            workerTile.parse(response.vectorTile, this.layerIndex, this.actor, (err, result) => {\r\n                if (err || !result) return callback(err);\r\n\r\n                // Transferring a copy of rawTileData because the worker needs to retain its copy.\r\n                callback(null, util.extend({rawTileData: rawTileData.slice(0)}, result, cacheControl));\r\n            });\r\n\r\n            this.loaded[source] = this.loaded[source] || {};\r\n            this.loaded[source][uid] = workerTile;\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Implements {@link WorkerSource#reloadTile}.\r\n     */\r\n    reloadTile(params: WorkerTileParameters, callback: WorkerTileCallback) {\r\n        const loaded = this.loaded[params.source],\r\n            uid = params.uid,\r\n            vtSource = this;\r\n        if (loaded && loaded[uid]) {\r\n            const workerTile = loaded[uid];\r\n            workerTile.showCollisionBoxes = params.showCollisionBoxes;\r\n\r\n            if (workerTile.status === 'parsing') {\r\n                workerTile.reloadCallback = done.bind(workerTile);\r\n            } else if (workerTile.status === 'done') {\r\n                workerTile.parse(workerTile.vectorTile, this.layerIndex, this.actor, done.bind(workerTile));\r\n            }\r\n\r\n        }\r\n\r\n        function done(err, data) {\r\n            if (this.reloadCallback) {\r\n                const reloadCallback = this.reloadCallback;\r\n                delete this.reloadCallback;\r\n                this.parse(this.vectorTile, vtSource.layerIndex, vtSource.actor, reloadCallback);\r\n            }\r\n\r\n            callback(err, data);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Implements {@link WorkerSource#abortTile}.\r\n     *\r\n     * @param params\r\n     * @param params.source The id of the source for which we're loading this tile.\r\n     * @param params.uid The UID for this tile.\r\n     */\r\n    abortTile(params: TileParameters, callback: WorkerTileCallback) {\r\n        const loading = this.loading[params.source],\r\n            uid = params.uid;\r\n        if (loading && loading[uid] && loading[uid].abort) {\r\n            loading[uid].abort();\r\n            delete loading[uid];\r\n        }\r\n        callback();\r\n    }\r\n\r\n    /**\r\n     * Implements {@link WorkerSource#removeTile}.\r\n     *\r\n     * @param params\r\n     * @param params.source The id of the source for which we're loading this tile.\r\n     * @param params.uid The UID for this tile.\r\n     */\r\n    removeTile(params: TileParameters, callback: WorkerTileCallback) {\r\n        const loaded = this.loaded[params.source],\r\n            uid = params.uid;\r\n        if (loaded && loaded[uid]) {\r\n            delete loaded[uid];\r\n        }\r\n        callback();\r\n    }\r\n}\r\n\r\nmodule.exports = VectorTileWorkerSource;\r\n","// @flow\r\n\r\nconst FeatureIndex = require('../data/feature_index');\r\nconst {performSymbolLayout} = require('../symbol/symbol_layout');\r\nconst {CollisionBoxArray} = require('../data/array_types');\r\nconst DictionaryCoder = require('../util/dictionary_coder');\r\nconst SymbolBucket = require('../data/bucket/symbol_bucket');\r\nconst util = require('../util/util');\r\nconst assert = require('assert');\r\nconst {makeImageAtlas} = require('../render/image_atlas');\r\nconst {makeGlyphAtlas} = require('../render/glyph_atlas');\r\nconst EvaluationParameters = require('../style/evaluation_parameters');\r\nconst {OverscaledTileID} = require('./tile_id');\r\n\r\nimport type {Bucket} from '../data/bucket';\r\nimport type Actor from '../util/actor';\r\nimport type StyleLayer from '../style/style_layer';\r\nimport type StyleLayerIndex from '../style/style_layer_index';\r\nimport type {StyleImage} from '../style/style_image';\r\nimport type {StyleGlyph} from '../style/style_glyph';\r\nimport type {\r\n    WorkerTileParameters,\r\n    WorkerTileCallback,\r\n} from '../source/worker_source';\r\n\r\nclass WorkerTile {\r\n    tileID: OverscaledTileID;\r\n    uid: string;\r\n    zoom: number;\r\n    pixelRatio: number;\r\n    tileSize: number;\r\n    source: string;\r\n    overscaling: number;\r\n    showCollisionBoxes: boolean;\r\n\r\n    status: 'parsing' | 'done';\r\n    data: VectorTile;\r\n    collisionBoxArray: CollisionBoxArray;\r\n\r\n    abort: ?() => void;\r\n    reloadCallback: WorkerTileCallback;\r\n    vectorTile: VectorTile;\r\n\r\n    constructor(params: WorkerTileParameters) {\r\n        this.tileID = new OverscaledTileID(params.tileID.overscaledZ, params.tileID.wrap, params.tileID.canonical.z, params.tileID.canonical.x, params.tileID.canonical.y);\r\n        this.uid = params.uid;\r\n        this.zoom = params.zoom;\r\n        this.pixelRatio = params.pixelRatio;\r\n        this.tileSize = params.tileSize;\r\n        this.source = params.source;\r\n        this.overscaling = params.overscaling;\r\n        this.showCollisionBoxes = params.showCollisionBoxes;\r\n    }\r\n\r\n    parse(data: VectorTile, layerIndex: StyleLayerIndex, actor: Actor, callback: WorkerTileCallback) {\r\n        this.status = 'parsing';\r\n        this.data = data;\r\n\r\n        this.collisionBoxArray = new CollisionBoxArray();\r\n        const sourceLayerCoder = new DictionaryCoder(Object.keys(data.layers).sort());\r\n\r\n        const featureIndex = new FeatureIndex(this.tileID, this.overscaling);\r\n        featureIndex.bucketLayerIDs = [];\r\n\r\n        const buckets: {[string]: Bucket} = {};\r\n\r\n        const options = {\r\n            featureIndex: featureIndex,\r\n            iconDependencies: {},\r\n            glyphDependencies: {}\r\n        };\r\n\r\n        const layerFamilies = layerIndex.familiesBySource[this.source];\r\n        for (const sourceLayerId in layerFamilies) {\r\n            const sourceLayer = data.layers[sourceLayerId];\r\n            if (!sourceLayer) {\r\n                continue;\r\n            }\r\n\r\n            if (sourceLayer.version === 1) {\r\n                util.warnOnce(`Vector tile source \"${this.source}\" layer \"${sourceLayerId}\" ` +\r\n                    `does not use vector tile spec v2 and therefore may have some rendering errors.`);\r\n            }\r\n\r\n            const sourceLayerIndex = sourceLayerCoder.encode(sourceLayerId);\r\n            const features = [];\r\n            for (let index = 0; index < sourceLayer.length; index++) {\r\n                const feature = sourceLayer.feature(index);\r\n                features.push({ feature, index, sourceLayerIndex });\r\n            }\r\n\r\n            for (const family of layerFamilies[sourceLayerId]) {\r\n                const layer = family[0];\r\n\r\n                assert(layer.source === this.source);\r\n                if (layer.minzoom && this.zoom < Math.floor(layer.minzoom)) continue;\r\n                if (layer.maxzoom && this.zoom >= layer.maxzoom) continue;\r\n                if (layer.visibility === 'none') continue;\r\n\r\n                recalculateLayers(family, this.zoom);\r\n\r\n                const bucket = buckets[layer.id] = layer.createBucket({\r\n                    index: featureIndex.bucketLayerIDs.length,\r\n                    layers: family,\r\n                    zoom: this.zoom,\r\n                    pixelRatio: this.pixelRatio,\r\n                    overscaling: this.overscaling,\r\n                    collisionBoxArray: this.collisionBoxArray\r\n                });\r\n\r\n                bucket.populate(features, options);\r\n                featureIndex.bucketLayerIDs.push(family.map((l) => l.id));\r\n            }\r\n        }\r\n\r\n        let error: ?Error;\r\n        let glyphMap: ?{[string]: {[number]: ?StyleGlyph}};\r\n        let imageMap: ?{[string]: StyleImage};\r\n\r\n        const stacks = util.mapObject(options.glyphDependencies, (glyphs) => Object.keys(glyphs).map(Number));\r\n        if (Object.keys(stacks).length) {\r\n            actor.send('getGlyphs', {uid: this.uid, stacks}, (err, result) => {\r\n                if (!error) {\r\n                    error = err;\r\n                    glyphMap = result;\r\n                    maybePrepare.call(this);\r\n                }\r\n            });\r\n        } else {\r\n            glyphMap = {};\r\n        }\r\n\r\n        const icons = Object.keys(options.iconDependencies);\r\n        if (icons.length) {\r\n            actor.send('getImages', {icons}, (err, result) => {\r\n                if (!error) {\r\n                    error = err;\r\n                    imageMap = result;\r\n                    maybePrepare.call(this);\r\n                }\r\n            });\r\n        } else {\r\n            imageMap = {};\r\n        }\r\n\r\n        maybePrepare.call(this);\r\n\r\n        function maybePrepare() {\r\n            if (error) {\r\n                return callback(error);\r\n            } else if (glyphMap && imageMap) {\r\n                const glyphAtlas = makeGlyphAtlas(glyphMap);\r\n                const imageAtlas = makeImageAtlas(imageMap);\r\n\r\n                for (const key in buckets) {\r\n                    const bucket = buckets[key];\r\n                    if (bucket instanceof SymbolBucket) {\r\n                        recalculateLayers(bucket.layers, this.zoom);\r\n                        performSymbolLayout(bucket, glyphMap, glyphAtlas.positions, imageMap, imageAtlas.positions, this.showCollisionBoxes);\r\n                    }\r\n                }\r\n\r\n                this.status = 'done';\r\n\r\n                callback(null, {\r\n                    buckets: util.values(buckets).filter(b => !b.isEmpty()),\r\n                    featureIndex,\r\n                    collisionBoxArray: this.collisionBoxArray,\r\n                    glyphAtlasImage: glyphAtlas.image,\r\n                    iconAtlasImage: imageAtlas.image\r\n                });\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nfunction recalculateLayers(layers: $ReadOnlyArray<StyleLayer>, zoom: number) {\r\n    // Layers are shared and may have been used by a WorkerTile with a different zoom.\r\n    const parameters = new EvaluationParameters(zoom);\r\n    for (const layer of layers) {\r\n        layer.recalculate(parameters);\r\n    }\r\n}\r\n\r\nmodule.exports = WorkerTile;\r\n","\r\nfunction ValidationError(key, value, message) {\r\n    this.message = (key ? `${key}: ` : '') + message;\r\n\r\n    if (value !== null && value !== undefined && value.__line__) {\r\n        this.line = value.__line__;\r\n    }\r\n}\r\n\r\nmodule.exports = ValidationError;\r\n","// @flow\r\n\r\nconst { toString } = require('./types');\r\nconst ParsingContext = require('./parsing_context');\r\nconst EvaluationContext = require('./evaluation_context');\r\nconst assert = require('assert');\r\n\r\nimport type { Expression, ExpressionRegistry } from './expression';\r\nimport type { Type } from './types';\r\nimport type { Value } from './values';\r\n\r\ntype Varargs = {| type: Type |};\r\ntype Signature = Array<Type> | Varargs;\r\ntype Evaluate = (EvaluationContext, Array<Expression>) => Value;\r\ntype Definition = [Type, Signature, Evaluate] |\r\n    {|type: Type, overloads: Array<[Signature, Evaluate]>|};\r\n\r\nclass CompoundExpression implements Expression {\r\n    name: string;\r\n    type: Type;\r\n    _evaluate: Evaluate;\r\n    args: Array<Expression>;\r\n\r\n    static definitions: { [string]: Definition };\r\n\r\n    constructor(name: string, type: Type, evaluate: Evaluate, args: Array<Expression>) {\r\n        this.name = name;\r\n        this.type = type;\r\n        this._evaluate = evaluate;\r\n        this.args = args;\r\n    }\r\n\r\n    evaluate(ctx: EvaluationContext) {\r\n        return this._evaluate(ctx, this.args);\r\n    }\r\n\r\n    eachChild(fn: (Expression) => void) {\r\n        this.args.forEach(fn);\r\n    }\r\n\r\n    possibleOutputs() {\r\n        return [undefined];\r\n    }\r\n\r\n    static parse(args: Array<mixed>, context: ParsingContext): ?Expression {\r\n        const op: string = (args[0]: any);\r\n        const definition = CompoundExpression.definitions[op];\r\n        if (!definition) {\r\n            return context.error(`Unknown expression \"${op}\". If you wanted a literal array, use [\"literal\", [...]].`, 0);\r\n        }\r\n\r\n        // Now check argument types against each signature\r\n        const type = Array.isArray(definition) ?\r\n            definition[0] : definition.type;\r\n\r\n        const availableOverloads = Array.isArray(definition) ?\r\n            [[definition[1], definition[2]]] :\r\n            definition.overloads;\r\n\r\n        const overloads = availableOverloads.filter(([signature]) => (\r\n            !Array.isArray(signature) || // varags\r\n            signature.length === args.length - 1 // correct param count\r\n        ));\r\n\r\n        // First parse all the args\r\n        const parsedArgs: Array<Expression> = [];\r\n        for (let i = 1; i < args.length; i++) {\r\n            const arg = args[i];\r\n            let expected;\r\n            if (overloads.length === 1) {\r\n                const params = overloads[0][0];\r\n                expected = Array.isArray(params) ?\r\n                    params[i - 1] :\r\n                    params.type;\r\n            }\r\n            const parsed = context.parse(arg, 1 + parsedArgs.length, expected);\r\n            if (!parsed) return null;\r\n            parsedArgs.push(parsed);\r\n        }\r\n\r\n        let signatureContext: ParsingContext = (null: any);\r\n\r\n        for (const [params, evaluate] of overloads) {\r\n            // Use a fresh context for each attempted signature so that, if\r\n            // we eventually succeed, we haven't polluted `context.errors`.\r\n            signatureContext = new ParsingContext(context.registry, context.path, null, context.scope);\r\n\r\n            if (Array.isArray(params)) {\r\n                if (params.length !== parsedArgs.length) {\r\n                    signatureContext.error(`Expected ${params.length} arguments, but found ${parsedArgs.length} instead.`);\r\n                    continue;\r\n                }\r\n            }\r\n\r\n            for (let i = 0; i < parsedArgs.length; i++) {\r\n                const expected = Array.isArray(params) ? params[i] : params.type;\r\n                const arg = parsedArgs[i];\r\n                signatureContext.concat(i + 1).checkSubtype(expected, arg.type);\r\n            }\r\n\r\n            if (signatureContext.errors.length === 0) {\r\n                return new CompoundExpression(op, type, evaluate, parsedArgs);\r\n            }\r\n        }\r\n\r\n        assert(!signatureContext || signatureContext.errors.length > 0);\r\n\r\n        if (overloads.length === 1) {\r\n            context.errors.push.apply(context.errors, signatureContext.errors);\r\n        } else {\r\n            const expected = overloads.length ? overloads : availableOverloads;\r\n            const signatures = expected\r\n                .map(([params]) => stringifySignature(params))\r\n                .join(' | ');\r\n            const actualTypes = parsedArgs\r\n                .map(arg => toString(arg.type))\r\n                .join(', ');\r\n            context.error(`Expected arguments of type ${signatures}, but found (${actualTypes}) instead.`);\r\n        }\r\n\r\n        return null;\r\n    }\r\n\r\n    static register(\r\n        registry: ExpressionRegistry,\r\n        definitions: { [string]: Definition }\r\n    ) {\r\n        assert(!CompoundExpression.definitions);\r\n        CompoundExpression.definitions = definitions;\r\n        for (const name in definitions) {\r\n            registry[name] = CompoundExpression;\r\n        }\r\n    }\r\n}\r\n\r\nfunction varargs(type: Type): Varargs {\r\n    return { type };\r\n}\r\n\r\nfunction stringifySignature(signature: Signature): string {\r\n    if (Array.isArray(signature)) {\r\n        return `(${signature.map(toString).join(', ')})`;\r\n    } else {\r\n        return `(${toString(signature.type)}...)`;\r\n    }\r\n}\r\n\r\nmodule.exports = {\r\n    CompoundExpression,\r\n    varargs\r\n};\r\n\r\n","// @flow\r\n\r\nconst {\r\n    toString,\r\n    array,\r\n    ValueType,\r\n    StringType,\r\n    NumberType,\r\n    BooleanType,\r\n    checkSubtype\r\n} = require('../types');\r\n\r\nconst {typeOf} = require('../values');\r\nconst RuntimeError = require('../runtime_error');\r\n\r\nimport type { Expression } from '../expression';\r\nimport type ParsingContext from '../parsing_context';\r\nimport type EvaluationContext from '../evaluation_context';\r\nimport type { ArrayType } from '../types';\r\n\r\nconst types = {\r\n    string: StringType,\r\n    number: NumberType,\r\n    boolean: BooleanType\r\n};\r\n\r\nclass ArrayAssertion implements Expression {\r\n    type: ArrayType;\r\n    input: Expression;\r\n\r\n    constructor(type: ArrayType, input: Expression) {\r\n        this.type = type;\r\n        this.input = input;\r\n    }\r\n\r\n    static parse(args: Array<mixed>, context: ParsingContext): ?Expression {\r\n        if (args.length < 2 || args.length > 4)\r\n            return context.error(`Expected 1, 2, or 3 arguments, but found ${args.length - 1} instead.`);\r\n\r\n        let itemType;\r\n        let N;\r\n        if (args.length > 2) {\r\n            const type = args[1];\r\n            if (typeof type !== 'string' || !(type in types))\r\n                return context.error('The item type argument of \"array\" must be one of string, number, boolean', 1);\r\n            itemType = types[type];\r\n        } else {\r\n            itemType = ValueType;\r\n        }\r\n\r\n        if (args.length > 3) {\r\n            if (\r\n                typeof args[2] !== 'number' ||\r\n                args[2] < 0 ||\r\n                args[2] !== Math.floor(args[2])\r\n            ) {\r\n                return context.error('The length argument to \"array\" must be a positive integer literal', 2);\r\n            }\r\n            N = args[2];\r\n        }\r\n\r\n        const type = array(itemType, N);\r\n\r\n        const input = context.parse(args[args.length - 1], args.length - 1, ValueType);\r\n        if (!input) return null;\r\n\r\n        return new ArrayAssertion(type, input);\r\n    }\r\n\r\n    evaluate(ctx: EvaluationContext) {\r\n        const value = this.input.evaluate(ctx);\r\n        const error = checkSubtype(this.type, typeOf(value));\r\n        if (error) {\r\n            throw new RuntimeError(`Expected value to be of type ${toString(this.type)}, but found ${toString(typeOf(value))} instead.`);\r\n        }\r\n        return value;\r\n    }\r\n\r\n    eachChild(fn: (Expression) => void) {\r\n        fn(this.input);\r\n    }\r\n\r\n    possibleOutputs() {\r\n        return this.input.possibleOutputs();\r\n    }\r\n}\r\n\r\nmodule.exports = ArrayAssertion;\r\n","// @flow\r\n\r\nconst assert = require('assert');\r\nconst {\r\n    ObjectType,\r\n    ValueType,\r\n    StringType,\r\n    NumberType,\r\n    BooleanType\r\n} = require('../types');\r\n\r\nconst RuntimeError = require('../runtime_error');\r\nconst {checkSubtype, toString} = require('../types');\r\nconst {typeOf} = require('../values');\r\n\r\nimport type { Expression } from '../expression';\r\nimport type ParsingContext from '../parsing_context';\r\nimport type EvaluationContext from '../evaluation_context';\r\nimport type { Type } from '../types';\r\n\r\nconst types = {\r\n    string: StringType,\r\n    number: NumberType,\r\n    boolean: BooleanType,\r\n    object: ObjectType\r\n};\r\n\r\nclass Assertion implements Expression {\r\n    type: Type;\r\n    args: Array<Expression>;\r\n\r\n    constructor(type: Type, args: Array<Expression>) {\r\n        this.type = type;\r\n        this.args = args;\r\n    }\r\n\r\n    static parse(args: Array<mixed>, context: ParsingContext): ?Expression {\r\n        if (args.length < 2)\r\n            return context.error(`Expected at least one argument.`);\r\n\r\n        const name: string = (args[0]: any);\r\n        assert(types[name], name);\r\n\r\n        const type = types[name];\r\n\r\n        const parsed = [];\r\n        for (let i = 1; i < args.length; i++) {\r\n            const input = context.parse(args[i], i, ValueType);\r\n            if (!input) return null;\r\n            parsed.push(input);\r\n        }\r\n\r\n        return new Assertion(type, parsed);\r\n    }\r\n\r\n    evaluate(ctx: EvaluationContext) {\r\n        for (let i = 0; i < this.args.length; i++) {\r\n            const value = this.args[i].evaluate(ctx);\r\n            const error = checkSubtype(this.type, typeOf(value));\r\n            if (!error) {\r\n                return value;\r\n            } else if (i === this.args.length - 1) {\r\n                throw new RuntimeError(`Expected value to be of type ${toString(this.type)}, but found ${toString(typeOf(value))} instead.`);\r\n            }\r\n        }\r\n\r\n        assert(false);\r\n        return null;\r\n    }\r\n\r\n    eachChild(fn: (Expression) => void) {\r\n        this.args.forEach(fn);\r\n    }\r\n\r\n    possibleOutputs() {\r\n        return [].concat(...this.args.map((arg) => arg.possibleOutputs()));\r\n    }\r\n}\r\n\r\nmodule.exports = Assertion;\r\n","// @flow\r\n\r\nconst {\r\n    array,\r\n    ValueType,\r\n    NumberType\r\n} = require('../types');\r\n\r\nconst RuntimeError = require('../runtime_error');\r\n\r\nimport type { Expression } from '../expression';\r\nimport type ParsingContext from '../parsing_context';\r\nimport type EvaluationContext from '../evaluation_context';\r\nimport type { Type, ArrayType } from '../types';\r\nimport type { Value } from '../values';\r\n\r\nclass At implements Expression {\r\n    type: Type;\r\n    index: Expression;\r\n    input: Expression;\r\n\r\n    constructor(type: Type, index: Expression, input: Expression) {\r\n        this.type = type;\r\n        this.index = index;\r\n        this.input = input;\r\n    }\r\n\r\n    static parse(args: Array<mixed>, context: ParsingContext) {\r\n        if (args.length !== 3)\r\n            return context.error(`Expected 2 arguments, but found ${args.length - 1} instead.`);\r\n\r\n        const index = context.parse(args[1], 1, NumberType);\r\n        const input = context.parse(args[2], 2, array(context.expectedType || ValueType));\r\n\r\n        if (!index || !input) return null;\r\n\r\n        const t: ArrayType = (input.type: any);\r\n        return new At(t.itemType, index, input);\r\n    }\r\n\r\n    evaluate(ctx: EvaluationContext) {\r\n        const index = ((this.index.evaluate(ctx): any): number);\r\n        const array = ((this.input.evaluate(ctx): any): Array<Value>);\r\n\r\n        if (index < 0 || index >= array.length) {\r\n            throw new RuntimeError(`Array index out of bounds: ${index} > ${array.length}.`);\r\n        }\r\n\r\n        if (index !== Math.floor(index)) {\r\n            throw new RuntimeError(`Array index must be an integer, but found ${index} instead.`);\r\n        }\r\n\r\n        return array[index];\r\n    }\r\n\r\n    eachChild(fn: (Expression) => void) {\r\n        fn(this.index);\r\n        fn(this.input);\r\n    }\r\n\r\n    possibleOutputs() {\r\n        return [undefined];\r\n    }\r\n}\r\n\r\nmodule.exports = At;\r\n","// @flow\r\n\r\nconst assert = require('assert');\r\nconst { BooleanType } = require('../types');\r\n\r\nimport type { Expression } from '../expression';\r\nimport type ParsingContext from '../parsing_context';\r\nimport type EvaluationContext from '../evaluation_context';\r\nimport type { Type } from '../types';\r\n\r\ntype Branches = Array<[Expression, Expression]>;\r\n\r\nclass Case implements Expression {\r\n    type: Type;\r\n\r\n    branches: Branches;\r\n    otherwise: Expression;\r\n\r\n    constructor(type: Type, branches: Branches, otherwise: Expression) {\r\n        this.type = type;\r\n        this.branches = branches;\r\n        this.otherwise = otherwise;\r\n    }\r\n\r\n    static parse(args: Array<mixed>, context: ParsingContext) {\r\n        if (args.length < 4)\r\n            return context.error(`Expected at least 3 arguments, but found only ${args.length - 1}.`);\r\n        if (args.length % 2 !== 0)\r\n            return context.error(`Expected an odd number of arguments.`);\r\n\r\n        let outputType: ?Type;\r\n        if (context.expectedType && context.expectedType.kind !== 'value') {\r\n            outputType = context.expectedType;\r\n        }\r\n\r\n        const branches = [];\r\n        for (let i = 1; i < args.length - 1; i += 2) {\r\n            const test = context.parse(args[i], i, BooleanType);\r\n            if (!test) return null;\r\n\r\n            const result = context.parse(args[i + 1], i + 1, outputType);\r\n            if (!result) return null;\r\n\r\n            branches.push([test, result]);\r\n\r\n            outputType = outputType || result.type;\r\n        }\r\n\r\n        const otherwise = context.parse(args[args.length - 1], args.length - 1, outputType);\r\n        if (!otherwise) return null;\r\n\r\n        assert(outputType);\r\n        return new Case((outputType: any), branches, otherwise);\r\n    }\r\n\r\n    evaluate(ctx: EvaluationContext) {\r\n        for (const [test, expression] of this.branches) {\r\n            if (test.evaluate(ctx)) {\r\n                return expression.evaluate(ctx);\r\n            }\r\n        }\r\n        return this.otherwise.evaluate(ctx);\r\n    }\r\n\r\n    eachChild(fn: (Expression) => void) {\r\n        for (const [test, expression] of this.branches) {\r\n            fn(test);\r\n            fn(expression);\r\n        }\r\n        fn(this.otherwise);\r\n    }\r\n\r\n    possibleOutputs() {\r\n        return []\r\n            .concat(...this.branches.map(([_, out]) => out.possibleOutputs()))\r\n            .concat(this.otherwise.possibleOutputs());\r\n    }\r\n}\r\n\r\nmodule.exports = Case;\r\n","// @flow\r\n\r\nconst assert = require('assert');\r\nconst {checkSubtype, ValueType} = require('../types');\r\n\r\nimport type { Expression } from '../expression';\r\nimport type ParsingContext from '../parsing_context';\r\nimport type EvaluationContext from '../evaluation_context';\r\nimport type { Type } from '../types';\r\n\r\nclass Coalesce implements Expression {\r\n    type: Type;\r\n    args: Array<Expression>;\r\n\r\n    constructor(type: Type, args: Array<Expression>) {\r\n        this.type = type;\r\n        this.args = args;\r\n    }\r\n\r\n    static parse(args: Array<mixed>, context: ParsingContext) {\r\n        if (args.length < 2) {\r\n            return context.error(\"Expectected at least one argument.\");\r\n        }\r\n        let outputType: Type = (null: any);\r\n        const expectedType = context.expectedType;\r\n        if (expectedType && expectedType.kind !== 'value') {\r\n            outputType = expectedType;\r\n        }\r\n        const parsedArgs = [];\r\n\r\n        for (const arg of args.slice(1)) {\r\n            const parsed = context.parse(arg, 1 + parsedArgs.length, outputType, undefined, {omitTypeAnnotations: true});\r\n            if (!parsed) return null;\r\n            outputType = outputType || parsed.type;\r\n            parsedArgs.push(parsed);\r\n        }\r\n        assert(outputType);\r\n\r\n        // Above, we parse arguments without inferred type annotation so that\r\n        // they don't produce a runtime error for `null` input, which would\r\n        // preempt the desired null-coalescing behavior.\r\n        // Thus, if any of our arguments would have needed an annotation, we\r\n        // need to wrap the enclosing coalesce expression with it instead.\r\n        const needsAnnotation = expectedType &&\r\n            parsedArgs.some(arg => checkSubtype(expectedType, arg.type));\r\n\r\n        return needsAnnotation ?\r\n            new Coalesce(ValueType, parsedArgs) :\r\n            new Coalesce((outputType: any), parsedArgs);\r\n    }\r\n\r\n    evaluate(ctx: EvaluationContext) {\r\n        let result = null;\r\n        for (const arg of this.args) {\r\n            result = arg.evaluate(ctx);\r\n            if (result !== null) break;\r\n        }\r\n        return result;\r\n    }\r\n\r\n    eachChild(fn: (Expression) => void) {\r\n        this.args.forEach(fn);\r\n    }\r\n\r\n    possibleOutputs() {\r\n        return [].concat(...this.args.map((arg) => arg.possibleOutputs()));\r\n    }\r\n}\r\n\r\nmodule.exports = Coalesce;\r\n","// @flow\r\n\r\nconst assert = require('assert');\r\nconst {\r\n    ColorType,\r\n    ValueType,\r\n    NumberType,\r\n} = require('../types');\r\n\r\nconst { Color, validateRGBA } = require('../values');\r\nconst RuntimeError = require('../runtime_error');\r\n\r\nimport type { Expression } from '../expression';\r\nimport type ParsingContext from '../parsing_context';\r\nimport type EvaluationContext from '../evaluation_context';\r\nimport type { Type } from '../types';\r\n\r\nconst types = {\r\n    'to-number': NumberType,\r\n    'to-color': ColorType\r\n};\r\n\r\n/**\r\n * Special form for error-coalescing coercion expressions \"to-number\",\r\n * \"to-color\".  Since these coercions can fail at runtime, they accept multiple\r\n * arguments, only evaluating one at a time until one succeeds.\r\n *\r\n * @private\r\n */\r\nclass Coercion implements Expression {\r\n    type: Type;\r\n    args: Array<Expression>;\r\n\r\n    constructor(type: Type, args: Array<Expression>) {\r\n        this.type = type;\r\n        this.args = args;\r\n    }\r\n\r\n    static parse(args: Array<mixed>, context: ParsingContext): ?Expression {\r\n        if (args.length < 2)\r\n            return context.error(`Expected at least one argument.`);\r\n\r\n        const name: string = (args[0]: any);\r\n        assert(types[name], name);\r\n\r\n        const type = types[name];\r\n\r\n        const parsed = [];\r\n        for (let i = 1; i < args.length; i++) {\r\n            const input = context.parse(args[i], i, ValueType);\r\n            if (!input) return null;\r\n            parsed.push(input);\r\n        }\r\n\r\n        return new Coercion(type, parsed);\r\n    }\r\n\r\n    evaluate(ctx: EvaluationContext) {\r\n        if (this.type.kind === 'color') {\r\n            let input;\r\n            let error;\r\n            for (const arg of this.args) {\r\n                input = arg.evaluate(ctx);\r\n                error = null;\r\n                if (typeof input === 'string') {\r\n                    const c = ctx.parseColor(input);\r\n                    if (c) return c;\r\n                } else if (Array.isArray(input)) {\r\n                    if (input.length < 3 || input.length > 4) {\r\n                        error = `Invalid rbga value ${JSON.stringify(input)}: expected an array containing either three or four numeric values.`;\r\n                    } else {\r\n                        error = validateRGBA(input[0], input[1], input[2], input[3]);\r\n                    }\r\n                    if (!error) {\r\n                        return new Color((input[0]: any) / 255, (input[1]: any) / 255, (input[2]: any) / 255, (input[3]: any));\r\n                    }\r\n                }\r\n            }\r\n            throw new RuntimeError(error || `Could not parse color from value '${typeof input === 'string' ? input : JSON.stringify(input)}'`);\r\n        } else {\r\n            let value = null;\r\n            for (const arg of this.args) {\r\n                value = arg.evaluate(ctx);\r\n                if (value === null) continue;\r\n                const num = Number(value);\r\n                if (isNaN(num)) continue;\r\n                return num;\r\n            }\r\n            throw new RuntimeError(`Could not convert ${JSON.stringify(value)} to number.`);\r\n        }\r\n    }\r\n\r\n    eachChild(fn: (Expression) => void) {\r\n        this.args.forEach(fn);\r\n    }\r\n\r\n    possibleOutputs() {\r\n        return [].concat(...this.args.map((arg) => arg.possibleOutputs()));\r\n    }\r\n}\r\n\r\nmodule.exports = Coercion;\r\n","// @flow\r\n\r\nconst {\r\n    ValueType,\r\n    BooleanType,\r\n} = require('../types');\r\nconst {toString} = require('../types');\r\n\r\nimport type { Expression } from '../expression';\r\nimport type EvaluationContext from '../evaluation_context';\r\nimport type ParsingContext from '../parsing_context';\r\nimport type { Type } from '../types';\r\n\r\nfunction isComparableType(type: Type) {\r\n    return type.kind === 'string' ||\r\n        type.kind === 'number' ||\r\n        type.kind === 'boolean' ||\r\n        type.kind === 'null';\r\n}\r\n\r\n/**\r\n * Special form for ==, !=, implementing the following signatures:\r\n * - (T1: Comparable, T2: Comparable) => boolean { T1 == T2 }\r\n * - (Comparable, value) => boolean\r\n * - (value, Comparable) => boolean\r\n *\r\n * Where Comparable = string | number | boolean | null.\r\n *\r\n * Evaluation semantics for the value cases are equivalent to Javascript's\r\n * strict equality (===/!==) -- i.e., when the value argument's type doesn't\r\n * match that of the Comparable argument, == evaluates to false, != to true.\r\n *\r\n * @private\r\n */\r\nfunction makeComparison(compare) {\r\n    return class Comparison implements Expression {\r\n        type: Type;\r\n        lhs: Expression;\r\n        rhs: Expression;\r\n\r\n        constructor(lhs: Expression, rhs: Expression) {\r\n            this.type = BooleanType;\r\n            this.lhs = lhs;\r\n            this.rhs = rhs;\r\n        }\r\n\r\n        static parse(args: Array<mixed>, context: ParsingContext): ?Expression {\r\n            if (args.length !== 3)\r\n                return context.error(`Expected two arguments.`);\r\n\r\n            const lhs = context.parse(args[1], 1, ValueType);\r\n            if (!lhs) return null;\r\n            const rhs = context.parse(args[2], 2, ValueType);\r\n            if (!rhs) return null;\r\n\r\n            if (!isComparableType(lhs.type) && !isComparableType(rhs.type)) {\r\n                return context.error(`Expected at least one argument to be a string, number, boolean, or null, but found (${toString(lhs.type)}, ${toString(rhs.type)}) instead.`);\r\n            }\r\n\r\n            if (lhs.type.kind !== rhs.type.kind && lhs.type.kind !== 'value' && rhs.type.kind !== 'value') {\r\n                return context.error(`Cannot compare ${toString(lhs.type)} and ${toString(rhs.type)}.`);\r\n            }\r\n\r\n            return new Comparison(lhs, rhs);\r\n        }\r\n\r\n        evaluate(ctx: EvaluationContext) {\r\n            return compare(this.lhs.evaluate(ctx), this.rhs.evaluate(ctx));\r\n        }\r\n\r\n        eachChild(fn: (Expression) => void) {\r\n            fn(this.lhs);\r\n            fn(this.rhs);\r\n        }\r\n\r\n        possibleOutputs() {\r\n            return [true, false];\r\n        }\r\n    };\r\n}\r\n\r\nmodule.exports = {\r\n    Equals: makeComparison((lhs, rhs) => lhs === rhs),\r\n    NotEquals: makeComparison((lhs, rhs) => lhs !== rhs)\r\n};\r\n","// @flow\r\n\r\nconst {\r\n    NumberType,\r\n    StringType,\r\n    BooleanType,\r\n    ColorType,\r\n    ObjectType,\r\n    ValueType,\r\n    ErrorType,\r\n    array,\r\n    toString\r\n} = require('../types');\r\n\r\nconst { typeOf, Color, validateRGBA } = require('../values');\r\nconst { CompoundExpression, varargs } = require('../compound_expression');\r\nconst RuntimeError = require('../runtime_error');\r\nconst Let = require('./let');\r\nconst Var = require('./var');\r\nconst Literal = require('./literal');\r\nconst Assertion = require('./assertion');\r\nconst ArrayAssertion = require('./array');\r\nconst Coercion = require('./coercion');\r\nconst At = require('./at');\r\nconst Match = require('./match');\r\nconst Case = require('./case');\r\nconst Step = require('./step');\r\nconst Interpolate = require('./interpolate');\r\nconst Coalesce = require('./coalesce');\r\nconst {Equals, NotEquals} = require('./equals');\r\n\r\nimport type { ExpressionRegistry } from '../expression';\r\n\r\nconst expressions: ExpressionRegistry = {\r\n    // special forms\r\n    '==': Equals,\r\n    '!=': NotEquals,\r\n    'array': ArrayAssertion,\r\n    'at': At,\r\n    'boolean': Assertion,\r\n    'case': Case,\r\n    'coalesce': Coalesce,\r\n    'interpolate': Interpolate,\r\n    'let': Let,\r\n    'literal': Literal,\r\n    'match': Match,\r\n    'number': Assertion,\r\n    'object': Assertion,\r\n    'step': Step,\r\n    'string': Assertion,\r\n    'to-color': Coercion,\r\n    'to-number': Coercion,\r\n    'var': Var\r\n};\r\n\r\nfunction rgba(ctx, [r, g, b, a]) {\r\n    r = r.evaluate(ctx);\r\n    g = g.evaluate(ctx);\r\n    b = b.evaluate(ctx);\r\n    const alpha = a ? a.evaluate(ctx) : 1;\r\n    const error = validateRGBA(r, g, b, alpha);\r\n    if (error) throw new RuntimeError(error);\r\n    return new Color(r / 255 * alpha, g / 255 * alpha, b / 255 * alpha, alpha);\r\n}\r\n\r\nfunction has(key, obj) {\r\n    return key in obj;\r\n}\r\n\r\nfunction get(key, obj) {\r\n    const v = obj[key];\r\n    return typeof v === 'undefined' ? null : v;\r\n}\r\n\r\nfunction length(ctx, [v]) {\r\n    return v.evaluate(ctx).length;\r\n}\r\n\r\nfunction lt(ctx, [a, b]) { return a.evaluate(ctx) < b.evaluate(ctx); }\r\nfunction gt(ctx, [a, b]) { return a.evaluate(ctx) > b.evaluate(ctx); }\r\nfunction lteq(ctx, [a, b]) { return a.evaluate(ctx) <= b.evaluate(ctx); }\r\nfunction gteq(ctx, [a, b]) { return a.evaluate(ctx) >= b.evaluate(ctx); }\r\n\r\nfunction binarySearch(v, a, i, j) {\r\n    while (i <= j) {\r\n        const m = (i + j) >> 1;\r\n        if (a[m] === v)\r\n            return true;\r\n        if (a[m] > v)\r\n            j = m - 1;\r\n        else\r\n            i = m + 1;\r\n    }\r\n    return false;\r\n}\r\n\r\n\r\nCompoundExpression.register(expressions, {\r\n    'error': [\r\n        ErrorType,\r\n        [StringType],\r\n        (ctx, [v]) => { throw new RuntimeError(v.evaluate(ctx)); }\r\n    ],\r\n    'typeof': [\r\n        StringType,\r\n        [ValueType],\r\n        (ctx, [v]) => toString(typeOf(v.evaluate(ctx)))\r\n    ],\r\n    'to-string': [\r\n        StringType,\r\n        [ValueType],\r\n        (ctx, [v]) => {\r\n            v = v.evaluate(ctx);\r\n            const type = typeof v;\r\n            if (v === null || type === 'string' || type === 'number' || type === 'boolean') {\r\n                return String(v);\r\n            } else if (v instanceof Color) {\r\n                return v.toString();\r\n            } else {\r\n                return JSON.stringify(v);\r\n            }\r\n        }\r\n    ],\r\n    'to-boolean': [\r\n        BooleanType,\r\n        [ValueType],\r\n        (ctx, [v]) => Boolean(v.evaluate(ctx))\r\n    ],\r\n    'to-rgba': [\r\n        array(NumberType, 4),\r\n        [ColorType],\r\n        (ctx, [v]) => {\r\n            const {r, g, b, a} = v.evaluate(ctx);\r\n            return [255 * r / a, 255 * g / a, 255 * b / a, a];\r\n        }\r\n    ],\r\n    'rgb': [\r\n        ColorType,\r\n        [NumberType, NumberType, NumberType],\r\n        rgba\r\n    ],\r\n    'rgba': [\r\n        ColorType,\r\n        [NumberType, NumberType, NumberType, NumberType],\r\n        rgba\r\n    ],\r\n    'length': {\r\n        type: NumberType,\r\n        overloads: [\r\n            [\r\n                [StringType],\r\n                length\r\n            ], [\r\n                [array(ValueType)],\r\n                length\r\n            ]\r\n        ]\r\n    },\r\n    'has': {\r\n        type: BooleanType,\r\n        overloads: [\r\n            [\r\n                [StringType],\r\n                (ctx, [key]) => has(key.evaluate(ctx), ctx.properties())\r\n            ], [\r\n                [StringType, ObjectType],\r\n                (ctx, [key, obj]) => has(key.evaluate(ctx), obj.evaluate(ctx))\r\n            ]\r\n        ]\r\n    },\r\n    'get': {\r\n        type: ValueType,\r\n        overloads: [\r\n            [\r\n                [StringType],\r\n                (ctx, [key]) => get(key.evaluate(ctx), ctx.properties())\r\n            ], [\r\n                [StringType, ObjectType],\r\n                (ctx, [key, obj]) => get(key.evaluate(ctx), obj.evaluate(ctx))\r\n            ]\r\n        ]\r\n    },\r\n    'properties': [\r\n        ObjectType,\r\n        [],\r\n        (ctx) => ctx.properties()\r\n    ],\r\n    'geometry-type': [\r\n        StringType,\r\n        [],\r\n        (ctx) => ctx.geometryType()\r\n    ],\r\n    'id': [\r\n        ValueType,\r\n        [],\r\n        (ctx) => ctx.id()\r\n    ],\r\n    'zoom': [\r\n        NumberType,\r\n        [],\r\n        (ctx) => ctx.globals.zoom\r\n    ],\r\n    'heatmap-density': [\r\n        NumberType,\r\n        [],\r\n        (ctx) => ctx.globals.heatmapDensity || 0\r\n    ],\r\n    '+': [\r\n        NumberType,\r\n        varargs(NumberType),\r\n        (ctx, args) => {\r\n            let result = 0;\r\n            for (const arg of args) {\r\n                result += arg.evaluate(ctx);\r\n            }\r\n            return result;\r\n        }\r\n    ],\r\n    '*': [\r\n        NumberType,\r\n        varargs(NumberType),\r\n        (ctx, args) => {\r\n            let result = 1;\r\n            for (const arg of args) {\r\n                result *= arg.evaluate(ctx);\r\n            }\r\n            return result;\r\n        }\r\n    ],\r\n    '-': {\r\n        type: NumberType,\r\n        overloads: [\r\n            [\r\n                [NumberType, NumberType],\r\n                (ctx, [a, b]) => a.evaluate(ctx) - b.evaluate(ctx)\r\n            ], [\r\n                [NumberType],\r\n                (ctx, [a]) => -a.evaluate(ctx)\r\n            ]\r\n        ]\r\n    },\r\n    '/': [\r\n        NumberType,\r\n        [NumberType, NumberType],\r\n        (ctx, [a, b]) => a.evaluate(ctx) / b.evaluate(ctx)\r\n    ],\r\n    '%': [\r\n        NumberType,\r\n        [NumberType, NumberType],\r\n        (ctx, [a, b]) => a.evaluate(ctx) % b.evaluate(ctx)\r\n    ],\r\n    'ln2': [\r\n        NumberType,\r\n        [],\r\n        () => Math.LN2\r\n    ],\r\n    'pi': [\r\n        NumberType,\r\n        [],\r\n        () => Math.PI\r\n    ],\r\n    'e': [\r\n        NumberType,\r\n        [],\r\n        () => Math.E\r\n    ],\r\n    '^': [\r\n        NumberType,\r\n        [NumberType, NumberType],\r\n        (ctx, [b, e]) => Math.pow(b.evaluate(ctx), e.evaluate(ctx))\r\n    ],\r\n    'sqrt': [\r\n        NumberType,\r\n        [NumberType],\r\n        (ctx, [x]) => Math.sqrt(x.evaluate(ctx))\r\n    ],\r\n    'log10': [\r\n        NumberType,\r\n        [NumberType],\r\n        (ctx, [n]) => Math.log10(n.evaluate(ctx))\r\n    ],\r\n    'ln': [\r\n        NumberType,\r\n        [NumberType],\r\n        (ctx, [n]) => Math.log(n.evaluate(ctx))\r\n    ],\r\n    'log2': [\r\n        NumberType,\r\n        [NumberType],\r\n        (ctx, [n]) => Math.log2(n.evaluate(ctx))\r\n    ],\r\n    'sin': [\r\n        NumberType,\r\n        [NumberType],\r\n        (ctx, [n]) => Math.sin(n.evaluate(ctx))\r\n    ],\r\n    'cos': [\r\n        NumberType,\r\n        [NumberType],\r\n        (ctx, [n]) => Math.cos(n.evaluate(ctx))\r\n    ],\r\n    'tan': [\r\n        NumberType,\r\n        [NumberType],\r\n        (ctx, [n]) => Math.tan(n.evaluate(ctx))\r\n    ],\r\n    'asin': [\r\n        NumberType,\r\n        [NumberType],\r\n        (ctx, [n]) => Math.asin(n.evaluate(ctx))\r\n    ],\r\n    'acos': [\r\n        NumberType,\r\n        [NumberType],\r\n        (ctx, [n]) => Math.acos(n.evaluate(ctx))\r\n    ],\r\n    'atan': [\r\n        NumberType,\r\n        [NumberType],\r\n        (ctx, [n]) => Math.atan(n.evaluate(ctx))\r\n    ],\r\n    'min': [\r\n        NumberType,\r\n        varargs(NumberType),\r\n        (ctx, args) => Math.min(...args.map(arg => arg.evaluate(ctx)))\r\n    ],\r\n    'max': [\r\n        NumberType,\r\n        varargs(NumberType),\r\n        (ctx, args) => Math.max(...args.map(arg => arg.evaluate(ctx)))\r\n    ],\r\n    'filter-==': [\r\n        BooleanType,\r\n        [StringType, ValueType],\r\n        (ctx, [k, v]) => ctx.properties()[(k: any).value] === (v: any).value\r\n    ],\r\n    'filter-id-==': [\r\n        BooleanType,\r\n        [ValueType],\r\n        (ctx, [v]) => ctx.id() === (v: any).value\r\n    ],\r\n    'filter-type-==': [\r\n        BooleanType,\r\n        [StringType],\r\n        (ctx, [v]) => ctx.geometryType() === (v: any).value\r\n    ],\r\n    'filter-<': [\r\n        BooleanType,\r\n        [StringType, ValueType],\r\n        (ctx, [k, v]) => {\r\n            const a = ctx.properties()[(k: any).value];\r\n            const b = (v: any).value;\r\n            return typeof a === typeof b && a < b;\r\n        }\r\n    ],\r\n    'filter-id-<': [\r\n        BooleanType,\r\n        [ValueType],\r\n        (ctx, [v]) => {\r\n            const a = ctx.id();\r\n            const b = (v: any).value;\r\n            return typeof a === typeof b && a < b;\r\n        }\r\n    ],\r\n    'filter->': [\r\n        BooleanType,\r\n        [StringType, ValueType],\r\n        (ctx, [k, v]) => {\r\n            const a = ctx.properties()[(k: any).value];\r\n            const b = (v: any).value;\r\n            return typeof a === typeof b && a > b;\r\n        }\r\n    ],\r\n    'filter-id->': [\r\n        BooleanType,\r\n        [ValueType],\r\n        (ctx, [v]) => {\r\n            const a = ctx.id();\r\n            const b = (v: any).value;\r\n            return typeof a === typeof b && a > b;\r\n        }\r\n    ],\r\n    'filter-<=': [\r\n        BooleanType,\r\n        [StringType, ValueType],\r\n        (ctx, [k, v]) => {\r\n            const a = ctx.properties()[(k: any).value];\r\n            const b = (v: any).value;\r\n            return typeof a === typeof b && a <= b;\r\n        }\r\n    ],\r\n    'filter-id-<=': [\r\n        BooleanType,\r\n        [ValueType],\r\n        (ctx, [v]) => {\r\n            const a = ctx.id();\r\n            const b = (v: any).value;\r\n            return typeof a === typeof b && a <= b;\r\n        }\r\n    ],\r\n    'filter->=': [\r\n        BooleanType,\r\n        [StringType, ValueType],\r\n        (ctx, [k, v]) => {\r\n            const a = ctx.properties()[(k: any).value];\r\n            const b = (v: any).value;\r\n            return typeof a === typeof b && a >= b;\r\n        }\r\n    ],\r\n    'filter-id->=': [\r\n        BooleanType,\r\n        [ValueType],\r\n        (ctx, [v]) => {\r\n            const a = ctx.id();\r\n            const b = (v: any).value;\r\n            return typeof a === typeof b && a >= b;\r\n        }\r\n    ],\r\n    'filter-has': [\r\n        BooleanType,\r\n        [ValueType],\r\n        (ctx, [k]) => (k: any).value in ctx.properties()\r\n    ],\r\n    'filter-has-id': [\r\n        BooleanType,\r\n        [],\r\n        (ctx) => ctx.id() !== null\r\n    ],\r\n    'filter-type-in': [\r\n        BooleanType,\r\n        [array(StringType)],\r\n        (ctx, [v]) => (v: any).value.indexOf(ctx.geometryType()) >= 0\r\n    ],\r\n    'filter-id-in': [\r\n        BooleanType,\r\n        [array(ValueType)],\r\n        (ctx, [v]) => (v: any).value.indexOf(ctx.id()) >= 0\r\n    ],\r\n    'filter-in-small': [\r\n        BooleanType,\r\n        [StringType, array(ValueType)],\r\n        // assumes v is an array literal\r\n        (ctx, [k, v]) => (v: any).value.indexOf(ctx.properties()[(k: any).value]) >= 0\r\n    ],\r\n    'filter-in-large': [\r\n        BooleanType,\r\n        [StringType, array(ValueType)],\r\n        // assumes v is a array literal with values sorted in ascending order and of a single type\r\n        (ctx, [k, v]) => binarySearch(ctx.properties()[(k: any).value], (v: any).value, 0, (v: any).value.length - 1)\r\n    ],\r\n    '>': {\r\n        type: BooleanType,\r\n        overloads: [\r\n            [[NumberType, NumberType], gt],\r\n            [[StringType, StringType], gt]\r\n        ]\r\n    },\r\n    '<': {\r\n        type: BooleanType,\r\n        overloads: [\r\n            [[NumberType, NumberType], lt],\r\n            [[StringType, StringType], lt]\r\n        ]\r\n    },\r\n    '>=': {\r\n        type: BooleanType,\r\n        overloads: [\r\n            [[NumberType, NumberType], gteq],\r\n            [[StringType, StringType], gteq]\r\n        ]\r\n    },\r\n    '<=': {\r\n        type: BooleanType,\r\n        overloads: [\r\n            [[NumberType, NumberType], lteq],\r\n            [[StringType, StringType], lteq]\r\n        ]\r\n    },\r\n    'all': {\r\n        type: BooleanType,\r\n        overloads: [\r\n            [\r\n                [BooleanType, BooleanType],\r\n                (ctx, [a, b]) => a.evaluate(ctx) && b.evaluate(ctx)\r\n            ],\r\n            [\r\n                varargs(BooleanType),\r\n                (ctx, args) => {\r\n                    for (const arg of args) {\r\n                        if (!arg.evaluate(ctx))\r\n                            return false;\r\n                    }\r\n                    return true;\r\n                }\r\n            ]\r\n        ]\r\n    },\r\n    'any': {\r\n        type: BooleanType,\r\n        overloads: [\r\n            [\r\n                [BooleanType, BooleanType],\r\n                (ctx, [a, b]) => a.evaluate(ctx) || b.evaluate(ctx)\r\n            ],\r\n            [\r\n                varargs(BooleanType),\r\n                (ctx, args) => {\r\n                    for (const arg of args) {\r\n                        if (arg.evaluate(ctx))\r\n                            return true;\r\n                    }\r\n                    return false;\r\n                }\r\n            ]\r\n        ]\r\n    },\r\n    '!': [\r\n        BooleanType,\r\n        [BooleanType],\r\n        (ctx, [b]) => !b.evaluate(ctx)\r\n    ],\r\n    'upcase': [\r\n        StringType,\r\n        [StringType],\r\n        (ctx, [s]) => s.evaluate(ctx).toUpperCase()\r\n    ],\r\n    'downcase': [\r\n        StringType,\r\n        [StringType],\r\n        (ctx, [s]) => s.evaluate(ctx).toLowerCase()\r\n    ],\r\n    'concat': [\r\n        StringType,\r\n        varargs(StringType),\r\n        (ctx, args) => args.map(arg => arg.evaluate(ctx)).join('')\r\n    ]\r\n});\r\n\r\nmodule.exports = expressions;\r\n","// @flow\r\n\r\nconst UnitBezier = require('@mapbox/unitbezier');\r\nconst interpolate = require('../../util/interpolate');\r\nconst { toString, NumberType } = require('../types');\r\nconst { findStopLessThanOrEqualTo } = require(\"../stops\");\r\n\r\nimport type { Stops } from '../stops';\r\nimport type { Expression } from '../expression';\r\nimport type ParsingContext from '../parsing_context';\r\nimport type EvaluationContext from '../evaluation_context';\r\nimport type { Type } from '../types';\r\n\r\nexport type InterpolationType =\r\n    { name: 'linear' } |\r\n    { name: 'exponential', base: number } |\r\n    { name: 'cubic-bezier', controlPoints: [number, number, number, number] };\r\n\r\nclass Interpolate implements Expression {\r\n    type: Type;\r\n\r\n    interpolation: InterpolationType;\r\n    input: Expression;\r\n    labels: Array<number>;\r\n    outputs: Array<Expression>;\r\n\r\n    constructor(type: Type, interpolation: InterpolationType, input: Expression, stops: Stops) {\r\n        this.type = type;\r\n        this.interpolation = interpolation;\r\n        this.input = input;\r\n\r\n        this.labels = [];\r\n        this.outputs = [];\r\n        for (const [label, expression] of stops) {\r\n            this.labels.push(label);\r\n            this.outputs.push(expression);\r\n        }\r\n    }\r\n\r\n    static interpolationFactor(interpolation: InterpolationType, input: number, lower: number, upper: number) {\r\n        let t = 0;\r\n        if (interpolation.name === 'exponential') {\r\n            t = exponentialInterpolation(input, interpolation.base, lower, upper);\r\n        } else if (interpolation.name === 'linear') {\r\n            t = exponentialInterpolation(input, 1, lower, upper);\r\n        } else if (interpolation.name === 'cubic-bezier') {\r\n            const c = interpolation.controlPoints;\r\n            const ub = new UnitBezier(c[0], c[1], c[2], c[3]);\r\n            t = ub.solve(exponentialInterpolation(input, 1, lower, upper));\r\n        }\r\n        return t;\r\n    }\r\n\r\n    static parse(args: Array<mixed>, context: ParsingContext) {\r\n        let [ , interpolation, input, ...rest] = args;\r\n\r\n        if (!Array.isArray(interpolation) || interpolation.length === 0) {\r\n            return context.error(`Expected an interpolation type expression.`, 1);\r\n        }\r\n\r\n        if (interpolation[0] === 'linear') {\r\n            interpolation = { name: 'linear' };\r\n        } else if (interpolation[0] === 'exponential') {\r\n            const base = interpolation[1];\r\n            if (typeof base !== 'number')\r\n                return context.error(`Exponential interpolation requires a numeric base.`, 1, 1);\r\n            interpolation = {\r\n                name: 'exponential',\r\n                base\r\n            };\r\n        } else if (interpolation[0] === 'cubic-bezier') {\r\n            const controlPoints = interpolation.slice(1);\r\n            if (\r\n                controlPoints.length !== 4 ||\r\n                controlPoints.some(t => typeof t !== 'number' || t < 0 || t > 1)\r\n            ) {\r\n                return context.error('Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.', 1);\r\n            }\r\n\r\n            interpolation = {\r\n                name: 'cubic-bezier',\r\n                controlPoints: (controlPoints: any)\r\n            };\r\n        } else {\r\n            return context.error(`Unknown interpolation type ${String(interpolation[0])}`, 1, 0);\r\n        }\r\n\r\n        if (args.length - 1 < 4) {\r\n            return context.error(`Expected at least 4 arguments, but found only ${args.length - 1}.`);\r\n        }\r\n\r\n        if ((args.length - 1) % 2 !== 0) {\r\n            return context.error(`Expected an even number of arguments.`);\r\n        }\r\n\r\n        input = context.parse(input, 2, NumberType);\r\n        if (!input) return null;\r\n\r\n        const stops: Stops = [];\r\n\r\n        let outputType: Type = (null: any);\r\n        if (context.expectedType && context.expectedType.kind !== 'value') {\r\n            outputType = context.expectedType;\r\n        }\r\n\r\n        for (let i = 0; i < rest.length; i += 2) {\r\n            const label = rest[i];\r\n            const value = rest[i + 1];\r\n\r\n            const labelKey = i + 3;\r\n            const valueKey = i + 4;\r\n\r\n            if (typeof label !== 'number') {\r\n                return context.error('Input/output pairs for \"interpolate\" expressions must be defined using literal numeric values (not computed expressions) for the input values.', labelKey);\r\n            }\r\n\r\n            if (stops.length && stops[stops.length - 1][0] >= label) {\r\n                return context.error('Input/output pairs for \"interpolate\" expressions must be arranged with input values in strictly ascending order.', labelKey);\r\n            }\r\n\r\n            const parsed = context.parse(value, valueKey, outputType);\r\n            if (!parsed) return null;\r\n            outputType = outputType || parsed.type;\r\n            stops.push([label, parsed]);\r\n        }\r\n\r\n        if (outputType.kind !== 'number' &&\r\n            outputType.kind !== 'color' &&\r\n            !(\r\n                outputType.kind === 'array' &&\r\n                outputType.itemType.kind === 'number' &&\r\n                typeof outputType.N === 'number'\r\n            )\r\n        ) {\r\n            return context.error(`Type ${toString(outputType)} is not interpolatable.`);\r\n        }\r\n\r\n        return new Interpolate(outputType, interpolation, input, stops);\r\n    }\r\n\r\n    evaluate(ctx: EvaluationContext) {\r\n        const labels = this.labels;\r\n        const outputs = this.outputs;\r\n\r\n        if (labels.length === 1) {\r\n            return outputs[0].evaluate(ctx);\r\n        }\r\n\r\n        const value = ((this.input.evaluate(ctx): any): number);\r\n        if (value <= labels[0]) {\r\n            return outputs[0].evaluate(ctx);\r\n        }\r\n\r\n        const stopCount = labels.length;\r\n        if (value >= labels[stopCount - 1]) {\r\n            return outputs[stopCount - 1].evaluate(ctx);\r\n        }\r\n\r\n        const index = findStopLessThanOrEqualTo(labels, value);\r\n        const lower = labels[index];\r\n        const upper = labels[index + 1];\r\n        const t = Interpolate.interpolationFactor(this.interpolation, value, lower, upper);\r\n\r\n        const outputLower = outputs[index].evaluate(ctx);\r\n        const outputUpper = outputs[index + 1].evaluate(ctx);\r\n\r\n        return (interpolate[this.type.kind.toLowerCase()]: any)(outputLower, outputUpper, t);\r\n    }\r\n\r\n    eachChild(fn: (Expression) => void) {\r\n        fn(this.input);\r\n        for (const expression of this.outputs) {\r\n            fn(expression);\r\n        }\r\n    }\r\n\r\n    possibleOutputs() {\r\n        return [].concat(...this.outputs.map((output) => output.possibleOutputs()));\r\n    }\r\n}\r\n\r\n/**\r\n * Returns a ratio that can be used to interpolate between exponential function\r\n * stops.\r\n * How it works: Two consecutive stop values define a (scaled and shifted) exponential function `f(x) = a * base^x + b`, where `base` is the user-specified base,\r\n * and `a` and `b` are constants affording sufficient degrees of freedom to fit\r\n * the function to the given stops.\r\n *\r\n * Here's a bit of algebra that lets us compute `f(x)` directly from the stop\r\n * values without explicitly solving for `a` and `b`:\r\n *\r\n * First stop value: `f(x0) = y0 = a * base^x0 + b`\r\n * Second stop value: `f(x1) = y1 = a * base^x1 + b`\r\n * => `y1 - y0 = a(base^x1 - base^x0)`\r\n * => `a = (y1 - y0)/(base^x1 - base^x0)`\r\n *\r\n * Desired value: `f(x) = y = a * base^x + b`\r\n * => `f(x) = y0 + a * (base^x - base^x0)`\r\n *\r\n * From the above, we can replace the `a` in `a * (base^x - base^x0)` and do a\r\n * little algebra:\r\n * ```\r\n * a * (base^x - base^x0) = (y1 - y0)/(base^x1 - base^x0) * (base^x - base^x0)\r\n *                     = (y1 - y0) * (base^x - base^x0) / (base^x1 - base^x0)\r\n * ```\r\n *\r\n * If we let `(base^x - base^x0) / (base^x1 base^x0)`, then we have\r\n * `f(x) = y0 + (y1 - y0) * ratio`.  In other words, `ratio` may be treated as\r\n * an interpolation factor between the two stops' output values.\r\n *\r\n * (Note: a slightly different form for `ratio`,\r\n * `(base^(x-x0) - 1) / (base^(x1-x0) - 1) `, is equivalent, but requires fewer\r\n * expensive `Math.pow()` operations.)\r\n *\r\n * @private\r\n*/\r\nfunction exponentialInterpolation(input, base, lowerValue, upperValue) {\r\n    const difference = upperValue - lowerValue;\r\n    const progress = input - lowerValue;\r\n\r\n    if (difference === 0) {\r\n        return 0;\r\n    } else if (base === 1) {\r\n        return progress / difference;\r\n    } else {\r\n        return (Math.pow(base, progress) - 1) / (Math.pow(base, difference) - 1);\r\n    }\r\n}\r\n\r\nmodule.exports = Interpolate;\r\n","// @flow\r\n\r\nimport type { Type } from '../types';\r\nimport type { Expression } from '../expression';\r\nimport type ParsingContext from '../parsing_context';\r\nimport type EvaluationContext  from '../evaluation_context';\r\n\r\nclass Let implements Expression {\r\n    type: Type;\r\n    bindings: Array<[string, Expression]>;\r\n    result: Expression;\r\n\r\n    constructor(bindings: Array<[string, Expression]>, result: Expression) {\r\n        this.type = result.type;\r\n        this.bindings = [].concat(bindings);\r\n        this.result = result;\r\n    }\r\n\r\n    evaluate(ctx: EvaluationContext) {\r\n        ctx.pushScope(this.bindings);\r\n        const result = this.result.evaluate(ctx);\r\n        ctx.popScope();\r\n        return result;\r\n    }\r\n\r\n    eachChild(fn: (Expression) => void) {\r\n        for (const binding of this.bindings) {\r\n            fn(binding[1]);\r\n        }\r\n        fn(this.result);\r\n    }\r\n\r\n    static parse(args: Array<mixed>, context: ParsingContext) {\r\n        if (args.length < 4)\r\n            return context.error(`Expected at least 3 arguments, but found ${args.length - 1} instead.`);\r\n\r\n        const bindings: Array<[string, Expression]> = [];\r\n        for (let i = 1; i < args.length - 1; i += 2) {\r\n            const name = args[i];\r\n\r\n            if (typeof name !== 'string') {\r\n                return context.error(`Expected string, but found ${typeof name} instead.`, i);\r\n            }\r\n\r\n            if (/[^a-zA-Z0-9_]/.test(name)) {\r\n                return context.error(`Variable names must contain only alphanumeric characters or '_'.`, i);\r\n            }\r\n\r\n            const value = context.parse(args[i + 1], i + 1);\r\n            if (!value) return null;\r\n\r\n            bindings.push([name, value]);\r\n        }\r\n\r\n        const result = context.parse(args[args.length - 1], args.length - 1, undefined, bindings);\r\n        if (!result) return null;\r\n\r\n        return new Let(bindings, result);\r\n    }\r\n\r\n    possibleOutputs() {\r\n        return this.result.possibleOutputs();\r\n    }\r\n}\r\n\r\nmodule.exports = Let;\r\n","// @flow\r\n\r\nconst { isValue, typeOf } = require('../values');\r\n\r\nimport type { Type } from '../types';\r\nimport type { Value }  from '../values';\r\nimport type { Expression } from '../expression';\r\nimport type ParsingContext from '../parsing_context';\r\n\r\nclass Literal implements Expression {\r\n    type: Type;\r\n    value: Value;\r\n\r\n    constructor(type: Type, value: Value) {\r\n        this.type = type;\r\n        this.value = value;\r\n    }\r\n\r\n    static parse(args: Array<mixed>, context: ParsingContext) {\r\n        if (args.length !== 2)\r\n            return context.error(`'literal' expression requires exactly one argument, but found ${args.length - 1} instead.`);\r\n\r\n        if (!isValue(args[1]))\r\n            return context.error(`invalid value`);\r\n\r\n        const value = (args[1]: any);\r\n        let type = typeOf(value);\r\n\r\n        // special case: infer the item type if possible for zero-length arrays\r\n        const expected = context.expectedType;\r\n        if (\r\n            type.kind === 'array' &&\r\n            type.N === 0 &&\r\n            expected &&\r\n            expected.kind === 'array' &&\r\n            (typeof expected.N !== 'number' || expected.N === 0)\r\n        ) {\r\n            type = expected;\r\n        }\r\n\r\n        return new Literal(type, value);\r\n    }\r\n\r\n    evaluate() {\r\n        return this.value;\r\n    }\r\n\r\n    eachChild() {}\r\n\r\n    possibleOutputs() {\r\n        return [this.value];\r\n    }\r\n}\r\n\r\nmodule.exports = Literal;\r\n","// @flow\r\n\r\nconst assert = require('assert');\r\nconst { typeOf } = require('../values');\r\n\r\nimport type { Expression } from '../expression';\r\nimport type ParsingContext from '../parsing_context';\r\nimport type EvaluationContext from '../evaluation_context';\r\nimport type { Type } from '../types';\r\n\r\n// Map input label values to output expression index\r\ntype Cases = {[number | string]: number};\r\n\r\nclass Match implements Expression {\r\n    type: Type;\r\n    inputType: Type;\r\n\r\n    input: Expression;\r\n    cases: Cases;\r\n    outputs: Array<Expression>;\r\n    otherwise: Expression;\r\n\r\n    constructor(inputType: Type, outputType: Type, input: Expression, cases: Cases, outputs: Array<Expression>, otherwise: Expression) {\r\n        this.inputType = inputType;\r\n        this.type = outputType;\r\n        this.input = input;\r\n        this.cases = cases;\r\n        this.outputs = outputs;\r\n        this.otherwise = otherwise;\r\n    }\r\n\r\n    static parse(args: Array<mixed>, context: ParsingContext) {\r\n        if (args.length < 5)\r\n            return context.error(`Expected at least 4 arguments, but found only ${args.length - 1}.`);\r\n        if (args.length % 2 !== 1)\r\n            return context.error(`Expected an even number of arguments.`);\r\n\r\n        let inputType;\r\n        let outputType;\r\n        if (context.expectedType && context.expectedType.kind !== 'value') {\r\n            outputType = context.expectedType;\r\n        }\r\n        const cases = {};\r\n        const outputs = [];\r\n        for (let i = 2; i < args.length - 1; i += 2) {\r\n            let labels = args[i];\r\n            const value = args[i + 1];\r\n\r\n            if (!Array.isArray(labels)) {\r\n                labels = [labels];\r\n            }\r\n\r\n            const labelContext = context.concat(i);\r\n            if (labels.length === 0) {\r\n                return labelContext.error('Expected at least one branch label.');\r\n            }\r\n\r\n            for (const label of labels) {\r\n                if (typeof label !== 'number' && typeof label !== 'string') {\r\n                    return labelContext.error(`Branch labels must be numbers or strings.`);\r\n                } else if (typeof label === 'number' && Math.abs(label) > Number.MAX_SAFE_INTEGER) {\r\n                    return labelContext.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);\r\n\r\n                } else if (typeof label === 'number' && Math.floor(label) !== label) {\r\n                    return labelContext.error(`Numeric branch labels must be integer values.`);\r\n\r\n                } else if (!inputType) {\r\n                    inputType = typeOf(label);\r\n                } else if (labelContext.checkSubtype(inputType, typeOf(label))) {\r\n                    return null;\r\n                }\r\n\r\n                if (typeof cases[String(label)] !== 'undefined') {\r\n                    return labelContext.error('Branch labels must be unique.');\r\n                }\r\n\r\n                cases[String(label)] = outputs.length;\r\n            }\r\n\r\n            const result = context.parse(value, i, outputType);\r\n            if (!result) return null;\r\n            outputType = outputType || result.type;\r\n            outputs.push(result);\r\n        }\r\n\r\n        const input = context.parse(args[1], 1, inputType);\r\n        if (!input) return null;\r\n\r\n        const otherwise = context.parse(args[args.length - 1], args.length - 1, outputType);\r\n        if (!otherwise) return null;\r\n\r\n        assert(inputType && outputType);\r\n        return new Match((inputType: any), (outputType: any), input, cases, outputs, otherwise);\r\n    }\r\n\r\n    evaluate(ctx: EvaluationContext) {\r\n        const input = (this.input.evaluate(ctx): any);\r\n        return (this.outputs[this.cases[input]] || this.otherwise).evaluate(ctx);\r\n    }\r\n\r\n    eachChild(fn: (Expression) => void) {\r\n        fn(this.input);\r\n        this.outputs.forEach(fn);\r\n        fn(this.otherwise);\r\n    }\r\n\r\n    possibleOutputs() {\r\n        return []\r\n            .concat(...this.outputs.map((out) => out.possibleOutputs()))\r\n            .concat(this.otherwise.possibleOutputs());\r\n    }\r\n}\r\n\r\nmodule.exports = Match;\r\n","// @flow\r\n\r\nconst { NumberType } = require('../types');\r\nconst { findStopLessThanOrEqualTo } = require(\"../stops\");\r\n\r\nimport type { Stops } from '../stops';\r\nimport type { Expression } from '../expression';\r\nimport type ParsingContext from '../parsing_context';\r\nimport type EvaluationContext from '../evaluation_context';\r\nimport type { Type } from '../types';\r\n\r\nclass Step implements Expression {\r\n    type: Type;\r\n\r\n    input: Expression;\r\n    labels: Array<number>;\r\n    outputs: Array<Expression>;\r\n\r\n    constructor(type: Type, input: Expression, stops: Stops) {\r\n        this.type = type;\r\n        this.input = input;\r\n\r\n        this.labels = [];\r\n        this.outputs = [];\r\n        for (const [label, expression] of stops) {\r\n            this.labels.push(label);\r\n            this.outputs.push(expression);\r\n        }\r\n    }\r\n\r\n    static parse(args: Array<mixed>, context: ParsingContext) {\r\n        let [ , input, ...rest] = args;\r\n\r\n        if (args.length - 1 < 4) {\r\n            return context.error(`Expected at least 4 arguments, but found only ${args.length - 1}.`);\r\n        }\r\n\r\n        if ((args.length - 1) % 2 !== 0) {\r\n            return context.error(`Expected an even number of arguments.`);\r\n        }\r\n\r\n        input = context.parse(input, 1, NumberType);\r\n        if (!input) return null;\r\n\r\n        const stops: Stops = [];\r\n\r\n        let outputType: Type = (null: any);\r\n        if (context.expectedType && context.expectedType.kind !== 'value') {\r\n            outputType = context.expectedType;\r\n        }\r\n\r\n        rest.unshift(-Infinity);\r\n\r\n        for (let i = 0; i < rest.length; i += 2) {\r\n            const label = rest[i];\r\n            const value = rest[i + 1];\r\n\r\n            const labelKey = i + 1;\r\n            const valueKey = i + 2;\r\n\r\n            if (typeof label !== 'number') {\r\n                return context.error('Input/output pairs for \"step\" expressions must be defined using literal numeric values (not computed expressions) for the input values.', labelKey);\r\n            }\r\n\r\n            if (stops.length && stops[stops.length - 1][0] >= label) {\r\n                return context.error('Input/output pairs for \"step\" expressions must be arranged with input values in strictly ascending order.', labelKey);\r\n            }\r\n\r\n            const parsed = context.parse(value, valueKey, outputType);\r\n            if (!parsed) return null;\r\n            outputType = outputType || parsed.type;\r\n            stops.push([label, parsed]);\r\n        }\r\n\r\n        return new Step(outputType, input, stops);\r\n    }\r\n\r\n    evaluate(ctx: EvaluationContext) {\r\n        const labels = this.labels;\r\n        const outputs = this.outputs;\r\n\r\n        if (labels.length === 1) {\r\n            return outputs[0].evaluate(ctx);\r\n        }\r\n\r\n        const value = ((this.input.evaluate(ctx): any): number);\r\n        if (value <= labels[0]) {\r\n            return outputs[0].evaluate(ctx);\r\n        }\r\n\r\n        const stopCount = labels.length;\r\n        if (value >= labels[stopCount - 1]) {\r\n            return outputs[stopCount - 1].evaluate(ctx);\r\n        }\r\n\r\n        const index = findStopLessThanOrEqualTo(labels, value);\r\n        return outputs[index].evaluate(ctx);\r\n    }\r\n\r\n    eachChild(fn: (Expression) => void) {\r\n        fn(this.input);\r\n        for (const expression of this.outputs) {\r\n            fn(expression);\r\n        }\r\n    }\r\n\r\n    possibleOutputs() {\r\n        return [].concat(...this.outputs.map((output) => output.possibleOutputs()));\r\n    }\r\n}\r\n\r\nmodule.exports = Step;\r\n","// @flow\r\n\r\nimport type { Type } from '../types';\r\nimport type { Expression } from '../expression';\r\nimport type ParsingContext from '../parsing_context';\r\nimport type EvaluationContext  from '../evaluation_context';\r\n\r\nclass Var implements Expression {\r\n    type: Type;\r\n    name: string;\r\n\r\n    constructor(name: string, type: Type) {\r\n        this.type = type;\r\n        this.name = name;\r\n    }\r\n\r\n    static parse(args: Array<mixed>, context: ParsingContext) {\r\n        if (args.length !== 2 || typeof args[1] !== 'string')\r\n            return context.error(`'var' expression requires exactly one string literal argument.`);\r\n\r\n        const name = args[1];\r\n        if (!context.scope.has(name)) {\r\n            return context.error(`Unknown variable \"${name}\". Make sure \"${name}\" has been bound in an enclosing \"let\" expression before using it.`, 1);\r\n        }\r\n\r\n        return new Var(name, context.scope.get(name).type);\r\n    }\r\n\r\n    evaluate(ctx: EvaluationContext) {\r\n        return ctx.scope.get(this.name).evaluate(ctx);\r\n    }\r\n\r\n    eachChild() {}\r\n\r\n    possibleOutputs() {\r\n        return [undefined];\r\n    }\r\n}\r\n\r\nmodule.exports = Var;\r\n","// @flow\r\n\r\nconst assert = require('assert');\r\nconst Scope = require('./scope');\r\nconst {Color} = require('./values');\r\n\r\nimport type { Feature, GlobalProperties } from './index';\r\nimport type { Expression } from './expression';\r\n\r\nconst geometryTypes = ['Unknown', 'Point', 'LineString', 'Polygon'];\r\n\r\nclass EvaluationContext {\r\n    globals: GlobalProperties;\r\n    feature: ?Feature;\r\n\r\n    scope: Scope;\r\n    _parseColorCache: {[string]: ?Color};\r\n\r\n    constructor() {\r\n        this.scope = new Scope();\r\n        this._parseColorCache = {};\r\n    }\r\n\r\n    id() {\r\n        return this.feature && 'id' in this.feature ? this.feature.id : null;\r\n    }\r\n\r\n    geometryType() {\r\n        return this.feature ? typeof this.feature.type === 'number' ? geometryTypes[this.feature.type] : this.feature.type : null;\r\n    }\r\n\r\n    properties() {\r\n        return this.feature && this.feature.properties || {};\r\n    }\r\n\r\n    pushScope(bindings: Array<[string, Expression]>) {\r\n        this.scope = this.scope.concat(bindings);\r\n    }\r\n\r\n    popScope() {\r\n        assert(this.scope.parent);\r\n        this.scope = (this.scope.parent: any);\r\n    }\r\n\r\n    parseColor(input: string): ?Color {\r\n        let cached = this._parseColorCache[input];\r\n        if (!cached) {\r\n            cached = this._parseColorCache[input] = Color.parse(input);\r\n        }\r\n        return cached;\r\n    }\r\n}\r\n\r\nmodule.exports = EvaluationContext;\r\n","// @flow\r\n\r\nconst assert = require('assert');\r\nconst extend = require('../util/extend');\r\nconst ParsingError = require('./parsing_error');\r\nconst ParsingContext = require('./parsing_context');\r\nconst EvaluationContext = require('./evaluation_context');\r\nconst {CompoundExpression} = require('./compound_expression');\r\nconst Step = require('./definitions/step');\r\nconst Interpolate = require('./definitions/interpolate');\r\nconst Coalesce = require('./definitions/coalesce');\r\nconst Let = require('./definitions/let');\r\nconst definitions = require('./definitions');\r\nconst isConstant = require('./is_constant');\r\nconst RuntimeError = require('./runtime_error');\r\nconst {success, error} = require('../util/result');\r\n\r\nimport type {Type} from './types';\r\nimport type {Value} from './values';\r\nimport type {Expression} from './expression';\r\nimport type {StylePropertySpecification} from '../style-spec';\r\nimport type {Result} from '../util/result';\r\nimport type {InterpolationType} from './definitions/interpolate';\r\n\r\nexport type Feature = {\r\n    +type: 1 | 2 | 3 | 'Unknown' | 'Point' | 'MultiPoint' | 'LineString' | 'MultiLineString' | 'Polygon' | 'MultiPolygon',\r\n    +id?: any,\r\n    +properties: {[string]: any}\r\n};\r\n\r\nexport type GlobalProperties = {\r\n    zoom: number,\r\n    heatmapDensity?: number\r\n};\r\n\r\nclass StyleExpression {\r\n    expression: Expression;\r\n\r\n    _evaluator: EvaluationContext;\r\n\r\n    constructor(expression: Expression) {\r\n        this.expression = expression;\r\n    }\r\n\r\n    evaluate(globals: GlobalProperties, feature?: Feature): any {\r\n        if (!this._evaluator) {\r\n            this._evaluator = new EvaluationContext();\r\n        }\r\n\r\n        this._evaluator.globals = globals;\r\n        this._evaluator.feature = feature;\r\n        return this.expression.evaluate(this._evaluator);\r\n    }\r\n}\r\n\r\nclass StyleExpressionWithErrorHandling extends StyleExpression {\r\n    _defaultValue: Value;\r\n    _warningHistory: {[key: string]: boolean};\r\n    _enumValues: {[string]: any};\r\n\r\n    _evaluator: EvaluationContext;\r\n\r\n    constructor(expression: Expression, propertySpec: StylePropertySpecification) {\r\n        super(expression);\r\n        this._warningHistory = {};\r\n        this._defaultValue = getDefaultValue(propertySpec);\r\n        if (propertySpec.type === 'enum') {\r\n            this._enumValues = propertySpec.values;\r\n        }\r\n    }\r\n\r\n    evaluate(globals: GlobalProperties, feature?: Feature) {\r\n        if (!this._evaluator) {\r\n            this._evaluator = new EvaluationContext();\r\n        }\r\n\r\n        this._evaluator.globals = globals;\r\n        this._evaluator.feature = feature;\r\n\r\n        try {\r\n            const val = this.expression.evaluate(this._evaluator);\r\n            if (val === null || val === undefined) {\r\n                return this._defaultValue;\r\n            }\r\n            if (this._enumValues && !(val in this._enumValues)) {\r\n                throw new RuntimeError(`Expected value to be one of ${Object.keys(this._enumValues).map(v => JSON.stringify(v)).join(', ')}, but found ${JSON.stringify(val)} instead.`);\r\n            }\r\n            return val;\r\n        } catch (e) {\r\n            if (!this._warningHistory[e.message]) {\r\n                this._warningHistory[e.message] = true;\r\n                if (typeof console !== 'undefined') {\r\n                    console.warn(e.message);\r\n                }\r\n            }\r\n            return this._defaultValue;\r\n        }\r\n    }\r\n}\r\n\r\nfunction isExpression(expression: mixed) {\r\n    return Array.isArray(expression) && expression.length > 0 &&\r\n        typeof expression[0] === 'string' && expression[0] in definitions;\r\n}\r\n\r\n/**\r\n * Parse and typecheck the given style spec JSON expression.  If\r\n * options.defaultValue is provided, then the resulting StyleExpression's\r\n * `evaluate()` method will handle errors by logging a warning (once per\r\n * message) and returning the default value.  Otherwise, it will throw\r\n * evaluation errors.\r\n *\r\n * @private\r\n */\r\nfunction createExpression(expression: mixed,\r\n                          propertySpec: StylePropertySpecification,\r\n                          options: {handleErrors?: boolean} = {}): Result<StyleExpression, Array<ParsingError>> {\r\n    const parser = new ParsingContext(definitions, [], getExpectedType(propertySpec));\r\n    const parsed = parser.parse(expression);\r\n    if (!parsed) {\r\n        assert(parser.errors.length > 0);\r\n        return error(parser.errors);\r\n    }\r\n\r\n    if (options.handleErrors === false) {\r\n        return success(new StyleExpression(parsed));\r\n    } else {\r\n        return success(new StyleExpressionWithErrorHandling(parsed, propertySpec));\r\n    }\r\n}\r\n\r\nclass ZoomConstantExpression<Kind> {\r\n    kind: Kind;\r\n    _styleExpression: StyleExpression;\r\n    constructor(kind: Kind, expression: StyleExpression) {\r\n        this.kind = kind;\r\n        this._styleExpression = expression;\r\n    }\r\n    evaluate(globals: GlobalProperties, feature?: Feature): any {\r\n        return this._styleExpression.evaluate(globals, feature);\r\n    }\r\n}\r\n\r\nclass ZoomDependentExpression<Kind> {\r\n    kind: Kind;\r\n    zoomStops: Array<number>;\r\n\r\n    _styleExpression: StyleExpression;\r\n    _interpolationType: ?InterpolationType;\r\n\r\n    constructor(kind: Kind, expression: StyleExpression, zoomCurve: Step | Interpolate) {\r\n        this.kind = kind;\r\n        this.zoomStops = zoomCurve.labels;\r\n        this._styleExpression = expression;\r\n        if (zoomCurve instanceof Interpolate) {\r\n            this._interpolationType = zoomCurve.interpolation;\r\n        }\r\n    }\r\n\r\n    evaluate(globals: GlobalProperties, feature?: Feature): any {\r\n        return this._styleExpression.evaluate(globals, feature);\r\n    }\r\n\r\n    interpolationFactor(input: number, lower: number, upper: number): number {\r\n        if (this._interpolationType) {\r\n            return Interpolate.interpolationFactor(this._interpolationType, input, lower, upper);\r\n        } else {\r\n            return 0;\r\n        }\r\n    }\r\n}\r\n\r\nexport type ConstantExpression = {\r\n    kind: 'constant',\r\n    +evaluate: (globals: GlobalProperties, feature?: Feature) => any,\r\n}\r\n\r\nexport type SourceExpression = {\r\n    kind: 'source',\r\n    +evaluate: (globals: GlobalProperties, feature?: Feature) => any,\r\n};\r\n\r\nexport type CameraExpression = {\r\n    kind: 'camera',\r\n    +evaluate: (globals: GlobalProperties, feature?: Feature) => any,\r\n    +interpolationFactor: (input: number, lower: number, upper: number) => number,\r\n    zoomStops: Array<number>\r\n};\r\n\r\nexport type CompositeExpression = {\r\n    kind: 'composite',\r\n    +evaluate: (globals: GlobalProperties, feature?: Feature) => any,\r\n    +interpolationFactor: (input: number, lower: number, upper: number) => number,\r\n    zoomStops: Array<number>\r\n};\r\n\r\nexport type StylePropertyExpression =\r\n    | ConstantExpression\r\n    | SourceExpression\r\n    | CameraExpression\r\n    | CompositeExpression;\r\n\r\nfunction createPropertyExpression(expression: mixed,\r\n                                  propertySpec: StylePropertySpecification,\r\n                                  options: {handleErrors?: boolean} = {}): Result<StylePropertyExpression, Array<ParsingError>> {\r\n    expression = createExpression(expression, propertySpec, options);\r\n    if (expression.result === 'error') {\r\n        return expression;\r\n    }\r\n\r\n    const parsed = expression.value.expression;\r\n\r\n    const isFeatureConstant = isConstant.isFeatureConstant(parsed);\r\n    if (!isFeatureConstant && !propertySpec['property-function']) {\r\n        return error([new ParsingError('', 'property expressions not supported')]);\r\n    }\r\n\r\n    const isZoomConstant = isConstant.isGlobalPropertyConstant(parsed, ['zoom']);\r\n    if (!isZoomConstant && propertySpec['zoom-function'] === false) {\r\n        return error([new ParsingError('', 'zoom expressions not supported')]);\r\n    }\r\n\r\n    const zoomCurve = findZoomCurve(parsed);\r\n    if (!zoomCurve && !isZoomConstant) {\r\n        return error([new ParsingError('', '\"zoom\" expression may only be used as input to a top-level \"step\" or \"interpolate\" expression.')]);\r\n    } else if (zoomCurve instanceof ParsingError) {\r\n        return error([zoomCurve]);\r\n    } else if (zoomCurve instanceof Interpolate && propertySpec['function'] === 'piecewise-constant') {\r\n        return error([new ParsingError('', '\"interpolate\" expressions cannot be used with this property')]);\r\n    }\r\n\r\n    if (!zoomCurve) {\r\n        return success(isFeatureConstant ?\r\n            (new ZoomConstantExpression('constant', expression.value): ConstantExpression) :\r\n            (new ZoomConstantExpression('source', expression.value): SourceExpression));\r\n    }\r\n\r\n    return success(isFeatureConstant ?\r\n        (new ZoomDependentExpression('camera', expression.value, zoomCurve): CameraExpression) :\r\n        (new ZoomDependentExpression('composite', expression.value, zoomCurve): CompositeExpression));\r\n}\r\n\r\nconst {isFunction, createFunction} = require('../function');\r\nconst {Color} = require('./values');\r\n\r\n// serialization wrapper for old-style stop functions normalized to the\r\n// expression interface\r\nclass StylePropertyFunction<T> {\r\n    _parameters: PropertyValueSpecification<T>;\r\n    _specification: StylePropertySpecification;\r\n\r\n    kind: 'constant' | 'source' | 'camera' | 'composite';\r\n    evaluate: (globals: GlobalProperties, feature?: Feature) => any;\r\n    interpolationFactor: ?(input: number, lower: number, upper: number) => number;\r\n    zoomStops: ?Array<number>;\r\n\r\n    constructor(parameters: PropertyValueSpecification<T>, specification: StylePropertySpecification) {\r\n        this._parameters = parameters;\r\n        this._specification = specification;\r\n        extend(this, createFunction(this._parameters, this._specification));\r\n    }\r\n\r\n    static deserialize(serialized: {_parameters: PropertyValueSpecification<T>, _specification: StylePropertySpecification}) {\r\n        return ((new StylePropertyFunction(serialized._parameters, serialized._specification)): StylePropertyFunction<T>);\r\n    }\r\n\r\n    static serialize(input: StylePropertyFunction<T>) {\r\n        return {\r\n            _parameters: input._parameters,\r\n            _specification: input._specification\r\n        };\r\n    }\r\n}\r\n\r\nfunction normalizePropertyExpression<T>(value: PropertyValueSpecification<T>, specification: StylePropertySpecification): StylePropertyExpression {\r\n    if (isFunction(value)) {\r\n        return (new StylePropertyFunction(value, specification): any);\r\n\r\n    } else if (isExpression(value)) {\r\n        const expression = createPropertyExpression(value, specification);\r\n        if (expression.result === 'error') {\r\n            // this should have been caught in validation\r\n            throw new Error(expression.value.map(err => `${err.key}: ${err.message}`).join(', '));\r\n        }\r\n        return expression.value;\r\n\r\n    } else {\r\n        let constant: any = value;\r\n        if (typeof value === 'string' && specification.type === 'color') {\r\n            constant = Color.parse(value);\r\n        }\r\n        return {\r\n            kind: 'constant',\r\n            evaluate: () => constant\r\n        };\r\n    }\r\n}\r\n\r\nmodule.exports = {\r\n    StyleExpression,\r\n    StyleExpressionWithErrorHandling,\r\n    isExpression,\r\n    createExpression,\r\n    createPropertyExpression,\r\n    normalizePropertyExpression,\r\n    ZoomConstantExpression,\r\n    ZoomDependentExpression,\r\n    StylePropertyFunction\r\n};\r\n\r\n// Zoom-dependent expressions may only use [\"zoom\"] as the input to a top-level \"step\" or \"interpolate\"\r\n// expression (collectively referred to as a \"curve\"). The curve may be wrapped in one or more \"let\" or\r\n// \"coalesce\" expressions.\r\nfunction findZoomCurve(expression: Expression): Step | Interpolate | ParsingError | null {\r\n    let result = null;\r\n    if (expression instanceof Let) {\r\n        result = findZoomCurve(expression.result);\r\n\r\n    } else if (expression instanceof Coalesce) {\r\n        for (const arg of expression.args) {\r\n            result = findZoomCurve(arg);\r\n            if (result) {\r\n                break;\r\n            }\r\n        }\r\n\r\n    } else if ((expression instanceof Step || expression instanceof Interpolate) &&\r\n        expression.input instanceof CompoundExpression &&\r\n        expression.input.name === 'zoom') {\r\n\r\n        result = expression;\r\n    }\r\n\r\n    if (result instanceof ParsingError) {\r\n        return result;\r\n    }\r\n\r\n    expression.eachChild((child) => {\r\n        const childResult = findZoomCurve(child);\r\n        if (childResult instanceof ParsingError) {\r\n            result = childResult;\r\n        } else if (!result && childResult) {\r\n            result = new ParsingError('', '\"zoom\" expression may only be used as input to a top-level \"step\" or \"interpolate\" expression.');\r\n        } else if (result && childResult && result !== childResult) {\r\n            result = new ParsingError('', 'Only one zoom-based \"step\" or \"interpolate\" subexpression may be used in an expression.');\r\n        }\r\n    });\r\n\r\n    return result;\r\n}\r\n\r\nconst {\r\n    ColorType,\r\n    StringType,\r\n    NumberType,\r\n    BooleanType,\r\n    ValueType,\r\n    array\r\n} = require('./types');\r\n\r\nfunction getExpectedType(spec: StylePropertySpecification): Type | null {\r\n    const types = {\r\n        color: ColorType,\r\n        string: StringType,\r\n        number: NumberType,\r\n        enum: StringType,\r\n        boolean: BooleanType\r\n    };\r\n\r\n    if (spec.type === 'array') {\r\n        return array(types[spec.value] || ValueType, spec.length);\r\n    }\r\n\r\n    return types[spec.type] || null;\r\n}\r\n\r\nfunction getDefaultValue(spec: StylePropertySpecification): Value {\r\n    if (spec.type === 'color' && isFunction(spec.default)) {\r\n        // Special case for heatmap-color: it uses the 'default:' to define a\r\n        // default color ramp, but createExpression expects a simple value to fall\r\n        // back to in case of runtime errors\r\n        return new Color(0, 0, 0, 0);\r\n    } else if (spec.type === 'color') {\r\n        return Color.parse(spec.default) || null;\r\n    } else if (spec.default === undefined) {\r\n        return null;\r\n    } else {\r\n        return spec.default;\r\n    }\r\n}\r\n","// @flow\r\n\r\nconst { CompoundExpression } = require('./compound_expression');\r\n\r\nimport type { Expression } from './expression.js';\r\n\r\nfunction isFeatureConstant(e: Expression) {\r\n    if (e instanceof CompoundExpression) {\r\n        if (e.name === 'get' && e.args.length === 1) {\r\n            return false;\r\n        } else if (e.name === 'has' && e.args.length === 1) {\r\n            return false;\r\n        } else if (\r\n            e.name === 'properties' ||\r\n            e.name === 'geometry-type' ||\r\n            e.name === 'id'\r\n        ) {\r\n            return false;\r\n        } else if (e.name.startsWith('filter-')) {\r\n            return false;\r\n        }\r\n    }\r\n\r\n    let result = true;\r\n    e.eachChild(arg => {\r\n        if (result && !isFeatureConstant(arg)) { result = false; }\r\n    });\r\n    return result;\r\n}\r\n\r\nfunction isGlobalPropertyConstant(e: Expression, properties: Array<string>) {\r\n    if (e instanceof CompoundExpression && properties.indexOf(e.name) >= 0) { return false; }\r\n    let result = true;\r\n    e.eachChild((arg) => {\r\n        if (result && !isGlobalPropertyConstant(arg, properties)) { result = false; }\r\n    });\r\n    return result;\r\n}\r\n\r\nmodule.exports = {\r\n    isFeatureConstant,\r\n    isGlobalPropertyConstant,\r\n};\r\n","// @flow\r\n\r\nconst Scope = require('./scope');\r\nconst {checkSubtype} = require('./types');\r\nconst ParsingError = require('./parsing_error');\r\nconst Literal = require('./definitions/literal');\r\nconst Assertion = require('./definitions/assertion');\r\nconst ArrayAssertion = require('./definitions/array');\r\nconst Coercion = require('./definitions/coercion');\r\n\r\nimport type {Expression, ExpressionRegistry} from './expression';\r\nimport type {Type} from './types';\r\n\r\n/**\r\n * State associated parsing at a given point in an expression tree.\r\n * @private\r\n */\r\nclass ParsingContext {\r\n    registry: ExpressionRegistry;\r\n    path: Array<number>;\r\n    key: string;\r\n    scope: Scope;\r\n    errors: Array<ParsingError>;\r\n\r\n    // The expected type of this expression. Provided only to allow Expression\r\n    // implementations to infer argument types: Expression#parse() need not\r\n    // check that the output type of the parsed expression matches\r\n    // `expectedType`.\r\n    expectedType: ?Type;\r\n\r\n    constructor(\r\n        registry: ExpressionRegistry,\r\n        path: Array<number> = [],\r\n        expectedType: ?Type,\r\n        scope: Scope = new Scope(),\r\n        errors: Array<ParsingError> = []\r\n    ) {\r\n        this.registry = registry;\r\n        this.path = path;\r\n        this.key = path.map(part => `[${part}]`).join('');\r\n        this.scope = scope;\r\n        this.errors = errors;\r\n        this.expectedType = expectedType;\r\n    }\r\n\r\n    /**\r\n     * @param expr the JSON expression to parse\r\n     * @param index the optional argument index if this expression is an argument of a parent expression that's being parsed\r\n     * @param options\r\n     * @param options.omitTypeAnnotations set true to omit inferred type annotations.  Caller beware: with this option set, the parsed expression's type will NOT satisfy `expectedType` if it would normally be wrapped in an inferred annotation.\r\n     * @private\r\n     */\r\n    parse(\r\n        expr: mixed,\r\n        index?: number,\r\n        expectedType?: ?Type,\r\n        bindings?: Array<[string, Expression]>,\r\n        options: {omitTypeAnnotations?: boolean} = {}\r\n    ): ?Expression {\r\n        let context = this;\r\n        if (index) {\r\n            context = context.concat(index, expectedType, bindings);\r\n        }\r\n\r\n        if (expr === null || typeof expr === 'string' || typeof expr === 'boolean' || typeof expr === 'number') {\r\n            expr = ['literal', expr];\r\n        }\r\n\r\n        if (Array.isArray(expr)) {\r\n            if (expr.length === 0) {\r\n                return context.error(`Expected an array with at least one element. If you wanted a literal array, use [\"literal\", []].`);\r\n            }\r\n\r\n            const op = expr[0];\r\n            if (typeof op !== 'string') {\r\n                context.error(`Expression name must be a string, but found ${typeof op} instead. If you wanted a literal array, use [\"literal\", [...]].`, 0);\r\n                return null;\r\n            }\r\n\r\n            const Expr = context.registry[op];\r\n            if (Expr) {\r\n                let parsed = Expr.parse(expr, context);\r\n                if (!parsed) return null;\r\n\r\n                if (context.expectedType) {\r\n                    const expected = context.expectedType;\r\n                    const actual = parsed.type;\r\n\r\n                    // When we expect a number, string, boolean, or array but\r\n                    // have a Value, we can wrap it in a refining assertion.\r\n                    // When we expect a Color but have a String or Value, we\r\n                    // can wrap it in \"to-color\" coercion.\r\n                    // Otherwise, we do static type-checking.\r\n                    if ((expected.kind === 'string' || expected.kind === 'number' || expected.kind === 'boolean') && actual.kind === 'value') {\r\n                        if (!options.omitTypeAnnotations) {\r\n                            parsed = new Assertion(expected, [parsed]);\r\n                        }\r\n                    } else if (expected.kind === 'array' && actual.kind === 'value') {\r\n                        if (!options.omitTypeAnnotations) {\r\n                            parsed = new ArrayAssertion(expected, parsed);\r\n                        }\r\n                    } else if (expected.kind === 'color' && (actual.kind === 'value' || actual.kind === 'string')) {\r\n                        if (!options.omitTypeAnnotations) {\r\n                            parsed = new Coercion(expected, [parsed]);\r\n                        }\r\n                    } else if (context.checkSubtype(context.expectedType, parsed.type)) {\r\n                        return null;\r\n                    }\r\n                }\r\n\r\n                // If an expression's arguments are all literals, we can evaluate\r\n                // it immediately and replace it with a literal value in the\r\n                // parsed/compiled result.\r\n                if (!(parsed instanceof Literal) && isConstant(parsed)) {\r\n                    const ec = new (require('./evaluation_context'))();\r\n                    try {\r\n                        parsed = new Literal(parsed.type, parsed.evaluate(ec));\r\n                    } catch (e) {\r\n                        context.error(e.message);\r\n                        return null;\r\n                    }\r\n                }\r\n\r\n                return parsed;\r\n            }\r\n\r\n            return context.error(`Unknown expression \"${op}\". If you wanted a literal array, use [\"literal\", [...]].`, 0);\r\n        } else if (typeof expr === 'undefined') {\r\n            return context.error(`'undefined' value invalid. Use null instead.`);\r\n        } else if (typeof expr === 'object') {\r\n            return context.error(`Bare objects invalid. Use [\"literal\", {...}] instead.`);\r\n        } else {\r\n            return context.error(`Expected an array, but found ${typeof expr} instead.`);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Returns a copy of this context suitable for parsing the subexpression at\r\n     * index `index`, optionally appending to 'let' binding map.\r\n     *\r\n     * Note that `errors` property, intended for collecting errors while\r\n     * parsing, is copied by reference rather than cloned.\r\n     * @private\r\n     */\r\n    concat(index: number, expectedType?: ?Type, bindings?: Array<[string, Expression]>) {\r\n        const path = typeof index === 'number' ? this.path.concat(index) : this.path;\r\n        const scope = bindings ? this.scope.concat(bindings) : this.scope;\r\n        return new ParsingContext(\r\n            this.registry,\r\n            path,\r\n            expectedType || null,\r\n            scope,\r\n            this.errors\r\n        );\r\n    }\r\n\r\n    /**\r\n     * Push a parsing (or type checking) error into the `this.errors`\r\n     * @param error The message\r\n     * @param keys Optionally specify the source of the error at a child\r\n     * of the current expression at `this.key`.\r\n     * @private\r\n     */\r\n    error(error: string, ...keys: Array<number>) {\r\n        const key = `${this.key}${keys.map(k => `[${k}]`).join('')}`;\r\n        this.errors.push(new ParsingError(key, error));\r\n    }\r\n\r\n    /**\r\n     * Returns null if `t` is a subtype of `expected`; otherwise returns an\r\n     * error message and also pushes it to `this.errors`.\r\n     */\r\n    checkSubtype(expected: Type, t: Type): ?string {\r\n        const error = checkSubtype(expected, t);\r\n        if (error) this.error(error);\r\n        return error;\r\n    }\r\n}\r\n\r\nmodule.exports = ParsingContext;\r\n\r\nfunction isConstant(expression: Expression) {\r\n    // requires within function body to workaround circular dependency\r\n    const {CompoundExpression} = require('./compound_expression');\r\n    const {isGlobalPropertyConstant, isFeatureConstant} = require('./is_constant');\r\n    const Var = require('./definitions/var');\r\n\r\n    if (expression instanceof Var) {\r\n        return false;\r\n    } else if (expression instanceof CompoundExpression && expression.name === 'error') {\r\n        return false;\r\n    }\r\n\r\n    let literalArgs = true;\r\n    expression.eachChild(arg => {\r\n        if (!(arg instanceof Literal)) { literalArgs = false; }\r\n    });\r\n    if (!literalArgs) {\r\n        return false;\r\n    }\r\n\r\n    return isFeatureConstant(expression) &&\r\n        isGlobalPropertyConstant(expression, ['zoom', 'heatmap-density']);\r\n}\r\n","// @flow\r\n\r\nclass ParsingError extends Error {\r\n    key: string;\r\n    message: string;\r\n    constructor(key: string, message: string) {\r\n        super(message);\r\n        this.message = message;\r\n        this.key = key;\r\n    }\r\n}\r\n\r\nmodule.exports = ParsingError;\r\n","// @flow\r\n\r\nclass RuntimeError {\r\n    name: string;\r\n    message: string;\r\n\r\n    constructor(message: string) {\r\n        this.name = 'ExpressionEvaluationError';\r\n        this.message = message;\r\n    }\r\n\r\n    toJSON() {\r\n        return this.message;\r\n    }\r\n}\r\n\r\nmodule.exports = RuntimeError;\r\n","// @flow\r\n\r\nimport type {Expression} from './expression';\r\n\r\n/**\r\n * Tracks `let` bindings during expression parsing.\r\n * @private\r\n */\r\nclass Scope {\r\n    parent: ?Scope;\r\n    bindings: {[string]: Expression};\r\n    constructor(parent?: Scope, bindings: Array<[string, Expression]> = []) {\r\n        this.parent = parent;\r\n        this.bindings = {};\r\n        for (const [name, expression] of bindings) {\r\n            this.bindings[name] = expression;\r\n        }\r\n    }\r\n\r\n    concat(bindings: Array<[string, Expression]>) {\r\n        return new Scope(this, bindings);\r\n    }\r\n\r\n    get(name: string): Expression {\r\n        if (this.bindings[name]) { return this.bindings[name]; }\r\n        if (this.parent) { return this.parent.get(name); }\r\n        throw new Error(`${name} not found in scope.`);\r\n    }\r\n\r\n    has(name: string): boolean {\r\n        if (this.bindings[name]) return true;\r\n        return this.parent ? this.parent.has(name) : false;\r\n    }\r\n}\r\n\r\nmodule.exports = Scope;\r\n","// @flow\r\n\r\nconst RuntimeError = require('./runtime_error');\r\n\r\nimport type { Expression } from './expression';\r\n\r\nexport type Stops = Array<[number, Expression]>;\r\n\r\n/**\r\n * Returns the index of the last stop <= input, or 0 if it doesn't exist.\r\n * @private\r\n */\r\nfunction findStopLessThanOrEqualTo(stops: Array<number>, input: number) {\r\n    const n = stops.length;\r\n    let lowerIndex = 0;\r\n    let upperIndex = n - 1;\r\n    let currentIndex = 0;\r\n    let currentValue, upperValue;\r\n\r\n    while (lowerIndex <= upperIndex) {\r\n        currentIndex = Math.floor((lowerIndex + upperIndex) / 2);\r\n        currentValue = stops[currentIndex];\r\n        upperValue = stops[currentIndex + 1];\r\n        if (input === currentValue || input > currentValue && input < upperValue) { // Search complete\r\n            return currentIndex;\r\n        } else if (currentValue < input) {\r\n            lowerIndex = currentIndex + 1;\r\n        } else if (currentValue > input) {\r\n            upperIndex = currentIndex - 1;\r\n        } else {\r\n            throw new RuntimeError('Input is not a number.');\r\n        }\r\n    }\r\n\r\n    return Math.max(currentIndex - 1, 0);\r\n}\r\n\r\nmodule.exports = {findStopLessThanOrEqualTo};\r\n","// @flow\r\n\r\nexport type NullTypeT = { kind: 'null' };\r\nexport type NumberTypeT = { kind: 'number' };\r\nexport type StringTypeT = { kind: 'string' };\r\nexport type BooleanTypeT = { kind: 'boolean' };\r\nexport type ColorTypeT = { kind: 'color' };\r\nexport type ObjectTypeT = { kind: 'object' };\r\nexport type ValueTypeT = { kind: 'value' };\r\nexport type ErrorTypeT = { kind: 'error' };\r\n\r\nexport type Type =\r\n    NullTypeT |\r\n    NumberTypeT |\r\n    StringTypeT |\r\n    BooleanTypeT |\r\n    ColorTypeT |\r\n    ObjectTypeT |\r\n    ValueTypeT |\r\n    ArrayType | // eslint-disable-line no-use-before-define\r\n    ErrorTypeT\r\n\r\nexport type ArrayType = {\r\n    kind: 'array',\r\n    itemType: Type,\r\n    N: ?number\r\n}\r\n\r\nconst NullType = { kind: 'null' };\r\nconst NumberType = { kind: 'number' };\r\nconst StringType = { kind: 'string' };\r\nconst BooleanType = { kind: 'boolean' };\r\nconst ColorType = { kind: 'color' };\r\nconst ObjectType = { kind: 'object' };\r\nconst ValueType = { kind: 'value' };\r\nconst ErrorType = { kind: 'error' };\r\n\r\nfunction array(itemType: Type, N: ?number): ArrayType {\r\n    return {\r\n        kind: 'array',\r\n        itemType,\r\n        N\r\n    };\r\n}\r\n\r\nfunction toString(type: Type): string {\r\n    if (type.kind === 'array') {\r\n        const itemType = toString(type.itemType);\r\n        return typeof type.N === 'number' ?\r\n            `array<${itemType}, ${type.N}>` :\r\n            type.itemType.kind === 'value' ? 'array' : `array<${itemType}>`;\r\n    } else {\r\n        return type.kind;\r\n    }\r\n}\r\n\r\nconst valueMemberTypes = [\r\n    NullType,\r\n    NumberType,\r\n    StringType,\r\n    BooleanType,\r\n    ColorType,\r\n    ObjectType,\r\n    array(ValueType)\r\n];\r\n\r\n/**\r\n * Returns null if `t` is a subtype of `expected`; otherwise returns an\r\n * error message.\r\n * @private\r\n */\r\nfunction checkSubtype(expected: Type, t: Type): ?string {\r\n    if (t.kind === 'error') {\r\n        // Error is a subtype of every type\r\n        return null;\r\n    } else if (expected.kind === 'array') {\r\n        if (t.kind === 'array' &&\r\n            !checkSubtype(expected.itemType, t.itemType) &&\r\n            (typeof expected.N !== 'number' || expected.N === t.N)) {\r\n            return null;\r\n        }\r\n    } else if (expected.kind === t.kind) {\r\n        return null;\r\n    } else if (expected.kind === 'value') {\r\n        for (const memberType of valueMemberTypes) {\r\n            if (!checkSubtype(memberType, t)) {\r\n                return null;\r\n            }\r\n        }\r\n    }\r\n\r\n    return `Expected ${toString(expected)} but found ${toString(t)} instead.`;\r\n}\r\n\r\nmodule.exports = {\r\n    NullType,\r\n    NumberType,\r\n    StringType,\r\n    BooleanType,\r\n    ColorType,\r\n    ObjectType,\r\n    ValueType,\r\n    array,\r\n    ErrorType,\r\n    toString,\r\n    checkSubtype\r\n};\r\n","// @flow\r\n\r\nconst assert = require('assert');\r\nconst Color = require('../util/color');\r\n\r\nconst {\r\n    NullType,\r\n    NumberType,\r\n    StringType,\r\n    BooleanType,\r\n    ColorType,\r\n    ObjectType,\r\n    ValueType,\r\n    array\r\n} = require('./types');\r\n\r\nimport type { Type } from './types';\r\n\r\nfunction validateRGBA(r: mixed, g: mixed, b: mixed, a?: mixed): ?string {\r\n    if (!(\r\n        typeof r === 'number' && r >= 0 && r <= 255 &&\r\n        typeof g === 'number' && g >= 0 && g <= 255 &&\r\n        typeof b === 'number' && b >= 0 && b <= 255\r\n    )) {\r\n        const value = typeof a === 'number' ? [r, g, b, a] : [r, g, b];\r\n        return `Invalid rgba value [${value.join(', ')}]: 'r', 'g', and 'b' must be between 0 and 255.`;\r\n    }\r\n\r\n    if (!(\r\n        typeof a === 'undefined' || (typeof a === 'number' && a >= 0 && a <= 1)\r\n    )) {\r\n        return `Invalid rgba value [${[r, g, b, a].join(', ')}]: 'a' must be between 0 and 1.`;\r\n    }\r\n\r\n    return null;\r\n}\r\n\r\nexport type Value = null | string | boolean | number | Color | $ReadOnlyArray<Value> | { +[string]: Value }\r\n\r\nfunction isValue(mixed: mixed): boolean {\r\n    if (mixed === null) {\r\n        return true;\r\n    } else if (typeof mixed === 'string') {\r\n        return true;\r\n    } else if (typeof mixed === 'boolean') {\r\n        return true;\r\n    } else if (typeof mixed === 'number') {\r\n        return true;\r\n    } else if (mixed instanceof Color) {\r\n        return true;\r\n    } else if (Array.isArray(mixed)) {\r\n        for (const item of mixed) {\r\n            if (!isValue(item)) {\r\n                return false;\r\n            }\r\n        }\r\n        return true;\r\n    } else if (typeof mixed === 'object') {\r\n        for (const key in mixed) {\r\n            if (!isValue(mixed[key])) {\r\n                return false;\r\n            }\r\n        }\r\n        return true;\r\n    } else {\r\n        return false;\r\n    }\r\n}\r\n\r\nfunction typeOf(value: Value): Type {\r\n    if (value === null) {\r\n        return NullType;\r\n    } else if (typeof value === 'string') {\r\n        return StringType;\r\n    } else if (typeof value === 'boolean') {\r\n        return BooleanType;\r\n    } else if (typeof value === 'number') {\r\n        return NumberType;\r\n    } else if (value instanceof Color) {\r\n        return ColorType;\r\n    } else if (Array.isArray(value)) {\r\n        const length = value.length;\r\n        let itemType: ?Type;\r\n\r\n        for (const item of value) {\r\n            const t = typeOf(item);\r\n            if (!itemType) {\r\n                itemType = t;\r\n            } else if (itemType === t) {\r\n                continue;\r\n            } else {\r\n                itemType = ValueType;\r\n                break;\r\n            }\r\n        }\r\n\r\n        return array(itemType || ValueType, length);\r\n    } else {\r\n        assert(typeof value === 'object');\r\n        return ObjectType;\r\n    }\r\n}\r\n\r\nmodule.exports = {\r\n    Color,\r\n    validateRGBA,\r\n    isValue,\r\n    typeOf\r\n};\r\n","// @flow\r\n\r\nconst {createExpression} = require('../expression');\r\n\r\nimport type {GlobalProperties} from '../expression';\r\nexport type FeatureFilter = (globalProperties: GlobalProperties, feature: VectorTileFeature) => boolean;\r\n\r\nmodule.exports = createFilter;\r\nmodule.exports.isExpressionFilter = isExpressionFilter;\r\n\r\nfunction isExpressionFilter(filter) {\r\n    if (!Array.isArray(filter) || filter.length === 0) {\r\n        return false;\r\n    }\r\n    switch (filter[0]) {\r\n    case 'has':\r\n        return filter.length >= 2 && filter[1] !== '$id' && filter[1] !== '$type';\r\n\r\n    case 'in':\r\n    case '!in':\r\n    case '!has':\r\n    case 'none':\r\n        return false;\r\n\r\n    case '==':\r\n    case '!=':\r\n    case '>':\r\n    case '>=':\r\n    case '<':\r\n    case '<=':\r\n        return filter.length === 3 && (Array.isArray(filter[1]) || Array.isArray(filter[2]));\r\n\r\n    case 'any':\r\n    case 'all':\r\n        for (const f of filter.slice(1)) {\r\n            if (!isExpressionFilter(f) && typeof f !== 'boolean') {\r\n                return false;\r\n            }\r\n        }\r\n        return true;\r\n\r\n    default:\r\n        return true;\r\n    }\r\n}\r\n\r\nconst filterSpec = {\r\n    'type': 'boolean',\r\n    'default': false,\r\n    'function': true,\r\n    'property-function': true,\r\n    'zoom-function': true\r\n};\r\n\r\n/**\r\n * Given a filter expressed as nested arrays, return a new function\r\n * that evaluates whether a given feature (with a .properties or .tags property)\r\n * passes its test.\r\n *\r\n * @private\r\n * @param {Array} filter mapbox gl filter\r\n * @returns {Function} filter-evaluating function\r\n */\r\nfunction createFilter(filter: any): FeatureFilter {\r\n    if (!filter) {\r\n        return () => true;\r\n    }\r\n\r\n    if (!isExpressionFilter(filter)) {\r\n        filter = convertFilter(filter);\r\n    }\r\n\r\n    const compiled = createExpression(filter, filterSpec);\r\n    if (compiled.result === 'error') {\r\n        throw new Error(compiled.value.map(err => `${err.key}: ${err.message}`).join(', '));\r\n    } else {\r\n        return (globalProperties: GlobalProperties, feature: VectorTileFeature) => compiled.value.evaluate(globalProperties, feature);\r\n    }\r\n}\r\n\r\n// Comparison function to sort numbers and strings\r\nfunction compare(a, b) {\r\n    return a < b ? -1 : a > b ? 1 : 0;\r\n}\r\n\r\nfunction convertFilter(filter: ?Array<any>): mixed {\r\n    if (!filter) return true;\r\n    const op = filter[0];\r\n    if (filter.length <= 1) return (op !== 'any');\r\n    const converted =\r\n        op === '==' ? convertComparisonOp(filter[1], filter[2], '==') :\r\n        op === '!=' ? convertNegation(convertComparisonOp(filter[1], filter[2], '==')) :\r\n        op === '<' ||\r\n        op === '>' ||\r\n        op === '<=' ||\r\n        op === '>=' ? convertComparisonOp(filter[1], filter[2], op) :\r\n        op === 'any' ? convertDisjunctionOp(filter.slice(1)) :\r\n        op === 'all' ? ['all'].concat(filter.slice(1).map(convertFilter)) :\r\n        op === 'none' ? ['all'].concat(filter.slice(1).map(convertFilter).map(convertNegation)) :\r\n        op === 'in' ? convertInOp(filter[1], filter.slice(2)) :\r\n        op === '!in' ? convertNegation(convertInOp(filter[1], filter.slice(2))) :\r\n        op === 'has' ? convertHasOp(filter[1]) :\r\n        op === '!has' ? convertNegation(convertHasOp(filter[1])) :\r\n        true;\r\n    return converted;\r\n}\r\n\r\nfunction convertComparisonOp(property: string, value: any, op: string) {\r\n    switch (property) {\r\n    case '$type':\r\n        return [`filter-type-${op}`, value];\r\n    case '$id':\r\n        return [`filter-id-${op}`, value];\r\n    default:\r\n        return [`filter-${op}`, property, value];\r\n    }\r\n}\r\n\r\nfunction convertDisjunctionOp(filters: Array<Array<any>>) {\r\n    return ['any'].concat(filters.map(convertFilter));\r\n}\r\n\r\nfunction convertInOp(property: string, values: Array<any>) {\r\n    if (values.length === 0) { return false; }\r\n    switch (property) {\r\n    case '$type':\r\n        return [`filter-type-in`, ['literal', values]];\r\n    case '$id':\r\n        return [`filter-id-in`, ['literal', values]];\r\n    default:\r\n        if (values.length > 200 && !values.some(v => typeof v !== typeof values[0])) {\r\n            return ['filter-in-large', property, ['literal', values.sort(compare)]];\r\n        } else {\r\n            return ['filter-in-small', property, ['literal', values]];\r\n        }\r\n    }\r\n}\r\n\r\nfunction convertHasOp(property: string) {\r\n    switch (property) {\r\n    case '$type':\r\n        return true;\r\n    case '$id':\r\n        return [`filter-has-id`];\r\n    default:\r\n        return [`filter-has`, property];\r\n    }\r\n}\r\n\r\nfunction convertNegation(filter: mixed) {\r\n    return ['!', filter];\r\n}\r\n\r\n","\r\nconst colorSpaces = require('../util/color_spaces');\r\nconst Color = require('../util/color');\r\nconst extend = require('../util/extend');\r\nconst getType = require('../util/get_type');\r\nconst interpolate = require('../util/interpolate');\r\nconst Interpolate = require('../expression/definitions/interpolate');\r\n\r\nfunction isFunction(value) {\r\n    return typeof value === 'object' && value !== null && !Array.isArray(value);\r\n}\r\n\r\nfunction identityFunction(x) {\r\n    return x;\r\n}\r\n\r\nfunction createFunction(parameters, propertySpec) {\r\n    const isColor = propertySpec.type === 'color';\r\n    const zoomAndFeatureDependent = parameters.stops && typeof parameters.stops[0][0] === 'object';\r\n    const featureDependent = zoomAndFeatureDependent || parameters.property !== undefined;\r\n    const zoomDependent = zoomAndFeatureDependent || !featureDependent;\r\n    const type = parameters.type || (propertySpec.function === 'interpolated' ? 'exponential' : 'interval');\r\n\r\n    if (isColor) {\r\n        parameters = extend({}, parameters);\r\n\r\n        if (parameters.stops) {\r\n            parameters.stops = parameters.stops.map((stop) => {\r\n                return [stop[0], Color.parse(stop[1])];\r\n            });\r\n        }\r\n\r\n        if (parameters.default) {\r\n            parameters.default = Color.parse(parameters.default);\r\n        } else {\r\n            parameters.default = Color.parse(propertySpec.default);\r\n        }\r\n    }\r\n\r\n    if (parameters.colorSpace && parameters.colorSpace !== 'rgb' && !colorSpaces[parameters.colorSpace]) {\r\n        throw new Error(`Unknown color space: ${parameters.colorSpace}`);\r\n    }\r\n\r\n    let innerFun;\r\n    let hashedStops;\r\n    let categoricalKeyType;\r\n    if (type === 'exponential') {\r\n        innerFun = evaluateExponentialFunction;\r\n    } else if (type === 'interval') {\r\n        innerFun = evaluateIntervalFunction;\r\n    } else if (type === 'categorical') {\r\n        innerFun = evaluateCategoricalFunction;\r\n\r\n        // For categorical functions, generate an Object as a hashmap of the stops for fast searching\r\n        hashedStops = Object.create(null);\r\n        for (const stop of parameters.stops) {\r\n            hashedStops[stop[0]] = stop[1];\r\n        }\r\n\r\n        // Infer key type based on first stop key-- used to encforce strict type checking later\r\n        categoricalKeyType = typeof parameters.stops[0][0];\r\n\r\n    } else if (type === 'identity') {\r\n        innerFun = evaluateIdentityFunction;\r\n    } else {\r\n        throw new Error(`Unknown function type \"${type}\"`);\r\n    }\r\n\r\n    if (zoomAndFeatureDependent) {\r\n        const featureFunctions = {};\r\n        const zoomStops = [];\r\n        for (let s = 0; s < parameters.stops.length; s++) {\r\n            const stop = parameters.stops[s];\r\n            const zoom = stop[0].zoom;\r\n            if (featureFunctions[zoom] === undefined) {\r\n                featureFunctions[zoom] = {\r\n                    zoom: zoom,\r\n                    type: parameters.type,\r\n                    property: parameters.property,\r\n                    default: parameters.default,\r\n                    stops: []\r\n                };\r\n                zoomStops.push(zoom);\r\n            }\r\n            featureFunctions[zoom].stops.push([stop[0].value, stop[1]]);\r\n        }\r\n\r\n        const featureFunctionStops = [];\r\n        for (const z of zoomStops) {\r\n            featureFunctionStops.push([featureFunctions[z].zoom, createFunction(featureFunctions[z], propertySpec)]);\r\n        }\r\n\r\n        return {\r\n            kind: 'composite',\r\n            interpolationFactor: Interpolate.interpolationFactor.bind(undefined, {name: 'linear'}),\r\n            zoomStops: featureFunctionStops.map(s => s[0]),\r\n            evaluate({zoom}, properties) {\r\n                return evaluateExponentialFunction({\r\n                    stops: featureFunctionStops,\r\n                    base: parameters.base\r\n                }, propertySpec, zoom).evaluate(zoom, properties);\r\n            }\r\n        };\r\n    } else if (zoomDependent) {\r\n        return {\r\n            kind: 'camera',\r\n            interpolationFactor: type === 'exponential' ?\r\n                Interpolate.interpolationFactor.bind(undefined, {name: 'exponential', base: parameters.base !== undefined ? parameters.base : 1}) :\r\n                () => 0,\r\n            zoomStops: parameters.stops.map(s => s[0]),\r\n            evaluate: ({zoom}) => innerFun(parameters, propertySpec, zoom, hashedStops, categoricalKeyType)\r\n        };\r\n    } else {\r\n        return {\r\n            kind: 'source',\r\n            evaluate(_, feature) {\r\n                const value = feature && feature.properties ? feature.properties[parameters.property] : undefined;\r\n                if (value === undefined) {\r\n                    return coalesce(parameters.default, propertySpec.default);\r\n                }\r\n                return innerFun(parameters, propertySpec, value, hashedStops, categoricalKeyType);\r\n            }\r\n        };\r\n    }\r\n}\r\n\r\nfunction coalesce(a, b, c) {\r\n    if (a !== undefined) return a;\r\n    if (b !== undefined) return b;\r\n    if (c !== undefined) return c;\r\n}\r\n\r\nfunction evaluateCategoricalFunction(parameters, propertySpec, input, hashedStops, keyType) {\r\n    const evaluated = typeof input === keyType ? hashedStops[input] : undefined; // Enforce strict typing on input\r\n    return coalesce(evaluated, parameters.default, propertySpec.default);\r\n}\r\n\r\nfunction evaluateIntervalFunction(parameters, propertySpec, input) {\r\n    // Edge cases\r\n    if (getType(input) !== 'number') return coalesce(parameters.default, propertySpec.default);\r\n    const n = parameters.stops.length;\r\n    if (n === 1) return parameters.stops[0][1];\r\n    if (input <= parameters.stops[0][0]) return parameters.stops[0][1];\r\n    if (input >= parameters.stops[n - 1][0]) return parameters.stops[n - 1][1];\r\n\r\n    const index = findStopLessThanOrEqualTo(parameters.stops, input);\r\n\r\n    return parameters.stops[index][1];\r\n}\r\n\r\nfunction evaluateExponentialFunction(parameters, propertySpec, input) {\r\n    const base = parameters.base !== undefined ? parameters.base : 1;\r\n\r\n    // Edge cases\r\n    if (getType(input) !== 'number') return coalesce(parameters.default, propertySpec.default);\r\n    const n = parameters.stops.length;\r\n    if (n === 1) return parameters.stops[0][1];\r\n    if (input <= parameters.stops[0][0]) return parameters.stops[0][1];\r\n    if (input >= parameters.stops[n - 1][0]) return parameters.stops[n - 1][1];\r\n\r\n    const index = findStopLessThanOrEqualTo(parameters.stops, input);\r\n    const t = interpolationFactor(\r\n        input, base,\r\n        parameters.stops[index][0],\r\n        parameters.stops[index + 1][0]);\r\n\r\n    const outputLower = parameters.stops[index][1];\r\n    const outputUpper = parameters.stops[index + 1][1];\r\n    let interp = interpolate[propertySpec.type] || identityFunction;\r\n\r\n    if (parameters.colorSpace && parameters.colorSpace !== 'rgb') {\r\n        const colorspace = colorSpaces[parameters.colorSpace];\r\n        interp = (a, b) => colorspace.reverse(colorspace.interpolate(colorspace.forward(a), colorspace.forward(b), t));\r\n    }\r\n\r\n    if (typeof outputLower.evaluate === 'function') {\r\n        return {\r\n            evaluate(...args) {\r\n                const evaluatedLower = outputLower.evaluate.apply(undefined, args);\r\n                const evaluatedUpper = outputUpper.evaluate.apply(undefined, args);\r\n                // Special case for fill-outline-color, which has no spec default.\r\n                if (evaluatedLower === undefined || evaluatedUpper === undefined) {\r\n                    return undefined;\r\n                }\r\n                return interp(evaluatedLower, evaluatedUpper, t);\r\n            }\r\n        };\r\n    }\r\n\r\n    return interp(outputLower, outputUpper, t);\r\n}\r\n\r\nfunction evaluateIdentityFunction(parameters, propertySpec, input) {\r\n    if (propertySpec.type === 'color') {\r\n        input = Color.parse(input);\r\n    } else if (getType(input) !== propertySpec.type && (propertySpec.type !== 'enum' || !propertySpec.values[input])) {\r\n        input = undefined;\r\n    }\r\n    return coalesce(input, parameters.default, propertySpec.default);\r\n}\r\n\r\n/**\r\n * Returns the index of the last stop <= input, or 0 if it doesn't exist.\r\n *\r\n * @private\r\n */\r\nfunction findStopLessThanOrEqualTo(stops, input) {\r\n    const n = stops.length;\r\n    let lowerIndex = 0;\r\n    let upperIndex = n - 1;\r\n    let currentIndex = 0;\r\n    let currentValue, upperValue;\r\n\r\n    while (lowerIndex <= upperIndex) {\r\n        currentIndex = Math.floor((lowerIndex + upperIndex) / 2);\r\n        currentValue = stops[currentIndex][0];\r\n        upperValue = stops[currentIndex + 1][0];\r\n        if (input === currentValue || input > currentValue && input < upperValue) { // Search complete\r\n            return currentIndex;\r\n        } else if (currentValue < input) {\r\n            lowerIndex = currentIndex + 1;\r\n        } else if (currentValue > input) {\r\n            upperIndex = currentIndex - 1;\r\n        }\r\n    }\r\n\r\n    return Math.max(currentIndex - 1, 0);\r\n}\r\n\r\n/**\r\n * Returns a ratio that can be used to interpolate between exponential function\r\n * stops.\r\n *\r\n * How it works:\r\n * Two consecutive stop values define a (scaled and shifted) exponential\r\n * function `f(x) = a * base^x + b`, where `base` is the user-specified base,\r\n * and `a` and `b` are constants affording sufficient degrees of freedom to fit\r\n * the function to the given stops.\r\n *\r\n * Here's a bit of algebra that lets us compute `f(x)` directly from the stop\r\n * values without explicitly solving for `a` and `b`:\r\n *\r\n * First stop value: `f(x0) = y0 = a * base^x0 + b`\r\n * Second stop value: `f(x1) = y1 = a * base^x1 + b`\r\n * => `y1 - y0 = a(base^x1 - base^x0)`\r\n * => `a = (y1 - y0)/(base^x1 - base^x0)`\r\n *\r\n * Desired value: `f(x) = y = a * base^x + b`\r\n * => `f(x) = y0 + a * (base^x - base^x0)`\r\n *\r\n * From the above, we can replace the `a` in `a * (base^x - base^x0)` and do a\r\n * little algebra:\r\n * ```\r\n * a * (base^x - base^x0) = (y1 - y0)/(base^x1 - base^x0) * (base^x - base^x0)\r\n *                     = (y1 - y0) * (base^x - base^x0) / (base^x1 - base^x0)\r\n * ```\r\n *\r\n * If we let `(base^x - base^x0) / (base^x1 base^x0)`, then we have\r\n * `f(x) = y0 + (y1 - y0) * ratio`.  In other words, `ratio` may be treated as\r\n * an interpolation factor between the two stops' output values.\r\n *\r\n * (Note: a slightly different form for `ratio`,\r\n * `(base^(x-x0) - 1) / (base^(x1-x0) - 1) `, is equivalent, but requires fewer\r\n * expensive `Math.pow()` operations.)\r\n *\r\n * @private\r\n */\r\nfunction interpolationFactor(input, base, lowerValue, upperValue) {\r\n    const difference = upperValue - lowerValue;\r\n    const progress = input - lowerValue;\r\n\r\n    if (difference === 0) {\r\n        return 0;\r\n    } else if (base === 1) {\r\n        return progress / difference;\r\n    } else {\r\n        return (Math.pow(base, progress) - 1) / (Math.pow(base, difference) - 1);\r\n    }\r\n}\r\n\r\nmodule.exports = {\r\n    createFunction,\r\n    isFunction\r\n};\r\n","\r\nconst refProperties = require('./util/ref_properties');\r\n\r\nfunction stringify(obj) {\r\n    const type = typeof obj;\r\n    if (type === 'number' || type === 'boolean' || type === 'string' || obj === undefined || obj === null)\r\n        return JSON.stringify(obj);\r\n\r\n    if (Array.isArray(obj)) {\r\n        let str = '[';\r\n        for (const val of obj) {\r\n            str += `${stringify(val)},`;\r\n        }\r\n        return `${str}]`;\r\n    }\r\n\r\n    const keys = Object.keys(obj).sort();\r\n\r\n    let str = '{';\r\n    for (let i = 0; i < keys.length; i++) {\r\n        str += `${JSON.stringify(keys[i])}:${stringify(obj[keys[i]])},`;\r\n    }\r\n    return `${str}}`;\r\n}\r\n\r\nfunction getKey(layer) {\r\n    let key = '';\r\n    for (const k of refProperties) {\r\n        key += `/${stringify(layer[k])}`;\r\n    }\r\n    return key;\r\n}\r\n\r\nmodule.exports = groupByLayout;\r\n\r\n/**\r\n * Given an array of layers, return an array of arrays of layers where all\r\n * layers in each group have identical layout-affecting properties. These\r\n * are the properties that were formerly used by explicit `ref` mechanism\r\n * for layers: 'type', 'source', 'source-layer', 'minzoom', 'maxzoom',\r\n * 'filter', and 'layout'.\r\n *\r\n * The input is not modified. The output layers are references to the\r\n * input layers.\r\n *\r\n * @private\r\n * @param {Array<Layer>} layers\r\n * @returns {Array<Array<Layer>>}\r\n */\r\nfunction groupByLayout(layers) {\r\n    const groups = {};\r\n\r\n    for (let i = 0; i < layers.length; i++) {\r\n        const k = getKey(layers[i]);\r\n        let group = groups[k];\r\n        if (!group) {\r\n            group = groups[k] = [];\r\n        }\r\n        group.push(layers[i]);\r\n    }\r\n\r\n    const result = [];\r\n\r\n    for (const k in groups) {\r\n        result.push(groups[k]);\r\n    }\r\n\r\n    return result;\r\n}\r\n","\r\nmodule.exports = require('./v8.json');\r\n","// @flow\r\n\r\nconst {parseCSSColor} = require('csscolorparser');\r\n\r\n/**\r\n * An RGBA color value. Create instances from color strings using the static\r\n * method `Color.parse`. The constructor accepts RGB channel values in the range\r\n * `[0, 1]`, premultiplied by A.\r\n *\r\n * @param {number} r The red channel.\r\n * @param {number} g The green channel.\r\n * @param {number} b The blue channel.\r\n * @param {number} a The alpha channel.\r\n */\r\nclass Color {\r\n    r: number;\r\n    g: number;\r\n    b: number;\r\n    a: number;\r\n\r\n    constructor(r: number, g: number, b: number, a: number = 1) {\r\n        this.r = r;\r\n        this.g = g;\r\n        this.b = b;\r\n        this.a = a;\r\n    }\r\n\r\n    static black: Color;\r\n    static white: Color;\r\n    static transparent: Color;\r\n\r\n    /**\r\n     * Parses valid CSS color strings and returns a `Color` instance.\r\n     * @returns A `Color` instance, or `undefined` if the input is not a valid color string.\r\n     */\r\n    static parse(input: ?string): Color | void {\r\n        if (!input) {\r\n            return undefined;\r\n        }\r\n\r\n        if (input instanceof Color) {\r\n            return input;\r\n        }\r\n\r\n        if (typeof input !== 'string') {\r\n            return undefined;\r\n        }\r\n\r\n        const rgba = parseCSSColor(input);\r\n        if (!rgba) {\r\n            return undefined;\r\n        }\r\n\r\n        return new Color(\r\n            rgba[0] / 255 * rgba[3],\r\n            rgba[1] / 255 * rgba[3],\r\n            rgba[2] / 255 * rgba[3],\r\n            rgba[3]\r\n        );\r\n    }\r\n\r\n    /**\r\n     * Returns an RGBA string representing the color value.\r\n     *\r\n     * @returns An RGBA string.\r\n     * @example\r\n     * var purple = new Color.parse('purple');\r\n     * purple.toString; // = \"rgba(128,0,128,1)\"\r\n     * var translucentGreen = new Color.parse('rgba(26, 207, 26, .73)');\r\n     * translucentGreen.toString(); // = \"rgba(26,207,26,0.73)\"\r\n     */\r\n    toString(): string {\r\n        const transformRgb = (value: number) => Math.round(value * 255 / this.a);\r\n        const rgb = [this.r, this.g, this.b].map(transformRgb);\r\n        return `rgba(${rgb.concat(this.a).join(',')})`;\r\n    }\r\n}\r\n\r\nColor.black = new Color(0, 0, 0, 1);\r\nColor.white = new Color(1, 1, 1, 1);\r\nColor.transparent = new Color(0, 0, 0, 0);\r\n\r\nmodule.exports = Color;\r\n","// @flow\r\n\r\nconst Color = require('./color');\r\nconst interpolateNumber = require('./interpolate').number;\r\n\r\ntype LABColor = {\r\n    l: number,\r\n    a: number,\r\n    b: number,\r\n    alpha: number\r\n};\r\n\r\ntype HCLColor = {\r\n    h: number,\r\n    c: number,\r\n    l: number,\r\n    alpha: number\r\n};\r\n\r\n// Constants\r\nconst Xn = 0.950470, // D65 standard referent\r\n    Yn = 1,\r\n    Zn = 1.088830,\r\n    t0 = 4 / 29,\r\n    t1 = 6 / 29,\r\n    t2 = 3 * t1 * t1,\r\n    t3 = t1 * t1 * t1,\r\n    deg2rad = Math.PI / 180,\r\n    rad2deg = 180 / Math.PI;\r\n\r\n// Utilities\r\nfunction xyz2lab(t) {\r\n    return t > t3 ? Math.pow(t, 1 / 3) : t / t2 + t0;\r\n}\r\n\r\nfunction lab2xyz(t) {\r\n    return t > t1 ? t * t * t : t2 * (t - t0);\r\n}\r\n\r\nfunction xyz2rgb(x) {\r\n    return 255 * (x <= 0.0031308 ? 12.92 * x : 1.055 * Math.pow(x, 1 / 2.4) - 0.055);\r\n}\r\n\r\nfunction rgb2xyz(x) {\r\n    x /= 255;\r\n    return x <= 0.04045 ? x / 12.92 : Math.pow((x + 0.055) / 1.055, 2.4);\r\n}\r\n\r\n// LAB\r\nfunction rgbToLab(rgbColor: Color): LABColor {\r\n    const b = rgb2xyz(rgbColor.r),\r\n        a = rgb2xyz(rgbColor.g),\r\n        l = rgb2xyz(rgbColor.b),\r\n        x = xyz2lab((0.4124564 * b + 0.3575761 * a + 0.1804375 * l) / Xn),\r\n        y = xyz2lab((0.2126729 * b + 0.7151522 * a + 0.0721750 * l) / Yn),\r\n        z = xyz2lab((0.0193339 * b + 0.1191920 * a + 0.9503041 * l) / Zn);\r\n\r\n    return {\r\n        l: 116 * y - 16,\r\n        a: 500 * (x - y),\r\n        b: 200 * (y - z),\r\n        alpha: rgbColor.a\r\n    };\r\n}\r\n\r\nfunction labToRgb(labColor: LABColor): Color {\r\n    let y = (labColor.l + 16) / 116,\r\n        x = isNaN(labColor.a) ? y : y + labColor.a / 500,\r\n        z = isNaN(labColor.b) ? y : y - labColor.b / 200;\r\n    y = Yn * lab2xyz(y);\r\n    x = Xn * lab2xyz(x);\r\n    z = Zn * lab2xyz(z);\r\n    return new Color(\r\n        xyz2rgb(3.2404542 * x - 1.5371385 * y - 0.4985314 * z), // D65 -> sRGB\r\n        xyz2rgb(-0.9692660 * x + 1.8760108 * y + 0.0415560 * z),\r\n        xyz2rgb(0.0556434 * x - 0.2040259 * y + 1.0572252 * z),\r\n        labColor.alpha\r\n    );\r\n}\r\n\r\nfunction interpolateLab(from: LABColor, to: LABColor, t: number) {\r\n    return {\r\n        l: interpolateNumber(from.l, to.l, t),\r\n        a: interpolateNumber(from.a, to.a, t),\r\n        b: interpolateNumber(from.b, to.b, t),\r\n        alpha: interpolateNumber(from.alpha, to.alpha, t)\r\n    };\r\n}\r\n\r\n// HCL\r\nfunction rgbToHcl(rgbColor: Color): HCLColor {\r\n    const {l, a, b} = rgbToLab(rgbColor);\r\n    const h = Math.atan2(b, a) * rad2deg;\r\n    return {\r\n        h: h < 0 ? h + 360 : h,\r\n        c: Math.sqrt(a * a + b * b),\r\n        l: l,\r\n        alpha: rgbColor.a\r\n    };\r\n}\r\n\r\nfunction hclToRgb(hclColor: HCLColor): Color {\r\n    const h = hclColor.h * deg2rad,\r\n        c = hclColor.c,\r\n        l = hclColor.l;\r\n    return labToRgb({\r\n        l: l,\r\n        a: Math.cos(h) * c,\r\n        b: Math.sin(h) * c,\r\n        alpha: hclColor.alpha\r\n    });\r\n}\r\n\r\nfunction interpolateHue(a: number, b: number, t: number) {\r\n    const d = b - a;\r\n    return a + t * (d > 180 || d < -180 ? d - 360 * Math.round(d / 360) : d);\r\n}\r\n\r\nfunction interpolateHcl(from: HCLColor, to: HCLColor, t: number) {\r\n    return {\r\n        h: interpolateHue(from.h, to.h, t),\r\n        c: interpolateNumber(from.c, to.c, t),\r\n        l: interpolateNumber(from.l, to.l, t),\r\n        alpha: interpolateNumber(from.alpha, to.alpha, t)\r\n    };\r\n}\r\n\r\nmodule.exports = {\r\n    lab: {\r\n        forward: rgbToLab,\r\n        reverse: labToRgb,\r\n        interpolate: interpolateLab\r\n    },\r\n    hcl: {\r\n        forward: rgbToHcl,\r\n        reverse: hclToRgb,\r\n        interpolate: interpolateHcl\r\n    }\r\n};\r\n","// @flow\r\n\r\n/**\r\n * Deeply compares two object literals.\r\n *\r\n * @private\r\n */\r\nfunction deepEqual(a: ?mixed, b: ?mixed): boolean {\r\n    if (Array.isArray(a)) {\r\n        if (!Array.isArray(b) || a.length !== b.length) return false;\r\n        for (let i = 0; i < a.length; i++) {\r\n            if (!deepEqual(a[i], b[i])) return false;\r\n        }\r\n        return true;\r\n    }\r\n    if (typeof a === 'object' && a !== null && b !== null) {\r\n        if (!(typeof b === 'object')) return false;\r\n        const keys = Object.keys(a);\r\n        if (keys.length !== Object.keys(b).length) return false;\r\n        for (const key in a) {\r\n            if (!deepEqual(a[key], b[key])) return false;\r\n        }\r\n        return true;\r\n    }\r\n    return a === b;\r\n}\r\n\r\nmodule.exports = deepEqual;\r\n","\r\nmodule.exports = function (output, ...inputs) {\r\n    for (const input of inputs) {\r\n        for (const k in input) {\r\n            output[k] = input[k];\r\n        }\r\n    }\r\n    return output;\r\n};\r\n","\r\nmodule.exports = function getType(val) {\r\n    if (val instanceof Number) {\r\n        return 'number';\r\n    } else if (val instanceof String) {\r\n        return 'string';\r\n    } else if (val instanceof Boolean) {\r\n        return 'boolean';\r\n    } else if (Array.isArray(val)) {\r\n        return 'array';\r\n    } else if (val === null) {\r\n        return 'null';\r\n    } else {\r\n        return typeof val;\r\n    }\r\n};\r\n","// @flow\r\n\r\nconst Color = require('./color');\r\n\r\nmodule.exports = {\r\n    number,\r\n    color,\r\n    array\r\n};\r\n\r\nfunction number(a: number, b: number, t: number) {\r\n    return (a * (1 - t)) + (b * t);\r\n}\r\n\r\nfunction color(from: Color, to: Color, t: number) {\r\n    return new Color(\r\n        number(from.r, to.r, t),\r\n        number(from.g, to.g, t),\r\n        number(from.b, to.b, t),\r\n        number(from.a, to.a, t)\r\n    );\r\n}\r\n\r\nfunction array(from: Array<number>, to: Array<number>, t: number) {\r\n    return from.map((d, i) => {\r\n        return number(d, to[i], t);\r\n    });\r\n}\r\n","\r\nmodule.exports = ['type', 'source', 'source-layer', 'minzoom', 'maxzoom', 'filter', 'layout'];\r\n","// @flow\r\n\r\n/**\r\n * A type used for returning and propagating errors. The first element of the union\r\n * represents success and contains a value, and the second represents an error and\r\n * contains an error value.\r\n */\r\nexport type Result<T, E> =\r\n    | {| result: 'success', value: T |}\r\n    | {| result: 'error', value: E |};\r\n\r\nfunction success<T, E>(value: T): Result<T, E> {\r\n    return { result: 'success', value };\r\n}\r\n\r\nfunction error<T, E>(value: E): Result<T, E> {\r\n    return { result: 'error', value };\r\n}\r\n\r\nmodule.exports = {\r\n    success,\r\n    error\r\n};\r\n","\r\n// Turn jsonlint-lines-primitives objects into primitive objects\r\nfunction unbundle(value) {\r\n    if (value instanceof Number || value instanceof String || value instanceof Boolean) {\r\n        return value.valueOf();\r\n    } else {\r\n        return value;\r\n    }\r\n}\r\n\r\nfunction deepUnbundle(value) {\r\n    if (Array.isArray(value)) {\r\n        return value.map(deepUnbundle);\r\n    }\r\n    return unbundle(value);\r\n}\r\n\r\nmodule.exports = unbundle;\r\nmodule.exports.deep = deepUnbundle;\r\n","\r\nconst extend = require('../util/extend');\r\nconst unbundle = require('../util/unbundle_jsonlint');\r\nconst {isExpression} = require('../expression');\r\nconst {isFunction} = require('../function');\r\n\r\n// Main recursive validation function. Tracks:\r\n//\r\n// - key: string representing location of validation in style tree. Used only\r\n//   for more informative error reporting.\r\n// - value: current value from style being evaluated. May be anything from a\r\n//   high level object that needs to be descended into deeper or a simple\r\n//   scalar value.\r\n// - valueSpec: current spec being evaluated. Tracks value.\r\n// - styleSpec: current full spec being evaluated.\r\n\r\nmodule.exports = function validate(options) {\r\n\r\n    const validateFunction = require('./validate_function');\r\n    const validateExpression = require('./validate_expression');\r\n    const validateObject = require('./validate_object');\r\n    const VALIDATORS = {\r\n        '*': function() {\r\n            return [];\r\n        },\r\n        'array': require('./validate_array'),\r\n        'boolean': require('./validate_boolean'),\r\n        'number': require('./validate_number'),\r\n        'color': require('./validate_color'),\r\n        'constants': require('./validate_constants'),\r\n        'enum': require('./validate_enum'),\r\n        'filter': require('./validate_filter'),\r\n        'function': require('./validate_function'),\r\n        'layer': require('./validate_layer'),\r\n        'object': require('./validate_object'),\r\n        'source': require('./validate_source'),\r\n        'light': require('./validate_light'),\r\n        'string': require('./validate_string')\r\n    };\r\n\r\n    const value = options.value;\r\n    const valueSpec = options.valueSpec;\r\n    const styleSpec = options.styleSpec;\r\n\r\n    if (valueSpec.function && isFunction(unbundle(value))) {\r\n        return validateFunction(options);\r\n\r\n    } else if (valueSpec.function && isExpression(unbundle.deep(value))) {\r\n        return validateExpression(options);\r\n\r\n    } else if (valueSpec.type && VALIDATORS[valueSpec.type]) {\r\n        return VALIDATORS[valueSpec.type](options);\r\n\r\n    } else {\r\n        return validateObject(extend({}, options, {\r\n            valueSpec: valueSpec.type ? styleSpec[valueSpec.type] : valueSpec\r\n        }));\r\n    }\r\n};\r\n","\r\nconst getType = require('../util/get_type');\r\nconst validate = require('./validate');\r\nconst ValidationError = require('../error/validation_error');\r\n\r\nmodule.exports = function validateArray(options) {\r\n    const array = options.value;\r\n    const arraySpec = options.valueSpec;\r\n    const style = options.style;\r\n    const styleSpec = options.styleSpec;\r\n    const key = options.key;\r\n    const validateArrayElement = options.arrayElementValidator || validate;\r\n\r\n    if (getType(array) !== 'array') {\r\n        return [new ValidationError(key, array, `array expected, ${getType(array)} found`)];\r\n    }\r\n\r\n    if (arraySpec.length && array.length !== arraySpec.length) {\r\n        return [new ValidationError(key, array, `array length ${arraySpec.length} expected, length ${array.length} found`)];\r\n    }\r\n\r\n    if (arraySpec['min-length'] && array.length < arraySpec['min-length']) {\r\n        return [new ValidationError(key, array, `array length at least ${arraySpec['min-length']} expected, length ${array.length} found`)];\r\n    }\r\n\r\n    let arrayElementSpec = {\r\n        \"type\": arraySpec.value\r\n    };\r\n\r\n    if (styleSpec.$version < 7) {\r\n        arrayElementSpec.function = arraySpec.function;\r\n    }\r\n\r\n    if (getType(arraySpec.value) === 'object') {\r\n        arrayElementSpec = arraySpec.value;\r\n    }\r\n\r\n    let errors = [];\r\n    for (let i = 0; i < array.length; i++) {\r\n        errors = errors.concat(validateArrayElement({\r\n            array: array,\r\n            arrayIndex: i,\r\n            value: array[i],\r\n            valueSpec: arrayElementSpec,\r\n            style: style,\r\n            styleSpec: styleSpec,\r\n            key: `${key}[${i}]`\r\n        }));\r\n    }\r\n    return errors;\r\n};\r\n","\r\nconst getType = require('../util/get_type');\r\nconst ValidationError = require('../error/validation_error');\r\n\r\nmodule.exports = function validateBoolean(options) {\r\n    const value = options.value;\r\n    const key = options.key;\r\n    const type = getType(value);\r\n\r\n    if (type !== 'boolean') {\r\n        return [new ValidationError(key, value, `boolean expected, ${type} found`)];\r\n    }\r\n\r\n    return [];\r\n};\r\n","\r\nconst ValidationError = require('../error/validation_error');\r\nconst getType = require('../util/get_type');\r\nconst parseCSSColor = require('csscolorparser').parseCSSColor;\r\n\r\nmodule.exports = function validateColor(options) {\r\n    const key = options.key;\r\n    const value = options.value;\r\n    const type = getType(value);\r\n\r\n    if (type !== 'string') {\r\n        return [new ValidationError(key, value, `color expected, ${type} found`)];\r\n    }\r\n\r\n    if (parseCSSColor(value) === null) {\r\n        return [new ValidationError(key, value, `color expected, \"${value}\" found`)];\r\n    }\r\n\r\n    return [];\r\n};\r\n","\r\nconst ValidationError = require('../error/validation_error');\r\n\r\nmodule.exports = function validateConstants(options) {\r\n    const key = options.key;\r\n    const constants = options.value;\r\n\r\n    if (constants) {\r\n        return [new ValidationError(key, constants, 'constants have been deprecated as of v8')];\r\n    } else {\r\n        return [];\r\n    }\r\n};\r\n","\r\nconst ValidationError = require('../error/validation_error');\r\nconst unbundle = require('../util/unbundle_jsonlint');\r\n\r\nmodule.exports = function validateEnum(options) {\r\n    const key = options.key;\r\n    const value = options.value;\r\n    const valueSpec = options.valueSpec;\r\n    const errors = [];\r\n\r\n    if (Array.isArray(valueSpec.values)) { // <=v7\r\n        if (valueSpec.values.indexOf(unbundle(value)) === -1) {\r\n            errors.push(new ValidationError(key, value, `expected one of [${valueSpec.values.join(', ')}], ${JSON.stringify(value)} found`));\r\n        }\r\n    } else { // >=v8\r\n        if (Object.keys(valueSpec.values).indexOf(unbundle(value)) === -1) {\r\n            errors.push(new ValidationError(key, value, `expected one of [${Object.keys(valueSpec.values).join(', ')}], ${JSON.stringify(value)} found`));\r\n        }\r\n    }\r\n    return errors;\r\n};\r\n","// @flow\r\n\r\nconst ValidationError = require('../error/validation_error');\r\nconst {createExpression, createPropertyExpression} = require('../expression');\r\nconst unbundle = require('../util/unbundle_jsonlint');\r\n\r\nmodule.exports = function validateExpression(options: any) {\r\n    const expression = (options.expressionContext === 'property' ? createPropertyExpression : createExpression)(unbundle.deep(options.value), options.valueSpec);\r\n    if (expression.result === 'error') {\r\n        return expression.value.map((error) => {\r\n            return new ValidationError(`${options.key}${error.key}`, options.value, error.message);\r\n        });\r\n    }\r\n\r\n    if (options.expressionContext === 'property' && options.propertyKey === 'text-font' &&\r\n        (expression.value: any)._styleExpression.expression.possibleOutputs().indexOf(undefined) !== -1) {\r\n        return [new ValidationError(options.key, options.value, 'Invalid data expression for \"text-font\". Output values must be contained as literals within the expression.')];\r\n    }\r\n\r\n    return [];\r\n};\r\n","\r\nconst ValidationError = require('../error/validation_error');\r\nconst validateExpression = require('./validate_expression');\r\nconst validateEnum = require('./validate_enum');\r\nconst getType = require('../util/get_type');\r\nconst unbundle = require('../util/unbundle_jsonlint');\r\nconst extend = require('../util/extend');\r\nconst {isExpressionFilter} = require('../feature_filter');\r\n\r\nmodule.exports = function validateFilter(options) {\r\n    if (isExpressionFilter(unbundle.deep(options.value))) {\r\n        return validateExpression(extend({}, options, {\r\n            expressionContext: 'filter',\r\n            valueSpec: { value: 'boolean' }\r\n        }));\r\n    } else {\r\n        return validateNonExpressionFilter(options);\r\n    }\r\n};\r\n\r\nfunction validateNonExpressionFilter(options) {\r\n    const value = options.value;\r\n    const key = options.key;\r\n\r\n    if (getType(value) !== 'array') {\r\n        return [new ValidationError(key, value, `array expected, ${getType(value)} found`)];\r\n    }\r\n\r\n    const styleSpec = options.styleSpec;\r\n    let type;\r\n\r\n    let errors = [];\r\n\r\n    if (value.length < 1) {\r\n        return [new ValidationError(key, value, 'filter array must have at least 1 element')];\r\n    }\r\n\r\n    errors = errors.concat(validateEnum({\r\n        key: `${key}[0]`,\r\n        value: value[0],\r\n        valueSpec: styleSpec.filter_operator,\r\n        style: options.style,\r\n        styleSpec: options.styleSpec\r\n    }));\r\n\r\n    switch (unbundle(value[0])) {\r\n    case '<':\r\n    case '<=':\r\n    case '>':\r\n    case '>=':\r\n        if (value.length >= 2 && unbundle(value[1]) === '$type') {\r\n            errors.push(new ValidationError(key, value, `\"$type\" cannot be use with operator \"${value[0]}\"`));\r\n        }\r\n        /* falls through */\r\n    case '==':\r\n    case '!=':\r\n        if (value.length !== 3) {\r\n            errors.push(new ValidationError(key, value, `filter array for operator \"${value[0]}\" must have 3 elements`));\r\n        }\r\n        /* falls through */\r\n    case 'in':\r\n    case '!in':\r\n        if (value.length >= 2) {\r\n            type = getType(value[1]);\r\n            if (type !== 'string') {\r\n                errors.push(new ValidationError(`${key}[1]`, value[1], `string expected, ${type} found`));\r\n            }\r\n        }\r\n        for (let i = 2; i < value.length; i++) {\r\n            type = getType(value[i]);\r\n            if (unbundle(value[1]) === '$type') {\r\n                errors = errors.concat(validateEnum({\r\n                    key: `${key}[${i}]`,\r\n                    value: value[i],\r\n                    valueSpec: styleSpec.geometry_type,\r\n                    style: options.style,\r\n                    styleSpec: options.styleSpec\r\n                }));\r\n            } else if (type !== 'string' && type !== 'number' && type !== 'boolean') {\r\n                errors.push(new ValidationError(`${key}[${i}]`, value[i], `string, number, or boolean expected, ${type} found`));\r\n            }\r\n        }\r\n        break;\r\n\r\n    case 'any':\r\n    case 'all':\r\n    case 'none':\r\n        for (let i = 1; i < value.length; i++) {\r\n            errors = errors.concat(validateNonExpressionFilter({\r\n                key: `${key}[${i}]`,\r\n                value: value[i],\r\n                style: options.style,\r\n                styleSpec: options.styleSpec\r\n            }));\r\n        }\r\n        break;\r\n\r\n    case 'has':\r\n    case '!has':\r\n        type = getType(value[1]);\r\n        if (value.length !== 2) {\r\n            errors.push(new ValidationError(key, value, `filter array for \"${value[0]}\" operator must have 2 elements`));\r\n        } else if (type !== 'string') {\r\n            errors.push(new ValidationError(`${key}[1]`, value[1], `string expected, ${type} found`));\r\n        }\r\n        break;\r\n\r\n    }\r\n\r\n    return errors;\r\n}\r\n","\r\nconst ValidationError = require('../error/validation_error');\r\nconst getType = require('../util/get_type');\r\nconst validate = require('./validate');\r\nconst validateObject = require('./validate_object');\r\nconst validateArray = require('./validate_array');\r\nconst validateNumber = require('./validate_number');\r\nconst unbundle = require('../util/unbundle_jsonlint');\r\n\r\nmodule.exports = function validateFunction(options) {\r\n    const functionValueSpec = options.valueSpec;\r\n    const functionType = unbundle(options.value.type);\r\n    let stopKeyType;\r\n    let stopDomainValues = {};\r\n    let previousStopDomainValue;\r\n    let previousStopDomainZoom;\r\n\r\n    const isZoomFunction = functionType !== 'categorical' && options.value.property === undefined;\r\n    const isPropertyFunction = !isZoomFunction;\r\n    const isZoomAndPropertyFunction =\r\n        getType(options.value.stops) === 'array' &&\r\n        getType(options.value.stops[0]) === 'array' &&\r\n        getType(options.value.stops[0][0]) === 'object';\r\n\r\n    const errors = validateObject({\r\n        key: options.key,\r\n        value: options.value,\r\n        valueSpec: options.styleSpec.function,\r\n        style: options.style,\r\n        styleSpec: options.styleSpec,\r\n        objectElementValidators: {\r\n            stops: validateFunctionStops,\r\n            default: validateFunctionDefault\r\n        }\r\n    });\r\n\r\n    if (functionType === 'identity' && isZoomFunction) {\r\n        errors.push(new ValidationError(options.key, options.value, 'missing required property \"property\"'));\r\n    }\r\n\r\n    if (functionType !== 'identity' && !options.value.stops) {\r\n        errors.push(new ValidationError(options.key, options.value, 'missing required property \"stops\"'));\r\n    }\r\n\r\n    if (functionType === 'exponential' && options.valueSpec['function'] === 'piecewise-constant') {\r\n        errors.push(new ValidationError(options.key, options.value, 'exponential functions not supported'));\r\n    }\r\n\r\n    if (options.styleSpec.$version >= 8) {\r\n        if (isPropertyFunction && !options.valueSpec['property-function']) {\r\n            errors.push(new ValidationError(options.key, options.value, 'property functions not supported'));\r\n        } else if (isZoomFunction && !options.valueSpec['zoom-function'] && options.objectKey !== 'heatmap-color') {\r\n            errors.push(new ValidationError(options.key, options.value, 'zoom functions not supported'));\r\n        }\r\n    }\r\n\r\n    if ((functionType === 'categorical' || isZoomAndPropertyFunction) && options.value.property === undefined) {\r\n        errors.push(new ValidationError(options.key, options.value, '\"property\" property is required'));\r\n    }\r\n\r\n    return errors;\r\n\r\n    function validateFunctionStops(options) {\r\n        if (functionType === 'identity') {\r\n            return [new ValidationError(options.key, options.value, 'identity function may not have a \"stops\" property')];\r\n        }\r\n\r\n        let errors = [];\r\n        const value = options.value;\r\n\r\n        errors = errors.concat(validateArray({\r\n            key: options.key,\r\n            value: value,\r\n            valueSpec: options.valueSpec,\r\n            style: options.style,\r\n            styleSpec: options.styleSpec,\r\n            arrayElementValidator: validateFunctionStop\r\n        }));\r\n\r\n        if (getType(value) === 'array' && value.length === 0) {\r\n            errors.push(new ValidationError(options.key, value, 'array must have at least one stop'));\r\n        }\r\n\r\n        return errors;\r\n    }\r\n\r\n    function validateFunctionStop(options) {\r\n        let errors = [];\r\n        const value = options.value;\r\n        const key = options.key;\r\n\r\n        if (getType(value) !== 'array') {\r\n            return [new ValidationError(key, value, `array expected, ${getType(value)} found`)];\r\n        }\r\n\r\n        if (value.length !== 2) {\r\n            return [new ValidationError(key, value, `array length 2 expected, length ${value.length} found`)];\r\n        }\r\n\r\n        if (isZoomAndPropertyFunction) {\r\n            if (getType(value[0]) !== 'object') {\r\n                return [new ValidationError(key, value, `object expected, ${getType(value[0])} found`)];\r\n            }\r\n            if (value[0].zoom === undefined) {\r\n                return [new ValidationError(key, value, 'object stop key must have zoom')];\r\n            }\r\n            if (value[0].value === undefined) {\r\n                return [new ValidationError(key, value, 'object stop key must have value')];\r\n            }\r\n            if (previousStopDomainZoom && previousStopDomainZoom > unbundle(value[0].zoom)) {\r\n                return [new ValidationError(key, value[0].zoom, 'stop zoom values must appear in ascending order')];\r\n            }\r\n            if (unbundle(value[0].zoom) !== previousStopDomainZoom) {\r\n                previousStopDomainZoom = unbundle(value[0].zoom);\r\n                previousStopDomainValue = undefined;\r\n                stopDomainValues = {};\r\n            }\r\n            errors = errors.concat(validateObject({\r\n                key: `${key}[0]`,\r\n                value: value[0],\r\n                valueSpec: { zoom: {} },\r\n                style: options.style,\r\n                styleSpec: options.styleSpec,\r\n                objectElementValidators: { zoom: validateNumber, value: validateStopDomainValue }\r\n            }));\r\n        } else {\r\n            errors = errors.concat(validateStopDomainValue({\r\n                key: `${key}[0]`,\r\n                value: value[0],\r\n                valueSpec: {},\r\n                style: options.style,\r\n                styleSpec: options.styleSpec\r\n            }, value));\r\n        }\r\n\r\n        return errors.concat(validate({\r\n            key: `${key}[1]`,\r\n            value: value[1],\r\n            valueSpec: functionValueSpec,\r\n            style: options.style,\r\n            styleSpec: options.styleSpec\r\n        }));\r\n    }\r\n\r\n    function validateStopDomainValue(options, stop) {\r\n        const type = getType(options.value);\r\n        const value = unbundle(options.value);\r\n\r\n        const reportValue = options.value !== null ? options.value : stop;\r\n\r\n        if (!stopKeyType) {\r\n            stopKeyType = type;\r\n        } else if (type !== stopKeyType) {\r\n            return [new ValidationError(options.key, reportValue, `${type} stop domain type must match previous stop domain type ${stopKeyType}`)];\r\n        }\r\n\r\n        if (type !== 'number' && type !== 'string' && type !== 'boolean') {\r\n            return [new ValidationError(options.key, reportValue, 'stop domain value must be a number, string, or boolean')];\r\n        }\r\n\r\n        if (type !== 'number' && functionType !== 'categorical') {\r\n            let message = `number expected, ${type} found`;\r\n            if (functionValueSpec['property-function'] && functionType === undefined) {\r\n                message += '\\nIf you intended to use a categorical function, specify `\"type\": \"categorical\"`.';\r\n            }\r\n            return [new ValidationError(options.key, reportValue, message)];\r\n        }\r\n\r\n        if (functionType === 'categorical' && type === 'number' && (!isFinite(value) || Math.floor(value) !== value)) {\r\n            return [new ValidationError(options.key, reportValue, `integer expected, found ${value}`)];\r\n        }\r\n\r\n        if (functionType !== 'categorical' && type === 'number' && previousStopDomainValue !== undefined && value < previousStopDomainValue) {\r\n            return [new ValidationError(options.key, reportValue, 'stop domain values must appear in ascending order')];\r\n        } else {\r\n            previousStopDomainValue = value;\r\n        }\r\n\r\n        if (functionType === 'categorical' && value in stopDomainValues) {\r\n            return [new ValidationError(options.key, reportValue, 'stop domain values must be unique')];\r\n        } else {\r\n            stopDomainValues[value] = true;\r\n        }\r\n\r\n        return [];\r\n    }\r\n\r\n    function validateFunctionDefault(options) {\r\n        return validate({\r\n            key: options.key,\r\n            value: options.value,\r\n            valueSpec: functionValueSpec,\r\n            style: options.style,\r\n            styleSpec: options.styleSpec\r\n        });\r\n    }\r\n};\r\n","\r\nconst ValidationError = require('../error/validation_error');\r\nconst validateString = require('./validate_string');\r\n\r\nmodule.exports = function(options) {\r\n    const value = options.value;\r\n    const key = options.key;\r\n\r\n    const errors = validateString(options);\r\n    if (errors.length) return errors;\r\n\r\n    if (value.indexOf('{fontstack}') === -1) {\r\n        errors.push(new ValidationError(key, value, '\"glyphs\" url must include a \"{fontstack}\" token'));\r\n    }\r\n\r\n    if (value.indexOf('{range}') === -1) {\r\n        errors.push(new ValidationError(key, value, '\"glyphs\" url must include a \"{range}\" token'));\r\n    }\r\n\r\n    return errors;\r\n};\r\n","\r\nconst ValidationError = require('../error/validation_error');\r\nconst unbundle = require('../util/unbundle_jsonlint');\r\nconst validateObject = require('./validate_object');\r\nconst validateFilter = require('./validate_filter');\r\nconst validatePaintProperty = require('./validate_paint_property');\r\nconst validateLayoutProperty = require('./validate_layout_property');\r\nconst validateSpec = require('./validate');\r\nconst extend = require('../util/extend');\r\n\r\nmodule.exports = function validateLayer(options) {\r\n    let errors = [];\r\n\r\n    const layer = options.value;\r\n    const key = options.key;\r\n    const style = options.style;\r\n    const styleSpec = options.styleSpec;\r\n\r\n    if (!layer.type && !layer.ref) {\r\n        errors.push(new ValidationError(key, layer, 'either \"type\" or \"ref\" is required'));\r\n    }\r\n    let type = unbundle(layer.type);\r\n    const ref = unbundle(layer.ref);\r\n\r\n    if (layer.id) {\r\n        const layerId = unbundle(layer.id);\r\n        for (let i = 0; i < options.arrayIndex; i++) {\r\n            const otherLayer = style.layers[i];\r\n            if (unbundle(otherLayer.id) === layerId) {\r\n                errors.push(new ValidationError(key, layer.id, `duplicate layer id \"${layer.id}\", previously used at line ${otherLayer.id.__line__}`));\r\n            }\r\n        }\r\n    }\r\n\r\n    if ('ref' in layer) {\r\n        ['type', 'source', 'source-layer', 'filter', 'layout'].forEach((p) => {\r\n            if (p in layer) {\r\n                errors.push(new ValidationError(key, layer[p], `\"${p}\" is prohibited for ref layers`));\r\n            }\r\n        });\r\n\r\n        let parent;\r\n\r\n        style.layers.forEach((layer) => {\r\n            if (unbundle(layer.id) === ref) parent = layer;\r\n        });\r\n\r\n        if (!parent) {\r\n            errors.push(new ValidationError(key, layer.ref, `ref layer \"${ref}\" not found`));\r\n        } else if (parent.ref) {\r\n            errors.push(new ValidationError(key, layer.ref, 'ref cannot reference another ref layer'));\r\n        } else {\r\n            type = unbundle(parent.type);\r\n        }\r\n    } else if (type !== 'background') {\r\n        if (!layer.source) {\r\n            errors.push(new ValidationError(key, layer, 'missing required property \"source\"'));\r\n        } else {\r\n            const source = style.sources && style.sources[layer.source];\r\n            const sourceType = source && unbundle(source.type);\r\n            if (!source) {\r\n                errors.push(new ValidationError(key, layer.source, `source \"${layer.source}\" not found`));\r\n            } else if (sourceType === 'vector' && type === 'raster') {\r\n                errors.push(new ValidationError(key, layer.source, `layer \"${layer.id}\" requires a raster source`));\r\n            } else if (sourceType === 'raster' && type !== 'raster') {\r\n                errors.push(new ValidationError(key, layer.source, `layer \"${layer.id}\" requires a vector source`));\r\n            } else if (sourceType === 'vector' && !layer['source-layer']) {\r\n                errors.push(new ValidationError(key, layer, `layer \"${layer.id}\" must specify a \"source-layer\"`));\r\n            } else if (sourceType === 'raster-dem' && type !== 'hillshade') {\r\n                errors.push(new ValidationError(key, layer.source, 'raster-dem source can only be used with layer type \\'hillshade\\'.'));\r\n            }\r\n        }\r\n    }\r\n\r\n    errors = errors.concat(validateObject({\r\n        key: key,\r\n        value: layer,\r\n        valueSpec: styleSpec.layer,\r\n        style: options.style,\r\n        styleSpec: options.styleSpec,\r\n        objectElementValidators: {\r\n            '*': function() {\r\n                return [];\r\n            },\r\n            // We don't want to enforce the spec's `\"requires\": true` for backward compatibility with refs;\r\n            // the actual requirement is validated above. See https://github.com/mapbox/mapbox-gl-js/issues/5772.\r\n            type: function() {\r\n                return validateSpec({\r\n                    key: `${key}.type`,\r\n                    value: layer.type,\r\n                    valueSpec: styleSpec.layer.type,\r\n                    style: options.style,\r\n                    styleSpec: options.styleSpec,\r\n                    object: layer,\r\n                    objectKey: 'type'\r\n                });\r\n            },\r\n            filter: validateFilter,\r\n            layout: function(options) {\r\n                return validateObject({\r\n                    layer: layer,\r\n                    key: options.key,\r\n                    value: options.value,\r\n                    style: options.style,\r\n                    styleSpec: options.styleSpec,\r\n                    objectElementValidators: {\r\n                        '*': function(options) {\r\n                            return validateLayoutProperty(extend({layerType: type}, options));\r\n                        }\r\n                    }\r\n                });\r\n            },\r\n            paint: function(options) {\r\n                return validateObject({\r\n                    layer: layer,\r\n                    key: options.key,\r\n                    value: options.value,\r\n                    style: options.style,\r\n                    styleSpec: options.styleSpec,\r\n                    objectElementValidators: {\r\n                        '*': function(options) {\r\n                            return validatePaintProperty(extend({layerType: type}, options));\r\n                        }\r\n                    }\r\n                });\r\n            }\r\n        }\r\n    }));\r\n\r\n    return errors;\r\n};\r\n","\r\nconst validateProperty = require('./validate_property');\r\n\r\nmodule.exports = function validateLayoutProperty(options) {\r\n    return validateProperty(options, 'layout');\r\n};\r\n","\r\nconst ValidationError = require('../error/validation_error');\r\nconst getType = require('../util/get_type');\r\nconst validate = require('./validate');\r\n\r\nmodule.exports = function validateLight(options) {\r\n    const light = options.value;\r\n    const styleSpec = options.styleSpec;\r\n    const lightSpec = styleSpec.light;\r\n    const style = options.style;\r\n\r\n    let errors = [];\r\n\r\n    const rootType = getType(light);\r\n    if (light === undefined) {\r\n        return errors;\r\n    } else if (rootType !== 'object') {\r\n        errors = errors.concat([new ValidationError('light', light, `object expected, ${rootType} found`)]);\r\n        return errors;\r\n    }\r\n\r\n    for (const key in light) {\r\n        const transitionMatch = key.match(/^(.*)-transition$/);\r\n\r\n        if (transitionMatch && lightSpec[transitionMatch[1]] && lightSpec[transitionMatch[1]].transition) {\r\n            errors = errors.concat(validate({\r\n                key: key,\r\n                value: light[key],\r\n                valueSpec: styleSpec.transition,\r\n                style: style,\r\n                styleSpec: styleSpec\r\n            }));\r\n        } else if (lightSpec[key]) {\r\n            errors = errors.concat(validate({\r\n                key: key,\r\n                value: light[key],\r\n                valueSpec: lightSpec[key],\r\n                style: style,\r\n                styleSpec: styleSpec\r\n            }));\r\n        } else {\r\n            errors = errors.concat([new ValidationError(key, light[key], `unknown property \"${key}\"`)]);\r\n        }\r\n    }\r\n\r\n    return errors;\r\n};\r\n","\r\nconst getType = require('../util/get_type');\r\nconst ValidationError = require('../error/validation_error');\r\n\r\nmodule.exports = function validateNumber(options) {\r\n    const key = options.key;\r\n    const value = options.value;\r\n    const valueSpec = options.valueSpec;\r\n    const type = getType(value);\r\n\r\n    if (type !== 'number') {\r\n        return [new ValidationError(key, value, `number expected, ${type} found`)];\r\n    }\r\n\r\n    if ('minimum' in valueSpec && value < valueSpec.minimum) {\r\n        return [new ValidationError(key, value, `${value} is less than the minimum value ${valueSpec.minimum}`)];\r\n    }\r\n\r\n    if ('maximum' in valueSpec && value > valueSpec.maximum) {\r\n        return [new ValidationError(key, value, `${value} is greater than the maximum value ${valueSpec.maximum}`)];\r\n    }\r\n\r\n    return [];\r\n};\r\n","\r\nconst ValidationError = require('../error/validation_error');\r\nconst getType = require('../util/get_type');\r\nconst validateSpec = require('./validate');\r\n\r\nmodule.exports = function validateObject(options) {\r\n    const key = options.key;\r\n    const object = options.value;\r\n    const elementSpecs = options.valueSpec || {};\r\n    const elementValidators = options.objectElementValidators || {};\r\n    const style = options.style;\r\n    const styleSpec = options.styleSpec;\r\n    let errors = [];\r\n\r\n    const type = getType(object);\r\n    if (type !== 'object') {\r\n        return [new ValidationError(key, object, `object expected, ${type} found`)];\r\n    }\r\n\r\n    for (const objectKey in object) {\r\n        const elementSpecKey = objectKey.split('.')[0]; // treat 'paint.*' as 'paint'\r\n        const elementSpec = elementSpecs[elementSpecKey] || elementSpecs['*'];\r\n\r\n        let validateElement;\r\n        if (elementValidators[elementSpecKey]) {\r\n            validateElement = elementValidators[elementSpecKey];\r\n        } else if (elementSpecs[elementSpecKey]) {\r\n            validateElement = validateSpec;\r\n        } else if (elementValidators['*']) {\r\n            validateElement = elementValidators['*'];\r\n        } else if (elementSpecs['*']) {\r\n            validateElement = validateSpec;\r\n        } else {\r\n            errors.push(new ValidationError(key, object[objectKey], `unknown property \"${objectKey}\"`));\r\n            continue;\r\n        }\r\n\r\n        errors = errors.concat(validateElement({\r\n            key: (key ? `${key}.` : key) + objectKey,\r\n            value: object[objectKey],\r\n            valueSpec: elementSpec,\r\n            style: style,\r\n            styleSpec: styleSpec,\r\n            object: object,\r\n            objectKey: objectKey\r\n        }, object));\r\n    }\r\n\r\n    for (const elementSpecKey in elementSpecs) {\r\n        // Don't check `required` when there's a custom validator for that property.\r\n        if (elementValidators[elementSpecKey]) {\r\n            continue;\r\n        }\r\n\r\n        if (elementSpecs[elementSpecKey].required && elementSpecs[elementSpecKey]['default'] === undefined && object[elementSpecKey] === undefined) {\r\n            errors.push(new ValidationError(key, object, `missing required property \"${elementSpecKey}\"`));\r\n        }\r\n    }\r\n\r\n    return errors;\r\n};\r\n","\r\nconst validateProperty = require('./validate_property');\r\n\r\nmodule.exports = function validatePaintProperty(options) {\r\n    return validateProperty(options, 'paint');\r\n};\r\n","\r\nconst validate = require('./validate');\r\nconst ValidationError = require('../error/validation_error');\r\nconst getType = require('../util/get_type');\r\nconst {isFunction} = require('../function');\r\nconst unbundle = require('../util/unbundle_jsonlint');\r\n\r\nmodule.exports = function validateProperty(options, propertyType) {\r\n    const key = options.key;\r\n    const style = options.style;\r\n    const styleSpec = options.styleSpec;\r\n    const value = options.value;\r\n    const propertyKey = options.objectKey;\r\n    const layerSpec = styleSpec[`${propertyType}_${options.layerType}`];\r\n\r\n    if (!layerSpec) return [];\r\n\r\n    const transitionMatch = propertyKey.match(/^(.*)-transition$/);\r\n    if (propertyType === 'paint' && transitionMatch && layerSpec[transitionMatch[1]] && layerSpec[transitionMatch[1]].transition) {\r\n        return validate({\r\n            key: key,\r\n            value: value,\r\n            valueSpec: styleSpec.transition,\r\n            style: style,\r\n            styleSpec: styleSpec\r\n        });\r\n    }\r\n\r\n    const valueSpec = options.valueSpec || layerSpec[propertyKey];\r\n    if (!valueSpec) {\r\n        return [new ValidationError(key, value, `unknown property \"${propertyKey}\"`)];\r\n    }\r\n\r\n    let tokenMatch;\r\n    if (getType(value) === 'string' && valueSpec['property-function'] && !valueSpec.tokens && (tokenMatch = /^{([^}]+)}$/.exec(value))) {\r\n        return [new ValidationError(\r\n            key, value,\r\n            `\"${propertyKey}\" does not support interpolation syntax\\n` +\r\n                `Use an identity property function instead: \\`{ \"type\": \"identity\", \"property\": ${JSON.stringify(tokenMatch[1])} }\\`.`)];\r\n    }\r\n\r\n    const errors = [];\r\n\r\n    if (options.layerType === 'symbol') {\r\n        if (propertyKey === 'text-field' && style && !style.glyphs) {\r\n            errors.push(new ValidationError(key, value, 'use of \"text-field\" requires a style \"glyphs\" property'));\r\n        }\r\n        if (propertyKey === 'text-font' && isFunction(unbundle.deep(value)) && unbundle(value.type) === 'identity') {\r\n            errors.push(new ValidationError(key, value, '\"text-font\" does not support identity functions'));\r\n        }\r\n    }\r\n\r\n    return errors.concat(validate({\r\n        key: options.key,\r\n        value: value,\r\n        valueSpec: valueSpec,\r\n        style: style,\r\n        styleSpec: styleSpec,\r\n        expressionContext: 'property',\r\n        propertyKey\r\n    }));\r\n};\r\n","\r\nconst ValidationError = require('../error/validation_error');\r\nconst unbundle = require('../util/unbundle_jsonlint');\r\nconst validateObject = require('./validate_object');\r\nconst validateEnum = require('./validate_enum');\r\n\r\nmodule.exports = function validateSource(options) {\r\n    const value = options.value;\r\n    const key = options.key;\r\n    const styleSpec = options.styleSpec;\r\n    const style = options.style;\r\n\r\n    if (!value.type) {\r\n        return [new ValidationError(key, value, '\"type\" is required')];\r\n    }\r\n\r\n    const type = unbundle(value.type);\r\n    let errors = [];\r\n\r\n    switch (type) {\r\n    case 'vector':\r\n    case 'raster':\r\n    case 'raster-dem':\r\n        errors = errors.concat(validateObject({\r\n            key: key,\r\n            value: value,\r\n            valueSpec: styleSpec[`source_${type.replace('-', '_')}`],\r\n            style: options.style,\r\n            styleSpec: styleSpec\r\n        }));\r\n        if ('url' in value) {\r\n            for (const prop in value) {\r\n                if (['type', 'url', 'tileSize'].indexOf(prop) < 0) {\r\n                    errors.push(new ValidationError(`${key}.${prop}`, value[prop], `a source with a \"url\" property may not include a \"${prop}\" property`));\r\n                }\r\n            }\r\n        }\r\n        return errors;\r\n\r\n    case 'geojson':\r\n        return validateObject({\r\n            key: key,\r\n            value: value,\r\n            valueSpec: styleSpec.source_geojson,\r\n            style: style,\r\n            styleSpec: styleSpec\r\n        });\r\n\r\n    case 'video':\r\n        return validateObject({\r\n            key: key,\r\n            value: value,\r\n            valueSpec: styleSpec.source_video,\r\n            style: style,\r\n            styleSpec: styleSpec\r\n        });\r\n\r\n    case 'image':\r\n        return validateObject({\r\n            key: key,\r\n            value: value,\r\n            valueSpec: styleSpec.source_image,\r\n            style: style,\r\n            styleSpec: styleSpec\r\n        });\r\n\r\n    case 'canvas':\r\n        return validateObject({\r\n            key: key,\r\n            value: value,\r\n            valueSpec: styleSpec.source_canvas,\r\n            style: style,\r\n            styleSpec: styleSpec\r\n        });\r\n\r\n    default:\r\n        return validateEnum({\r\n            key: `${key}.type`,\r\n            value: value.type,\r\n            valueSpec: {values: ['vector', 'raster', 'raster-dem', 'geojson', 'video', 'image', 'canvas']},\r\n            style: style,\r\n            styleSpec: styleSpec\r\n        });\r\n    }\r\n};\r\n","\r\nconst getType = require('../util/get_type');\r\nconst ValidationError = require('../error/validation_error');\r\n\r\nmodule.exports = function validateString(options) {\r\n    const value = options.value;\r\n    const key = options.key;\r\n    const type = getType(value);\r\n\r\n    if (type !== 'string') {\r\n        return [new ValidationError(key, value, `string expected, ${type} found`)];\r\n    }\r\n\r\n    return [];\r\n};\r\n","\r\nconst validateConstants = require('./validate/validate_constants');\r\nconst validate = require('./validate/validate');\r\nconst latestStyleSpec = require('./reference/latest');\r\nconst validateGlyphsURL = require('./validate/validate_glyphs_url');\r\n\r\n/**\r\n * Validate a Mapbox GL style against the style specification. This entrypoint,\r\n * `mapbox-gl-style-spec/lib/validate_style.min`, is designed to produce as\r\n * small a browserify bundle as possible by omitting unnecessary functionality\r\n * and legacy style specifications.\r\n *\r\n * @private\r\n * @param {Object} style The style to be validated.\r\n * @param {Object} [styleSpec] The style specification to validate against.\r\n *     If omitted, the latest style spec is used.\r\n * @returns {Array<ValidationError>}\r\n * @example\r\n *   var validate = require('mapbox-gl-style-spec/lib/validate_style.min');\r\n *   var errors = validate(style);\r\n */\r\nfunction validateStyleMin(style, styleSpec) {\r\n    styleSpec = styleSpec || latestStyleSpec;\r\n\r\n    let errors = [];\r\n\r\n    errors = errors.concat(validate({\r\n        key: '',\r\n        value: style,\r\n        valueSpec: styleSpec.$root,\r\n        styleSpec: styleSpec,\r\n        style: style,\r\n        objectElementValidators: {\r\n            glyphs: validateGlyphsURL,\r\n            '*': function() {\r\n                return [];\r\n            }\r\n        }\r\n    }));\r\n\r\n    if (style.constants) {\r\n        errors = errors.concat(validateConstants({\r\n            key: 'constants',\r\n            value: style.constants,\r\n            style: style,\r\n            styleSpec: styleSpec\r\n        }));\r\n    }\r\n\r\n    return sortErrors(errors);\r\n}\r\n\r\nvalidateStyleMin.source = wrapCleanErrors(require('./validate/validate_source'));\r\nvalidateStyleMin.light = wrapCleanErrors(require('./validate/validate_light'));\r\nvalidateStyleMin.layer = wrapCleanErrors(require('./validate/validate_layer'));\r\nvalidateStyleMin.filter = wrapCleanErrors(require('./validate/validate_filter'));\r\nvalidateStyleMin.paintProperty = wrapCleanErrors(require('./validate/validate_paint_property'));\r\nvalidateStyleMin.layoutProperty = wrapCleanErrors(require('./validate/validate_layout_property'));\r\n\r\nfunction sortErrors(errors) {\r\n    return [].concat(errors).sort((a, b) => {\r\n        return a.line - b.line;\r\n    });\r\n}\r\n\r\nfunction wrapCleanErrors(inner) {\r\n    return function() {\r\n        return sortErrors(inner.apply(this, arguments));\r\n    };\r\n}\r\n\r\nmodule.exports = validateStyleMin;\r\n","// @flow\r\n\r\nconst ZoomHistory = require('./zoom_history');\r\n\r\nclass EvaluationParameters {\r\n    zoom: number;\r\n    now: number;\r\n    fadeDuration: number;\r\n    zoomHistory: ZoomHistory;\r\n    transition: TransitionSpecification;\r\n\r\n    constructor(zoom: number, options?: *) {\r\n        this.zoom = zoom;\r\n\r\n        if (options) {\r\n            this.now = options.now;\r\n            this.fadeDuration = options.fadeDuration;\r\n            this.zoomHistory = options.zoomHistory;\r\n            this.transition = options.transition;\r\n        } else {\r\n            this.now = 0;\r\n            this.fadeDuration = 0;\r\n            this.zoomHistory = new ZoomHistory();\r\n            this.transition = {};\r\n        }\r\n    }\r\n\r\n    crossFadingFactor() {\r\n        if (this.fadeDuration === 0) {\r\n            return 1;\r\n        } else {\r\n            return Math.min((this.now - this.zoomHistory.lastIntegerZoomTime) / this.fadeDuration, 1);\r\n        }\r\n    }\r\n}\r\n\r\nmodule.exports = EvaluationParameters;\r\n","// @flow\r\n\r\nconst {AlphaImage} = require('../util/image');\r\nconst Protobuf = require('pbf');\r\nconst border = 3;\r\n\r\nimport type {StyleGlyph} from './style_glyph';\r\n\r\nfunction readFontstacks(tag: number, glyphs: Array<StyleGlyph>, pbf: Protobuf) {\r\n    if (tag === 1) {\r\n        pbf.readMessage(readFontstack, glyphs);\r\n    }\r\n}\r\n\r\nfunction readFontstack(tag: number, glyphs: Array<StyleGlyph>, pbf: Protobuf) {\r\n    if (tag === 3) {\r\n        const {id, bitmap, width, height, left, top, advance} = pbf.readMessage(readGlyph, {});\r\n        glyphs.push({\r\n            id,\r\n            bitmap: new AlphaImage({\r\n                width: width + 2 * border,\r\n                height: height + 2 * border\r\n            }, bitmap),\r\n            metrics: {width, height, left, top, advance}\r\n        });\r\n    }\r\n}\r\n\r\nfunction readGlyph(tag: number, glyph: Object, pbf: Protobuf) {\r\n    if (tag === 1) glyph.id = pbf.readVarint();\r\n    else if (tag === 2) glyph.bitmap = pbf.readBytes();\r\n    else if (tag === 3) glyph.width = pbf.readVarint();\r\n    else if (tag === 4) glyph.height = pbf.readVarint();\r\n    else if (tag === 5) glyph.left = pbf.readSVarint();\r\n    else if (tag === 6) glyph.top = pbf.readSVarint();\r\n    else if (tag === 7) glyph.advance = pbf.readVarint();\r\n}\r\n\r\nmodule.exports = function (data: ArrayBuffer | Uint8Array): Array<StyleGlyph> {\r\n    return new Protobuf(data).readFields(readFontstacks, []);\r\n};\r\n\r\nmodule.exports.GLYPH_PBF_BORDER = border;\r\n","// @flow\r\n\r\nconst assert = require('assert');\r\nconst {clone, extend, easeCubicInOut} = require('../util/util');\r\nconst interpolate = require('../style-spec/util/interpolate');\r\nconst {normalizePropertyExpression} = require('../style-spec/expression');\r\nconst Color = require('../style-spec/util/color');\r\nconst {register} = require('../util/web_worker_transfer');\r\n\r\nimport type {StylePropertySpecification} from '../style-spec/style-spec';\r\nimport type {CrossFaded} from './cross_faded';\r\nimport type EvaluationParameters from './evaluation_parameters';\r\n\r\nimport type {\r\n    Feature,\r\n    GlobalProperties,\r\n    StylePropertyExpression,\r\n    SourceExpression,\r\n    CompositeExpression\r\n} from '../style-spec/expression';\r\n\r\ntype TimePoint = number;\r\n\r\n/**\r\n * Implements a number of classes that define state and behavior for paint and layout properties, most\r\n * importantly their respective evaluation chains:\r\n *\r\n *       Transitionable paint property value\r\n *     → Transitioning paint property value\r\n *     → Possibly evaluated paint property value\r\n *     → Fully evaluated paint property value\r\n *\r\n *       Layout property value\r\n *     → Possibly evaluated layout property value\r\n *     → Fully evaluated layout property value\r\n *\r\n * @module\r\n * @private\r\n */\r\n\r\n/**\r\n *  Implementations of the `Property` interface:\r\n *\r\n *  * Hold metadata about a property that's independent of any specific value: stuff like the type of the value,\r\n *    the default value, etc. This comes from the style specification JSON.\r\n *  * Define behavior that needs to be polymorphic across different properties: \"possibly evaluating\"\r\n *    an input value (see below), and interpolating between two possibly-evaluted values.\r\n *\r\n *  The type `T` is the fully-evaluated value type (e.g. `number`, `string`, `Color`).\r\n *  The type `R` is the intermediate \"possibly evaluated\" value type. See below.\r\n *\r\n *  There are two main implementations of the interface -- one for properties that allow data-driven values,\r\n *  and one for properties that don't. There are a few \"special case\" implementations as well: one for properties\r\n *  which cross-fade between two values rather than interpolating, one for `heatmap-color`, and one for\r\n *  `light-position`.\r\n *\r\n * @private\r\n */\r\nexport interface Property<T, R> {\r\n    specification: StylePropertySpecification;\r\n    possiblyEvaluate(value: PropertyValue<T, R>, parameters: EvaluationParameters): R;\r\n    interpolate(a: R, b: R, t: number): R;\r\n}\r\n\r\n/**\r\n *  `PropertyValue` represents the value part of a property key-value unit. It's used to represent both\r\n *  paint and layout property values, and regardless of whether or not their property supports data-driven\r\n *  expressions.\r\n *\r\n *  `PropertyValue` stores the raw input value as seen in a style or a runtime styling API call, i.e. one of the\r\n *  following:\r\n *\r\n *    * A constant value of the type appropriate for the property\r\n *    * A function which produces a value of that type (but functions are quasi-deprecated in favor of expressions)\r\n *    * An expression which produces a value of that type\r\n *    * \"undefined\"/\"not present\", in which case the property is assumed to take on its default value.\r\n *\r\n *  In addition to storing the original input value, `PropertyValue` also stores a normalized representation,\r\n *  effectively treating functions as if they are expressions, and constant or default values as if they are\r\n *  (constant) expressions.\r\n *\r\n *  @private\r\n */\r\nclass PropertyValue<T, R> {\r\n    property: Property<T, R>;\r\n    value: PropertyValueSpecification<T> | void;\r\n    expression: StylePropertyExpression;\r\n\r\n    constructor(property: Property<T, R>, value: PropertyValueSpecification<T> | void) {\r\n        this.property = property;\r\n        this.value = value;\r\n        this.expression = normalizePropertyExpression(value === undefined ? property.specification.default : value, property.specification);\r\n    }\r\n\r\n    isDataDriven(): boolean {\r\n        return this.expression.kind === 'source' || this.expression.kind === 'composite';\r\n    }\r\n\r\n    possiblyEvaluate(parameters: EvaluationParameters): R {\r\n        return this.property.possiblyEvaluate(this, parameters);\r\n    }\r\n}\r\n\r\n// ------- Transitionable -------\r\n\r\nexport type TransitionParameters = {\r\n    now: TimePoint,\r\n    transition: TransitionSpecification\r\n};\r\n\r\n/**\r\n * Paint properties are _transitionable_: they can change in a fluid manner, interpolating or cross-fading between\r\n * old and new value. The duration of the transition, and the delay before it begins, is configurable.\r\n *\r\n * `TransitionablePropertyValue` is a compositional class that stores both the property value and that transition\r\n * configuration.\r\n *\r\n * A `TransitionablePropertyValue` can calculate the next step in the evaluation chain for paint property values:\r\n * `TransitioningPropertyValue`.\r\n *\r\n * @private\r\n */\r\nclass TransitionablePropertyValue<T, R> {\r\n    property: Property<T, R>;\r\n    value: PropertyValue<T, R>;\r\n    transition: TransitionSpecification | void;\r\n\r\n    constructor(property: Property<T, R>) {\r\n        this.property = property;\r\n        this.value = new PropertyValue(property, undefined);\r\n    }\r\n\r\n    transitioned(parameters: TransitionParameters,\r\n                 prior: TransitioningPropertyValue<T, R>): TransitioningPropertyValue<T, R> {\r\n        return new TransitioningPropertyValue(this.property, this.value, prior, // eslint-disable-line no-use-before-define\r\n            extend({}, parameters.transition, this.transition), parameters.now);\r\n    }\r\n\r\n    untransitioned(): TransitioningPropertyValue<T, R> {\r\n        return new TransitioningPropertyValue(this.property, this.value, null, {}, 0); // eslint-disable-line no-use-before-define\r\n    }\r\n}\r\n\r\n/**\r\n * A helper type: given an object type `Properties` whose values are each of type `Property<T, R>`, it calculates\r\n * an object type with the same keys and values of type `TransitionablePropertyValue<T, R>`.\r\n *\r\n * @private\r\n */\r\ntype TransitionablePropertyValues<Props: Object>\r\n    = $Exact<$ObjMap<Props, <T, R>(p: Property<T, R>) => TransitionablePropertyValue<T, R>>>\r\n\r\n/**\r\n * `Transitionable` stores a map of all (property name, `TransitionablePropertyValue`) pairs for paint properties of a\r\n * given layer type. It can calculate the `TransitioningPropertyValue`s for all of them at once, producing a\r\n * `Transitioning` instance for the same set of properties.\r\n *\r\n * @private\r\n */\r\nclass Transitionable<Props: Object> {\r\n    _properties: Properties<Props>;\r\n    _values: TransitionablePropertyValues<Props>;\r\n\r\n    constructor(properties: Properties<Props>) {\r\n        this._properties = properties;\r\n        this._values = (Object.create(properties.defaultTransitionablePropertyValues): any);\r\n    }\r\n\r\n    getValue<S: string, T>(name: S): PropertyValueSpecification<T> | void {\r\n        return clone(this._values[name].value.value);\r\n    }\r\n\r\n    setValue<S: string, T>(name: S, value: PropertyValueSpecification<T> | void) {\r\n        if (!this._values.hasOwnProperty(name)) {\r\n            this._values[name] = new TransitionablePropertyValue(this._values[name].property);\r\n        }\r\n        // Note that we do not _remove_ an own property in the case where a value is being reset\r\n        // to the default: the transition might still be non-default.\r\n        this._values[name].value = new PropertyValue(this._values[name].property, value === null ? undefined : clone(value));\r\n    }\r\n\r\n    getTransition<S: string>(name: S): TransitionSpecification | void {\r\n        return clone(this._values[name].transition);\r\n    }\r\n\r\n    setTransition<S: string>(name: S, value: TransitionSpecification | void) {\r\n        if (!this._values.hasOwnProperty(name)) {\r\n            this._values[name] = new TransitionablePropertyValue(this._values[name].property);\r\n        }\r\n        this._values[name].transition = clone(value) || undefined;\r\n    }\r\n\r\n    serialize() {\r\n        const result: any = {};\r\n        for (const property of Object.keys(this._values)) {\r\n            const value = this.getValue(property);\r\n            if (value !== undefined) {\r\n                result[property] = value;\r\n            }\r\n\r\n            const transition = this.getTransition(property);\r\n            if (transition !== undefined) {\r\n                result[`${property}-transition`] = transition;\r\n            }\r\n        }\r\n        return result;\r\n    }\r\n\r\n    transitioned(parameters: TransitionParameters, prior: Transitioning<Props>): Transitioning<Props> {\r\n        const result = new Transitioning(this._properties); // eslint-disable-line no-use-before-define\r\n        for (const property of Object.keys(this._values)) {\r\n            result._values[property] = this._values[property].transitioned(parameters, prior._values[property]);\r\n        }\r\n        return result;\r\n    }\r\n\r\n    untransitioned(): Transitioning<Props> {\r\n        const result = new Transitioning(this._properties); // eslint-disable-line no-use-before-define\r\n        for (const property of Object.keys(this._values)) {\r\n            result._values[property] = this._values[property].untransitioned();\r\n        }\r\n        return result;\r\n    }\r\n}\r\n\r\n// ------- Transitioning -------\r\n\r\n/**\r\n * `TransitioningPropertyValue` implements the first of two intermediate steps in the evaluation chain of a paint\r\n * property value. In this step, transitions between old and new values are handled: as long as the transition is in\r\n * progress, `TransitioningPropertyValue` maintains a reference to the prior value, and interpolates between it and\r\n * the new value based on the current time and the configured transition duration and delay. The product is the next\r\n * step in the evaluation chain: the \"possibly evaluated\" result type `R`. See below for more on this concept.\r\n *\r\n * @private\r\n */\r\nclass TransitioningPropertyValue<T, R> {\r\n    property: Property<T, R>;\r\n    value: PropertyValue<T, R>;\r\n    prior: ?TransitioningPropertyValue<T, R>;\r\n    begin: TimePoint;\r\n    end: TimePoint;\r\n\r\n    constructor(property: Property<T, R>,\r\n                value: PropertyValue<T, R>,\r\n                prior: ?TransitioningPropertyValue<T, R>,\r\n                transition: TransitionSpecification,\r\n                now: TimePoint) {\r\n        this.property = property;\r\n        this.value = value;\r\n        this.begin = now + transition.delay || 0;\r\n        this.end = this.begin + transition.duration || 0;\r\n        if (property.specification.transition && (transition.delay || transition.duration)) {\r\n            this.prior = prior;\r\n        }\r\n    }\r\n\r\n    possiblyEvaluate(parameters: EvaluationParameters): R {\r\n        const now = parameters.now || 0;\r\n        const finalValue = this.value.possiblyEvaluate(parameters);\r\n        const prior = this.prior;\r\n        if (!prior) {\r\n            // No prior value.\r\n            return finalValue;\r\n        } else if (now > this.end) {\r\n            // Transition from prior value is now complete.\r\n            this.prior = null;\r\n            return finalValue;\r\n        } else if (this.value.isDataDriven()) {\r\n            // Transitions to data-driven properties are not supported.\r\n            // We snap immediately to the data-driven value so that, when we perform layout,\r\n            // we see the data-driven function and can use it to populate vertex buffers.\r\n            this.prior = null;\r\n            return finalValue;\r\n        } else if (now < this.begin) {\r\n            // Transition hasn't started yet.\r\n            return prior.possiblyEvaluate(parameters);\r\n        } else {\r\n            // Interpolate between recursively-calculated prior value and final.\r\n            const t = (now - this.begin) / (this.end - this.begin);\r\n            return this.property.interpolate(prior.possiblyEvaluate(parameters), finalValue, easeCubicInOut(t));\r\n        }\r\n    }\r\n}\r\n\r\n/**\r\n * A helper type: given an object type `Properties` whose values are each of type `Property<T, R>`, it calculates\r\n * an object type with the same keys and values of type `TransitioningPropertyValue<T, R>`.\r\n *\r\n * @private\r\n */\r\ntype TransitioningPropertyValues<Props: Object>\r\n    = $Exact<$ObjMap<Props, <T, R>(p: Property<T, R>) => TransitioningPropertyValue<T, R>>>\r\n\r\n/**\r\n * `Transitioning` stores a map of all (property name, `TransitioningPropertyValue`) pairs for paint properties of a\r\n * given layer type. It can calculate the possibly-evaluated values for all of them at once, producing a\r\n * `PossiblyEvaluated` instance for the same set of properties.\r\n *\r\n * @private\r\n */\r\nclass Transitioning<Props: Object> {\r\n    _properties: Properties<Props>;\r\n    _values: TransitioningPropertyValues<Props>;\r\n\r\n    constructor(properties: Properties<Props>) {\r\n        this._properties = properties;\r\n        this._values = (Object.create(properties.defaultTransitioningPropertyValues): any);\r\n    }\r\n\r\n    possiblyEvaluate(parameters: EvaluationParameters): PossiblyEvaluated<Props> {\r\n        const result = new PossiblyEvaluated(this._properties); // eslint-disable-line no-use-before-define\r\n        for (const property of Object.keys(this._values)) {\r\n            result._values[property] = this._values[property].possiblyEvaluate(parameters);\r\n        }\r\n        return result;\r\n    }\r\n\r\n    hasTransition() {\r\n        for (const property of Object.keys(this._values)) {\r\n            if (this._values[property].prior) {\r\n                return true;\r\n            }\r\n        }\r\n        return false;\r\n    }\r\n}\r\n\r\n// ------- Layout -------\r\n\r\n/**\r\n * A helper type: given an object type `Properties` whose values are each of type `Property<T, R>`, it calculates\r\n * an object type with the same keys and values of type `PropertyValue<T, R>`.\r\n *\r\n * @private\r\n */\r\ntype PropertyValues<Props: Object>\r\n    = $Exact<$ObjMap<Props, <T, R>(p: Property<T, R>) => PropertyValue<T, R>>>\r\n\r\n/**\r\n * Because layout properties are not transitionable, they have a simpler representation and evaluation chain than\r\n * paint properties: `PropertyValue`s are possibly evaluated, producing possibly evaluated values, which are then\r\n * fully evaluated.\r\n *\r\n * `Layout` stores a map of all (property name, `PropertyValue`) pairs for layout properties of a\r\n * given layer type. It can calculate the possibly-evaluated values for all of them at once, producing a\r\n * `PossiblyEvaluated` instance for the same set of properties.\r\n *\r\n * @private\r\n */\r\nclass Layout<Props: Object> {\r\n    _properties: Properties<Props>;\r\n    _values: PropertyValues<Props>;\r\n\r\n    constructor(properties: Properties<Props>) {\r\n        this._properties = properties;\r\n        this._values = (Object.create(properties.defaultPropertyValues): any);\r\n    }\r\n\r\n    getValue<S: string>(name: S) {\r\n        return clone(this._values[name].value);\r\n    }\r\n\r\n    setValue<S: string>(name: S, value: *) {\r\n        this._values[name] = new PropertyValue(this._values[name].property, value === null ? undefined : clone(value));\r\n    }\r\n\r\n    serialize() {\r\n        const result: any = {};\r\n        for (const property of Object.keys(this._values)) {\r\n            const value = this.getValue(property);\r\n            if (value !== undefined) {\r\n                result[property] = value;\r\n            }\r\n        }\r\n        return result;\r\n    }\r\n\r\n    possiblyEvaluate(parameters: EvaluationParameters): PossiblyEvaluated<Props> {\r\n        const result = new PossiblyEvaluated(this._properties); // eslint-disable-line no-use-before-define\r\n        for (const property of Object.keys(this._values)) {\r\n            result._values[property] = this._values[property].possiblyEvaluate(parameters);\r\n        }\r\n        return result;\r\n    }\r\n}\r\n\r\n// ------- PossiblyEvaluated -------\r\n\r\n/**\r\n * \"Possibly evaluated value\" is an intermediate stage in the evaluation chain for both paint and layout property\r\n * values. The purpose of this stage is to optimize away unnecessary recalculations for data-driven properties. Code\r\n * which uses data-driven property values must assume that the value is dependent on feature data, and request that it\r\n * be evaluated for each feature. But when that property value is in fact a constant or camera function, the calculation\r\n * will not actually depend on the feature, and we can benefit from returning the prior result of having done the\r\n * evaluation once, ahead of time, in an intermediate step whose inputs are just the value and \"global\" parameters\r\n * such as current zoom level.\r\n *\r\n * `PossiblyEvaluatedValue` represents the three possible outcomes of this step: if the input value was a constant or\r\n * camera expression, then the \"possibly evaluated\" result is a constant value. Otherwise, the input value was either\r\n * a source or composite expression, and we must defer final evaluation until supplied a feature. We separate\r\n * the source and composite cases because they are handled differently when generating GL attributes, buffers, and\r\n * uniforms.\r\n *\r\n * Note that `PossiblyEvaluatedValue` (and `PossiblyEvaluatedPropertyValue`, below) are _not_ used for properties that\r\n * do not allow data-driven values. For such properties, we know that the \"possibly evaluated\" result is always a constant\r\n * scalar value. See below.\r\n *\r\n * @private\r\n */\r\ntype PossiblyEvaluatedValue<T> =\r\n    | {kind: 'constant', value: T}\r\n    | SourceExpression\r\n    | CompositeExpression;\r\n\r\n/**\r\n * `PossiblyEvaluatedPropertyValue` is used for data-driven paint and layout property values. It holds a\r\n * `PossiblyEvaluatedValue` and the `GlobalProperties` that were used to generate it. You're not allowed to supply\r\n * a different set of `GlobalProperties` when performing the final evaluation because they would be ignored in the\r\n * case where the input value was a constant or camera function.\r\n *\r\n * @private\r\n */\r\nclass PossiblyEvaluatedPropertyValue<T> {\r\n    property: DataDrivenProperty<T>;\r\n    value: PossiblyEvaluatedValue<T>;\r\n    globals: GlobalProperties;\r\n\r\n    constructor(property: DataDrivenProperty<T>, value: PossiblyEvaluatedValue<T>, globals: GlobalProperties) {\r\n        this.property = property;\r\n        this.value = value;\r\n        this.globals = globals;\r\n    }\r\n\r\n    isConstant(): boolean {\r\n        return this.value.kind === 'constant';\r\n    }\r\n\r\n    constantOr(value: T): T {\r\n        if (this.value.kind === 'constant') {\r\n            return this.value.value;\r\n        } else {\r\n            return value;\r\n        }\r\n    }\r\n\r\n    evaluate(feature: Feature): T {\r\n        return this.property.evaluate(this.value, this.globals, feature);\r\n    }\r\n}\r\n\r\n/**\r\n * A helper type: given an object type `Properties` whose values are each of type `Property<T, R>`, it calculates\r\n * an object type with the same keys, and values of type `R`.\r\n *\r\n * For properties that don't allow data-driven values, `R` is a scalar type such as `number`, `string`, or `Color`.\r\n * For data-driven properties, it is `PossiblyEvaluatedPropertyValue`. Critically, the type definitions are set up\r\n * in a way that allows flow to know which of these two cases applies for any given property name, and if you attempt\r\n * to use a `PossiblyEvaluatedPropertyValue` as if it was a scalar, or vice versa, you will get a type error. (However,\r\n * there's at least one case in which flow fails to produce a type error that you should be aware of: in a context such\r\n * as `layer.paint.get('foo-opacity') === 0`, if `foo-opacity` is data-driven, than the left-hand side is of type\r\n * `PossiblyEvaluatedPropertyValue<number>`, but flow will not complain about comparing this to a number using `===`.\r\n * See https://github.com/facebook/flow/issues/2359.)\r\n *\r\n * There's also a third, special case possiblity for `R`: for cross-faded properties, it's `?CrossFaded<T>`.\r\n *\r\n * @private\r\n */\r\ntype PossiblyEvaluatedPropertyValues<Props: Object>\r\n    = $Exact<$ObjMap<Props, <T, R>(p: Property<T, R>) => R>>\r\n\r\n/**\r\n * `PossiblyEvaluated` stores a map of all (property name, `R`) pairs for paint or layout properties of a\r\n * given layer type.\r\n */\r\nclass PossiblyEvaluated<Props: Object> {\r\n    _properties: Properties<Props>;\r\n    _values: PossiblyEvaluatedPropertyValues<Props>;\r\n\r\n    constructor(properties: Properties<Props>) {\r\n        this._properties = properties;\r\n        this._values = (Object.create(properties.defaultPossiblyEvaluatedValues): any);\r\n    }\r\n\r\n    get<S: string>(name: S): $ElementType<PossiblyEvaluatedPropertyValues<Props>, S> {\r\n        return this._values[name];\r\n    }\r\n}\r\n\r\n/**\r\n * An implementation of `Property` for properties that do not permit data-driven (source or composite) expressions.\r\n * This restriction allows us to declare statically that the result of possibly evaluating this kind of property\r\n * is in fact always the scalar type `T`, and can be used without further evaluating the value on a per-feature basis.\r\n *\r\n * @private\r\n */\r\nclass DataConstantProperty<T> implements Property<T, T> {\r\n    specification: StylePropertySpecification;\r\n\r\n    constructor(specification: StylePropertySpecification) {\r\n        this.specification = specification;\r\n    }\r\n\r\n    possiblyEvaluate(value: PropertyValue<T, T>, parameters: EvaluationParameters): T {\r\n        assert(!value.isDataDriven());\r\n        return value.expression.evaluate(parameters);\r\n    }\r\n\r\n    interpolate(a: T, b: T, t: number): T {\r\n        const interp: ?(a: T, b: T, t: number) => T = (interpolate: any)[this.specification.type];\r\n        if (interp) {\r\n            return interp(a, b, t);\r\n        } else {\r\n            return a;\r\n        }\r\n    }\r\n}\r\n\r\n/**\r\n * An implementation of `Property` for properties that permit data-driven (source or composite) expressions.\r\n * The result of possibly evaluating this kind of property is `PossiblyEvaluatedPropertyValue<T>`; obtaining\r\n * a scalar value `T` requires further evaluation on a per-feature basis.\r\n *\r\n * @private\r\n */\r\nclass DataDrivenProperty<T> implements Property<T, PossiblyEvaluatedPropertyValue<T>> {\r\n    specification: StylePropertySpecification;\r\n\r\n    constructor(specification: StylePropertySpecification) {\r\n        this.specification = specification;\r\n    }\r\n\r\n    possiblyEvaluate(value: PropertyValue<T, PossiblyEvaluatedPropertyValue<T>>, parameters: EvaluationParameters): PossiblyEvaluatedPropertyValue<T> {\r\n        if (value.expression.kind === 'constant' || value.expression.kind === 'camera') {\r\n            return new PossiblyEvaluatedPropertyValue(this, {kind: 'constant', value: value.expression.evaluate(parameters)}, parameters);\r\n        } else {\r\n            return new PossiblyEvaluatedPropertyValue(this, value.expression, parameters);\r\n        }\r\n    }\r\n\r\n    interpolate(a: PossiblyEvaluatedPropertyValue<T>,\r\n                b: PossiblyEvaluatedPropertyValue<T>,\r\n                t: number): PossiblyEvaluatedPropertyValue<T> {\r\n        // If either possibly-evaluated value is non-constant, give up: we aren't able to interpolate data-driven values.\r\n        if (a.value.kind !== 'constant' || b.value.kind !== 'constant') {\r\n            return a;\r\n        }\r\n\r\n        // Special case hack solely for fill-outline-color.\r\n        if (a.value.value === undefined || b.value.value === undefined)\r\n            return (undefined: any);\r\n\r\n        const interp: ?(a: T, b: T, t: number) => T = (interpolate: any)[this.specification.type];\r\n        if (interp) {\r\n            return new PossiblyEvaluatedPropertyValue(this, {kind: 'constant', value: interp(a.value.value, b.value.value, t)}, a.globals);\r\n        } else {\r\n            return a;\r\n        }\r\n    }\r\n\r\n    evaluate(value: PossiblyEvaluatedValue<T>, globals: GlobalProperties, feature: Feature): T {\r\n        if (value.kind === 'constant') {\r\n            return value.value;\r\n        } else {\r\n            return value.evaluate(globals, feature);\r\n        }\r\n    }\r\n}\r\n\r\n/**\r\n * An implementation of `Property` for `*-pattern` and `line-dasharray`, which are transitioned by cross-fading\r\n * rather than interpolation.\r\n *\r\n * @private\r\n */\r\nclass CrossFadedProperty<T> implements Property<T, ?CrossFaded<T>> {\r\n    specification: StylePropertySpecification;\r\n\r\n    constructor(specification: StylePropertySpecification) {\r\n        this.specification = specification;\r\n    }\r\n\r\n    possiblyEvaluate(value: PropertyValue<T, ?CrossFaded<T>>, parameters: EvaluationParameters): ?CrossFaded<T> {\r\n        if (value.value === undefined) {\r\n            return undefined;\r\n        } else if (value.expression.kind === 'constant') {\r\n            const constant = value.expression.evaluate(parameters);\r\n            return this._calculate(constant, constant, constant, parameters);\r\n        } else {\r\n            assert(!value.isDataDriven());\r\n            return this._calculate(\r\n                value.expression.evaluate({zoom: parameters.zoom - 1.0}),\r\n                value.expression.evaluate({zoom: parameters.zoom}),\r\n                value.expression.evaluate({zoom: parameters.zoom + 1.0}),\r\n                parameters);\r\n        }\r\n    }\r\n\r\n    _calculate(min: T, mid: T, max: T, parameters: EvaluationParameters): ?CrossFaded<T> {\r\n        const z = parameters.zoom;\r\n        const fraction = z - Math.floor(z);\r\n        const t = parameters.crossFadingFactor();\r\n        return z > parameters.zoomHistory.lastIntegerZoom ?\r\n            { from: min, to: mid, fromScale: 2, toScale: 1, t: fraction + (1 - fraction) * t } :\r\n            { from: max, to: mid, fromScale: 0.5, toScale: 1, t: 1 - (1 - t) * fraction };\r\n    }\r\n\r\n    interpolate(a: ?CrossFaded<T>): ?CrossFaded<T> {\r\n        return a;\r\n    }\r\n}\r\n\r\n/**\r\n * An implementation of `Property` for `heatmap-color`. Evaluation and interpolation are no-ops: the real\r\n * evaluation happens in HeatmapStyleLayer.\r\n *\r\n * @private\r\n */\r\nclass HeatmapColorProperty implements Property<Color, void> {\r\n    specification: StylePropertySpecification;\r\n\r\n    constructor(specification: StylePropertySpecification) {\r\n        this.specification = specification;\r\n    }\r\n\r\n    possiblyEvaluate() {}\r\n    interpolate() {}\r\n}\r\n\r\n/**\r\n * `Properties` holds objects containing default values for the layout or paint property set of a given\r\n * layer type. These objects are immutable, and they are used as the prototypes for the `_values` members of\r\n * `Transitionable`, `Transitioning`, `Layout`, and `PossiblyEvaluated`. This allows these classes to avoid\r\n * doing work in the common case where a property has no explicit value set and should be considered to take\r\n * on the default value: using `for (const property of Object.keys(this._values))`, they can iterate over\r\n * only the _own_ properties of `_values`, skipping repeated calculation of transitions and possible/final\r\n * evaluations for defaults, the result of which will always be the same.\r\n *\r\n * @private\r\n */\r\nclass Properties<Props: Object> {\r\n    properties: Props;\r\n    defaultPropertyValues: PropertyValues<Props>;\r\n    defaultTransitionablePropertyValues: TransitionablePropertyValues<Props>;\r\n    defaultTransitioningPropertyValues: TransitioningPropertyValues<Props>;\r\n    defaultPossiblyEvaluatedValues: PossiblyEvaluatedPropertyValues<Props>;\r\n\r\n    constructor(properties: Props) {\r\n        this.properties = properties;\r\n        this.defaultPropertyValues = ({}: any);\r\n        this.defaultTransitionablePropertyValues = ({}: any);\r\n        this.defaultTransitioningPropertyValues = ({}: any);\r\n        this.defaultPossiblyEvaluatedValues = ({}: any);\r\n\r\n        for (const property in properties) {\r\n            const prop = properties[property];\r\n            const defaultPropertyValue = this.defaultPropertyValues[property] =\r\n                new PropertyValue(prop, undefined);\r\n            const defaultTransitionablePropertyValue = this.defaultTransitionablePropertyValues[property] =\r\n                new TransitionablePropertyValue(prop);\r\n            this.defaultTransitioningPropertyValues[property] =\r\n                defaultTransitionablePropertyValue.untransitioned();\r\n            this.defaultPossiblyEvaluatedValues[property] =\r\n                defaultPropertyValue.possiblyEvaluate(({}: any));\r\n        }\r\n    }\r\n}\r\n\r\nregister('DataDrivenProperty', DataDrivenProperty);\r\nregister('DataConstantProperty', DataConstantProperty);\r\nregister('CrossFadedProperty', CrossFadedProperty);\r\nregister('HeatmapColorProperty', HeatmapColorProperty);\r\n\r\nmodule.exports = {\r\n    PropertyValue,\r\n    Transitionable,\r\n    Transitioning,\r\n    Layout,\r\n    PossiblyEvaluatedPropertyValue,\r\n    PossiblyEvaluated,\r\n    DataConstantProperty,\r\n    DataDrivenProperty,\r\n    CrossFadedProperty,\r\n    HeatmapColorProperty,\r\n    Properties\r\n};\r\n","// @flow\r\n\r\nconst Point = require('@mapbox/point-geometry');\r\n\r\nimport type {PossiblyEvaluatedPropertyValue} from \"./properties\";\r\nimport type StyleLayer from '../style/style_layer';\r\nimport type CircleBucket from '../data/bucket/circle_bucket';\r\nimport type LineBucket from '../data/bucket/line_bucket';\r\n\r\nfunction getMaximumPaintValue(property: string, layer: StyleLayer, bucket: CircleBucket<*> | LineBucket): number {\r\n    const value = ((layer.paint: any).get(property): PossiblyEvaluatedPropertyValue<any>).value;\r\n    if (value.kind === 'constant') {\r\n        return value.value;\r\n    } else {\r\n        const binders = bucket.programConfigurations.get(layer.id).binders;\r\n        return binders[property].statistics.max;\r\n    }\r\n}\r\n\r\nfunction translateDistance(translate: [number, number]) {\r\n    return Math.sqrt(translate[0] * translate[0] + translate[1] * translate[1]);\r\n}\r\n\r\nfunction translate(queryGeometry: Array<Array<Point>>,\r\n                   translate: [number, number],\r\n                   translateAnchor: 'viewport' | 'map',\r\n                   bearing: number,\r\n                   pixelsToTileUnits: number) {\r\n    if (!translate[0] && !translate[1]) {\r\n        return queryGeometry;\r\n    }\r\n\r\n    const pt = Point.convert(translate);\r\n\r\n    if (translateAnchor === \"viewport\") {\r\n        pt._rotate(-bearing);\r\n    }\r\n\r\n    const translated = [];\r\n    for (let i = 0; i < queryGeometry.length; i++) {\r\n        const ring = queryGeometry[i];\r\n        const translatedRing = [];\r\n        for (let k = 0; k < ring.length; k++) {\r\n            translatedRing.push(ring[k].sub(pt._mult(pixelsToTileUnits)));\r\n        }\r\n        translated.push(translatedRing);\r\n    }\r\n    return translated;\r\n}\r\n\r\nmodule.exports = {\r\n    getMaximumPaintValue,\r\n    translateDistance,\r\n    translate\r\n};\r\n","// @flow\r\n\r\n\r\nconst util = require('../util/util');\r\nconst styleSpec = require('../style-spec/reference/latest');\r\nconst validateStyle = require('./validate_style');\r\nconst Evented = require('../util/evented');\r\n\r\nconst {\r\n    Layout,\r\n    Transitionable,\r\n    Transitioning,\r\n    Properties\r\n} = require('./properties');\r\n\r\nimport type {Bucket} from '../data/bucket';\r\nimport type Point from '@mapbox/point-geometry';\r\nimport type {FeatureFilter} from '../style-spec/feature_filter';\r\nimport type {TransitionParameters} from './properties';\r\nimport type EvaluationParameters from './evaluation_parameters';\r\n\r\nconst TRANSITION_SUFFIX = '-transition';\r\n\r\nclass StyleLayer extends Evented {\r\n    static create: (layer: LayerSpecification) => StyleLayer;\r\n\r\n    id: string;\r\n    metadata: mixed;\r\n    type: string;\r\n    source: string;\r\n    sourceLayer: ?string;\r\n    minzoom: ?number;\r\n    maxzoom: ?number;\r\n    filter: FilterSpecification | void;\r\n    visibility: 'visible' | 'none';\r\n\r\n    _unevaluatedLayout: Layout<any>;\r\n    +layout: mixed;\r\n\r\n    _transitionablePaint: Transitionable<any>;\r\n    _transitioningPaint: Transitioning<any>;\r\n    +paint: mixed;\r\n\r\n    _featureFilter: FeatureFilter;\r\n\r\n    +queryRadius: (bucket: Bucket) => number;\r\n    +queryIntersectsFeature: (queryGeometry: Array<Array<Point>>,\r\n                              feature: VectorTileFeature,\r\n                              geometry: Array<Array<Point>>,\r\n                              zoom: number,\r\n                              bearing: number,\r\n                              pixelsToTileUnits: number) => boolean;\r\n\r\n    constructor(layer: LayerSpecification, properties: {layout?: Properties<*>, paint: Properties<*>}) {\r\n        super();\r\n\r\n        this.id = layer.id;\r\n        this.metadata = layer.metadata;\r\n        this.type = layer.type;\r\n        this.minzoom = layer.minzoom;\r\n        this.maxzoom = layer.maxzoom;\r\n        this.visibility = 'visible';\r\n\r\n        if (layer.type !== 'background') {\r\n            this.source = layer.source;\r\n            this.sourceLayer = layer['source-layer'];\r\n            this.filter = layer.filter;\r\n        }\r\n\r\n        this._featureFilter = () => true;\r\n\r\n        if (properties.layout) {\r\n            this._unevaluatedLayout = new Layout(properties.layout);\r\n        }\r\n\r\n        this._transitionablePaint = new Transitionable(properties.paint);\r\n\r\n        for (const property in layer.paint) {\r\n            this.setPaintProperty(property, layer.paint[property], {validate: false});\r\n        }\r\n        for (const property in layer.layout) {\r\n            this.setLayoutProperty(property, layer.layout[property], {validate: false});\r\n        }\r\n\r\n        this._transitioningPaint = this._transitionablePaint.untransitioned();\r\n    }\r\n\r\n    getLayoutProperty(name: string) {\r\n        if (name === 'visibility') {\r\n            return this.visibility;\r\n        }\r\n\r\n        return this._unevaluatedLayout.getValue(name);\r\n    }\r\n\r\n    setLayoutProperty(name: string, value: mixed, options: {validate: boolean}) {\r\n        if (value !== null && value !== undefined) {\r\n            const key = `layers.${this.id}.layout.${name}`;\r\n            if (this._validate(validateStyle.layoutProperty, key, name, value, options)) {\r\n                return;\r\n            }\r\n        }\r\n\r\n        if (name === 'visibility') {\r\n            this.visibility = value === 'none' ? value : 'visible';\r\n            return;\r\n        }\r\n\r\n        this._unevaluatedLayout.setValue(name, value);\r\n    }\r\n\r\n    getPaintProperty(name: string) {\r\n        if (util.endsWith(name, TRANSITION_SUFFIX)) {\r\n            return this._transitionablePaint.getTransition(name.slice(0, -TRANSITION_SUFFIX.length));\r\n        } else {\r\n            return this._transitionablePaint.getValue(name);\r\n        }\r\n    }\r\n\r\n    setPaintProperty(name: string, value: mixed, options: {validate: boolean}) {\r\n        if (value !== null && value !== undefined) {\r\n            const key = `layers.${this.id}.paint.${name}`;\r\n            if (this._validate(validateStyle.paintProperty, key, name, value, options)) {\r\n                return;\r\n            }\r\n        }\r\n\r\n        if (util.endsWith(name, TRANSITION_SUFFIX)) {\r\n            this._transitionablePaint.setTransition(name.slice(0, -TRANSITION_SUFFIX.length), (value: any) || undefined);\r\n        } else {\r\n            this._transitionablePaint.setValue(name, value);\r\n        }\r\n    }\r\n\r\n    isHidden(zoom: number) {\r\n        if (this.minzoom && zoom < this.minzoom) return true;\r\n        if (this.maxzoom && zoom >= this.maxzoom) return true;\r\n        return this.visibility === 'none';\r\n    }\r\n\r\n    updateTransitions(parameters: TransitionParameters) {\r\n        this._transitioningPaint = this._transitionablePaint.transitioned(parameters, this._transitioningPaint);\r\n    }\r\n\r\n    hasTransition() {\r\n        return this._transitioningPaint.hasTransition();\r\n    }\r\n\r\n    recalculate(parameters: EvaluationParameters) {\r\n        if (this._unevaluatedLayout) {\r\n            (this: any).layout = this._unevaluatedLayout.possiblyEvaluate(parameters);\r\n        }\r\n\r\n        (this: any).paint = this._transitioningPaint.possiblyEvaluate(parameters);\r\n    }\r\n\r\n    serialize() {\r\n        const output : any = {\r\n            'id': this.id,\r\n            'type': this.type,\r\n            'source': this.source,\r\n            'source-layer': this.sourceLayer,\r\n            'metadata': this.metadata,\r\n            'minzoom': this.minzoom,\r\n            'maxzoom': this.maxzoom,\r\n            'filter': this.filter,\r\n            'layout': this._unevaluatedLayout && this._unevaluatedLayout.serialize(),\r\n            'paint': this._transitionablePaint && this._transitionablePaint.serialize()\r\n        };\r\n\r\n        if (this.visibility === 'none') {\r\n            output.layout = output.layout || {};\r\n            output.layout.visibility = 'none';\r\n        }\r\n\r\n        return util.filterObject(output, (value, key) => {\r\n            return value !== undefined &&\r\n                !(key === 'layout' && !Object.keys(value).length) &&\r\n                !(key === 'paint' && !Object.keys(value).length);\r\n        });\r\n    }\r\n\r\n    _validate(validate: Function, key: string, name: string, value: mixed, options: {validate: boolean}) {\r\n        if (options && options.validate === false) {\r\n            return false;\r\n        }\r\n        return validateStyle.emitErrors(this, validate.call(validateStyle, {\r\n            key: key,\r\n            layerType: this.type,\r\n            objectKey: name,\r\n            value: value,\r\n            styleSpec: styleSpec,\r\n            // Workaround for https://github.com/mapbox/mapbox-gl-js/issues/2407\r\n            style: {glyphs: true, sprite: true}\r\n        }));\r\n    }\r\n\r\n    hasOffscreenPass() {\r\n        return false;\r\n    }\r\n\r\n    resize() {\r\n        // noop\r\n    }\r\n}\r\n\r\nmodule.exports = StyleLayer;\r\n\r\nconst subclasses = {\r\n    'circle': require('./style_layer/circle_style_layer'),\r\n    'heatmap': require('./style_layer/heatmap_style_layer'),\r\n    'hillshade': require('./style_layer/hillshade_style_layer'),\r\n    'fill': require('./style_layer/fill_style_layer'),\r\n    'fill-extrusion': require('./style_layer/fill_extrusion_style_layer'),\r\n    'line': require('./style_layer/line_style_layer'),\r\n    'symbol': require('./style_layer/symbol_style_layer'),\r\n    'background': require('./style_layer/background_style_layer'),\r\n    'raster': require('./style_layer/raster_style_layer')\r\n};\r\n\r\nStyleLayer.create = function(layer: LayerSpecification) {\r\n    return new subclasses[layer.type](layer);\r\n};\r\n","// @flow\r\n\r\nconst StyleLayer = require('../style_layer');\r\nconst properties = require('./background_style_layer_properties');\r\n\r\nconst {\r\n    Transitionable,\r\n    Transitioning,\r\n    PossiblyEvaluated\r\n} = require('../properties');\r\n\r\nimport type {PaintProps} from './background_style_layer_properties';\r\n\r\nclass BackgroundStyleLayer extends StyleLayer {\r\n    _transitionablePaint: Transitionable<PaintProps>;\r\n    _transitioningPaint: Transitioning<PaintProps>;\r\n    paint: PossiblyEvaluated<PaintProps>;\r\n\r\n    constructor(layer: LayerSpecification) {\r\n        super(layer, properties);\r\n    }\r\n}\r\n\r\nmodule.exports = BackgroundStyleLayer;\r\n","// This file is generated. Edit build/generate-style-code.js, then run `yarn run codegen`.\r\n// @flow\r\n/* eslint-disable */\r\n\r\nconst styleSpec = require('../../style-spec/reference/latest');\r\n\r\nconst {\r\n    Properties,\r\n    DataConstantProperty,\r\n    DataDrivenProperty,\r\n    CrossFadedProperty,\r\n    HeatmapColorProperty\r\n} = require('../properties');\r\n\r\nimport type Color from '../../style-spec/util/color';\r\n\r\n\r\nexport type PaintProps = {|\r\n    \"background-color\": DataConstantProperty<Color>,\r\n    \"background-pattern\": CrossFadedProperty<string>,\r\n    \"background-opacity\": DataConstantProperty<number>,\r\n|};\r\n\r\nconst paint: Properties<PaintProps> = new Properties({\r\n    \"background-color\": new DataConstantProperty(styleSpec[\"paint_background\"][\"background-color\"]),\r\n    \"background-pattern\": new CrossFadedProperty(styleSpec[\"paint_background\"][\"background-pattern\"]),\r\n    \"background-opacity\": new DataConstantProperty(styleSpec[\"paint_background\"][\"background-opacity\"]),\r\n});\r\n\r\nmodule.exports = { paint };\r\n","// @flow\r\n\r\nconst StyleLayer = require('../style_layer');\r\nconst CircleBucket = require('../../data/bucket/circle_bucket');\r\nconst {multiPolygonIntersectsBufferedMultiPoint} = require('../../util/intersection_tests');\r\nconst {getMaximumPaintValue, translateDistance, translate} = require('../query_utils');\r\nconst properties = require('./circle_style_layer_properties');\r\n\r\nconst {\r\n    Transitionable,\r\n    Transitioning,\r\n    PossiblyEvaluated\r\n} = require('../properties');\r\n\r\nimport type {Bucket, BucketParameters} from '../../data/bucket';\r\nimport type Point from '@mapbox/point-geometry';\r\nimport type {PaintProps} from './circle_style_layer_properties';\r\n\r\nclass CircleStyleLayer extends StyleLayer {\r\n    _transitionablePaint: Transitionable<PaintProps>;\r\n    _transitioningPaint: Transitioning<PaintProps>;\r\n    paint: PossiblyEvaluated<PaintProps>;\r\n\r\n    constructor(layer: LayerSpecification) {\r\n        super(layer, properties);\r\n    }\r\n\r\n    createBucket(parameters: BucketParameters<*>) {\r\n        return new CircleBucket(parameters);\r\n    }\r\n\r\n    queryRadius(bucket: Bucket): number {\r\n        const circleBucket: CircleBucket<CircleStyleLayer> = (bucket: any);\r\n        return getMaximumPaintValue('circle-radius', this, circleBucket) +\r\n            getMaximumPaintValue('circle-stroke-width', this, circleBucket) +\r\n            translateDistance(this.paint.get('circle-translate'));\r\n    }\r\n\r\n    queryIntersectsFeature(queryGeometry: Array<Array<Point>>,\r\n                           feature: VectorTileFeature,\r\n                           geometry: Array<Array<Point>>,\r\n                           zoom: number,\r\n                           bearing: number,\r\n                           pixelsToTileUnits: number): boolean {\r\n        const translatedPolygon = translate(queryGeometry,\r\n            this.paint.get('circle-translate'),\r\n            this.paint.get('circle-translate-anchor'),\r\n            bearing, pixelsToTileUnits);\r\n        const radius = this.paint.get('circle-radius').evaluate(feature) * pixelsToTileUnits;\r\n        const stroke = this.paint.get('circle-stroke-width').evaluate(feature) * pixelsToTileUnits;\r\n        return multiPolygonIntersectsBufferedMultiPoint(translatedPolygon, geometry, radius + stroke);\r\n    }\r\n}\r\n\r\nmodule.exports = CircleStyleLayer;\r\n","// This file is generated. Edit build/generate-style-code.js, then run `yarn run codegen`.\r\n// @flow\r\n/* eslint-disable */\r\n\r\nconst styleSpec = require('../../style-spec/reference/latest');\r\n\r\nconst {\r\n    Properties,\r\n    DataConstantProperty,\r\n    DataDrivenProperty,\r\n    CrossFadedProperty,\r\n    HeatmapColorProperty\r\n} = require('../properties');\r\n\r\nimport type Color from '../../style-spec/util/color';\r\n\r\n\r\nexport type PaintProps = {|\r\n    \"circle-radius\": DataDrivenProperty<number>,\r\n    \"circle-color\": DataDrivenProperty<Color>,\r\n    \"circle-blur\": DataDrivenProperty<number>,\r\n    \"circle-opacity\": DataDrivenProperty<number>,\r\n    \"circle-translate\": DataConstantProperty<[number, number]>,\r\n    \"circle-translate-anchor\": DataConstantProperty<\"map\" | \"viewport\">,\r\n    \"circle-pitch-scale\": DataConstantProperty<\"map\" | \"viewport\">,\r\n    \"circle-pitch-alignment\": DataConstantProperty<\"map\" | \"viewport\">,\r\n    \"circle-stroke-width\": DataDrivenProperty<number>,\r\n    \"circle-stroke-color\": DataDrivenProperty<Color>,\r\n    \"circle-stroke-opacity\": DataDrivenProperty<number>,\r\n|};\r\n\r\nconst paint: Properties<PaintProps> = new Properties({\r\n    \"circle-radius\": new DataDrivenProperty(styleSpec[\"paint_circle\"][\"circle-radius\"]),\r\n    \"circle-color\": new DataDrivenProperty(styleSpec[\"paint_circle\"][\"circle-color\"]),\r\n    \"circle-blur\": new DataDrivenProperty(styleSpec[\"paint_circle\"][\"circle-blur\"]),\r\n    \"circle-opacity\": new DataDrivenProperty(styleSpec[\"paint_circle\"][\"circle-opacity\"]),\r\n    \"circle-translate\": new DataConstantProperty(styleSpec[\"paint_circle\"][\"circle-translate\"]),\r\n    \"circle-translate-anchor\": new DataConstantProperty(styleSpec[\"paint_circle\"][\"circle-translate-anchor\"]),\r\n    \"circle-pitch-scale\": new DataConstantProperty(styleSpec[\"paint_circle\"][\"circle-pitch-scale\"]),\r\n    \"circle-pitch-alignment\": new DataConstantProperty(styleSpec[\"paint_circle\"][\"circle-pitch-alignment\"]),\r\n    \"circle-stroke-width\": new DataDrivenProperty(styleSpec[\"paint_circle\"][\"circle-stroke-width\"]),\r\n    \"circle-stroke-color\": new DataDrivenProperty(styleSpec[\"paint_circle\"][\"circle-stroke-color\"]),\r\n    \"circle-stroke-opacity\": new DataDrivenProperty(styleSpec[\"paint_circle\"][\"circle-stroke-opacity\"]),\r\n});\r\n\r\nmodule.exports = { paint };\r\n","// @flow\r\n\r\nconst StyleLayer = require('../style_layer');\r\nconst FillExtrusionBucket = require('../../data/bucket/fill_extrusion_bucket');\r\nconst {multiPolygonIntersectsMultiPolygon} = require('../../util/intersection_tests');\r\nconst {translateDistance, translate} = require('../query_utils');\r\nconst properties = require('./fill_extrusion_style_layer_properties');\r\n\r\nconst {\r\n    Transitionable,\r\n    Transitioning,\r\n    PossiblyEvaluated\r\n} = require('../properties');\r\n\r\nimport type {BucketParameters} from '../../data/bucket';\r\nimport type Point from '@mapbox/point-geometry';\r\nimport type {PaintProps} from './fill_extrusion_style_layer_properties';\r\nimport type Framebuffer from '../../gl/framebuffer';\r\n\r\nclass FillExtrusionStyleLayer extends StyleLayer {\r\n    _transitionablePaint: Transitionable<PaintProps>;\r\n    _transitioningPaint: Transitioning<PaintProps>;\r\n    paint: PossiblyEvaluated<PaintProps>;\r\n    viewportFrame: ?Framebuffer;\r\n\r\n    constructor(layer: LayerSpecification) {\r\n        super(layer, properties);\r\n    }\r\n\r\n    createBucket(parameters: BucketParameters<FillExtrusionStyleLayer>) {\r\n        return new FillExtrusionBucket(parameters);\r\n    }\r\n\r\n    queryRadius(): number {\r\n        return translateDistance(this.paint.get('fill-extrusion-translate'));\r\n    }\r\n\r\n    queryIntersectsFeature(queryGeometry: Array<Array<Point>>,\r\n                           feature: VectorTileFeature,\r\n                           geometry: Array<Array<Point>>,\r\n                           zoom: number,\r\n                           bearing: number,\r\n                           pixelsToTileUnits: number): boolean {\r\n        const translatedPolygon = translate(queryGeometry,\r\n            this.paint.get('fill-extrusion-translate'),\r\n            this.paint.get('fill-extrusion-translate-anchor'),\r\n            bearing, pixelsToTileUnits);\r\n        return multiPolygonIntersectsMultiPolygon(translatedPolygon, geometry);\r\n    }\r\n\r\n    hasOffscreenPass() {\r\n        return this.paint.get('fill-extrusion-opacity') !== 0 && this.visibility !== 'none';\r\n    }\r\n\r\n    resize() {\r\n        if (this.viewportFrame) {\r\n            this.viewportFrame.destroy();\r\n            this.viewportFrame = null;\r\n        }\r\n    }\r\n}\r\n\r\nmodule.exports = FillExtrusionStyleLayer;\r\n","// This file is generated. Edit build/generate-style-code.js, then run `yarn run codegen`.\r\n// @flow\r\n/* eslint-disable */\r\n\r\nconst styleSpec = require('../../style-spec/reference/latest');\r\n\r\nconst {\r\n    Properties,\r\n    DataConstantProperty,\r\n    DataDrivenProperty,\r\n    CrossFadedProperty,\r\n    HeatmapColorProperty\r\n} = require('../properties');\r\n\r\nimport type Color from '../../style-spec/util/color';\r\n\r\n\r\nexport type PaintProps = {|\r\n    \"fill-extrusion-opacity\": DataConstantProperty<number>,\r\n    \"fill-extrusion-color\": DataDrivenProperty<Color>,\r\n    \"fill-extrusion-translate\": DataConstantProperty<[number, number]>,\r\n    \"fill-extrusion-translate-anchor\": DataConstantProperty<\"map\" | \"viewport\">,\r\n    \"fill-extrusion-pattern\": CrossFadedProperty<string>,\r\n    \"fill-extrusion-height\": DataDrivenProperty<number>,\r\n    \"fill-extrusion-base\": DataDrivenProperty<number>,\r\n|};\r\n\r\nconst paint: Properties<PaintProps> = new Properties({\r\n    \"fill-extrusion-opacity\": new DataConstantProperty(styleSpec[\"paint_fill-extrusion\"][\"fill-extrusion-opacity\"]),\r\n    \"fill-extrusion-color\": new DataDrivenProperty(styleSpec[\"paint_fill-extrusion\"][\"fill-extrusion-color\"]),\r\n    \"fill-extrusion-translate\": new DataConstantProperty(styleSpec[\"paint_fill-extrusion\"][\"fill-extrusion-translate\"]),\r\n    \"fill-extrusion-translate-anchor\": new DataConstantProperty(styleSpec[\"paint_fill-extrusion\"][\"fill-extrusion-translate-anchor\"]),\r\n    \"fill-extrusion-pattern\": new CrossFadedProperty(styleSpec[\"paint_fill-extrusion\"][\"fill-extrusion-pattern\"]),\r\n    \"fill-extrusion-height\": new DataDrivenProperty(styleSpec[\"paint_fill-extrusion\"][\"fill-extrusion-height\"]),\r\n    \"fill-extrusion-base\": new DataDrivenProperty(styleSpec[\"paint_fill-extrusion\"][\"fill-extrusion-base\"]),\r\n});\r\n\r\nmodule.exports = { paint };\r\n","// @flow\r\n\r\nconst StyleLayer = require('../style_layer');\r\nconst FillBucket = require('../../data/bucket/fill_bucket');\r\nconst {multiPolygonIntersectsMultiPolygon} = require('../../util/intersection_tests');\r\nconst {translateDistance, translate} = require('../query_utils');\r\nconst properties = require('./fill_style_layer_properties');\r\n\r\nconst {\r\n    Transitionable,\r\n    Transitioning,\r\n    PossiblyEvaluated\r\n} = require('../properties');\r\n\r\nimport type {BucketParameters} from '../../data/bucket';\r\nimport type Point from '@mapbox/point-geometry';\r\nimport type {PaintProps} from './fill_style_layer_properties';\r\nimport type EvaluationParameters from '../evaluation_parameters';\r\n\r\nclass FillStyleLayer extends StyleLayer {\r\n    _transitionablePaint: Transitionable<PaintProps>;\r\n    _transitioningPaint: Transitioning<PaintProps>;\r\n    paint: PossiblyEvaluated<PaintProps>;\r\n\r\n    constructor(layer: LayerSpecification) {\r\n        super(layer, properties);\r\n    }\r\n\r\n    recalculate(parameters: EvaluationParameters) {\r\n        this.paint = this._transitioningPaint.possiblyEvaluate(parameters);\r\n\r\n        if (this._transitionablePaint.getValue('fill-outline-color') === undefined) {\r\n            this.paint._values['fill-outline-color'] = this.paint._values['fill-color'];\r\n        }\r\n    }\r\n\r\n    createBucket(parameters: BucketParameters<*>) {\r\n        return new FillBucket(parameters);\r\n    }\r\n\r\n    queryRadius(): number {\r\n        return translateDistance(this.paint.get('fill-translate'));\r\n    }\r\n\r\n    queryIntersectsFeature(queryGeometry: Array<Array<Point>>,\r\n                           feature: VectorTileFeature,\r\n                           geometry: Array<Array<Point>>,\r\n                           zoom: number,\r\n                           bearing: number,\r\n                           pixelsToTileUnits: number): boolean {\r\n        const translatedPolygon = translate(queryGeometry,\r\n            this.paint.get('fill-translate'),\r\n            this.paint.get('fill-translate-anchor'),\r\n            bearing, pixelsToTileUnits);\r\n        return multiPolygonIntersectsMultiPolygon(translatedPolygon, geometry);\r\n    }\r\n}\r\n\r\nmodule.exports = FillStyleLayer;\r\n","// This file is generated. Edit build/generate-style-code.js, then run `yarn run codegen`.\r\n// @flow\r\n/* eslint-disable */\r\n\r\nconst styleSpec = require('../../style-spec/reference/latest');\r\n\r\nconst {\r\n    Properties,\r\n    DataConstantProperty,\r\n    DataDrivenProperty,\r\n    CrossFadedProperty,\r\n    HeatmapColorProperty\r\n} = require('../properties');\r\n\r\nimport type Color from '../../style-spec/util/color';\r\n\r\n\r\nexport type PaintProps = {|\r\n    \"fill-antialias\": DataConstantProperty<boolean>,\r\n    \"fill-opacity\": DataDrivenProperty<number>,\r\n    \"fill-color\": DataDrivenProperty<Color>,\r\n    \"fill-outline-color\": DataDrivenProperty<Color>,\r\n    \"fill-translate\": DataConstantProperty<[number, number]>,\r\n    \"fill-translate-anchor\": DataConstantProperty<\"map\" | \"viewport\">,\r\n    \"fill-pattern\": CrossFadedProperty<string>,\r\n|};\r\n\r\nconst paint: Properties<PaintProps> = new Properties({\r\n    \"fill-antialias\": new DataConstantProperty(styleSpec[\"paint_fill\"][\"fill-antialias\"]),\r\n    \"fill-opacity\": new DataDrivenProperty(styleSpec[\"paint_fill\"][\"fill-opacity\"]),\r\n    \"fill-color\": new DataDrivenProperty(styleSpec[\"paint_fill\"][\"fill-color\"]),\r\n    \"fill-outline-color\": new DataDrivenProperty(styleSpec[\"paint_fill\"][\"fill-outline-color\"]),\r\n    \"fill-translate\": new DataConstantProperty(styleSpec[\"paint_fill\"][\"fill-translate\"]),\r\n    \"fill-translate-anchor\": new DataConstantProperty(styleSpec[\"paint_fill\"][\"fill-translate-anchor\"]),\r\n    \"fill-pattern\": new CrossFadedProperty(styleSpec[\"paint_fill\"][\"fill-pattern\"]),\r\n});\r\n\r\nmodule.exports = { paint };\r\n","// @flow\r\n\r\nconst StyleLayer = require('../style_layer');\r\nconst HeatmapBucket = require('../../data/bucket/heatmap_bucket');\r\nconst RGBAImage = require('../../util/image').RGBAImage;\r\nconst properties = require('./heatmap_style_layer_properties');\r\n\r\nconst {\r\n    Transitionable,\r\n    Transitioning,\r\n    PossiblyEvaluated\r\n} = require('../properties');\r\n\r\nimport type Texture from '../../render/texture';\r\nimport type Framebuffer from '../../gl/framebuffer';\r\nimport type {PaintProps} from './heatmap_style_layer_properties';\r\n\r\nclass HeatmapStyleLayer extends StyleLayer {\r\n\r\n    heatmapFbo: ?Framebuffer;\r\n    colorRamp: RGBAImage;\r\n    colorRampTexture: ?Texture;\r\n\r\n    _transitionablePaint: Transitionable<PaintProps>;\r\n    _transitioningPaint: Transitioning<PaintProps>;\r\n    paint: PossiblyEvaluated<PaintProps>;\r\n\r\n    createBucket(options: any) {\r\n        return new HeatmapBucket(options);\r\n    }\r\n\r\n    constructor(layer: LayerSpecification) {\r\n        super(layer, properties);\r\n\r\n        // make sure color ramp texture is generated for default heatmap color too\r\n        this._updateColorRamp();\r\n    }\r\n\r\n    setPaintProperty(name: string, value: mixed, options: {validate: boolean}) {\r\n        super.setPaintProperty(name, value, options);\r\n        if (name === 'heatmap-color') {\r\n            this._updateColorRamp();\r\n        }\r\n    }\r\n\r\n    _updateColorRamp() {\r\n        const expression = this._transitionablePaint._values['heatmap-color'].value.expression;\r\n        const colorRampData = new Uint8Array(256 * 4);\r\n        const len = colorRampData.length;\r\n        for (let i = 4; i < len; i += 4) {\r\n            const pxColor = expression.evaluate(({heatmapDensity: i / len}: any));\r\n            // the colors are being unpremultiplied because Color uses\r\n            // premultiplied values, and the Texture class expects unpremultiplied ones\r\n            colorRampData[i + 0] = Math.floor(pxColor.r * 255 / pxColor.a);\r\n            colorRampData[i + 1] = Math.floor(pxColor.g * 255 / pxColor.a);\r\n            colorRampData[i + 2] = Math.floor(pxColor.b * 255 / pxColor.a);\r\n            colorRampData[i + 3] = Math.floor(pxColor.a * 255);\r\n        }\r\n        this.colorRamp = new RGBAImage({width: 256, height: 1}, colorRampData);\r\n        this.colorRampTexture = null;\r\n    }\r\n\r\n    resize() {\r\n        if (this.heatmapFbo) {\r\n            this.heatmapFbo.destroy();\r\n            this.heatmapFbo = null;\r\n        }\r\n    }\r\n\r\n    queryRadius(): number {\r\n        return 0;\r\n    }\r\n\r\n    queryIntersectsFeature(): boolean  {\r\n        return false;\r\n    }\r\n\r\n    hasOffscreenPass() {\r\n        return this.paint.get('heatmap-opacity') !== 0 && this.visibility !== 'none';\r\n    }\r\n}\r\n\r\nmodule.exports = HeatmapStyleLayer;\r\n","// This file is generated. Edit build/generate-style-code.js, then run `yarn run codegen`.\r\n// @flow\r\n/* eslint-disable */\r\n\r\nconst styleSpec = require('../../style-spec/reference/latest');\r\n\r\nconst {\r\n    Properties,\r\n    DataConstantProperty,\r\n    DataDrivenProperty,\r\n    CrossFadedProperty,\r\n    HeatmapColorProperty\r\n} = require('../properties');\r\n\r\nimport type Color from '../../style-spec/util/color';\r\n\r\n\r\nexport type PaintProps = {|\r\n    \"heatmap-radius\": DataDrivenProperty<number>,\r\n    \"heatmap-weight\": DataDrivenProperty<number>,\r\n    \"heatmap-intensity\": DataConstantProperty<number>,\r\n    \"heatmap-color\": HeatmapColorProperty,\r\n    \"heatmap-opacity\": DataConstantProperty<number>,\r\n|};\r\n\r\nconst paint: Properties<PaintProps> = new Properties({\r\n    \"heatmap-radius\": new DataDrivenProperty(styleSpec[\"paint_heatmap\"][\"heatmap-radius\"]),\r\n    \"heatmap-weight\": new DataDrivenProperty(styleSpec[\"paint_heatmap\"][\"heatmap-weight\"]),\r\n    \"heatmap-intensity\": new DataConstantProperty(styleSpec[\"paint_heatmap\"][\"heatmap-intensity\"]),\r\n    \"heatmap-color\": new HeatmapColorProperty(styleSpec[\"paint_heatmap\"][\"heatmap-color\"]),\r\n    \"heatmap-opacity\": new DataConstantProperty(styleSpec[\"paint_heatmap\"][\"heatmap-opacity\"]),\r\n});\r\n\r\nmodule.exports = { paint };\r\n","// @flow\r\n\r\nconst StyleLayer = require('../style_layer');\r\nconst properties = require('./hillshade_style_layer_properties');\r\n\r\nconst {\r\n    Transitionable,\r\n    Transitioning,\r\n    PossiblyEvaluated\r\n} = require('../properties');\r\n\r\nimport type {PaintProps} from './hillshade_style_layer_properties';\r\n\r\nclass HillshadeStyleLayer extends StyleLayer {\r\n    _transitionablePaint: Transitionable<PaintProps>;\r\n    _transitioningPaint: Transitioning<PaintProps>;\r\n    paint: PossiblyEvaluated<PaintProps>;\r\n\r\n    constructor(layer: LayerSpecification) {\r\n        super(layer, properties);\r\n    }\r\n\r\n    hasOffscreenPass() {\r\n        return this.paint.get('hillshade-exaggeration') !== 0 && this.visibility !== 'none';\r\n    }\r\n}\r\n\r\nmodule.exports = HillshadeStyleLayer;\r\n","// This file is generated. Edit build/generate-style-code.js, then run `yarn run codegen`.\r\n// @flow\r\n/* eslint-disable */\r\n\r\nconst styleSpec = require('../../style-spec/reference/latest');\r\n\r\nconst {\r\n    Properties,\r\n    DataConstantProperty,\r\n    DataDrivenProperty,\r\n    CrossFadedProperty,\r\n    HeatmapColorProperty\r\n} = require('../properties');\r\n\r\nimport type Color from '../../style-spec/util/color';\r\n\r\n\r\nexport type PaintProps = {|\r\n    \"hillshade-illumination-direction\": DataConstantProperty<number>,\r\n    \"hillshade-illumination-anchor\": DataConstantProperty<\"map\" | \"viewport\">,\r\n    \"hillshade-exaggeration\": DataConstantProperty<number>,\r\n    \"hillshade-shadow-color\": DataConstantProperty<Color>,\r\n    \"hillshade-highlight-color\": DataConstantProperty<Color>,\r\n    \"hillshade-accent-color\": DataConstantProperty<Color>,\r\n|};\r\n\r\nconst paint: Properties<PaintProps> = new Properties({\r\n    \"hillshade-illumination-direction\": new DataConstantProperty(styleSpec[\"paint_hillshade\"][\"hillshade-illumination-direction\"]),\r\n    \"hillshade-illumination-anchor\": new DataConstantProperty(styleSpec[\"paint_hillshade\"][\"hillshade-illumination-anchor\"]),\r\n    \"hillshade-exaggeration\": new DataConstantProperty(styleSpec[\"paint_hillshade\"][\"hillshade-exaggeration\"]),\r\n    \"hillshade-shadow-color\": new DataConstantProperty(styleSpec[\"paint_hillshade\"][\"hillshade-shadow-color\"]),\r\n    \"hillshade-highlight-color\": new DataConstantProperty(styleSpec[\"paint_hillshade\"][\"hillshade-highlight-color\"]),\r\n    \"hillshade-accent-color\": new DataConstantProperty(styleSpec[\"paint_hillshade\"][\"hillshade-accent-color\"]),\r\n});\r\n\r\nmodule.exports = { paint };\r\n","// @flow\r\n\r\nconst Point = require('@mapbox/point-geometry');\r\n\r\nconst StyleLayer = require('../style_layer');\r\nconst LineBucket = require('../../data/bucket/line_bucket');\r\nconst {multiPolygonIntersectsBufferedMultiLine} = require('../../util/intersection_tests');\r\nconst {getMaximumPaintValue, translateDistance, translate} = require('../query_utils');\r\nconst properties = require('./line_style_layer_properties');\r\nconst {extend} = require('../../util/util');\r\nconst EvaluationParameters = require('../evaluation_parameters');\r\n\r\nconst {\r\n    Transitionable,\r\n    Transitioning,\r\n    Layout,\r\n    PossiblyEvaluated,\r\n    DataDrivenProperty\r\n} = require('../properties');\r\n\r\nimport type {Bucket, BucketParameters} from '../../data/bucket';\r\nimport type {LayoutProps, PaintProps} from './line_style_layer_properties';\r\n\r\nclass LineFloorwidthProperty extends DataDrivenProperty<number> {\r\n    useIntegerZoom: true;\r\n\r\n    possiblyEvaluate(value, parameters) {\r\n        parameters = new EvaluationParameters(Math.floor(parameters.zoom), {\r\n            now: parameters.now,\r\n            fadeDuration: parameters.fadeDuration,\r\n            zoomHistory: parameters.zoomHistory,\r\n            transition: parameters.transition\r\n        });\r\n        return super.possiblyEvaluate(value, parameters);\r\n    }\r\n\r\n    evaluate(value, globals, feature) {\r\n        globals = extend({}, globals, {zoom: Math.floor(globals.zoom)});\r\n        return super.evaluate(value, globals, feature);\r\n    }\r\n}\r\n\r\nconst lineFloorwidthProperty = new LineFloorwidthProperty(properties.paint.properties['line-width'].specification);\r\nlineFloorwidthProperty.useIntegerZoom = true;\r\n\r\nclass LineStyleLayer extends StyleLayer {\r\n    _unevaluatedLayout: Layout<LayoutProps>;\r\n    layout: PossiblyEvaluated<LayoutProps>;\r\n\r\n    _transitionablePaint: Transitionable<PaintProps>;\r\n    _transitioningPaint: Transitioning<PaintProps>;\r\n    paint: PossiblyEvaluated<PaintProps>;\r\n\r\n    constructor(layer: LayerSpecification) {\r\n        super(layer, properties);\r\n    }\r\n\r\n    recalculate(parameters: EvaluationParameters) {\r\n        super.recalculate(parameters);\r\n\r\n        (this.paint._values: any)['line-floorwidth'] =\r\n            lineFloorwidthProperty.possiblyEvaluate(this._transitioningPaint._values['line-width'].value, parameters);\r\n    }\r\n\r\n    createBucket(parameters: BucketParameters<*>) {\r\n        return new LineBucket(parameters);\r\n    }\r\n\r\n    queryRadius(bucket: Bucket): number {\r\n        const lineBucket: LineBucket = (bucket: any);\r\n        const width = getLineWidth(\r\n            getMaximumPaintValue('line-width', this, lineBucket),\r\n            getMaximumPaintValue('line-gap-width', this, lineBucket));\r\n        const offset = getMaximumPaintValue('line-offset', this, lineBucket);\r\n        return width / 2 + Math.abs(offset) + translateDistance(this.paint.get('line-translate'));\r\n    }\r\n\r\n    queryIntersectsFeature(queryGeometry: Array<Array<Point>>,\r\n                           feature: VectorTileFeature,\r\n                           geometry: Array<Array<Point>>,\r\n                           zoom: number,\r\n                           bearing: number,\r\n                           pixelsToTileUnits: number): boolean {\r\n        const translatedPolygon = translate(queryGeometry,\r\n            this.paint.get('line-translate'),\r\n            this.paint.get('line-translate-anchor'),\r\n            bearing, pixelsToTileUnits);\r\n        const halfWidth = pixelsToTileUnits / 2 * getLineWidth(\r\n            this.paint.get('line-width').evaluate(feature),\r\n            this.paint.get('line-gap-width').evaluate(feature));\r\n        const lineOffset = this.paint.get('line-offset').evaluate(feature);\r\n        if (lineOffset) {\r\n            geometry = offsetLine(geometry, lineOffset * pixelsToTileUnits);\r\n        }\r\n        return multiPolygonIntersectsBufferedMultiLine(translatedPolygon, geometry, halfWidth);\r\n    }\r\n}\r\n\r\nmodule.exports = LineStyleLayer;\r\n\r\nfunction getLineWidth(lineWidth, lineGapWidth) {\r\n    if (lineGapWidth > 0) {\r\n        return lineGapWidth + 2 * lineWidth;\r\n    } else {\r\n        return lineWidth;\r\n    }\r\n}\r\n\r\nfunction offsetLine(rings, offset) {\r\n    const newRings = [];\r\n    const zero = new Point(0, 0);\r\n    for (let k = 0; k < rings.length; k++) {\r\n        const ring = rings[k];\r\n        const newRing = [];\r\n        for (let i = 0; i < ring.length; i++) {\r\n            const a = ring[i - 1];\r\n            const b = ring[i];\r\n            const c = ring[i + 1];\r\n            const aToB = i === 0 ? zero : b.sub(a)._unit()._perp();\r\n            const bToC = i === ring.length - 1 ? zero : c.sub(b)._unit()._perp();\r\n            const extrude = aToB._add(bToC)._unit();\r\n\r\n            const cosHalfAngle = extrude.x * bToC.x + extrude.y * bToC.y;\r\n            extrude._mult(1 / cosHalfAngle);\r\n\r\n            newRing.push(extrude._mult(offset)._add(b));\r\n        }\r\n        newRings.push(newRing);\r\n    }\r\n    return newRings;\r\n}\r\n","// This file is generated. Edit build/generate-style-code.js, then run `yarn run codegen`.\r\n// @flow\r\n/* eslint-disable */\r\n\r\nconst styleSpec = require('../../style-spec/reference/latest');\r\n\r\nconst {\r\n    Properties,\r\n    DataConstantProperty,\r\n    DataDrivenProperty,\r\n    CrossFadedProperty,\r\n    HeatmapColorProperty\r\n} = require('../properties');\r\n\r\nimport type Color from '../../style-spec/util/color';\r\n\r\nexport type LayoutProps = {|\r\n    \"line-cap\": DataConstantProperty<\"butt\" | \"round\" | \"square\">,\r\n    \"line-join\": DataDrivenProperty<\"bevel\" | \"round\" | \"miter\">,\r\n    \"line-miter-limit\": DataConstantProperty<number>,\r\n    \"line-round-limit\": DataConstantProperty<number>,\r\n|};\r\n\r\nconst layout: Properties<LayoutProps> = new Properties({\r\n    \"line-cap\": new DataConstantProperty(styleSpec[\"layout_line\"][\"line-cap\"]),\r\n    \"line-join\": new DataDrivenProperty(styleSpec[\"layout_line\"][\"line-join\"]),\r\n    \"line-miter-limit\": new DataConstantProperty(styleSpec[\"layout_line\"][\"line-miter-limit\"]),\r\n    \"line-round-limit\": new DataConstantProperty(styleSpec[\"layout_line\"][\"line-round-limit\"]),\r\n});\r\n\r\nexport type PaintProps = {|\r\n    \"line-opacity\": DataDrivenProperty<number>,\r\n    \"line-color\": DataDrivenProperty<Color>,\r\n    \"line-translate\": DataConstantProperty<[number, number]>,\r\n    \"line-translate-anchor\": DataConstantProperty<\"map\" | \"viewport\">,\r\n    \"line-width\": DataDrivenProperty<number>,\r\n    \"line-gap-width\": DataDrivenProperty<number>,\r\n    \"line-offset\": DataDrivenProperty<number>,\r\n    \"line-blur\": DataDrivenProperty<number>,\r\n    \"line-dasharray\": CrossFadedProperty<Array<number>>,\r\n    \"line-pattern\": CrossFadedProperty<string>,\r\n|};\r\n\r\nconst paint: Properties<PaintProps> = new Properties({\r\n    \"line-opacity\": new DataDrivenProperty(styleSpec[\"paint_line\"][\"line-opacity\"]),\r\n    \"line-color\": new DataDrivenProperty(styleSpec[\"paint_line\"][\"line-color\"]),\r\n    \"line-translate\": new DataConstantProperty(styleSpec[\"paint_line\"][\"line-translate\"]),\r\n    \"line-translate-anchor\": new DataConstantProperty(styleSpec[\"paint_line\"][\"line-translate-anchor\"]),\r\n    \"line-width\": new DataDrivenProperty(styleSpec[\"paint_line\"][\"line-width\"]),\r\n    \"line-gap-width\": new DataDrivenProperty(styleSpec[\"paint_line\"][\"line-gap-width\"]),\r\n    \"line-offset\": new DataDrivenProperty(styleSpec[\"paint_line\"][\"line-offset\"]),\r\n    \"line-blur\": new DataDrivenProperty(styleSpec[\"paint_line\"][\"line-blur\"]),\r\n    \"line-dasharray\": new CrossFadedProperty(styleSpec[\"paint_line\"][\"line-dasharray\"]),\r\n    \"line-pattern\": new CrossFadedProperty(styleSpec[\"paint_line\"][\"line-pattern\"]),\r\n});\r\n\r\nmodule.exports = { paint, layout };\r\n","// @flow\r\n\r\nconst StyleLayer = require('../style_layer');\r\nconst properties = require('./raster_style_layer_properties');\r\n\r\nconst {\r\n    Transitionable,\r\n    Transitioning,\r\n    PossiblyEvaluated\r\n} = require('../properties');\r\n\r\nimport type {PaintProps} from './raster_style_layer_properties';\r\n\r\nclass RasterStyleLayer extends StyleLayer {\r\n    _transitionablePaint: Transitionable<PaintProps>;\r\n    _transitioningPaint: Transitioning<PaintProps>;\r\n    paint: PossiblyEvaluated<PaintProps>;\r\n\r\n    constructor(layer: LayerSpecification) {\r\n        super(layer, properties);\r\n    }\r\n}\r\n\r\nmodule.exports = RasterStyleLayer;\r\n","// This file is generated. Edit build/generate-style-code.js, then run `yarn run codegen`.\r\n// @flow\r\n/* eslint-disable */\r\n\r\nconst styleSpec = require('../../style-spec/reference/latest');\r\n\r\nconst {\r\n    Properties,\r\n    DataConstantProperty,\r\n    DataDrivenProperty,\r\n    CrossFadedProperty,\r\n    HeatmapColorProperty\r\n} = require('../properties');\r\n\r\nimport type Color from '../../style-spec/util/color';\r\n\r\n\r\nexport type PaintProps = {|\r\n    \"raster-opacity\": DataConstantProperty<number>,\r\n    \"raster-hue-rotate\": DataConstantProperty<number>,\r\n    \"raster-brightness-min\": DataConstantProperty<number>,\r\n    \"raster-brightness-max\": DataConstantProperty<number>,\r\n    \"raster-saturation\": DataConstantProperty<number>,\r\n    \"raster-contrast\": DataConstantProperty<number>,\r\n    \"raster-fade-duration\": DataConstantProperty<number>,\r\n|};\r\n\r\nconst paint: Properties<PaintProps> = new Properties({\r\n    \"raster-opacity\": new DataConstantProperty(styleSpec[\"paint_raster\"][\"raster-opacity\"]),\r\n    \"raster-hue-rotate\": new DataConstantProperty(styleSpec[\"paint_raster\"][\"raster-hue-rotate\"]),\r\n    \"raster-brightness-min\": new DataConstantProperty(styleSpec[\"paint_raster\"][\"raster-brightness-min\"]),\r\n    \"raster-brightness-max\": new DataConstantProperty(styleSpec[\"paint_raster\"][\"raster-brightness-max\"]),\r\n    \"raster-saturation\": new DataConstantProperty(styleSpec[\"paint_raster\"][\"raster-saturation\"]),\r\n    \"raster-contrast\": new DataConstantProperty(styleSpec[\"paint_raster\"][\"raster-contrast\"]),\r\n    \"raster-fade-duration\": new DataConstantProperty(styleSpec[\"paint_raster\"][\"raster-fade-duration\"]),\r\n});\r\n\r\nmodule.exports = { paint };\r\n","// @flow\r\n\r\nconst StyleLayer = require('../style_layer');\r\nconst SymbolBucket = require('../../data/bucket/symbol_bucket');\r\nconst resolveTokens = require('../../util/token');\r\nconst {isExpression} = require('../../style-spec/expression');\r\nconst assert = require('assert');\r\nconst properties = require('./symbol_style_layer_properties');\r\n\r\nconst {\r\n    Transitionable,\r\n    Transitioning,\r\n    Layout,\r\n    PossiblyEvaluated\r\n} = require('../properties');\r\n\r\nimport type {BucketParameters} from '../../data/bucket';\r\nimport type {LayoutProps, PaintProps} from './symbol_style_layer_properties';\r\nimport type {Feature} from '../../style-spec/expression';\r\nimport type EvaluationParameters from '../evaluation_parameters';\r\n\r\nclass SymbolStyleLayer extends StyleLayer {\r\n    _unevaluatedLayout: Layout<LayoutProps>;\r\n    layout: PossiblyEvaluated<LayoutProps>;\r\n\r\n    _transitionablePaint: Transitionable<PaintProps>;\r\n    _transitioningPaint: Transitioning<PaintProps>;\r\n    paint: PossiblyEvaluated<PaintProps>;\r\n\r\n    constructor(layer: LayerSpecification) {\r\n        super(layer, properties);\r\n    }\r\n\r\n    recalculate(parameters: EvaluationParameters) {\r\n        super.recalculate(parameters);\r\n\r\n        if (this.layout.get('icon-rotation-alignment') === 'auto') {\r\n            if (this.layout.get('symbol-placement') === 'line') {\r\n                this.layout._values['icon-rotation-alignment'] = 'map';\r\n            } else {\r\n                this.layout._values['icon-rotation-alignment'] = 'viewport';\r\n            }\r\n        }\r\n\r\n        if (this.layout.get('text-rotation-alignment') === 'auto') {\r\n            if (this.layout.get('symbol-placement') === 'line') {\r\n                this.layout._values['text-rotation-alignment'] = 'map';\r\n            } else {\r\n                this.layout._values['text-rotation-alignment'] = 'viewport';\r\n            }\r\n        }\r\n\r\n        // If unspecified, `*-pitch-alignment` inherits `*-rotation-alignment`\r\n        if (this.layout.get('text-pitch-alignment') === 'auto') {\r\n            this.layout._values['text-pitch-alignment'] = this.layout.get('text-rotation-alignment');\r\n        }\r\n        if (this.layout.get('icon-pitch-alignment') === 'auto') {\r\n            this.layout._values['icon-pitch-alignment'] = this.layout.get('icon-rotation-alignment');\r\n        }\r\n    }\r\n\r\n    getValueAndResolveTokens(name: *, feature: Feature) {\r\n        const value = this.layout.get(name).evaluate(feature);\r\n        const unevaluated = this._unevaluatedLayout._values[name];\r\n        if (!unevaluated.isDataDriven() && !isExpression(unevaluated.value)) {\r\n            return resolveTokens(feature.properties, value);\r\n        }\r\n\r\n        return value;\r\n    }\r\n\r\n    createBucket(parameters: BucketParameters<*>) {\r\n        return new SymbolBucket(parameters);\r\n    }\r\n\r\n    queryRadius(): number {\r\n        return 0;\r\n    }\r\n\r\n    queryIntersectsFeature(): boolean {\r\n        assert(false); // Should take a different path in FeatureIndex\r\n        return false;\r\n    }\r\n}\r\n\r\nmodule.exports = SymbolStyleLayer;\r\n","// This file is generated. Edit build/generate-style-code.js, then run `yarn run codegen`.\r\n// @flow\r\n/* eslint-disable */\r\n\r\nconst styleSpec = require('../../style-spec/reference/latest');\r\n\r\nconst {\r\n    Properties,\r\n    DataConstantProperty,\r\n    DataDrivenProperty,\r\n    CrossFadedProperty,\r\n    HeatmapColorProperty\r\n} = require('../properties');\r\n\r\nimport type Color from '../../style-spec/util/color';\r\n\r\nexport type LayoutProps = {|\r\n    \"symbol-placement\": DataConstantProperty<\"point\" | \"line\">,\r\n    \"symbol-spacing\": DataConstantProperty<number>,\r\n    \"symbol-avoid-edges\": DataConstantProperty<boolean>,\r\n    \"icon-allow-overlap\": DataConstantProperty<boolean>,\r\n    \"icon-ignore-placement\": DataConstantProperty<boolean>,\r\n    \"icon-optional\": DataConstantProperty<boolean>,\r\n    \"icon-rotation-alignment\": DataConstantProperty<\"map\" | \"viewport\" | \"auto\">,\r\n    \"icon-size\": DataDrivenProperty<number>,\r\n    \"icon-text-fit\": DataConstantProperty<\"none\" | \"width\" | \"height\" | \"both\">,\r\n    \"icon-text-fit-padding\": DataConstantProperty<[number, number, number, number]>,\r\n    \"icon-image\": DataDrivenProperty<string>,\r\n    \"icon-rotate\": DataDrivenProperty<number>,\r\n    \"icon-padding\": DataConstantProperty<number>,\r\n    \"icon-keep-upright\": DataConstantProperty<boolean>,\r\n    \"icon-offset\": DataDrivenProperty<[number, number]>,\r\n    \"icon-anchor\": DataDrivenProperty<\"center\" | \"left\" | \"right\" | \"top\" | \"bottom\" | \"top-left\" | \"top-right\" | \"bottom-left\" | \"bottom-right\">,\r\n    \"icon-pitch-alignment\": DataConstantProperty<\"map\" | \"viewport\" | \"auto\">,\r\n    \"text-pitch-alignment\": DataConstantProperty<\"map\" | \"viewport\" | \"auto\">,\r\n    \"text-rotation-alignment\": DataConstantProperty<\"map\" | \"viewport\" | \"auto\">,\r\n    \"text-field\": DataDrivenProperty<string>,\r\n    \"text-font\": DataDrivenProperty<Array<string>>,\r\n    \"text-size\": DataDrivenProperty<number>,\r\n    \"text-max-width\": DataDrivenProperty<number>,\r\n    \"text-line-height\": DataConstantProperty<number>,\r\n    \"text-letter-spacing\": DataDrivenProperty<number>,\r\n    \"text-justify\": DataDrivenProperty<\"left\" | \"center\" | \"right\">,\r\n    \"text-anchor\": DataDrivenProperty<\"center\" | \"left\" | \"right\" | \"top\" | \"bottom\" | \"top-left\" | \"top-right\" | \"bottom-left\" | \"bottom-right\">,\r\n    \"text-max-angle\": DataConstantProperty<number>,\r\n    \"text-rotate\": DataDrivenProperty<number>,\r\n    \"text-padding\": DataConstantProperty<number>,\r\n    \"text-keep-upright\": DataConstantProperty<boolean>,\r\n    \"text-transform\": DataDrivenProperty<\"none\" | \"uppercase\" | \"lowercase\">,\r\n    \"text-offset\": DataDrivenProperty<[number, number]>,\r\n    \"text-allow-overlap\": DataConstantProperty<boolean>,\r\n    \"text-ignore-placement\": DataConstantProperty<boolean>,\r\n    \"text-optional\": DataConstantProperty<boolean>,\r\n|};\r\n\r\nconst layout: Properties<LayoutProps> = new Properties({\r\n    \"symbol-placement\": new DataConstantProperty(styleSpec[\"layout_symbol\"][\"symbol-placement\"]),\r\n    \"symbol-spacing\": new DataConstantProperty(styleSpec[\"layout_symbol\"][\"symbol-spacing\"]),\r\n    \"symbol-avoid-edges\": new DataConstantProperty(styleSpec[\"layout_symbol\"][\"symbol-avoid-edges\"]),\r\n    \"icon-allow-overlap\": new DataConstantProperty(styleSpec[\"layout_symbol\"][\"icon-allow-overlap\"]),\r\n    \"icon-ignore-placement\": new DataConstantProperty(styleSpec[\"layout_symbol\"][\"icon-ignore-placement\"]),\r\n    \"icon-optional\": new DataConstantProperty(styleSpec[\"layout_symbol\"][\"icon-optional\"]),\r\n    \"icon-rotation-alignment\": new DataConstantProperty(styleSpec[\"layout_symbol\"][\"icon-rotation-alignment\"]),\r\n    \"icon-size\": new DataDrivenProperty(styleSpec[\"layout_symbol\"][\"icon-size\"]),\r\n    \"icon-text-fit\": new DataConstantProperty(styleSpec[\"layout_symbol\"][\"icon-text-fit\"]),\r\n    \"icon-text-fit-padding\": new DataConstantProperty(styleSpec[\"layout_symbol\"][\"icon-text-fit-padding\"]),\r\n    \"icon-image\": new DataDrivenProperty(styleSpec[\"layout_symbol\"][\"icon-image\"]),\r\n    \"icon-rotate\": new DataDrivenProperty(styleSpec[\"layout_symbol\"][\"icon-rotate\"]),\r\n    \"icon-padding\": new DataConstantProperty(styleSpec[\"layout_symbol\"][\"icon-padding\"]),\r\n    \"icon-keep-upright\": new DataConstantProperty(styleSpec[\"layout_symbol\"][\"icon-keep-upright\"]),\r\n    \"icon-offset\": new DataDrivenProperty(styleSpec[\"layout_symbol\"][\"icon-offset\"]),\r\n    \"icon-anchor\": new DataDrivenProperty(styleSpec[\"layout_symbol\"][\"icon-anchor\"]),\r\n    \"icon-pitch-alignment\": new DataConstantProperty(styleSpec[\"layout_symbol\"][\"icon-pitch-alignment\"]),\r\n    \"text-pitch-alignment\": new DataConstantProperty(styleSpec[\"layout_symbol\"][\"text-pitch-alignment\"]),\r\n    \"text-rotation-alignment\": new DataConstantProperty(styleSpec[\"layout_symbol\"][\"text-rotation-alignment\"]),\r\n    \"text-field\": new DataDrivenProperty(styleSpec[\"layout_symbol\"][\"text-field\"]),\r\n    \"text-font\": new DataDrivenProperty(styleSpec[\"layout_symbol\"][\"text-font\"]),\r\n    \"text-size\": new DataDrivenProperty(styleSpec[\"layout_symbol\"][\"text-size\"]),\r\n    \"text-max-width\": new DataDrivenProperty(styleSpec[\"layout_symbol\"][\"text-max-width\"]),\r\n    \"text-line-height\": new DataConstantProperty(styleSpec[\"layout_symbol\"][\"text-line-height\"]),\r\n    \"text-letter-spacing\": new DataDrivenProperty(styleSpec[\"layout_symbol\"][\"text-letter-spacing\"]),\r\n    \"text-justify\": new DataDrivenProperty(styleSpec[\"layout_symbol\"][\"text-justify\"]),\r\n    \"text-anchor\": new DataDrivenProperty(styleSpec[\"layout_symbol\"][\"text-anchor\"]),\r\n    \"text-max-angle\": new DataConstantProperty(styleSpec[\"layout_symbol\"][\"text-max-angle\"]),\r\n    \"text-rotate\": new DataDrivenProperty(styleSpec[\"layout_symbol\"][\"text-rotate\"]),\r\n    \"text-padding\": new DataConstantProperty(styleSpec[\"layout_symbol\"][\"text-padding\"]),\r\n    \"text-keep-upright\": new DataConstantProperty(styleSpec[\"layout_symbol\"][\"text-keep-upright\"]),\r\n    \"text-transform\": new DataDrivenProperty(styleSpec[\"layout_symbol\"][\"text-transform\"]),\r\n    \"text-offset\": new DataDrivenProperty(styleSpec[\"layout_symbol\"][\"text-offset\"]),\r\n    \"text-allow-overlap\": new DataConstantProperty(styleSpec[\"layout_symbol\"][\"text-allow-overlap\"]),\r\n    \"text-ignore-placement\": new DataConstantProperty(styleSpec[\"layout_symbol\"][\"text-ignore-placement\"]),\r\n    \"text-optional\": new DataConstantProperty(styleSpec[\"layout_symbol\"][\"text-optional\"]),\r\n});\r\n\r\nexport type PaintProps = {|\r\n    \"icon-opacity\": DataDrivenProperty<number>,\r\n    \"icon-color\": DataDrivenProperty<Color>,\r\n    \"icon-halo-color\": DataDrivenProperty<Color>,\r\n    \"icon-halo-width\": DataDrivenProperty<number>,\r\n    \"icon-halo-blur\": DataDrivenProperty<number>,\r\n    \"icon-translate\": DataConstantProperty<[number, number]>,\r\n    \"icon-translate-anchor\": DataConstantProperty<\"map\" | \"viewport\">,\r\n    \"text-opacity\": DataDrivenProperty<number>,\r\n    \"text-color\": DataDrivenProperty<Color>,\r\n    \"text-halo-color\": DataDrivenProperty<Color>,\r\n    \"text-halo-width\": DataDrivenProperty<number>,\r\n    \"text-halo-blur\": DataDrivenProperty<number>,\r\n    \"text-translate\": DataConstantProperty<[number, number]>,\r\n    \"text-translate-anchor\": DataConstantProperty<\"map\" | \"viewport\">,\r\n|};\r\n\r\nconst paint: Properties<PaintProps> = new Properties({\r\n    \"icon-opacity\": new DataDrivenProperty(styleSpec[\"paint_symbol\"][\"icon-opacity\"]),\r\n    \"icon-color\": new DataDrivenProperty(styleSpec[\"paint_symbol\"][\"icon-color\"]),\r\n    \"icon-halo-color\": new DataDrivenProperty(styleSpec[\"paint_symbol\"][\"icon-halo-color\"]),\r\n    \"icon-halo-width\": new DataDrivenProperty(styleSpec[\"paint_symbol\"][\"icon-halo-width\"]),\r\n    \"icon-halo-blur\": new DataDrivenProperty(styleSpec[\"paint_symbol\"][\"icon-halo-blur\"]),\r\n    \"icon-translate\": new DataConstantProperty(styleSpec[\"paint_symbol\"][\"icon-translate\"]),\r\n    \"icon-translate-anchor\": new DataConstantProperty(styleSpec[\"paint_symbol\"][\"icon-translate-anchor\"]),\r\n    \"text-opacity\": new DataDrivenProperty(styleSpec[\"paint_symbol\"][\"text-opacity\"]),\r\n    \"text-color\": new DataDrivenProperty(styleSpec[\"paint_symbol\"][\"text-color\"]),\r\n    \"text-halo-color\": new DataDrivenProperty(styleSpec[\"paint_symbol\"][\"text-halo-color\"]),\r\n    \"text-halo-width\": new DataDrivenProperty(styleSpec[\"paint_symbol\"][\"text-halo-width\"]),\r\n    \"text-halo-blur\": new DataDrivenProperty(styleSpec[\"paint_symbol\"][\"text-halo-blur\"]),\r\n    \"text-translate\": new DataConstantProperty(styleSpec[\"paint_symbol\"][\"text-translate\"]),\r\n    \"text-translate-anchor\": new DataConstantProperty(styleSpec[\"paint_symbol\"][\"text-translate-anchor\"]),\r\n});\r\n\r\nmodule.exports = { paint, layout };\r\n","// @flow\r\n\r\nconst StyleLayer = require('./style_layer');\r\nconst util = require('../util/util');\r\nconst featureFilter = require('../style-spec/feature_filter');\r\nconst groupByLayout = require('../style-spec/group_by_layout');\r\n\r\nimport type {TypedStyleLayer} from './style_layer/typed_style_layer';\r\n\r\nexport type LayerConfigs = { [string]: LayerSpecification };\r\nexport type Family<Layer: TypedStyleLayer> = Array<Layer>;\r\n\r\nclass StyleLayerIndex {\r\n    familiesBySource: { [source: string]: { [sourceLayer: string]: Array<Family<*>> } };\r\n\r\n    _layerConfigs: LayerConfigs;\r\n    _layers: { [string]: StyleLayer };\r\n\r\n    constructor(layerConfigs: ?Array<LayerSpecification>) {\r\n        if (layerConfigs) {\r\n            this.replace(layerConfigs);\r\n        }\r\n    }\r\n\r\n    replace(layerConfigs: Array<LayerSpecification>) {\r\n        this._layerConfigs = {};\r\n        this._layers = {};\r\n        this.update(layerConfigs, []);\r\n    }\r\n\r\n    update(layerConfigs: Array<LayerSpecification>, removedIds: Array<string>) {\r\n        for (const layerConfig of layerConfigs) {\r\n            this._layerConfigs[layerConfig.id] = layerConfig;\r\n\r\n            const layer = this._layers[layerConfig.id] = StyleLayer.create(layerConfig);\r\n            layer._featureFilter = featureFilter(layer.filter);\r\n        }\r\n        for (const id of removedIds) {\r\n            delete this._layerConfigs[id];\r\n            delete this._layers[id];\r\n        }\r\n\r\n        this.familiesBySource = {};\r\n\r\n        const groups = groupByLayout(util.values(this._layerConfigs));\r\n\r\n        for (const layerConfigs of groups) {\r\n            const layers = layerConfigs.map((layerConfig) => this._layers[layerConfig.id]);\r\n\r\n            const layer = layers[0];\r\n            if (layer.visibility === 'none') {\r\n                continue;\r\n            }\r\n\r\n            const sourceId = layer.source || '';\r\n            let sourceGroup = this.familiesBySource[sourceId];\r\n            if (!sourceGroup) {\r\n                sourceGroup = this.familiesBySource[sourceId] = {};\r\n            }\r\n\r\n            const sourceLayerId = layer.sourceLayer || '_geojsonTileLayer';\r\n            let sourceLayerFamilies = sourceGroup[sourceLayerId];\r\n            if (!sourceLayerFamilies) {\r\n                sourceLayerFamilies = sourceGroup[sourceLayerId] = [];\r\n            }\r\n\r\n            sourceLayerFamilies.push(layers);\r\n        }\r\n    }\r\n}\r\n\r\nmodule.exports = StyleLayerIndex;\r\n","// @flow\r\n\r\nmodule.exports = require('../style-spec/validate_style.min');\r\n\r\nimport type Evented from '../util/evented';\r\n\r\nmodule.exports.emitErrors = function (emitter: Evented, errors: ?Array<{message: string}>) {\r\n    if (errors && errors.length) {\r\n        for (const {message} of errors) {\r\n            emitter.fire('error', { error: new Error(message) });\r\n        }\r\n        return true;\r\n    } else {\r\n        return false;\r\n    }\r\n};\r\n","// @flow\r\n\r\nclass ZoomHistory {\r\n    lastZoom: number;\r\n    lastFloorZoom: number;\r\n    lastIntegerZoom: number;\r\n    lastIntegerZoomTime: number;\r\n    first: boolean;\r\n\r\n    constructor() {\r\n        this.first = true;\r\n    }\r\n\r\n    update(z: number, now: number) {\r\n        const floorZ = Math.floor(z);\r\n\r\n        if (this.first) {\r\n            this.first = false;\r\n            this.lastIntegerZoom = floorZ;\r\n            this.lastIntegerZoomTime = 0;\r\n            this.lastZoom = z;\r\n            this.lastFloorZoom = floorZ;\r\n            return true;\r\n        }\r\n\r\n        if (this.lastFloorZoom > floorZ) {\r\n            this.lastIntegerZoom = floorZ + 1;\r\n            this.lastIntegerZoomTime = now;\r\n        } else if (this.lastFloorZoom < floorZ) {\r\n            this.lastIntegerZoom = floorZ;\r\n            this.lastIntegerZoomTime = now;\r\n        }\r\n\r\n        if (z !== this.lastZoom) {\r\n            this.lastZoom = z;\r\n            this.lastFloorZoom = floorZ;\r\n            return true;\r\n        }\r\n\r\n        return false;\r\n    }\r\n}\r\n\r\nmodule.exports = ZoomHistory;\r\n","// @flow\r\n\r\nconst Point = require('@mapbox/point-geometry');\r\nconst {register} = require('../util/web_worker_transfer');\r\n\r\nclass Anchor extends Point {\r\n    angle: any;\r\n    segment: number | void;\r\n\r\n    constructor(x: number, y: number, angle: number, segment?: number) {\r\n        super(x, y);\r\n        this.angle = angle;\r\n        if (segment !== undefined) {\r\n            this.segment = segment;\r\n        }\r\n    }\r\n\r\n    clone() {\r\n        return new Anchor(this.x, this.y, this.angle, this.segment);\r\n    }\r\n}\r\n\r\nregister('Anchor', Anchor);\r\n\r\nmodule.exports = Anchor;\r\n","// @flow\r\n\r\nmodule.exports = checkMaxAngle;\r\n\r\nimport type Point from '@mapbox/point-geometry';\r\nimport type Anchor from './anchor';\r\n\r\n/**\r\n * Labels placed around really sharp angles aren't readable. Check if any\r\n * part of the potential label has a combined angle that is too big.\r\n *\r\n * @param line\r\n * @param anchor The point on the line around which the label is anchored.\r\n * @param labelLength The length of the label in geometry units.\r\n * @param windowSize The check fails if the combined angles within a part of the line that is `windowSize` long is too big.\r\n * @param maxAngle The maximum combined angle that any window along the label is allowed to have.\r\n *\r\n * @returns {boolean} whether the label should be placed\r\n * @private\r\n */\r\nfunction checkMaxAngle(line: Array<Point>, anchor: Anchor, labelLength: number, windowSize: number, maxAngle: number) {\r\n\r\n    // horizontal labels always pass\r\n    if (anchor.segment === undefined) return true;\r\n\r\n    let p = anchor;\r\n    let index = anchor.segment + 1;\r\n    let anchorDistance = 0;\r\n\r\n    // move backwards along the line to the first segment the label appears on\r\n    while (anchorDistance > -labelLength / 2) {\r\n        index--;\r\n\r\n        // there isn't enough room for the label after the beginning of the line\r\n        if (index < 0) return false;\r\n\r\n        anchorDistance -= line[index].dist(p);\r\n        p = line[index];\r\n    }\r\n\r\n    anchorDistance += line[index].dist(line[index + 1]);\r\n    index++;\r\n\r\n    // store recent corners and their total angle difference\r\n    const recentCorners = [];\r\n    let recentAngleDelta = 0;\r\n\r\n    // move forwards by the length of the label and check angles along the way\r\n    while (anchorDistance < labelLength / 2) {\r\n        const prev = line[index - 1];\r\n        const current = line[index];\r\n        const next = line[index + 1];\r\n\r\n        // there isn't enough room for the label before the end of the line\r\n        if (!next) return false;\r\n\r\n        let angleDelta = prev.angleTo(current) - current.angleTo(next);\r\n        // restrict angle to -pi..pi range\r\n        angleDelta = Math.abs(((angleDelta + 3 * Math.PI) % (Math.PI * 2)) - Math.PI);\r\n\r\n        recentCorners.push({\r\n            distance: anchorDistance,\r\n            angleDelta: angleDelta\r\n        });\r\n        recentAngleDelta += angleDelta;\r\n\r\n        // remove corners that are far enough away from the list of recent anchors\r\n        while (anchorDistance - recentCorners[0].distance > windowSize) {\r\n            recentAngleDelta -= recentCorners.shift().angleDelta;\r\n        }\r\n\r\n        // the sum of angles within the window area exceeds the maximum allowed value. check fails.\r\n        if (recentAngleDelta > maxAngle) return false;\r\n\r\n        index++;\r\n        anchorDistance += current.dist(next);\r\n    }\r\n\r\n    // no part of the line had an angle greater than the maximum allowed. check passes.\r\n    return true;\r\n}\r\n","// @flow\r\n\r\nconst Point = require('@mapbox/point-geometry');\r\n\r\nmodule.exports = clipLine;\r\n\r\n/**\r\n * Returns the part of a multiline that intersects with the provided rectangular box.\r\n *\r\n * @param lines\r\n * @param x1 the left edge of the box\r\n * @param y1 the top edge of the box\r\n * @param x2 the right edge of the box\r\n * @param y2 the bottom edge of the box\r\n * @returns lines\r\n * @private\r\n */\r\nfunction clipLine(lines: Array<Array<Point>>, x1: number, y1: number, x2: number, y2: number): Array<Array<Point>> {\r\n    const clippedLines = [];\r\n\r\n    for (let l = 0; l < lines.length; l++) {\r\n        const line = lines[l];\r\n        let clippedLine;\r\n\r\n        for (let i = 0; i < line.length - 1; i++) {\r\n            let p0 = line[i];\r\n            let p1 = line[i + 1];\r\n\r\n\r\n            if (p0.x < x1 && p1.x < x1) {\r\n                continue;\r\n            } else if (p0.x < x1) {\r\n                p0 = new Point(x1, p0.y + (p1.y - p0.y) * ((x1 - p0.x) / (p1.x - p0.x)))._round();\r\n            } else if (p1.x < x1) {\r\n                p1 = new Point(x1, p0.y + (p1.y - p0.y) * ((x1 - p0.x) / (p1.x - p0.x)))._round();\r\n            }\r\n\r\n            if (p0.y < y1 && p1.y < y1) {\r\n                continue;\r\n            } else if (p0.y < y1) {\r\n                p0 = new Point(p0.x + (p1.x - p0.x) * ((y1 - p0.y) / (p1.y - p0.y)), y1)._round();\r\n            } else if (p1.y < y1) {\r\n                p1 = new Point(p0.x + (p1.x - p0.x) * ((y1 - p0.y) / (p1.y - p0.y)), y1)._round();\r\n            }\r\n\r\n            if (p0.x >= x2 && p1.x >= x2) {\r\n                continue;\r\n            } else if (p0.x >= x2) {\r\n                p0 = new Point(x2, p0.y + (p1.y - p0.y) * ((x2 - p0.x) / (p1.x - p0.x)))._round();\r\n            } else if (p1.x >= x2) {\r\n                p1 = new Point(x2, p0.y + (p1.y - p0.y) * ((x2 - p0.x) / (p1.x - p0.x)))._round();\r\n            }\r\n\r\n            if (p0.y >= y2 && p1.y >= y2) {\r\n                continue;\r\n            } else if (p0.y >= y2) {\r\n                p0 = new Point(p0.x + (p1.x - p0.x) * ((y2 - p0.y) / (p1.y - p0.y)), y2)._round();\r\n            } else if (p1.y >= y2) {\r\n                p1 = new Point(p0.x + (p1.x - p0.x) * ((y2 - p0.y) / (p1.y - p0.y)), y2)._round();\r\n            }\r\n\r\n            if (!clippedLine || !p0.equals(clippedLine[clippedLine.length - 1])) {\r\n                clippedLine = [p0];\r\n                clippedLines.push(clippedLine);\r\n            }\r\n\r\n            clippedLine.push(p1);\r\n        }\r\n    }\r\n\r\n    return clippedLines;\r\n}\r\n","// @flow\r\n\r\nimport type {CollisionBoxArray} from '../data/array_types';\r\nimport type Point from '@mapbox/point-geometry';\r\nimport type Anchor from './anchor';\r\n\r\n/**\r\n * A CollisionFeature represents the area of the tile covered by a single label.\r\n * It is used with CollisionIndex to check if the label overlaps with any\r\n * previous labels. A CollisionFeature is mostly just a set of CollisionBox\r\n * objects.\r\n *\r\n * @private\r\n */\r\nclass CollisionFeature {\r\n    boxStartIndex: number;\r\n    boxEndIndex: number;\r\n\r\n    /**\r\n     * Create a CollisionFeature, adding its collision box data to the given collisionBoxArray in the process.\r\n     *\r\n     * @param line The geometry the label is placed on.\r\n     * @param anchor The point along the line around which the label is anchored.\r\n     * @param shaped The text or icon shaping results.\r\n     * @param boxScale A magic number used to convert from glyph metrics units to geometry units.\r\n     * @param padding The amount of padding to add around the label edges.\r\n     * @param alignLine Whether the label is aligned with the line or the viewport.\r\n     */\r\n    constructor(collisionBoxArray: CollisionBoxArray,\r\n                line: Array<Point>,\r\n                anchor: Anchor,\r\n                featureIndex: number,\r\n                sourceLayerIndex: number,\r\n                bucketIndex: number,\r\n                shaped: Object,\r\n                boxScale: number,\r\n                padding: number,\r\n                alignLine: boolean,\r\n                overscaling: number) {\r\n        const y1 = shaped.top * boxScale - padding;\r\n        const y2 = shaped.bottom * boxScale + padding;\r\n        const x1 = shaped.left * boxScale - padding;\r\n        const x2 = shaped.right * boxScale + padding;\r\n\r\n        this.boxStartIndex = collisionBoxArray.length;\r\n\r\n        if (alignLine) {\r\n\r\n            let height = y2 - y1;\r\n            const length = x2 - x1;\r\n\r\n            if (height > 0) {\r\n                // set minimum box height to avoid very many small labels\r\n                height = Math.max(10 * boxScale, height);\r\n\r\n                this._addLineCollisionCircles(collisionBoxArray, line, anchor, (anchor.segment: any), length, height, featureIndex, sourceLayerIndex, bucketIndex, overscaling);\r\n            }\r\n\r\n        } else {\r\n            collisionBoxArray.emplaceBack(anchor.x, anchor.y, x1, y1, x2, y2, featureIndex, sourceLayerIndex, bucketIndex,\r\n                0, 0);\r\n        }\r\n\r\n        this.boxEndIndex = collisionBoxArray.length;\r\n    }\r\n\r\n    /**\r\n     * Create a set of CollisionBox objects for a line.\r\n     *\r\n     * @param labelLength The length of the label in geometry units.\r\n     * @param anchor The point along the line around which the label is anchored.\r\n     * @param boxSize The size of the collision boxes that will be created.\r\n     * @private\r\n     */\r\n    _addLineCollisionCircles(collisionBoxArray: CollisionBoxArray,\r\n                           line: Array<Point>,\r\n                           anchor: Anchor,\r\n                           segment: number,\r\n                           labelLength: number,\r\n                           boxSize: number,\r\n                           featureIndex: number,\r\n                           sourceLayerIndex: number,\r\n                           bucketIndex: number,\r\n                           overscaling: number) {\r\n        const step = boxSize / 2;\r\n        const nBoxes = Math.floor(labelLength / step);\r\n        // We calculate line collision circles out to 300% of what would normally be our\r\n        // max size, to allow collision detection to work on labels that expand as\r\n        // they move into the distance\r\n        // Vertically oriented labels in the distant field can extend past this padding\r\n        // This is a noticeable problem in overscaled tiles where the pitch 0-based\r\n        // symbol spacing will put labels very close together in a pitched map.\r\n        // To reduce the cost of adding extra collision circles, we slowly increase\r\n        // them for overscaled tiles.\r\n        const overscalingPaddingFactor = 1 + .4 * Math.log(overscaling) / Math.LN2;\r\n        const nPitchPaddingBoxes = Math.floor(nBoxes * overscalingPaddingFactor / 2);\r\n\r\n        // offset the center of the first box by half a box so that the edge of the\r\n        // box is at the edge of the label.\r\n        const firstBoxOffset = -boxSize / 2;\r\n\r\n        let p = anchor;\r\n        let index = segment + 1;\r\n        let anchorDistance = firstBoxOffset;\r\n        const labelStartDistance = -labelLength / 2;\r\n        const paddingStartDistance = labelStartDistance - labelLength / 4;\r\n        // move backwards along the line to the first segment the label appears on\r\n        do {\r\n            index--;\r\n\r\n            if (index < 0) {\r\n                if (anchorDistance > labelStartDistance) {\r\n                    // there isn't enough room for the label after the beginning of the line\r\n                    // checkMaxAngle should have already caught this\r\n                    return;\r\n                } else {\r\n                    // The line doesn't extend far enough back for all of our padding,\r\n                    // but we got far enough to show the label under most conditions.\r\n                    index = 0;\r\n                    break;\r\n                }\r\n            } else {\r\n                anchorDistance -= line[index].dist(p);\r\n                p = line[index];\r\n            }\r\n        } while (anchorDistance > paddingStartDistance);\r\n\r\n        let segmentLength = line[index].dist(line[index + 1]);\r\n\r\n        for (let i = -nPitchPaddingBoxes; i < nBoxes + nPitchPaddingBoxes; i++) {\r\n\r\n            // the distance the box will be from the anchor\r\n            const boxOffset = i * step;\r\n            let boxDistanceToAnchor = labelStartDistance + boxOffset;\r\n\r\n            // make the distance between pitch padding boxes bigger\r\n            if (boxOffset < 0) boxDistanceToAnchor += boxOffset;\r\n            if (boxOffset > labelLength) boxDistanceToAnchor += boxOffset - labelLength;\r\n\r\n            if (boxDistanceToAnchor < anchorDistance) {\r\n                // The line doesn't extend far enough back for this box, skip it\r\n                // (This could allow for line collisions on distant tiles)\r\n                continue;\r\n            }\r\n\r\n            // the box is not on the current segment. Move to the next segment.\r\n            while (anchorDistance + segmentLength < boxDistanceToAnchor) {\r\n                anchorDistance += segmentLength;\r\n                index++;\r\n\r\n                // There isn't enough room before the end of the line.\r\n                if (index + 1 >= line.length) {\r\n                    return;\r\n                }\r\n\r\n                segmentLength = line[index].dist(line[index + 1]);\r\n            }\r\n\r\n            // the distance the box will be from the beginning of the segment\r\n            const segmentBoxDistance = boxDistanceToAnchor - anchorDistance;\r\n\r\n            const p0 = line[index];\r\n            const p1 = line[index + 1];\r\n            const boxAnchorPoint = p1.sub(p0)._unit()._mult(segmentBoxDistance)._add(p0)._round();\r\n\r\n            // If the box is within boxSize of the anchor, force the box to be used\r\n            // (so even 0-width labels use at least one box)\r\n            // Otherwise, the .8 multiplication gives us a little bit of conservative\r\n            // padding in choosing which boxes to use (see CollisionIndex#placedCollisionCircles)\r\n            const paddedAnchorDistance = Math.abs(boxDistanceToAnchor - firstBoxOffset) < step ?\r\n                0 :\r\n                (boxDistanceToAnchor - firstBoxOffset) * 0.8;\r\n\r\n            collisionBoxArray.emplaceBack(boxAnchorPoint.x, boxAnchorPoint.y,\r\n                -boxSize / 2, -boxSize / 2, boxSize / 2, boxSize / 2,\r\n                featureIndex, sourceLayerIndex, bucketIndex,\r\n                boxSize / 2, paddedAnchorDistance);\r\n        }\r\n    }\r\n}\r\n\r\nmodule.exports = CollisionFeature;\r\n","// @flow\r\n\r\nconst interpolate = require('../style-spec/util/interpolate').number;\r\nconst Anchor = require('../symbol/anchor');\r\nconst checkMaxAngle = require('./check_max_angle');\r\n\r\nimport type Point from '@mapbox/point-geometry';\r\nimport type {Shaping, PositionedIcon} from './shaping';\r\n\r\nmodule.exports = getAnchors;\r\n\r\nfunction getAnchors(line: Array<Point>,\r\n                    spacing: number,\r\n                    maxAngle: number,\r\n                    shapedText: ?Shaping,\r\n                    shapedIcon: ?PositionedIcon,\r\n                    glyphSize: number,\r\n                    boxScale: number,\r\n                    overscaling: number,\r\n                    tileExtent: number) {\r\n\r\n    // Resample a line to get anchor points for labels and check that each\r\n    // potential label passes text-max-angle check and has enough froom to fit\r\n    // on the line.\r\n\r\n    const angleWindowSize = shapedText ?\r\n        3 / 5 * glyphSize * boxScale :\r\n        0;\r\n\r\n    const labelLength = Math.max(\r\n        shapedText ? shapedText.right - shapedText.left : 0,\r\n        shapedIcon ? shapedIcon.right - shapedIcon.left : 0);\r\n\r\n    // Is the line continued from outside the tile boundary?\r\n    const isLineContinued = line[0].x === 0 || line[0].x === tileExtent || line[0].y === 0 || line[0].y === tileExtent;\r\n\r\n    // Is the label long, relative to the spacing?\r\n    // If so, adjust the spacing so there is always a minimum space of `spacing / 4` between label edges.\r\n    if (spacing - labelLength * boxScale  < spacing / 4) {\r\n        spacing = labelLength * boxScale + spacing / 4;\r\n    }\r\n\r\n    // Offset the first anchor by:\r\n    // Either half the label length plus a fixed extra offset if the line is not continued\r\n    // Or half the spacing if the line is continued.\r\n\r\n    // For non-continued lines, add a bit of fixed extra offset to avoid collisions at T intersections.\r\n    const fixedExtraOffset = glyphSize * 2;\r\n\r\n    const offset = !isLineContinued ?\r\n        ((labelLength / 2 + fixedExtraOffset) * boxScale * overscaling) % spacing :\r\n        (spacing / 2 * overscaling) % spacing;\r\n\r\n    return resample(line, offset, spacing, angleWindowSize, maxAngle, labelLength * boxScale, isLineContinued, false, tileExtent);\r\n}\r\n\r\n\r\nfunction resample(line, offset, spacing, angleWindowSize, maxAngle, labelLength, isLineContinued, placeAtMiddle, tileExtent) {\r\n\r\n    const halfLabelLength = labelLength / 2;\r\n    let lineLength = 0;\r\n    for (let k = 0; k < line.length - 1; k++) {\r\n        lineLength += line[k].dist(line[k + 1]);\r\n    }\r\n\r\n    let distance = 0,\r\n        markedDistance = offset - spacing;\r\n\r\n    let anchors = [];\r\n\r\n    for (let i = 0; i < line.length - 1; i++) {\r\n\r\n        const a = line[i],\r\n            b = line[i + 1];\r\n\r\n        const segmentDist = a.dist(b),\r\n            angle = b.angleTo(a);\r\n\r\n        while (markedDistance + spacing < distance + segmentDist) {\r\n            markedDistance += spacing;\r\n\r\n            const t = (markedDistance - distance) / segmentDist,\r\n                x = interpolate(a.x, b.x, t),\r\n                y = interpolate(a.y, b.y, t);\r\n\r\n            // Check that the point is within the tile boundaries and that\r\n            // the label would fit before the beginning and end of the line\r\n            // if placed at this point.\r\n            if (x >= 0 && x < tileExtent && y >= 0 && y < tileExtent &&\r\n                    markedDistance - halfLabelLength >= 0 &&\r\n                    markedDistance + halfLabelLength <= lineLength) {\r\n                const anchor = new Anchor(x, y, angle, i);\r\n                anchor._round();\r\n\r\n                if (!angleWindowSize || checkMaxAngle(line, anchor, labelLength, angleWindowSize, maxAngle)) {\r\n                    anchors.push(anchor);\r\n                }\r\n            }\r\n        }\r\n\r\n        distance += segmentDist;\r\n    }\r\n\r\n    if (!placeAtMiddle && !anchors.length && !isLineContinued) {\r\n        // The first attempt at finding anchors at which labels can be placed failed.\r\n        // Try again, but this time just try placing one anchor at the middle of the line.\r\n        // This has the most effect for short lines in overscaled tiles, since the\r\n        // initial offset used in overscaled tiles is calculated to align labels with positions in\r\n        // parent tiles instead of placing the label as close to the beginning as possible.\r\n        anchors = resample(line, distance / 2, spacing, angleWindowSize, maxAngle, labelLength, isLineContinued, true, tileExtent);\r\n    }\r\n\r\n    return anchors;\r\n}\r\n","// @flow\r\n\r\nimport type {SymbolFeature} from '../data/bucket/symbol_bucket';\r\n\r\nmodule.exports = function (features: Array<SymbolFeature>) {\r\n    const leftIndex: {[string]: number} = {};\r\n    const rightIndex: {[string]: number} = {};\r\n    const mergedFeatures = [];\r\n    let mergedIndex = 0;\r\n\r\n    function add(k) {\r\n        mergedFeatures.push(features[k]);\r\n        mergedIndex++;\r\n    }\r\n\r\n    function mergeFromRight(leftKey: string, rightKey: string, geom) {\r\n        const i = rightIndex[leftKey];\r\n        delete rightIndex[leftKey];\r\n        rightIndex[rightKey] = i;\r\n\r\n        mergedFeatures[i].geometry[0].pop();\r\n        mergedFeatures[i].geometry[0] = mergedFeatures[i].geometry[0].concat(geom[0]);\r\n        return i;\r\n    }\r\n\r\n    function mergeFromLeft(leftKey: string, rightKey: string, geom) {\r\n        const i = leftIndex[rightKey];\r\n        delete leftIndex[rightKey];\r\n        leftIndex[leftKey] = i;\r\n\r\n        mergedFeatures[i].geometry[0].shift();\r\n        mergedFeatures[i].geometry[0] = geom[0].concat(mergedFeatures[i].geometry[0]);\r\n        return i;\r\n    }\r\n\r\n    function getKey(text, geom, onRight) {\r\n        const point = onRight ? geom[0][geom[0].length - 1] : geom[0][0];\r\n        return `${text}:${point.x}:${point.y}`;\r\n    }\r\n\r\n    for (let k = 0; k < features.length; k++) {\r\n        const feature = features[k];\r\n        const geom = feature.geometry;\r\n        const text = feature.text;\r\n\r\n        if (!text) {\r\n            add(k);\r\n            continue;\r\n        }\r\n\r\n        const leftKey = getKey(text, geom),\r\n            rightKey = getKey(text, geom, true);\r\n\r\n        if ((leftKey in rightIndex) && (rightKey in leftIndex) && (rightIndex[leftKey] !== leftIndex[rightKey])) {\r\n            // found lines with the same text adjacent to both ends of the current line, merge all three\r\n            const j = mergeFromLeft(leftKey, rightKey, geom);\r\n            const i = mergeFromRight(leftKey, rightKey, mergedFeatures[j].geometry);\r\n\r\n            delete leftIndex[leftKey];\r\n            delete rightIndex[rightKey];\r\n\r\n            rightIndex[getKey(text, mergedFeatures[i].geometry, true)] = i;\r\n            mergedFeatures[j].geometry = (null: any);\r\n\r\n        } else if (leftKey in rightIndex) {\r\n            // found mergeable line adjacent to the start of the current line, merge\r\n            mergeFromRight(leftKey, rightKey, geom);\r\n\r\n        } else if (rightKey in leftIndex) {\r\n            // found mergeable line adjacent to the end of the current line, merge\r\n            mergeFromLeft(leftKey, rightKey, geom);\r\n\r\n        } else {\r\n            // no adjacent lines, add as a new item\r\n            add(k);\r\n            leftIndex[leftKey] = mergedIndex - 1;\r\n            rightIndex[rightKey] = mergedIndex - 1;\r\n        }\r\n    }\r\n\r\n    return mergedFeatures.filter((f) => f.geometry);\r\n};\r\n","// @flow\r\n\r\nconst {register} = require('../util/web_worker_transfer');\r\n\r\nclass OpacityState {\r\n    opacity: number;\r\n    targetOpacity: number;\r\n    time: number\r\n\r\n    constructor() {\r\n        this.opacity = 0;\r\n        this.targetOpacity = 0;\r\n        this.time = 0;\r\n    }\r\n\r\n    clone() {\r\n        const clone = new OpacityState();\r\n        clone.opacity = this.opacity;\r\n        clone.targetOpacity = this.targetOpacity;\r\n        clone.time = this.time;\r\n        return clone;\r\n    }\r\n}\r\n\r\nregister('OpacityState', OpacityState);\r\n\r\nmodule.exports = OpacityState;\r\n","// @flow\r\n\r\nconst Point = require('@mapbox/point-geometry');\r\nconst {GLYPH_PBF_BORDER} = require('../style/parse_glyph_pbf');\r\n\r\nimport type Anchor from './anchor';\r\nimport type {PositionedIcon, Shaping} from './shaping';\r\nimport type SymbolStyleLayer from '../style/style_layer/symbol_style_layer';\r\nimport type {Feature} from '../style-spec/expression';\r\nimport type {GlyphPosition} from '../render/glyph_atlas';\r\n\r\nmodule.exports = {\r\n    getIconQuads,\r\n    getGlyphQuads\r\n};\r\n\r\n/**\r\n * A textured quad for rendering a single icon or glyph.\r\n *\r\n * The zoom range the glyph can be shown is defined by minScale and maxScale.\r\n *\r\n * @param tl The offset of the top left corner from the anchor.\r\n * @param tr The offset of the top right corner from the anchor.\r\n * @param bl The offset of the bottom left corner from the anchor.\r\n * @param br The offset of the bottom right corner from the anchor.\r\n * @param tex The texture coordinates.\r\n *\r\n * @private\r\n */\r\nexport type SymbolQuad = {\r\n    tl: Point,\r\n    tr: Point,\r\n    bl: Point,\r\n    br: Point,\r\n    tex: {\r\n        x: number,\r\n        y: number,\r\n        w: number,\r\n        h: number\r\n    },\r\n    writingMode: any | void,\r\n    glyphOffset: [number, number]\r\n};\r\n\r\n/**\r\n * Create the quads used for rendering an icon.\r\n * @private\r\n */\r\nfunction getIconQuads(anchor: Anchor,\r\n                      shapedIcon: PositionedIcon,\r\n                      layer: SymbolStyleLayer,\r\n                      alongLine: boolean,\r\n                      shapedText: Shaping,\r\n                      globalProperties: Object,\r\n                      feature: Feature): Array<SymbolQuad> {\r\n    const image = shapedIcon.image;\r\n    const layout = layer.layout;\r\n\r\n    // If you have a 10px icon that isn't perfectly aligned to the pixel grid it will cover 11 actual\r\n    // pixels. The quad needs to be padded to account for this, otherwise they'll look slightly clipped\r\n    // on one edge in some cases.\r\n    const border = 1;\r\n\r\n    const top = shapedIcon.top - border / image.pixelRatio;\r\n    const left = shapedIcon.left - border / image.pixelRatio;\r\n    const bottom = shapedIcon.bottom + border / image.pixelRatio;\r\n    const right = shapedIcon.right + border / image.pixelRatio;\r\n    let tl, tr, br, bl;\r\n\r\n    // text-fit mode\r\n    if (layout.get('icon-text-fit') !== 'none' && shapedText) {\r\n        const iconWidth = (right - left),\r\n            iconHeight = (bottom - top),\r\n            size = layout.get('text-size').evaluate(feature) / 24,\r\n            textLeft = shapedText.left * size,\r\n            textRight = shapedText.right * size,\r\n            textTop = shapedText.top * size,\r\n            textBottom = shapedText.bottom * size,\r\n            textWidth = textRight - textLeft,\r\n            textHeight = textBottom - textTop,\r\n            padT = layout.get('icon-text-fit-padding')[0],\r\n            padR = layout.get('icon-text-fit-padding')[1],\r\n            padB = layout.get('icon-text-fit-padding')[2],\r\n            padL = layout.get('icon-text-fit-padding')[3],\r\n            offsetY = layout.get('icon-text-fit') === 'width' ? (textHeight - iconHeight) * 0.5 : 0,\r\n            offsetX = layout.get('icon-text-fit') === 'height' ? (textWidth - iconWidth) * 0.5 : 0,\r\n            width = layout.get('icon-text-fit') === 'width' || layout.get('icon-text-fit') === 'both' ? textWidth : iconWidth,\r\n            height = layout.get('icon-text-fit') === 'height' || layout.get('icon-text-fit') === 'both' ? textHeight : iconHeight;\r\n        tl = new Point(textLeft + offsetX - padL,         textTop + offsetY - padT);\r\n        tr = new Point(textLeft + offsetX + padR + width, textTop + offsetY - padT);\r\n        br = new Point(textLeft + offsetX + padR + width, textTop + offsetY + padB + height);\r\n        bl = new Point(textLeft + offsetX - padL,         textTop + offsetY + padB + height);\r\n    // Normal icon size mode\r\n    } else {\r\n        tl = new Point(left, top);\r\n        tr = new Point(right, top);\r\n        br = new Point(right, bottom);\r\n        bl = new Point(left, bottom);\r\n    }\r\n\r\n    const angle = layer.layout.get('icon-rotate').evaluate(feature) * Math.PI / 180;\r\n\r\n    if (angle) {\r\n        const sin = Math.sin(angle),\r\n            cos = Math.cos(angle),\r\n            matrix = [cos, -sin, sin, cos];\r\n\r\n        tl._matMult(matrix);\r\n        tr._matMult(matrix);\r\n        bl._matMult(matrix);\r\n        br._matMult(matrix);\r\n    }\r\n\r\n    // Icon quad is padded, so texture coordinates also need to be padded.\r\n    const textureRect = {\r\n        x: image.textureRect.x - border,\r\n        y: image.textureRect.y - border,\r\n        w: image.textureRect.w + border * 2,\r\n        h: image.textureRect.h + border * 2\r\n    };\r\n\r\n    return [{tl, tr, bl, br, tex: textureRect, writingMode: undefined, glyphOffset: [0, 0]}];\r\n}\r\n\r\n/**\r\n * Create the quads used for rendering a text label.\r\n * @private\r\n */\r\nfunction getGlyphQuads(anchor: Anchor,\r\n                       shaping: Shaping,\r\n                       layer: SymbolStyleLayer,\r\n                       alongLine: boolean,\r\n                       globalProperties: Object,\r\n                       feature: Feature,\r\n                       positions: {[number]: GlyphPosition}): Array<SymbolQuad> {\r\n\r\n    const oneEm = 24;\r\n    const textRotate = layer.layout.get('text-rotate').evaluate(feature) * Math.PI / 180;\r\n    const textOffset = layer.layout.get('text-offset').evaluate(feature).map((t)=> t * oneEm);\r\n\r\n    const positionedGlyphs = shaping.positionedGlyphs;\r\n    const quads = [];\r\n\r\n\r\n    for (let k = 0; k < positionedGlyphs.length; k++) {\r\n        const positionedGlyph = positionedGlyphs[k];\r\n        const glyph = positions[positionedGlyph.glyph];\r\n        if (!glyph) continue;\r\n\r\n        const rect = glyph.rect;\r\n        if (!rect) continue;\r\n\r\n        // The rects have an addditional buffer that is not included in their size.\r\n        const glyphPadding = 1.0;\r\n        const rectBuffer = GLYPH_PBF_BORDER + glyphPadding;\r\n\r\n        const halfAdvance = glyph.metrics.advance / 2;\r\n\r\n        const glyphOffset = alongLine ?\r\n            [positionedGlyph.x + halfAdvance, positionedGlyph.y] :\r\n            [0, 0];\r\n\r\n        const builtInOffset = alongLine ?\r\n            [0, 0] :\r\n            [positionedGlyph.x + halfAdvance + textOffset[0], positionedGlyph.y + textOffset[1]];\r\n\r\n\r\n        const x1 = glyph.metrics.left - rectBuffer - halfAdvance + builtInOffset[0];\r\n        const y1 = -glyph.metrics.top - rectBuffer + builtInOffset[1];\r\n        const x2 = x1 + rect.w;\r\n        const y2 = y1 + rect.h;\r\n\r\n        const tl = new Point(x1, y1);\r\n        const tr = new Point(x2, y1);\r\n        const bl  = new Point(x1, y2);\r\n        const br = new Point(x2, y2);\r\n\r\n        if (alongLine && positionedGlyph.vertical) {\r\n            // Vertical-supporting glyphs are laid out in 24x24 point boxes (1 square em)\r\n            // In horizontal orientation, the y values for glyphs are below the midline\r\n            // and we use a \"yOffset\" of -17 to pull them up to the middle.\r\n            // By rotating counter-clockwise around the point at the center of the left\r\n            // edge of a 24x24 layout box centered below the midline, we align the center\r\n            // of the glyphs with the horizontal midline, so the yOffset is no longer\r\n            // necessary, but we also pull the glyph to the left along the x axis\r\n            const center = new Point(-halfAdvance, halfAdvance);\r\n            const verticalRotation = -Math.PI / 2;\r\n            const xOffsetCorrection = new Point(5, 0);\r\n            tl._rotateAround(verticalRotation, center)._add(xOffsetCorrection);\r\n            tr._rotateAround(verticalRotation, center)._add(xOffsetCorrection);\r\n            bl._rotateAround(verticalRotation, center)._add(xOffsetCorrection);\r\n            br._rotateAround(verticalRotation, center)._add(xOffsetCorrection);\r\n        }\r\n\r\n        if (textRotate) {\r\n            const sin = Math.sin(textRotate),\r\n                cos = Math.cos(textRotate),\r\n                matrix = [cos, -sin, sin, cos];\r\n\r\n            tl._matMult(matrix);\r\n            tr._matMult(matrix);\r\n            bl._matMult(matrix);\r\n            br._matMult(matrix);\r\n        }\r\n\r\n        quads.push({tl, tr, bl, br, tex: rect, writingMode: shaping.writingMode, glyphOffset});\r\n    }\r\n\r\n    return quads;\r\n}\r\n","// @flow\r\n\r\nconst scriptDetection = require('../util/script_detection');\r\nconst verticalizePunctuation = require('../util/verticalize_punctuation');\r\nconst rtlTextPlugin = require('../source/rtl_text_plugin');\r\n\r\nimport type {StyleGlyph} from '../style/style_glyph';\r\nimport type {ImagePosition} from '../render/image_atlas';\r\n\r\nconst WritingMode = {\r\n    horizontal: 1,\r\n    vertical: 2,\r\n    horizontalOnly: 3\r\n};\r\n\r\nmodule.exports = {\r\n    shapeText,\r\n    shapeIcon,\r\n    WritingMode\r\n};\r\n\r\n// The position of a glyph relative to the text's anchor point.\r\nexport type PositionedGlyph = {\r\n    glyph: number,\r\n    x: number,\r\n    y: number,\r\n    vertical: boolean\r\n};\r\n\r\n// A collection of positioned glyphs and some metadata\r\nexport type Shaping = {\r\n    positionedGlyphs: Array<PositionedGlyph>,\r\n    top: number,\r\n    bottom: number,\r\n    left: number,\r\n    right: number,\r\n    writingMode: 1 | 2\r\n};\r\n\r\ntype SymbolAnchor = 'center' | 'left' | 'right' | 'top' | 'bottom' | 'top-left' | 'top-right' | 'bottom-left' | 'bottom-right';\r\ntype TextJustify = 'left' | 'center' | 'right';\r\n\r\nfunction breakLines(text: string, lineBreakPoints: Array<number>) {\r\n    const lines = [];\r\n    let start = 0;\r\n    for (const lineBreak of lineBreakPoints) {\r\n        lines.push(text.substring(start, lineBreak));\r\n        start = lineBreak;\r\n    }\r\n\r\n    if (start < text.length) {\r\n        lines.push(text.substring(start, text.length));\r\n    }\r\n    return lines;\r\n}\r\n\r\nfunction shapeText(text: string,\r\n                   glyphs: {[number]: ?StyleGlyph},\r\n                   maxWidth: number,\r\n                   lineHeight: number,\r\n                   textAnchor: SymbolAnchor,\r\n                   textJustify: TextJustify,\r\n                   spacing: number,\r\n                   translate: [number, number],\r\n                   verticalHeight: number,\r\n                   writingMode: 1 | 2): Shaping | false {\r\n    let logicalInput = text.trim();\r\n    if (writingMode === WritingMode.vertical) {\r\n        logicalInput = verticalizePunctuation(logicalInput);\r\n    }\r\n\r\n    const positionedGlyphs = [];\r\n    const shaping = {\r\n        positionedGlyphs,\r\n        text: logicalInput,\r\n        top: translate[1],\r\n        bottom: translate[1],\r\n        left: translate[0],\r\n        right: translate[0],\r\n        writingMode\r\n    };\r\n\r\n    let lines: Array<string>;\r\n\r\n    const {processBidirectionalText} = rtlTextPlugin;\r\n    if (processBidirectionalText) {\r\n        lines = processBidirectionalText(logicalInput, determineLineBreaks(logicalInput, spacing, maxWidth, glyphs));\r\n    } else {\r\n        lines = breakLines(logicalInput, determineLineBreaks(logicalInput, spacing, maxWidth, glyphs));\r\n    }\r\n\r\n    shapeLines(shaping, glyphs, lines, lineHeight, textAnchor, textJustify, writingMode, spacing, verticalHeight);\r\n\r\n    if (!positionedGlyphs.length)\r\n        return false;\r\n\r\n    return shaping;\r\n}\r\n\r\nconst whitespace: {[number]: boolean} = {\r\n    [0x09]: true, // tab\r\n    [0x0a]: true, // newline\r\n    [0x0b]: true, // vertical tab\r\n    [0x0c]: true, // form feed\r\n    [0x0d]: true, // carriage return\r\n    [0x20]: true, // space\r\n};\r\n\r\nconst breakable: {[number]: boolean} = {\r\n    [0x0a]:   true, // newline\r\n    [0x20]:   true, // space\r\n    [0x26]:   true, // ampersand\r\n    [0x28]:   true, // left parenthesis\r\n    [0x29]:   true, // right parenthesis\r\n    [0x2b]:   true, // plus sign\r\n    [0x2d]:   true, // hyphen-minus\r\n    [0x2f]:   true, // solidus\r\n    [0xad]:   true, // soft hyphen\r\n    [0xb7]:   true, // middle dot\r\n    [0x200b]: true, // zero-width space\r\n    [0x2010]: true, // hyphen\r\n    [0x2013]: true, // en dash\r\n    [0x2027]: true  // interpunct\r\n    // Many other characters may be reasonable breakpoints\r\n    // Consider \"neutral orientation\" characters at scriptDetection.charHasNeutralVerticalOrientation\r\n    // See https://github.com/mapbox/mapbox-gl-js/issues/3658\r\n};\r\n\r\nfunction determineAverageLineWidth(logicalInput: string,\r\n                                   spacing: number,\r\n                                   maxWidth: number,\r\n                                   glyphs: {[number]: ?StyleGlyph}) {\r\n    let totalWidth = 0;\r\n\r\n    for (let index = 0; index < logicalInput.length; index++) {\r\n        const glyph = glyphs[logicalInput.charCodeAt(index)];\r\n        if (!glyph)\r\n            continue;\r\n        totalWidth += glyph.metrics.advance + spacing;\r\n    }\r\n\r\n    const lineCount = Math.max(1, Math.ceil(totalWidth / maxWidth));\r\n    return totalWidth / lineCount;\r\n}\r\n\r\nfunction calculateBadness(lineWidth: number,\r\n                          targetWidth: number,\r\n                          penalty: number,\r\n                          isLastBreak: boolean) {\r\n    const raggedness = Math.pow(lineWidth - targetWidth, 2);\r\n    if (isLastBreak) {\r\n        // Favor finals lines shorter than average over longer than average\r\n        if (lineWidth < targetWidth) {\r\n            return raggedness / 2;\r\n        } else {\r\n            return raggedness * 2;\r\n        }\r\n    }\r\n\r\n    return raggedness + Math.abs(penalty) * penalty;\r\n}\r\n\r\nfunction calculatePenalty(codePoint: number, nextCodePoint: number) {\r\n    let penalty = 0;\r\n    // Force break on newline\r\n    if (codePoint === 0x0a) {\r\n        penalty -= 10000;\r\n    }\r\n    // Penalize open parenthesis at end of line\r\n    if (codePoint === 0x28 || codePoint === 0xff08) {\r\n        penalty += 50;\r\n    }\r\n\r\n    // Penalize close parenthesis at beginning of line\r\n    if (nextCodePoint === 0x29 || nextCodePoint === 0xff09) {\r\n        penalty += 50;\r\n    }\r\n    return penalty;\r\n}\r\n\r\ntype Break = {\r\n    index: number,\r\n    x: number,\r\n    priorBreak: ?Break,\r\n    badness: number\r\n};\r\n\r\nfunction evaluateBreak(breakIndex: number,\r\n                       breakX: number,\r\n                       targetWidth: number,\r\n                       potentialBreaks: Array<Break>,\r\n                       penalty: number,\r\n                       isLastBreak: boolean): Break {\r\n    // We could skip evaluating breaks where the line length (breakX - priorBreak.x) > maxWidth\r\n    //  ...but in fact we allow lines longer than maxWidth (if there's no break points)\r\n    //  ...and when targetWidth and maxWidth are close, strictly enforcing maxWidth can give\r\n    //     more lopsided results.\r\n\r\n    let bestPriorBreak: ?Break = null;\r\n    let bestBreakBadness = calculateBadness(breakX, targetWidth, penalty, isLastBreak);\r\n\r\n    for (const potentialBreak of potentialBreaks) {\r\n        const lineWidth = breakX - potentialBreak.x;\r\n        const breakBadness =\r\n            calculateBadness(lineWidth, targetWidth, penalty, isLastBreak) + potentialBreak.badness;\r\n        if (breakBadness <= bestBreakBadness) {\r\n            bestPriorBreak = potentialBreak;\r\n            bestBreakBadness = breakBadness;\r\n        }\r\n    }\r\n\r\n    return {\r\n        index: breakIndex,\r\n        x: breakX,\r\n        priorBreak: bestPriorBreak,\r\n        badness: bestBreakBadness\r\n    };\r\n}\r\n\r\nfunction leastBadBreaks(lastLineBreak: ?Break): Array<number> {\r\n    if (!lastLineBreak) {\r\n        return [];\r\n    }\r\n    return leastBadBreaks(lastLineBreak.priorBreak).concat(lastLineBreak.index);\r\n}\r\n\r\nfunction determineLineBreaks(logicalInput: string,\r\n                             spacing: number,\r\n                             maxWidth: number,\r\n                             glyphs: {[number]: ?StyleGlyph}): Array<number> {\r\n    if (!maxWidth)\r\n        return [];\r\n\r\n    if (!logicalInput)\r\n        return [];\r\n\r\n    const potentialLineBreaks = [];\r\n    const targetWidth = determineAverageLineWidth(logicalInput, spacing, maxWidth, glyphs);\r\n\r\n    let currentX = 0;\r\n\r\n    for (let i = 0; i < logicalInput.length; i++) {\r\n        const codePoint = logicalInput.charCodeAt(i);\r\n        const glyph = glyphs[codePoint];\r\n\r\n        if (glyph && !whitespace[codePoint])\r\n            currentX += glyph.metrics.advance + spacing;\r\n\r\n        // Ideographic characters, spaces, and word-breaking punctuation that often appear without\r\n        // surrounding spaces.\r\n        if ((i < logicalInput.length - 1) &&\r\n            (breakable[codePoint] ||\r\n                scriptDetection.charAllowsIdeographicBreaking(codePoint))) {\r\n\r\n            potentialLineBreaks.push(\r\n                evaluateBreak(\r\n                    i + 1,\r\n                    currentX,\r\n                    targetWidth,\r\n                    potentialLineBreaks,\r\n                    calculatePenalty(codePoint, logicalInput.charCodeAt(i + 1)),\r\n                    false));\r\n        }\r\n    }\r\n\r\n    return leastBadBreaks(\r\n        evaluateBreak(\r\n            logicalInput.length,\r\n            currentX,\r\n            targetWidth,\r\n            potentialLineBreaks,\r\n            0,\r\n            true));\r\n}\r\n\r\nfunction getAnchorAlignment(anchor: SymbolAnchor) {\r\n    let horizontalAlign = 0.5, verticalAlign = 0.5;\r\n\r\n    switch (anchor) {\r\n    case 'right':\r\n    case 'top-right':\r\n    case 'bottom-right':\r\n        horizontalAlign = 1;\r\n        break;\r\n    case 'left':\r\n    case 'top-left':\r\n    case 'bottom-left':\r\n        horizontalAlign = 0;\r\n        break;\r\n    }\r\n\r\n    switch (anchor) {\r\n    case 'bottom':\r\n    case 'bottom-right':\r\n    case 'bottom-left':\r\n        verticalAlign = 1;\r\n        break;\r\n    case 'top':\r\n    case 'top-right':\r\n    case 'top-left':\r\n        verticalAlign = 0;\r\n        break;\r\n    }\r\n\r\n    return { horizontalAlign, verticalAlign };\r\n}\r\n\r\nfunction shapeLines(shaping: Shaping,\r\n                    glyphs: {[number]: ?StyleGlyph},\r\n                    lines: Array<string>,\r\n                    lineHeight: number,\r\n                    textAnchor: SymbolAnchor,\r\n                    textJustify: TextJustify,\r\n                    writingMode: 1 | 2,\r\n                    spacing: number,\r\n                    verticalHeight: number) {\r\n    // the y offset *should* be part of the font metadata\r\n    const yOffset = -17;\r\n\r\n    let x = 0;\r\n    let y = yOffset;\r\n\r\n    let maxLineLength = 0;\r\n    const positionedGlyphs = shaping.positionedGlyphs;\r\n\r\n    const justify =\r\n        textJustify === 'right' ? 1 :\r\n        textJustify === 'left' ? 0 : 0.5;\r\n\r\n    for (let line of lines) {\r\n        line = line.trim();\r\n\r\n        if (!line.length) {\r\n            y += lineHeight; // Still need a line feed after empty line\r\n            continue;\r\n        }\r\n\r\n        const lineStartIndex = positionedGlyphs.length;\r\n        for (let i = 0; i < line.length; i++) {\r\n            const codePoint = line.charCodeAt(i);\r\n            const glyph = glyphs[codePoint];\r\n\r\n            if (!glyph) continue;\r\n\r\n            if (!scriptDetection.charHasUprightVerticalOrientation(codePoint) || writingMode === WritingMode.horizontal) {\r\n                positionedGlyphs.push({glyph: codePoint, x, y, vertical: false});\r\n                x += glyph.metrics.advance + spacing;\r\n            } else {\r\n                positionedGlyphs.push({glyph: codePoint, x, y: 0, vertical: true});\r\n                x += verticalHeight + spacing;\r\n            }\r\n        }\r\n\r\n        // Only justify if we placed at least one glyph\r\n        if (positionedGlyphs.length !== lineStartIndex) {\r\n            const lineLength = x - spacing;\r\n            maxLineLength = Math.max(lineLength, maxLineLength);\r\n\r\n            justifyLine(positionedGlyphs, glyphs, lineStartIndex, positionedGlyphs.length - 1, justify);\r\n        }\r\n\r\n        x = 0;\r\n        y += lineHeight;\r\n    }\r\n\r\n    const {horizontalAlign, verticalAlign} = getAnchorAlignment(textAnchor);\r\n    align(positionedGlyphs, justify, horizontalAlign, verticalAlign, maxLineLength, lineHeight, lines.length);\r\n\r\n    // Calculate the bounding box\r\n    const height = lines.length * lineHeight;\r\n\r\n    shaping.top += -verticalAlign * height;\r\n    shaping.bottom = shaping.top + height;\r\n    shaping.left += -horizontalAlign * maxLineLength;\r\n    shaping.right = shaping.left + maxLineLength;\r\n}\r\n\r\n// justify right = 1, left = 0, center = 0.5\r\nfunction justifyLine(positionedGlyphs: Array<PositionedGlyph>,\r\n                     glyphs: {[number]: ?StyleGlyph},\r\n                     start: number,\r\n                     end: number,\r\n                     justify: 1 | 0 | 0.5) {\r\n    if (!justify)\r\n        return;\r\n\r\n    const glyph = glyphs[positionedGlyphs[end].glyph];\r\n    if (glyph) {\r\n        const lastAdvance = glyph.metrics.advance;\r\n        const lineIndent = (positionedGlyphs[end].x + lastAdvance) * justify;\r\n\r\n        for (let j = start; j <= end; j++) {\r\n            positionedGlyphs[j].x -= lineIndent;\r\n        }\r\n    }\r\n}\r\n\r\nfunction align(positionedGlyphs: Array<PositionedGlyph>,\r\n               justify: number,\r\n               horizontalAlign: number,\r\n               verticalAlign: number,\r\n               maxLineLength: number,\r\n               lineHeight: number,\r\n               lineCount: number) {\r\n    const shiftX = (justify - horizontalAlign) * maxLineLength;\r\n    const shiftY = (-verticalAlign * lineCount + 0.5) * lineHeight;\r\n\r\n    for (let j = 0; j < positionedGlyphs.length; j++) {\r\n        positionedGlyphs[j].x += shiftX;\r\n        positionedGlyphs[j].y += shiftY;\r\n    }\r\n}\r\n\r\nexport type PositionedIcon = {\r\n    image: ImagePosition,\r\n    top: number,\r\n    bottom: number,\r\n    left: number,\r\n    right: number\r\n};\r\n\r\nfunction shapeIcon(image: ImagePosition, iconOffset: [number, number], iconAnchor: SymbolAnchor): PositionedIcon {\r\n    const {horizontalAlign, verticalAlign} = getAnchorAlignment(iconAnchor);\r\n    const dx = iconOffset[0];\r\n    const dy = iconOffset[1];\r\n    const x1 = dx - image.displaySize[0] * horizontalAlign;\r\n    const x2 = x1 + image.displaySize[0];\r\n    const y1 = dy - image.displaySize[1] * verticalAlign;\r\n    const y2 = y1 + image.displaySize[1];\r\n    return {image, top: y1, bottom: y2, left: x1, right: x2};\r\n}\r\n","// @flow\r\n\r\nconst Anchor = require('./anchor');\r\nconst getAnchors = require('./get_anchors');\r\nconst clipLine = require('./clip_line');\r\nconst OpacityState = require('./opacity_state');\r\nconst {shapeText, shapeIcon, WritingMode} = require('./shaping');\r\nconst {getGlyphQuads, getIconQuads} = require('./quads');\r\nconst CollisionFeature = require('./collision_feature');\r\nconst util = require('../util/util');\r\nconst scriptDetection = require('../util/script_detection');\r\nconst findPoleOfInaccessibility = require('../util/find_pole_of_inaccessibility');\r\nconst classifyRings = require('../util/classify_rings');\r\nconst EXTENT = require('../data/extent');\r\nconst SymbolBucket = require('../data/bucket/symbol_bucket');\r\nconst EvaluationParameters = require('../style/evaluation_parameters');\r\n\r\nimport type {Shaping, PositionedIcon} from './shaping';\r\nimport type {CollisionBoxArray} from '../data/array_types';\r\nimport type {SymbolFeature} from '../data/bucket/symbol_bucket';\r\nimport type {StyleImage} from '../style/style_image';\r\nimport type {StyleGlyph} from '../style/style_glyph';\r\nimport type SymbolStyleLayer from '../style/style_layer/symbol_style_layer';\r\nimport type {ImagePosition} from '../render/image_atlas';\r\nimport type {GlyphPosition} from '../render/glyph_atlas';\r\nimport type {PossiblyEvaluatedPropertyValue} from '../style/properties';\r\n\r\nconst Point = require('@mapbox/point-geometry');\r\n\r\nmodule.exports = {\r\n    performSymbolLayout\r\n};\r\n\r\n// The symbol layout process needs `text-size` evaluated at up to five different zoom levels, and\r\n// `icon-size` at up to three:\r\n//\r\n//   1. `text-size` at the zoom level of the bucket. Used to calculate a per-feature size for source `text-size`\r\n//       expressions, and to calculate the box dimensions for icon-text-fit.\r\n//   2. `icon-size` at the zoom level of the bucket. Used to calculate a per-feature size for source `icon-size`\r\n//       expressions.\r\n//   3. `text-size` and `icon-size` at the zoom level of the bucket, plus one. Used to calculate collision boxes.\r\n//   4. `text-size` at zoom level 18. Used for something line-symbol-placement-related.\r\n//   5.  For composite `*-size` expressions: two zoom levels of curve stops that \"cover\" the zoom level of the\r\n//       bucket. These go into a vertex buffer and are used by the shader to interpolate the size at render time.\r\n//\r\n// (1) and (2) are stored in `bucket.layers[0].layout`. The remainder are below.\r\n//\r\ntype Sizes = {\r\n    layoutTextSize: PossiblyEvaluatedPropertyValue<number>, // (3)\r\n    layoutIconSize: PossiblyEvaluatedPropertyValue<number>, // (3)\r\n    textMaxSize: PossiblyEvaluatedPropertyValue<number>,    // (4)\r\n    compositeTextSizes: [PossiblyEvaluatedPropertyValue<number>, PossiblyEvaluatedPropertyValue<number>], // (5)\r\n    compositeIconSizes: [PossiblyEvaluatedPropertyValue<number>, PossiblyEvaluatedPropertyValue<number>], // (5)\r\n};\r\n\r\nfunction performSymbolLayout(bucket: SymbolBucket,\r\n                             glyphMap: {[string]: {[number]: ?StyleGlyph}},\r\n                             glyphPositions: {[string]: {[number]: GlyphPosition}},\r\n                             imageMap: {[string]: StyleImage},\r\n                             imagePositions: {[string]: ImagePosition},\r\n                             showCollisionBoxes: boolean) {\r\n    bucket.createArrays();\r\n    bucket.symbolInstances = [];\r\n\r\n    const tileSize = 512 * bucket.overscaling;\r\n    bucket.tilePixelRatio = EXTENT / tileSize;\r\n    bucket.compareText = {};\r\n    bucket.iconsNeedLinear = false;\r\n\r\n    const layout = bucket.layers[0].layout;\r\n    const unevaluatedLayoutValues = bucket.layers[0]._unevaluatedLayout._values;\r\n\r\n    const sizes = {};\r\n\r\n    if (bucket.textSizeData.functionType === 'composite') {\r\n        const {min, max} = bucket.textSizeData.zoomRange;\r\n        sizes.compositeTextSizes = [\r\n            unevaluatedLayoutValues['text-size'].possiblyEvaluate(new EvaluationParameters(min)),\r\n            unevaluatedLayoutValues['text-size'].possiblyEvaluate(new EvaluationParameters(max))\r\n        ];\r\n    }\r\n\r\n    if (bucket.iconSizeData.functionType === 'composite') {\r\n        const {min, max} = bucket.iconSizeData.zoomRange;\r\n        sizes.compositeIconSizes = [\r\n            unevaluatedLayoutValues['icon-size'].possiblyEvaluate(new EvaluationParameters(min)),\r\n            unevaluatedLayoutValues['icon-size'].possiblyEvaluate(new EvaluationParameters(max))\r\n        ];\r\n    }\r\n\r\n    sizes.layoutTextSize = unevaluatedLayoutValues['text-size'].possiblyEvaluate(new EvaluationParameters(bucket.zoom + 1));\r\n    sizes.layoutIconSize = unevaluatedLayoutValues['icon-size'].possiblyEvaluate(new EvaluationParameters(bucket.zoom + 1));\r\n    sizes.textMaxSize = unevaluatedLayoutValues['text-size'].possiblyEvaluate(new EvaluationParameters(18));\r\n\r\n    const oneEm = 24;\r\n    const lineHeight = layout.get('text-line-height') * oneEm;\r\n    const textAlongLine = layout.get('text-rotation-alignment') === 'map' && layout.get('symbol-placement') === 'line';\r\n    const keepUpright = layout.get('text-keep-upright');\r\n\r\n\r\n    for (const feature of bucket.features) {\r\n        const fontstack = layout.get('text-font').evaluate(feature).join(',');\r\n        const glyphs = glyphMap[fontstack] || {};\r\n        const glyphPositionMap = glyphPositions[fontstack] || {};\r\n\r\n        const shapedTextOrientations = {};\r\n        const text = feature.text;\r\n        if (text) {\r\n            const allowsVerticalWritingMode = scriptDetection.allowsVerticalWritingMode(text);\r\n            const textOffset: [number, number] = (layout.get('text-offset').evaluate(feature).map((t)=> t * oneEm): any);\r\n            const spacing = layout.get('text-letter-spacing').evaluate(feature) * oneEm;\r\n            const spacingIfAllowed = scriptDetection.allowsLetterSpacing(text) ? spacing : 0;\r\n            const textAnchor = layout.get('text-anchor').evaluate(feature);\r\n            const textJustify = layout.get('text-justify').evaluate(feature);\r\n            const maxWidth = layout.get('symbol-placement') !== 'line' ?\r\n                layout.get('text-max-width').evaluate(feature) * oneEm :\r\n                0;\r\n\r\n            shapedTextOrientations.horizontal = shapeText(text, glyphs, maxWidth, lineHeight, textAnchor, textJustify, spacingIfAllowed, textOffset, oneEm, WritingMode.horizontal);\r\n            if (allowsVerticalWritingMode && textAlongLine && keepUpright) {\r\n                shapedTextOrientations.vertical = shapeText(text, glyphs, maxWidth, lineHeight, textAnchor, textJustify, spacingIfAllowed, textOffset, oneEm, WritingMode.vertical);\r\n            }\r\n        }\r\n\r\n        let shapedIcon;\r\n        if (feature.icon) {\r\n            const image = imageMap[feature.icon];\r\n            if (image) {\r\n                shapedIcon = shapeIcon(\r\n                    imagePositions[feature.icon],\r\n                    layout.get('icon-offset').evaluate(feature),\r\n                    layout.get('icon-anchor').evaluate(feature));\r\n                if (bucket.sdfIcons === undefined) {\r\n                    bucket.sdfIcons = image.sdf;\r\n                } else if (bucket.sdfIcons !== image.sdf) {\r\n                    util.warnOnce('Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer');\r\n                }\r\n                if (image.pixelRatio !== bucket.pixelRatio) {\r\n                    bucket.iconsNeedLinear = true;\r\n                } else if (layout.get('icon-rotate').constantOr(1) !== 0) {\r\n                    bucket.iconsNeedLinear = true;\r\n                }\r\n            }\r\n        }\r\n\r\n        if (shapedTextOrientations.horizontal || shapedIcon) {\r\n            addFeature(bucket, feature, shapedTextOrientations, shapedIcon, glyphPositionMap, sizes);\r\n        }\r\n    }\r\n\r\n    if (showCollisionBoxes) {\r\n        bucket.generateCollisionDebugBuffers();\r\n    }\r\n}\r\n\r\n\r\n/**\r\n * Given a feature and its shaped text and icon data, add a 'symbol\r\n * instance' for each _possible_ placement of the symbol feature.\r\n * (At render timePlaceSymbols#place() selects which of these instances to\r\n * show or hide based on collisions with symbols in other layers.)\r\n * @private\r\n */\r\nfunction addFeature(bucket: SymbolBucket,\r\n                    feature: SymbolFeature,\r\n                    shapedTextOrientations: any,\r\n                    shapedIcon: PositionedIcon | void,\r\n                    glyphPositionMap: {[number]: GlyphPosition},\r\n                    sizes: Sizes) {\r\n    const layoutTextSize = sizes.layoutTextSize.evaluate(feature);\r\n    const layoutIconSize = sizes.layoutIconSize.evaluate(feature);\r\n\r\n    // To reduce the number of labels that jump around when zooming we need\r\n    // to use a text-size value that is the same for all zoom levels.\r\n    // bucket calculates text-size at a high zoom level so that all tiles can\r\n    // use the same value when calculating anchor positions.\r\n    let textMaxSize = sizes.textMaxSize.evaluate(feature);\r\n    if (textMaxSize === undefined) {\r\n        textMaxSize = layoutTextSize;\r\n    }\r\n\r\n    const layout = bucket.layers[0].layout;\r\n    const textOffset = layout.get('text-offset').evaluate(feature);\r\n    const iconOffset = layout.get('icon-offset').evaluate(feature);\r\n\r\n    const glyphSize = 24,\r\n        fontScale = layoutTextSize / glyphSize,\r\n        textBoxScale = bucket.tilePixelRatio * fontScale,\r\n        textMaxBoxScale = bucket.tilePixelRatio * textMaxSize / glyphSize,\r\n        iconBoxScale = bucket.tilePixelRatio * layoutIconSize,\r\n        symbolMinDistance = bucket.tilePixelRatio * layout.get('symbol-spacing'),\r\n        textPadding = layout.get('text-padding') * bucket.tilePixelRatio,\r\n        iconPadding = layout.get('icon-padding') * bucket.tilePixelRatio,\r\n        textMaxAngle = layout.get('text-max-angle') / 180 * Math.PI,\r\n        textAlongLine = layout.get('text-rotation-alignment') === 'map' && layout.get('symbol-placement') === 'line',\r\n        iconAlongLine = layout.get('icon-rotation-alignment') === 'map' && layout.get('symbol-placement') === 'line',\r\n        symbolPlacement = layout.get('symbol-placement'),\r\n        textRepeatDistance = symbolMinDistance / 2;\r\n\r\n    const addSymbolAtAnchor = (line, anchor) => {\r\n        if (anchor.x < 0 || anchor.x >= EXTENT || anchor.y < 0 || anchor.y >= EXTENT) {\r\n            // Symbol layers are drawn across tile boundaries, We filter out symbols\r\n            // outside our tile boundaries (which may be included in vector tile buffers)\r\n            // to prevent double-drawing symbols.\r\n            return;\r\n        }\r\n\r\n        bucket.symbolInstances.push(addSymbol(bucket, anchor, line, shapedTextOrientations, shapedIcon, bucket.layers[0],\r\n            bucket.collisionBoxArray, feature.index, feature.sourceLayerIndex, bucket.index,\r\n            textBoxScale, textPadding, textAlongLine, textOffset,\r\n            iconBoxScale, iconPadding, iconAlongLine, iconOffset,\r\n            {zoom: bucket.zoom}, feature, glyphPositionMap, sizes));\r\n    };\r\n\r\n    if (symbolPlacement === 'line') {\r\n        for (const line of clipLine(feature.geometry, 0, 0, EXTENT, EXTENT)) {\r\n            const anchors = getAnchors(\r\n                line,\r\n                symbolMinDistance,\r\n                textMaxAngle,\r\n                shapedTextOrientations.vertical || shapedTextOrientations.horizontal,\r\n                shapedIcon,\r\n                glyphSize,\r\n                textMaxBoxScale,\r\n                bucket.overscaling,\r\n                EXTENT\r\n            );\r\n            for (const anchor of anchors) {\r\n                const shapedText = shapedTextOrientations.horizontal;\r\n                if (!shapedText || !anchorIsTooClose(bucket, shapedText.text, textRepeatDistance, anchor)) {\r\n                    addSymbolAtAnchor(line, anchor);\r\n                }\r\n            }\r\n        }\r\n    } else if (feature.type === 'Polygon') {\r\n        for (const polygon of classifyRings(feature.geometry, 0)) {\r\n            // 16 here represents 2 pixels\r\n            const poi = findPoleOfInaccessibility(polygon, 16);\r\n            addSymbolAtAnchor(polygon[0], new Anchor(poi.x, poi.y, 0));\r\n        }\r\n    } else if (feature.type === 'LineString') {\r\n        // https://github.com/mapbox/mapbox-gl-js/issues/3808\r\n        for (const line of feature.geometry) {\r\n            addSymbolAtAnchor(line, new Anchor(line[0].x, line[0].y, 0));\r\n        }\r\n    } else if (feature.type === 'Point') {\r\n        for (const points of feature.geometry) {\r\n            for (const point of points) {\r\n                addSymbolAtAnchor([point], new Anchor(point.x, point.y, 0));\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nfunction addTextVertices(bucket: SymbolBucket,\r\n                         anchor: Point,\r\n                         shapedText: Shaping,\r\n                         layer: SymbolStyleLayer,\r\n                         textAlongLine: boolean,\r\n                         globalProperties: Object,\r\n                         feature: SymbolFeature,\r\n                         textOffset: [number, number],\r\n                         lineArray: {lineStartIndex: number, lineLength: number},\r\n                         writingMode: number,\r\n                         placedTextSymbolIndices: Array<number>,\r\n                         glyphPositionMap: {[number]: GlyphPosition},\r\n                         sizes: Sizes) {\r\n    const glyphQuads = getGlyphQuads(anchor, shapedText,\r\n                            layer, textAlongLine, globalProperties, feature, glyphPositionMap);\r\n\r\n    const sizeData = bucket.textSizeData;\r\n    let textSizeData = null;\r\n\r\n    if (sizeData.functionType === 'source') {\r\n        textSizeData = [\r\n            10 * layer.layout.get('text-size').evaluate(feature)\r\n        ];\r\n    } else if (sizeData.functionType === 'composite') {\r\n        textSizeData = [\r\n            10 * sizes.compositeTextSizes[0].evaluate(feature),\r\n            10 * sizes.compositeTextSizes[1].evaluate(feature)\r\n        ];\r\n    }\r\n\r\n    bucket.addSymbols(\r\n        bucket.text,\r\n        glyphQuads,\r\n        textSizeData,\r\n        textOffset,\r\n        textAlongLine,\r\n        feature,\r\n        writingMode,\r\n        anchor,\r\n        lineArray.lineStartIndex,\r\n        lineArray.lineLength);\r\n\r\n    // The placedSymbolArray is used at render time in drawTileSymbols\r\n    // These indices allow access to the array at collision detection time\r\n    placedTextSymbolIndices.push(bucket.text.placedSymbolArray.length - 1);\r\n\r\n    return glyphQuads.length * 4;\r\n}\r\n\r\n\r\n/**\r\n * Add a single label & icon placement.\r\n *\r\n * @private\r\n */\r\nfunction addSymbol(bucket: SymbolBucket,\r\n                   anchor: Anchor,\r\n                   line: Array<Point>,\r\n                   shapedTextOrientations: any,\r\n                   shapedIcon: PositionedIcon | void,\r\n                   layer: SymbolStyleLayer,\r\n                   collisionBoxArray: CollisionBoxArray,\r\n                   featureIndex: number,\r\n                   sourceLayerIndex: number,\r\n                   bucketIndex: number,\r\n                   textBoxScale: number,\r\n                   textPadding: number,\r\n                   textAlongLine: boolean,\r\n                   textOffset: [number, number],\r\n                   iconBoxScale: number,\r\n                   iconPadding: number,\r\n                   iconAlongLine: boolean,\r\n                   iconOffset: [number, number],\r\n                   globalProperties: Object,\r\n                   feature: SymbolFeature,\r\n                   glyphPositionMap: {[number]: GlyphPosition},\r\n                   sizes: Sizes) {\r\n    const lineArray = bucket.addToLineVertexArray(anchor, line);\r\n\r\n    let textCollisionFeature, iconCollisionFeature;\r\n\r\n    let numIconVertices = 0;\r\n    let numGlyphVertices = 0;\r\n    let numVerticalGlyphVertices = 0;\r\n    const key = shapedTextOrientations.horizontal ? shapedTextOrientations.horizontal.text : '';\r\n    const placedTextSymbolIndices = [];\r\n    if (shapedTextOrientations.horizontal) {\r\n        // As a collision approximation, we can use either the vertical or the horizontal version of the feature\r\n        // We're counting on the two versions having similar dimensions\r\n        textCollisionFeature = new CollisionFeature(collisionBoxArray, line, anchor, featureIndex, sourceLayerIndex, bucketIndex, shapedTextOrientations.horizontal, textBoxScale, textPadding, textAlongLine, bucket.overscaling);\r\n        numGlyphVertices += addTextVertices(bucket, anchor, shapedTextOrientations.horizontal, layer, textAlongLine, globalProperties, feature, textOffset, lineArray, shapedTextOrientations.vertical ? WritingMode.horizontal : WritingMode.horizontalOnly, placedTextSymbolIndices, glyphPositionMap, sizes);\r\n\r\n        if (shapedTextOrientations.vertical) {\r\n            numVerticalGlyphVertices += addTextVertices(bucket, anchor, shapedTextOrientations.vertical, layer, textAlongLine, globalProperties, feature, textOffset, lineArray, WritingMode.vertical, placedTextSymbolIndices, glyphPositionMap, sizes);\r\n        }\r\n    }\r\n\r\n    const textBoxStartIndex = textCollisionFeature ? textCollisionFeature.boxStartIndex : bucket.collisionBoxArray.length;\r\n    const textBoxEndIndex = textCollisionFeature ? textCollisionFeature.boxEndIndex : bucket.collisionBoxArray.length;\r\n\r\n    if (shapedIcon) {\r\n        const iconQuads = getIconQuads(anchor, shapedIcon, layer,\r\n                            iconAlongLine, shapedTextOrientations.horizontal,\r\n                            globalProperties, feature);\r\n        iconCollisionFeature = new CollisionFeature(collisionBoxArray, line, anchor, featureIndex, sourceLayerIndex, bucketIndex, shapedIcon, iconBoxScale, iconPadding, /*align boxes to line*/false, bucket.overscaling);\r\n\r\n        numIconVertices = iconQuads.length * 4;\r\n\r\n        const sizeData = bucket.iconSizeData;\r\n        let iconSizeData = null;\r\n\r\n        if (sizeData.functionType === 'source') {\r\n            iconSizeData = [\r\n                10 * layer.layout.get('icon-size').evaluate(feature)\r\n            ];\r\n        } else if (sizeData.functionType === 'composite') {\r\n            iconSizeData = [\r\n                10 * sizes.compositeIconSizes[0].evaluate(feature),\r\n                10 * sizes.compositeIconSizes[1].evaluate(feature)\r\n            ];\r\n        }\r\n\r\n        bucket.addSymbols(\r\n            bucket.icon,\r\n            iconQuads,\r\n            iconSizeData,\r\n            iconOffset,\r\n            iconAlongLine,\r\n            feature,\r\n            false,\r\n            anchor,\r\n            lineArray.lineStartIndex,\r\n            lineArray.lineLength);\r\n    }\r\n\r\n    const iconBoxStartIndex = iconCollisionFeature ? iconCollisionFeature.boxStartIndex : bucket.collisionBoxArray.length;\r\n    const iconBoxEndIndex = iconCollisionFeature ? iconCollisionFeature.boxEndIndex : bucket.collisionBoxArray.length;\r\n\r\n    if (bucket.glyphOffsetArray.length >= SymbolBucket.MAX_GLYPHS) util.warnOnce(\"Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907\");\r\n\r\n    const textOpacityState = new OpacityState();\r\n    const iconOpacityState = new OpacityState();\r\n\r\n    return {\r\n        key,\r\n        textBoxStartIndex,\r\n        textBoxEndIndex,\r\n        iconBoxStartIndex,\r\n        iconBoxEndIndex,\r\n        textOffset,\r\n        iconOffset,\r\n        anchor,\r\n        line,\r\n        featureIndex,\r\n        feature,\r\n        numGlyphVertices,\r\n        numVerticalGlyphVertices,\r\n        numIconVertices,\r\n        textOpacityState,\r\n        iconOpacityState,\r\n        isDuplicate: false,\r\n        placedTextSymbolIndices,\r\n        crossTileID: 0\r\n    };\r\n}\r\n\r\nfunction anchorIsTooClose(bucket: any, text: string, repeatDistance: number, anchor: Point) {\r\n    const compareText = bucket.compareText;\r\n    if (!(text in compareText)) {\r\n        compareText[text] = [];\r\n    } else {\r\n        const otherAnchors = compareText[text];\r\n        for (let k = otherAnchors.length - 1; k >= 0; k--) {\r\n            if (anchor.dist(otherAnchors[k]) < repeatDistance) {\r\n                // If it's within repeatDistance of one anchor, stop looking\r\n                return true;\r\n            }\r\n        }\r\n    }\r\n    // If anchor is not within repeatDistance of any other anchor, add to array\r\n    compareText[text].push(anchor);\r\n    return false;\r\n}\r\n","// @flow\r\n\r\nconst {normalizePropertyExpression} = require('../style-spec/expression');\r\nconst interpolate = require('../style-spec/util/interpolate');\r\nconst util = require('../util/util');\r\n\r\nimport type {Property, PropertyValue, PossiblyEvaluatedPropertyValue} from '../style/properties';\r\nimport type {CameraExpression, CompositeExpression} from '../style-spec/expression/index';\r\n\r\nmodule.exports = {\r\n    getSizeData,\r\n    evaluateSizeForFeature,\r\n    evaluateSizeForZoom\r\n};\r\n\r\nexport type SizeData = {\r\n    functionType: 'constant',\r\n    layoutSize: number\r\n} | {\r\n    functionType: 'source'\r\n} | {\r\n    functionType: 'camera',\r\n    layoutSize: number,\r\n    zoomRange: {min: number, max: number},\r\n    sizeRange: {min: number, max: number},\r\n    propertyValue: PropertyValueSpecification<number>\r\n} | {\r\n    functionType: 'composite',\r\n    zoomRange: {min: number, max: number},\r\n    propertyValue: PropertyValueSpecification<number>\r\n};\r\n\r\n// For {text,icon}-size, get the bucket-level data that will be needed by\r\n// the painter to set symbol-size-related uniforms\r\nfunction getSizeData(tileZoom: number, value: PropertyValue<number, PossiblyEvaluatedPropertyValue<number>>): SizeData {\r\n    const {expression} = value;\r\n    if (expression.kind === 'constant') {\r\n        return {\r\n            functionType: 'constant',\r\n            layoutSize: expression.evaluate({zoom: tileZoom + 1})\r\n        };\r\n    } else if (expression.kind === 'source') {\r\n        return {\r\n            functionType: 'source'\r\n        };\r\n    } else {\r\n        // calculate covering zoom stops for zoom-dependent values\r\n        const levels = expression.zoomStops;\r\n\r\n        let lower = 0;\r\n        while (lower < levels.length && levels[lower] <= tileZoom) lower++;\r\n        lower = Math.max(0, lower - 1);\r\n        let upper = lower;\r\n        while (upper < levels.length && levels[upper] < tileZoom + 1) upper++;\r\n        upper = Math.min(levels.length - 1, upper);\r\n\r\n        const zoomRange = {\r\n            min: levels[lower],\r\n            max: levels[upper]\r\n        };\r\n\r\n        // We'd like to be able to use CameraExpression or CompositeExpression in these\r\n        // return types rather than ExpressionSpecification, but the former are not\r\n        // transferrable across Web Worker boundaries.\r\n        if (expression.kind === 'composite') {\r\n            return {\r\n                functionType: 'composite',\r\n                zoomRange,\r\n                propertyValue: (value.value: any)\r\n            };\r\n        } else {\r\n            // for camera functions, also save off the function values\r\n            // evaluated at the covering zoom levels\r\n            return {\r\n                functionType: 'camera',\r\n                layoutSize: expression.evaluate({zoom: tileZoom + 1}),\r\n                zoomRange,\r\n                sizeRange: {\r\n                    min: expression.evaluate({zoom: zoomRange.min}),\r\n                    max: expression.evaluate({zoom: zoomRange.max})\r\n                },\r\n                propertyValue: (value.value: any)\r\n            };\r\n        }\r\n    }\r\n}\r\n\r\nfunction evaluateSizeForFeature(sizeData: SizeData,\r\n                                partiallyEvaluatedSize: { uSize: number, uSizeT: number },\r\n                                symbol: { lowerSize: number, upperSize: number}) {\r\n    const part = partiallyEvaluatedSize;\r\n    if (sizeData.functionType === 'source') {\r\n        return symbol.lowerSize / 10;\r\n    } else if (sizeData.functionType === 'composite') {\r\n        return interpolate.number(symbol.lowerSize / 10, symbol.upperSize / 10, part.uSizeT);\r\n    } else {\r\n        return part.uSize;\r\n    }\r\n}\r\n\r\nfunction evaluateSizeForZoom(sizeData: SizeData, currentZoom: number, property: Property<number, PossiblyEvaluatedPropertyValue<number>>) {\r\n    if (sizeData.functionType === 'constant') {\r\n        return {\r\n            uSizeT: 0,\r\n            uSize: sizeData.layoutSize\r\n        };\r\n    } else if (sizeData.functionType === 'source') {\r\n        return {\r\n            uSizeT: 0,\r\n            uSize: 0\r\n        };\r\n    } else if (sizeData.functionType === 'camera') {\r\n        const {propertyValue, zoomRange, sizeRange} = sizeData;\r\n        const expression = ((normalizePropertyExpression(propertyValue, property.specification): any): CameraExpression);\r\n\r\n        // Even though we could get the exact value of the camera function\r\n        // at z = tr.zoom, we intentionally do not: instead, we interpolate\r\n        // between the camera function values at a pair of zoom stops covering\r\n        // [tileZoom, tileZoom + 1] in order to be consistent with this\r\n        // restriction on composite functions\r\n        const t = util.clamp(\r\n            expression.interpolationFactor(currentZoom, zoomRange.min, zoomRange.max),\r\n            0, 1);\r\n\r\n        return {\r\n            uSizeT: 0,\r\n            uSize: sizeRange.min + t * (sizeRange.max - sizeRange.min)\r\n        };\r\n    } else {\r\n        const {propertyValue, zoomRange} = sizeData;\r\n        const expression = ((normalizePropertyExpression(propertyValue, property.specification): any): CompositeExpression);\r\n\r\n        return {\r\n            uSizeT: util.clamp(expression.interpolationFactor(currentZoom, zoomRange.min, zoomRange.max), 0, 1),\r\n            uSize: 0\r\n        };\r\n    }\r\n}\r\n","// @flow\r\n\r\nconst rtlTextPlugin = require('../source/rtl_text_plugin');\r\n\r\nimport type SymbolStyleLayer from '../style/style_layer/symbol_style_layer';\r\nimport type {Feature} from '../style-spec/expression';\r\n\r\nmodule.exports = function(text: string, layer: SymbolStyleLayer, feature: Feature) {\r\n    const transform = layer.layout.get('text-transform').evaluate(feature);\r\n    if (transform === 'uppercase') {\r\n        text = text.toLocaleUpperCase();\r\n    } else if (transform === 'lowercase') {\r\n        text = text.toLocaleLowerCase();\r\n    }\r\n\r\n    if (rtlTextPlugin.applyArabicShaping) {\r\n        text = rtlTextPlugin.applyArabicShaping(text);\r\n    }\r\n\r\n    return text;\r\n};\r\n","// @flow\r\n\r\nconst util = require('./util');\r\nconst {serialize, deserialize} = require('./web_worker_transfer');\r\n\r\nimport type {Transferable} from '../types/transferable';\r\n\r\n/**\r\n * An implementation of the [Actor design pattern](http://en.wikipedia.org/wiki/Actor_model)\r\n * that maintains the relationship between asynchronous tasks and the objects\r\n * that spin them off - in this case, tasks like parsing parts of styles,\r\n * owned by the styles\r\n *\r\n * @param {WebWorker} target\r\n * @param {WebWorker} parent\r\n * @param {string|number} mapId A unique identifier for the Map instance using this Actor.\r\n * @private\r\n */\r\nclass Actor {\r\n    target: any;\r\n    parent: any;\r\n    mapId: string;\r\n    callbacks: any;\r\n    callbackID: number;\r\n    name: string;\r\n\r\n    constructor(target: any, parent: any, mapId: any) {\r\n        this.target = target;\r\n        this.parent = parent;\r\n        this.mapId = mapId;\r\n        this.callbacks = {};\r\n        this.callbackID = 0;\r\n        util.bindAll(['receive'], this);\r\n        this.target.addEventListener('message', this.receive, false);\r\n    }\r\n\r\n    /**\r\n     * Sends a message from a main-thread map to a Worker or from a Worker back to\r\n     * a main-thread map instance.\r\n     *\r\n     * @param type The name of the target method to invoke or '[source-type].name' for a method on a WorkerSource.\r\n     * @param targetMapId A particular mapId to which to send this message.\r\n     * @private\r\n     */\r\n    send(type: string, data: mixed, callback: ?Function, targetMapId: ?string) {\r\n        const id = callback ? `${this.mapId}:${this.callbackID++}` : null;\r\n        if (callback) this.callbacks[id] = callback;\r\n        const buffers: Array<Transferable> = [];\r\n        this.target.postMessage({\r\n            targetMapId: targetMapId,\r\n            sourceMapId: this.mapId,\r\n            type: type,\r\n            id: String(id),\r\n            data: serialize(data, buffers)\r\n        }, buffers);\r\n    }\r\n\r\n    receive(message: Object) {\r\n        const data = message.data,\r\n            id = data.id;\r\n        let callback;\r\n\r\n        if (data.targetMapId && this.mapId !== data.targetMapId)\r\n            return;\r\n\r\n        const done = (err, data) => {\r\n            const buffers: Array<Transferable> = [];\r\n            this.target.postMessage({\r\n                sourceMapId: this.mapId,\r\n                type: '<response>',\r\n                id: String(id),\r\n                error: err ? String(err) : null,\r\n                data: serialize(data, buffers)\r\n            }, buffers);\r\n        };\r\n\r\n        if (data.type === '<response>') {\r\n            callback = this.callbacks[data.id];\r\n            delete this.callbacks[data.id];\r\n            if (callback && data.error) {\r\n                callback(new Error(data.error));\r\n            } else if (callback) {\r\n                callback(null, deserialize(data.data));\r\n            }\r\n        } else if (typeof data.id !== 'undefined' && this.parent[data.type]) {\r\n            // data.type == 'loadTile', 'removeTile', etc.\r\n            this.parent[data.type](data.sourceMapId, deserialize(data.data), done);\r\n        } else if (typeof data.id !== 'undefined' && this.parent.getWorkerSource) {\r\n            // data.type == sourcetype.method\r\n            const keys = data.type.split('.');\r\n            const workerSource = (this.parent: any).getWorkerSource(data.sourceMapId, keys[0]);\r\n            workerSource[keys[1]](deserialize(data.data), done);\r\n        } else {\r\n            this.parent[data.type](deserialize(data.data));\r\n        }\r\n    }\r\n\r\n    remove() {\r\n        this.target.removeEventListener('message', this.receive, false);\r\n    }\r\n}\r\n\r\nmodule.exports = Actor;\r\n","// @flow\r\n\r\nconst window = require('./window');\r\n\r\nimport type { Callback } from '../types/callback';\r\n\r\n/**\r\n * The type of a resource.\r\n * @private\r\n * @readonly\r\n * @enum {string}\r\n */\r\nconst ResourceType = {\r\n    Unknown: 'Unknown',\r\n    Style: 'Style',\r\n    Source: 'Source',\r\n    Tile: 'Tile',\r\n    Glyphs: 'Glyphs',\r\n    SpriteImage: 'SpriteImage',\r\n    SpriteJSON: 'SpriteJSON',\r\n    Image: 'Image'\r\n};\r\nexports.ResourceType = ResourceType;\r\n\r\nif (typeof Object.freeze == 'function') {\r\n    Object.freeze(ResourceType);\r\n}\r\n\r\n/**\r\n * A `RequestParameters` object to be returned from Map.options.transformRequest callbacks.\r\n * @typedef {Object} RequestParameters\r\n * @property {string} url The URL to be requested.\r\n * @property {Object} headers The headers to be sent with the request.\r\n * @property {string} credentials `'same-origin'|'include'` Use 'include' to send cookies with cross-origin requests.\r\n */\r\nexport type RequestParameters = {\r\n    url: string,\r\n    headers?: Object,\r\n    credentials?: 'same-origin' | 'include'\r\n};\r\n\r\nclass AJAXError extends Error {\r\n    status: number;\r\n    constructor(message: string, status: number) {\r\n        super(message);\r\n        this.status = status;\r\n    }\r\n}\r\n\r\nfunction makeRequest(requestParameters: RequestParameters): XMLHttpRequest {\r\n    const xhr: XMLHttpRequest = new window.XMLHttpRequest();\r\n\r\n    xhr.open('GET', requestParameters.url, true);\r\n    for (const k in requestParameters.headers) {\r\n        xhr.setRequestHeader(k, requestParameters.headers[k]);\r\n    }\r\n    xhr.withCredentials = requestParameters.credentials === 'include';\r\n    return xhr;\r\n}\r\n\r\nexports.getJSON = function(requestParameters: RequestParameters, callback: Callback<mixed>) {\r\n    const xhr = makeRequest(requestParameters);\r\n    xhr.setRequestHeader('Accept', 'application/json');\r\n    xhr.onerror = function() {\r\n        callback(new Error(xhr.statusText));\r\n    };\r\n    xhr.onload = function() {\r\n        if (xhr.status >= 200 && xhr.status < 300 && xhr.response) {\r\n            let data;\r\n            try {\r\n                data = JSON.parse(xhr.response);\r\n            } catch (err) {\r\n                return callback(err);\r\n            }\r\n            callback(null, data);\r\n        } else {\r\n            callback(new AJAXError(xhr.statusText, xhr.status));\r\n        }\r\n    };\r\n    xhr.send();\r\n    return xhr;\r\n};\r\n\r\nexports.getArrayBuffer = function(requestParameters: RequestParameters, callback: Callback<{data: ArrayBuffer, cacheControl: ?string, expires: ?string}>) {\r\n    const xhr = makeRequest(requestParameters);\r\n    xhr.responseType = 'arraybuffer';\r\n    xhr.onerror = function() {\r\n        callback(new Error(xhr.statusText));\r\n    };\r\n    xhr.onload = function() {\r\n        const response: ArrayBuffer = xhr.response;\r\n        if (response.byteLength === 0 && xhr.status === 200) {\r\n            return callback(new Error('http status 200 returned without content.'));\r\n        }\r\n        if (xhr.status >= 200 && xhr.status < 300 && xhr.response) {\r\n            callback(null, {\r\n                data: response,\r\n                cacheControl: xhr.getResponseHeader('Cache-Control'),\r\n                expires: xhr.getResponseHeader('Expires')\r\n            });\r\n        } else {\r\n            callback(new AJAXError(xhr.statusText, xhr.status));\r\n        }\r\n    };\r\n    xhr.send();\r\n    return xhr;\r\n};\r\n\r\nfunction sameOrigin(url) {\r\n    const a: HTMLAnchorElement = window.document.createElement('a');\r\n    a.href = url;\r\n    return a.protocol === window.document.location.protocol && a.host === window.document.location.host;\r\n}\r\n\r\nconst transparentPngUrl = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=';\r\n\r\nexports.getImage = function(requestParameters: RequestParameters, callback: Callback<HTMLImageElement>) {\r\n    // request the image with XHR to work around caching issues\r\n    // see https://github.com/mapbox/mapbox-gl-js/issues/1470\r\n    return exports.getArrayBuffer(requestParameters, (err, imgData) => {\r\n        if (err) {\r\n            callback(err);\r\n        } else if (imgData) {\r\n            const img: HTMLImageElement = new window.Image();\r\n            const URL = window.URL || window.webkitURL;\r\n            img.onload = () => {\r\n                callback(null, img);\r\n                URL.revokeObjectURL(img.src);\r\n            };\r\n            const blob: Blob = new window.Blob([new Uint8Array(imgData.data)], { type: 'image/png' });\r\n            (img: any).cacheControl = imgData.cacheControl;\r\n            (img: any).expires = imgData.expires;\r\n            img.src = imgData.data.byteLength ? URL.createObjectURL(blob) : transparentPngUrl;\r\n        }\r\n    });\r\n};\r\n\r\nexports.getVideo = function(urls: Array<string>, callback: Callback<HTMLVideoElement>) {\r\n    const video: HTMLVideoElement = window.document.createElement('video');\r\n    video.onloadstart = function() {\r\n        callback(null, video);\r\n    };\r\n    for (let i = 0; i < urls.length; i++) {\r\n        const s: HTMLSourceElement = window.document.createElement('source');\r\n        if (!sameOrigin(urls[i])) {\r\n            video.crossOrigin = 'Anonymous';\r\n        }\r\n        s.src = urls[i];\r\n        video.appendChild(s);\r\n    }\r\n    return video;\r\n};\r\n","// @flow\r\n\r\n/* eslint-env browser */\r\nmodule.exports = (self: Window);\r\n","// @flow\r\n\r\nconst quickselect = require('quickselect');\r\nconst calculateSignedArea = require('./util').calculateSignedArea;\r\n\r\nimport type Point from '@mapbox/point-geometry';\r\n\r\n// classifies an array of rings into polygons with outer rings and holes\r\nmodule.exports = function classifyRings(rings: Array<Array<Point>>, maxRings: number) {\r\n    const len = rings.length;\r\n\r\n    if (len <= 1) return [rings];\r\n\r\n    const polygons = [];\r\n    let polygon,\r\n        ccw;\r\n\r\n    for (let i = 0; i < len; i++) {\r\n        const area = calculateSignedArea(rings[i]);\r\n        if (area === 0) continue;\r\n\r\n        (rings[i]: any).area = Math.abs(area);\r\n\r\n        if (ccw === undefined) ccw = area < 0;\r\n\r\n        if (ccw === area < 0) {\r\n            if (polygon) polygons.push(polygon);\r\n            polygon = [rings[i]];\r\n\r\n        } else {\r\n            (polygon: any).push(rings[i]);\r\n        }\r\n    }\r\n    if (polygon) polygons.push(polygon);\r\n\r\n    // Earcut performance degrages with the # of rings in a polygon. For this\r\n    // reason, we limit strip out all but the `maxRings` largest rings.\r\n    if (maxRings > 1) {\r\n        for (let j = 0; j < polygons.length; j++) {\r\n            if (polygons[j].length <= maxRings) continue;\r\n            quickselect(polygons[j], maxRings, 1, polygons[j].length - 1, compareAreas);\r\n            polygons[j] = polygons[j].slice(0, maxRings);\r\n        }\r\n    }\r\n\r\n    return polygons;\r\n};\r\n\r\nfunction compareAreas(a, b) {\r\n    return b.area - a.area;\r\n}\r\n","// @flow\r\n\r\nconst assert = require('assert');\r\n\r\nclass DictionaryCoder {\r\n    _stringToNumber: { [string]: number };\r\n    _numberToString: Array<string>;\r\n\r\n    constructor(strings: Array<string>) {\r\n        this._stringToNumber = {};\r\n        this._numberToString = [];\r\n        for (let i = 0; i < strings.length; i++) {\r\n            const string = strings[i];\r\n            this._stringToNumber[string] = i;\r\n            this._numberToString[i] = string;\r\n        }\r\n    }\r\n\r\n    encode(string: string) {\r\n        assert(string in this._stringToNumber);\r\n        return this._stringToNumber[string];\r\n    }\r\n\r\n    decode(n: number) {\r\n        assert(n < this._numberToString.length);\r\n        return this._numberToString[n];\r\n    }\r\n}\r\n\r\nmodule.exports = DictionaryCoder;\r\n","// @flow\r\n\r\nconst util = require('./util');\r\n\r\ntype Listener = (Object) => any;\r\ntype Listeners = { [string]: Array<Listener> };\r\n\r\nfunction _addEventListener(type: string, listener: Listener, listenerList: Listeners) {\r\n    listenerList[type] = listenerList[type] || [];\r\n    listenerList[type].push(listener);\r\n}\r\n\r\nfunction _removeEventListener(type: string, listener: Listener, listenerList: Listeners) {\r\n    if (listenerList && listenerList[type]) {\r\n        const index = listenerList[type].indexOf(listener);\r\n        if (index !== -1) {\r\n            listenerList[type].splice(index, 1);\r\n        }\r\n    }\r\n}\r\n\r\n/**\r\n * Methods mixed in to other classes for event capabilities.\r\n *\r\n * @mixin Evented\r\n */\r\nclass Evented {\r\n    _listeners: Listeners;\r\n    _oneTimeListeners: Listeners;\r\n    _eventedParent: ?Evented;\r\n    _eventedParentData: ?(Object | () => Object);\r\n\r\n    /**\r\n     * Adds a listener to a specified event type.\r\n     *\r\n     * @param {string} type The event type to add a listen for.\r\n     * @param {Function} listener The function to be called when the event is fired.\r\n     *   The listener function is called with the data object passed to `fire`,\r\n     *   extended with `target` and `type` properties.\r\n     * @returns {Object} `this`\r\n     */\r\n    on(type: *, listener: Listener): this {\r\n        this._listeners = this._listeners || {};\r\n        _addEventListener(type, listener, this._listeners);\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * Removes a previously registered event listener.\r\n     *\r\n     * @param {string} type The event type to remove listeners for.\r\n     * @param {Function} listener The listener function to remove.\r\n     * @returns {Object} `this`\r\n     */\r\n    off(type: *, listener: Listener) {\r\n        _removeEventListener(type, listener, this._listeners);\r\n        _removeEventListener(type, listener, this._oneTimeListeners);\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * Adds a listener that will be called only once to a specified event type.\r\n     *\r\n     * The listener will be called first time the event fires after the listener is registered.\r\n     *\r\n     * @param {string} type The event type to listen for.\r\n     * @param {Function} listener The function to be called when the event is fired the first time.\r\n     * @returns {Object} `this`\r\n     */\r\n    once(type: string, listener: Listener) {\r\n        this._oneTimeListeners = this._oneTimeListeners || {};\r\n        _addEventListener(type, listener, this._oneTimeListeners);\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * Fires an event of the specified type.\r\n     *\r\n     * @param {string} type The type of event to fire.\r\n     * @param {Object} [data] Data to be passed to any listeners.\r\n     * @returns {Object} `this`\r\n     */\r\n    fire(type: string, data?: Object) {\r\n        if (this.listens(type)) {\r\n            data = util.extend({}, data, {type: type, target: this});\r\n\r\n            // make sure adding or removing listeners inside other listeners won't cause an infinite loop\r\n            const listeners = this._listeners && this._listeners[type] ? this._listeners[type].slice() : [];\r\n            for (const listener of listeners) {\r\n                listener.call(this, data);\r\n            }\r\n\r\n            const oneTimeListeners = this._oneTimeListeners && this._oneTimeListeners[type] ? this._oneTimeListeners[type].slice() : [];\r\n            for (const listener of oneTimeListeners) {\r\n                _removeEventListener(type, listener, this._oneTimeListeners);\r\n                listener.call(this, data);\r\n            }\r\n\r\n            if (this._eventedParent) {\r\n                this._eventedParent.fire(type, util.extend({}, data, typeof this._eventedParentData === 'function' ? this._eventedParentData() : this._eventedParentData));\r\n            }\r\n\r\n        // To ensure that no error events are dropped, print them to the\r\n        // console if they have no listeners.\r\n        } else if (util.endsWith(type, 'error')) {\r\n            console.error((data && data.error) || data || 'Empty error event');\r\n        }\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * Returns a true if this instance of Evented or any forwardeed instances of Evented have a listener for the specified type.\r\n     *\r\n     * @param {string} type The event type\r\n     * @returns {boolean} `true` if there is at least one registered listener for specified event type, `false` otherwise\r\n     */\r\n    listens(type: string) {\r\n        return (\r\n            (this._listeners && this._listeners[type] && this._listeners[type].length > 0) ||\r\n            (this._oneTimeListeners && this._oneTimeListeners[type] && this._oneTimeListeners[type].length > 0) ||\r\n            (this._eventedParent && this._eventedParent.listens(type))\r\n        );\r\n    }\r\n\r\n    /**\r\n     * Bubble all events fired by this instance of Evented to this parent instance of Evented.\r\n     *\r\n     * @private\r\n     * @returns {Object} `this`\r\n     */\r\n    setEventedParent(parent: ?Evented, data?: Object | () => Object) {\r\n        this._eventedParent = parent;\r\n        this._eventedParentData = data;\r\n\r\n        return this;\r\n    }\r\n}\r\n\r\nmodule.exports = Evented;\r\n","// @flow\r\n\r\nconst Queue = require('tinyqueue');\r\nconst Point = require('@mapbox/point-geometry');\r\nconst distToSegmentSquared = require('./intersection_tests').distToSegmentSquared;\r\n\r\n/**\r\n * Finds an approximation of a polygon's Pole Of Inaccessibiliy https://en.wikipedia.org/wiki/Pole_of_inaccessibility\r\n * This is a copy of http://github.com/mapbox/polylabel adapted to use Points\r\n *\r\n * @param polygonRings first item in array is the outer ring followed optionally by the list of holes, should be an element of the result of util/classify_rings\r\n * @param precision Specified in input coordinate units. If 0 returns after first run, if > 0 repeatedly narrows the search space until the radius of the area searched for the best pole is less than precision\r\n * @param debug Print some statistics to the console during execution\r\n * @returns Pole of Inaccessibiliy.\r\n * @private\r\n */\r\nmodule.exports = function (polygonRings: Array<Array<Point>>, precision?: number = 1, debug?: boolean = false): Point {\r\n    // find the bounding box of the outer ring\r\n    let minX = Infinity, minY = Infinity, maxX = -Infinity, maxY = -Infinity;\r\n    const outerRing = polygonRings[0];\r\n    for (let i = 0; i < outerRing.length; i++) {\r\n        const p = outerRing[i];\r\n        if (!i || p.x < minX) minX = p.x;\r\n        if (!i || p.y < minY) minY = p.y;\r\n        if (!i || p.x > maxX) maxX = p.x;\r\n        if (!i || p.y > maxY) maxY = p.y;\r\n    }\r\n\r\n    const width = maxX - minX;\r\n    const height = maxY - minY;\r\n    const cellSize = Math.min(width, height);\r\n    let h = cellSize / 2;\r\n\r\n    // a priority queue of cells in order of their \"potential\" (max distance to polygon)\r\n    const cellQueue = new Queue(null, compareMax);\r\n\r\n    if (cellSize === 0) return new Point(minX, minY);\r\n\r\n    // cover polygon with initial cells\r\n    for (let x = minX; x < maxX; x += cellSize) {\r\n        for (let y = minY; y < maxY; y += cellSize) {\r\n            cellQueue.push(new Cell(x + h, y + h, h, polygonRings));\r\n        }\r\n    }\r\n\r\n    // take centroid as the first best guess\r\n    let bestCell = getCentroidCell(polygonRings);\r\n    let numProbes = cellQueue.length;\r\n\r\n    while (cellQueue.length) {\r\n        // pick the most promising cell from the queue\r\n        const cell = cellQueue.pop();\r\n\r\n        // update the best cell if we found a better one\r\n        if (cell.d > bestCell.d || !bestCell.d) {\r\n            bestCell = cell;\r\n            if (debug) console.log('found best %d after %d probes', Math.round(1e4 * cell.d) / 1e4, numProbes);\r\n        }\r\n\r\n        // do not drill down further if there's no chance of a better solution\r\n        if (cell.max - bestCell.d <= precision) continue;\r\n\r\n        // split the cell into four cells\r\n        h = cell.h / 2;\r\n        cellQueue.push(new Cell(cell.p.x - h, cell.p.y - h, h, polygonRings));\r\n        cellQueue.push(new Cell(cell.p.x + h, cell.p.y - h, h, polygonRings));\r\n        cellQueue.push(new Cell(cell.p.x - h, cell.p.y + h, h, polygonRings));\r\n        cellQueue.push(new Cell(cell.p.x + h, cell.p.y + h, h, polygonRings));\r\n        numProbes += 4;\r\n    }\r\n\r\n    if (debug) {\r\n        console.log(`num probes: ${numProbes}`);\r\n        console.log(`best distance: ${bestCell.d}`);\r\n    }\r\n\r\n    return bestCell.p;\r\n};\r\n\r\nfunction compareMax(a, b) {\r\n    return b.max - a.max;\r\n}\r\n\r\nfunction Cell(x, y, h, polygon) {\r\n    this.p = new Point(x, y);\r\n    this.h = h; // half the cell size\r\n    this.d = pointToPolygonDist(this.p, polygon); // distance from cell center to polygon\r\n    this.max = this.d + this.h * Math.SQRT2; // max distance to polygon within a cell\r\n}\r\n\r\n// signed distance from point to polygon outline (negative if point is outside)\r\nfunction pointToPolygonDist(p, polygon) {\r\n    let inside = false;\r\n    let minDistSq = Infinity;\r\n\r\n    for (let k = 0; k < polygon.length; k++) {\r\n        const ring = polygon[k];\r\n\r\n        for (let i = 0, len = ring.length, j = len - 1; i < len; j = i++) {\r\n            const a = ring[i];\r\n            const b = ring[j];\r\n\r\n            if ((a.y > p.y !== b.y > p.y) &&\r\n                (p.x < (b.x - a.x) * (p.y - a.y) / (b.y - a.y) + a.x)) inside = !inside;\r\n\r\n            minDistSq = Math.min(minDistSq, distToSegmentSquared(p, a, b));\r\n        }\r\n    }\r\n\r\n    return (inside ? 1 : -1) * Math.sqrt(minDistSq);\r\n}\r\n\r\n// get polygon centroid\r\nfunction getCentroidCell(polygon) {\r\n    let area = 0;\r\n    let x = 0;\r\n    let y = 0;\r\n    const points = polygon[0];\r\n    for (let i = 0, len = points.length, j = len - 1; i < len; j = i++) {\r\n        const a = points[i];\r\n        const b = points[j];\r\n        const f = a.x * b.y - b.x * a.y;\r\n        x += (a.x + b.x) * f;\r\n        y += (a.y + b.y) * f;\r\n        area += f * 3;\r\n    }\r\n    return new Cell(x / area, y / area, 0, polygon);\r\n}\r\n","// @flow\r\n\r\nconst assert = require('assert');\r\nconst {register} = require('./web_worker_transfer');\r\n\r\nexport type Size = {\r\n    width: number,\r\n    height: number\r\n};\r\n\r\ntype Point = {\r\n    x: number,\r\n    y: number\r\n};\r\n\r\nfunction createImage(image: *, {width, height}: Size, channels: number, data?: Uint8Array | Uint8ClampedArray) {\r\n    if (!data) {\r\n        data = new Uint8Array(width * height * channels);\r\n    } else if (data.length !== width * height * channels) {\r\n        throw new RangeError('mismatched image size');\r\n    }\r\n    image.width = width;\r\n    image.height = height;\r\n    image.data = data;\r\n    return image;\r\n}\r\n\r\nfunction resizeImage(image: *, {width, height}: Size, channels: number) {\r\n    if (width === image.width && height === image.height) {\r\n        return;\r\n    }\r\n\r\n    const newImage = createImage({}, {width, height}, channels);\r\n\r\n    copyImage(image, newImage, {x: 0, y: 0}, {x: 0, y: 0}, {\r\n        width: Math.min(image.width, width),\r\n        height: Math.min(image.height, height)\r\n    }, channels);\r\n\r\n    image.width = width;\r\n    image.height = height;\r\n    image.data = newImage.data;\r\n}\r\n\r\nfunction copyImage(srcImg: *, dstImg: *, srcPt: Point, dstPt: Point, size: Size, channels: number) {\r\n    if (size.width === 0 || size.height === 0) {\r\n        return dstImg;\r\n    }\r\n\r\n    if (size.width > srcImg.width ||\r\n        size.height > srcImg.height ||\r\n        srcPt.x > srcImg.width - size.width ||\r\n        srcPt.y > srcImg.height - size.height) {\r\n        throw new RangeError('out of range source coordinates for image copy');\r\n    }\r\n\r\n    if (size.width > dstImg.width ||\r\n        size.height > dstImg.height ||\r\n        dstPt.x > dstImg.width - size.width ||\r\n        dstPt.y > dstImg.height - size.height) {\r\n        throw new RangeError('out of range destination coordinates for image copy');\r\n    }\r\n\r\n    const srcData = srcImg.data;\r\n    const dstData = dstImg.data;\r\n\r\n    assert(srcData !== dstData);\r\n\r\n    for (let y = 0; y < size.height; y++) {\r\n        const srcOffset = ((srcPt.y + y) * srcImg.width + srcPt.x) * channels;\r\n        const dstOffset = ((dstPt.y + y) * dstImg.width + dstPt.x) * channels;\r\n        for (let i = 0; i < size.width * channels; i++) {\r\n            dstData[dstOffset + i] = srcData[srcOffset + i];\r\n        }\r\n    }\r\n\r\n    return dstImg;\r\n}\r\n\r\nclass AlphaImage {\r\n    width: number;\r\n    height: number;\r\n    data: Uint8Array | Uint8ClampedArray;\r\n\r\n    constructor(size: Size, data?: Uint8Array | Uint8ClampedArray) {\r\n        createImage(this, size, 1, data);\r\n    }\r\n\r\n    resize(size: Size) {\r\n        resizeImage(this, size, 1);\r\n    }\r\n\r\n    clone() {\r\n        return new AlphaImage({width: this.width, height: this.height}, new Uint8Array(this.data));\r\n    }\r\n\r\n    static copy(srcImg: AlphaImage, dstImg: AlphaImage, srcPt: Point, dstPt: Point, size: Size) {\r\n        copyImage(srcImg, dstImg, srcPt, dstPt, size, 1);\r\n    }\r\n}\r\n\r\n// Not premultiplied, because ImageData is not premultiplied.\r\n// UNPACK_PREMULTIPLY_ALPHA_WEBGL must be used when uploading to a texture.\r\nclass RGBAImage {\r\n    width: number;\r\n    height: number;\r\n    data: Uint8Array | Uint8ClampedArray;\r\n\r\n    constructor(size: Size, data?: Uint8Array | Uint8ClampedArray) {\r\n        createImage(this, size, 4, data);\r\n    }\r\n\r\n    resize(size: Size) {\r\n        resizeImage(this, size, 4);\r\n    }\r\n\r\n    clone() {\r\n        return new RGBAImage({width: this.width, height: this.height}, new Uint8Array(this.data));\r\n    }\r\n\r\n    static copy(srcImg: RGBAImage | ImageData, dstImg: RGBAImage, srcPt: Point, dstPt: Point, size: Size) {\r\n        copyImage(srcImg, dstImg, srcPt, dstPt, size, 4);\r\n    }\r\n}\r\n\r\nregister('AlphaImage', AlphaImage);\r\nregister('RGBAImage', RGBAImage);\r\n\r\nmodule.exports = {\r\n    AlphaImage,\r\n    RGBAImage\r\n};\r\n","// @flow\r\n\r\nconst {isCounterClockwise} = require('./util');\r\n\r\nimport type Point from '@mapbox/point-geometry';\r\n\r\nmodule.exports = {\r\n    multiPolygonIntersectsBufferedMultiPoint,\r\n    multiPolygonIntersectsMultiPolygon,\r\n    multiPolygonIntersectsBufferedMultiLine,\r\n    polygonIntersectsPolygon,\r\n    distToSegmentSquared\r\n};\r\n\r\ntype Line = Array<Point>;\r\ntype MultiLine = Array<Line>;\r\ntype Ring = Array<Point>;\r\ntype Polygon = Array<Point>;\r\ntype MultiPolygon = Array<Polygon>;\r\n\r\nfunction polygonIntersectsPolygon(polygonA: Polygon, polygonB: Polygon) {\r\n    for (let i = 0; i < polygonA.length; i++) {\r\n        if (polygonContainsPoint(polygonB, polygonA[i])) return true;\r\n    }\r\n\r\n    for (let i = 0; i < polygonB.length; i++) {\r\n        if (polygonContainsPoint(polygonA, polygonB[i])) return true;\r\n    }\r\n\r\n    if (lineIntersectsLine(polygonA, polygonB)) return true;\r\n\r\n    return false;\r\n}\r\n\r\nfunction multiPolygonIntersectsBufferedMultiPoint(multiPolygon: MultiPolygon, rings: Array<Ring>, radius: number) {\r\n    for (let j = 0; j < multiPolygon.length; j++) {\r\n        const polygon = multiPolygon[j];\r\n        for (let i = 0; i < rings.length; i++) {\r\n            const ring = rings[i];\r\n            for (let k = 0; k < ring.length; k++) {\r\n                const point = ring[k];\r\n                if (polygonContainsPoint(polygon, point)) return true;\r\n                if (pointIntersectsBufferedLine(point, polygon, radius)) return true;\r\n            }\r\n        }\r\n    }\r\n    return false;\r\n}\r\n\r\nfunction multiPolygonIntersectsMultiPolygon(multiPolygonA: MultiPolygon, multiPolygonB: MultiPolygon) {\r\n\r\n    if (multiPolygonA.length === 1 && multiPolygonA[0].length === 1) {\r\n        return multiPolygonContainsPoint(multiPolygonB, multiPolygonA[0][0]);\r\n    }\r\n\r\n    for (let m = 0; m < multiPolygonB.length; m++) {\r\n        const ring = multiPolygonB[m];\r\n        for (let n = 0; n < ring.length; n++) {\r\n            if (multiPolygonContainsPoint(multiPolygonA, ring[n])) return true;\r\n        }\r\n    }\r\n\r\n    for (let j = 0; j < multiPolygonA.length; j++) {\r\n        const polygon = multiPolygonA[j];\r\n        for (let i = 0; i < polygon.length; i++) {\r\n            if (multiPolygonContainsPoint(multiPolygonB, polygon[i])) return true;\r\n        }\r\n\r\n        for (let k = 0; k < multiPolygonB.length; k++) {\r\n            if (lineIntersectsLine(polygon, multiPolygonB[k])) return true;\r\n        }\r\n    }\r\n\r\n    return false;\r\n}\r\n\r\nfunction multiPolygonIntersectsBufferedMultiLine(multiPolygon: MultiPolygon, multiLine: MultiLine, radius: number) {\r\n    for (let i = 0; i < multiLine.length; i++) {\r\n        const line = multiLine[i];\r\n\r\n        for (let j = 0; j < multiPolygon.length; j++) {\r\n            const polygon = multiPolygon[j];\r\n\r\n            if (polygon.length >= 3) {\r\n                for (let k = 0; k < line.length; k++) {\r\n                    if (polygonContainsPoint(polygon, line[k])) return true;\r\n                }\r\n            }\r\n\r\n            if (lineIntersectsBufferedLine(polygon, line, radius)) return true;\r\n        }\r\n    }\r\n    return false;\r\n}\r\n\r\nfunction lineIntersectsBufferedLine(lineA: Line, lineB: Line, radius: number) {\r\n\r\n    if (lineA.length > 1) {\r\n        if (lineIntersectsLine(lineA, lineB)) return true;\r\n\r\n        // Check whether any point in either line is within radius of the other line\r\n        for (let j = 0; j < lineB.length; j++) {\r\n            if (pointIntersectsBufferedLine(lineB[j], lineA, radius)) return true;\r\n        }\r\n    }\r\n\r\n    for (let k = 0; k < lineA.length; k++) {\r\n        if (pointIntersectsBufferedLine(lineA[k], lineB, radius)) return true;\r\n    }\r\n\r\n    return false;\r\n}\r\n\r\nfunction lineIntersectsLine(lineA: Line, lineB: Line) {\r\n    if (lineA.length === 0 || lineB.length === 0) return false;\r\n    for (let i = 0; i < lineA.length - 1; i++) {\r\n        const a0 = lineA[i];\r\n        const a1 = lineA[i + 1];\r\n        for (let j = 0; j < lineB.length - 1; j++) {\r\n            const b0 = lineB[j];\r\n            const b1 = lineB[j + 1];\r\n            if (lineSegmentIntersectsLineSegment(a0, a1, b0, b1)) return true;\r\n        }\r\n    }\r\n    return false;\r\n}\r\n\r\nfunction lineSegmentIntersectsLineSegment(a0: Point, a1: Point, b0: Point, b1: Point) {\r\n    return isCounterClockwise(a0, b0, b1) !== isCounterClockwise(a1, b0, b1) &&\r\n        isCounterClockwise(a0, a1, b0) !== isCounterClockwise(a0, a1, b1);\r\n}\r\n\r\nfunction pointIntersectsBufferedLine(p: Point, line: Line, radius: number) {\r\n    const radiusSquared = radius * radius;\r\n\r\n    if (line.length === 1) return p.distSqr(line[0]) < radiusSquared;\r\n\r\n    for (let i = 1; i < line.length; i++) {\r\n        // Find line segments that have a distance <= radius^2 to p\r\n        // In that case, we treat the line as \"containing point p\".\r\n        const v = line[i - 1], w = line[i];\r\n        if (distToSegmentSquared(p, v, w) < radiusSquared) return true;\r\n    }\r\n    return false;\r\n}\r\n\r\n// Code from http://stackoverflow.com/a/1501725/331379.\r\nfunction distToSegmentSquared(p: Point, v: Point, w: Point) {\r\n    const l2 = v.distSqr(w);\r\n    if (l2 === 0) return p.distSqr(v);\r\n    const t = ((p.x - v.x) * (w.x - v.x) + (p.y - v.y) * (w.y - v.y)) / l2;\r\n    if (t < 0) return p.distSqr(v);\r\n    if (t > 1) return p.distSqr(w);\r\n    return p.distSqr(w.sub(v)._mult(t)._add(v));\r\n}\r\n\r\n// point in polygon ray casting algorithm\r\nfunction multiPolygonContainsPoint(rings: Array<Ring>, p: Point) {\r\n    let c = false,\r\n        ring, p1, p2;\r\n\r\n    for (let k = 0; k < rings.length; k++) {\r\n        ring = rings[k];\r\n        for (let i = 0, j = ring.length - 1; i < ring.length; j = i++) {\r\n            p1 = ring[i];\r\n            p2 = ring[j];\r\n            if (((p1.y > p.y) !== (p2.y > p.y)) && (p.x < (p2.x - p1.x) * (p.y - p1.y) / (p2.y - p1.y) + p1.x)) {\r\n                c = !c;\r\n            }\r\n        }\r\n    }\r\n    return c;\r\n}\r\n\r\nfunction polygonContainsPoint(ring: Ring, p: Point) {\r\n    let c = false;\r\n    for (let i = 0, j = ring.length - 1; i < ring.length; j = i++) {\r\n        const p1 = ring[i];\r\n        const p2 = ring[j];\r\n        if (((p1.y > p.y) !== (p2.y > p.y)) && (p.x < (p2.x - p1.x) * (p.y - p1.y) / (p2.y - p1.y) + p1.x)) {\r\n            c = !c;\r\n        }\r\n    }\r\n    return c;\r\n}\r\n","// @flow\r\n\r\n// The following table comes from <http://www.unicode.org/Public/10.0.0/ucd/Blocks.txt>.\r\n// Keep it synchronized with <http://www.unicode.org/Public/UCD/latest/ucd/Blocks.txt>.\r\n\r\ntype UnicodeBlockLookup = {[key: string]: (char: number) => boolean};\r\n\r\nconst unicodeBlockLookup: UnicodeBlockLookup = {\r\n    // 'Basic Latin': (char) => char >= 0x0000 && char <= 0x007F,\r\n    'Latin-1 Supplement': (char) => char >= 0x0080 && char <= 0x00FF,\r\n    // 'Latin Extended-A': (char) => char >= 0x0100 && char <= 0x017F,\r\n    // 'Latin Extended-B': (char) => char >= 0x0180 && char <= 0x024F,\r\n    // 'IPA Extensions': (char) => char >= 0x0250 && char <= 0x02AF,\r\n    // 'Spacing Modifier Letters': (char) => char >= 0x02B0 && char <= 0x02FF,\r\n    // 'Combining Diacritical Marks': (char) => char >= 0x0300 && char <= 0x036F,\r\n    // 'Greek and Coptic': (char) => char >= 0x0370 && char <= 0x03FF,\r\n    // 'Cyrillic': (char) => char >= 0x0400 && char <= 0x04FF,\r\n    // 'Cyrillic Supplement': (char) => char >= 0x0500 && char <= 0x052F,\r\n    // 'Armenian': (char) => char >= 0x0530 && char <= 0x058F,\r\n    //'Hebrew': (char) => char >= 0x0590 && char <= 0x05FF,\r\n    'Arabic': (char) => char >= 0x0600 && char <= 0x06FF,\r\n    //'Syriac': (char) => char >= 0x0700 && char <= 0x074F,\r\n    'Arabic Supplement': (char) => char >= 0x0750 && char <= 0x077F,\r\n    // 'Thaana': (char) => char >= 0x0780 && char <= 0x07BF,\r\n    // 'NKo': (char) => char >= 0x07C0 && char <= 0x07FF,\r\n    // 'Samaritan': (char) => char >= 0x0800 && char <= 0x083F,\r\n    // 'Mandaic': (char) => char >= 0x0840 && char <= 0x085F,\r\n    // 'Syriac Supplement': (char) => char >= 0x0860 && char <= 0x086F,\r\n    'Arabic Extended-A': (char) => char >= 0x08A0 && char <= 0x08FF,\r\n    // 'Devanagari': (char) => char >= 0x0900 && char <= 0x097F,\r\n    // 'Bengali': (char) => char >= 0x0980 && char <= 0x09FF,\r\n    // 'Gurmukhi': (char) => char >= 0x0A00 && char <= 0x0A7F,\r\n    // 'Gujarati': (char) => char >= 0x0A80 && char <= 0x0AFF,\r\n    // 'Oriya': (char) => char >= 0x0B00 && char <= 0x0B7F,\r\n    // 'Tamil': (char) => char >= 0x0B80 && char <= 0x0BFF,\r\n    // 'Telugu': (char) => char >= 0x0C00 && char <= 0x0C7F,\r\n    // 'Kannada': (char) => char >= 0x0C80 && char <= 0x0CFF,\r\n    // 'Malayalam': (char) => char >= 0x0D00 && char <= 0x0D7F,\r\n    // 'Sinhala': (char) => char >= 0x0D80 && char <= 0x0DFF,\r\n    // 'Thai': (char) => char >= 0x0E00 && char <= 0x0E7F,\r\n    // 'Lao': (char) => char >= 0x0E80 && char <= 0x0EFF,\r\n    // 'Tibetan': (char) => char >= 0x0F00 && char <= 0x0FFF,\r\n    // 'Myanmar': (char) => char >= 0x1000 && char <= 0x109F,\r\n    // 'Georgian': (char) => char >= 0x10A0 && char <= 0x10FF,\r\n    'Hangul Jamo': (char) => char >= 0x1100 && char <= 0x11FF,\r\n    // 'Ethiopic': (char) => char >= 0x1200 && char <= 0x137F,\r\n    // 'Ethiopic Supplement': (char) => char >= 0x1380 && char <= 0x139F,\r\n    // 'Cherokee': (char) => char >= 0x13A0 && char <= 0x13FF,\r\n    'Unified Canadian Aboriginal Syllabics': (char) => char >= 0x1400 && char <= 0x167F,\r\n    // 'Ogham': (char) => char >= 0x1680 && char <= 0x169F,\r\n    // 'Runic': (char) => char >= 0x16A0 && char <= 0x16FF,\r\n    // 'Tagalog': (char) => char >= 0x1700 && char <= 0x171F,\r\n    // 'Hanunoo': (char) => char >= 0x1720 && char <= 0x173F,\r\n    // 'Buhid': (char) => char >= 0x1740 && char <= 0x175F,\r\n    // 'Tagbanwa': (char) => char >= 0x1760 && char <= 0x177F,\r\n    // 'Khmer': (char) => char >= 0x1780 && char <= 0x17FF,\r\n    // 'Mongolian': (char) => char >= 0x1800 && char <= 0x18AF,\r\n    'Unified Canadian Aboriginal Syllabics Extended': (char) => char >= 0x18B0 && char <= 0x18FF,\r\n    // 'Limbu': (char) => char >= 0x1900 && char <= 0x194F,\r\n    // 'Tai Le': (char) => char >= 0x1950 && char <= 0x197F,\r\n    // 'New Tai Lue': (char) => char >= 0x1980 && char <= 0x19DF,\r\n    // 'Khmer Symbols': (char) => char >= 0x19E0 && char <= 0x19FF,\r\n    // 'Buginese': (char) => char >= 0x1A00 && char <= 0x1A1F,\r\n    // 'Tai Tham': (char) => char >= 0x1A20 && char <= 0x1AAF,\r\n    // 'Combining Diacritical Marks Extended': (char) => char >= 0x1AB0 && char <= 0x1AFF,\r\n    // 'Balinese': (char) => char >= 0x1B00 && char <= 0x1B7F,\r\n    // 'Sundanese': (char) => char >= 0x1B80 && char <= 0x1BBF,\r\n    // 'Batak': (char) => char >= 0x1BC0 && char <= 0x1BFF,\r\n    // 'Lepcha': (char) => char >= 0x1C00 && char <= 0x1C4F,\r\n    // 'Ol Chiki': (char) => char >= 0x1C50 && char <= 0x1C7F,\r\n    // 'Cyrillic Extended-C': (char) => char >= 0x1C80 && char <= 0x1C8F,\r\n    // 'Sundanese Supplement': (char) => char >= 0x1CC0 && char <= 0x1CCF,\r\n    // 'Vedic Extensions': (char) => char >= 0x1CD0 && char <= 0x1CFF,\r\n    // 'Phonetic Extensions': (char) => char >= 0x1D00 && char <= 0x1D7F,\r\n    // 'Phonetic Extensions Supplement': (char) => char >= 0x1D80 && char <= 0x1DBF,\r\n    // 'Combining Diacritical Marks Supplement': (char) => char >= 0x1DC0 && char <= 0x1DFF,\r\n    // 'Latin Extended Additional': (char) => char >= 0x1E00 && char <= 0x1EFF,\r\n    // 'Greek Extended': (char) => char >= 0x1F00 && char <= 0x1FFF,\r\n    'General Punctuation': (char) => char >= 0x2000 && char <= 0x206F,\r\n    // 'Superscripts and Subscripts': (char) => char >= 0x2070 && char <= 0x209F,\r\n    // 'Currency Symbols': (char) => char >= 0x20A0 && char <= 0x20CF,\r\n    // 'Combining Diacritical Marks for Symbols': (char) => char >= 0x20D0 && char <= 0x20FF,\r\n    'Letterlike Symbols': (char) => char >= 0x2100 && char <= 0x214F,\r\n    'Number Forms': (char) => char >= 0x2150 && char <= 0x218F,\r\n    // 'Arrows': (char) => char >= 0x2190 && char <= 0x21FF,\r\n    // 'Mathematical Operators': (char) => char >= 0x2200 && char <= 0x22FF,\r\n    'Miscellaneous Technical': (char) => char >= 0x2300 && char <= 0x23FF,\r\n    'Control Pictures': (char) => char >= 0x2400 && char <= 0x243F,\r\n    'Optical Character Recognition': (char) => char >= 0x2440 && char <= 0x245F,\r\n    'Enclosed Alphanumerics': (char) => char >= 0x2460 && char <= 0x24FF,\r\n    // 'Box Drawing': (char) => char >= 0x2500 && char <= 0x257F,\r\n    // 'Block Elements': (char) => char >= 0x2580 && char <= 0x259F,\r\n    'Geometric Shapes': (char) => char >= 0x25A0 && char <= 0x25FF,\r\n    'Miscellaneous Symbols': (char) => char >= 0x2600 && char <= 0x26FF,\r\n    // 'Dingbats': (char) => char >= 0x2700 && char <= 0x27BF,\r\n    // 'Miscellaneous Mathematical Symbols-A': (char) => char >= 0x27C0 && char <= 0x27EF,\r\n    // 'Supplemental Arrows-A': (char) => char >= 0x27F0 && char <= 0x27FF,\r\n    // 'Braille Patterns': (char) => char >= 0x2800 && char <= 0x28FF,\r\n    // 'Supplemental Arrows-B': (char) => char >= 0x2900 && char <= 0x297F,\r\n    // 'Miscellaneous Mathematical Symbols-B': (char) => char >= 0x2980 && char <= 0x29FF,\r\n    // 'Supplemental Mathematical Operators': (char) => char >= 0x2A00 && char <= 0x2AFF,\r\n    'Miscellaneous Symbols and Arrows': (char) => char >= 0x2B00 && char <= 0x2BFF,\r\n    // 'Glagolitic': (char) => char >= 0x2C00 && char <= 0x2C5F,\r\n    // 'Latin Extended-C': (char) => char >= 0x2C60 && char <= 0x2C7F,\r\n    // 'Coptic': (char) => char >= 0x2C80 && char <= 0x2CFF,\r\n    // 'Georgian Supplement': (char) => char >= 0x2D00 && char <= 0x2D2F,\r\n    // 'Tifinagh': (char) => char >= 0x2D30 && char <= 0x2D7F,\r\n    // 'Ethiopic Extended': (char) => char >= 0x2D80 && char <= 0x2DDF,\r\n    // 'Cyrillic Extended-A': (char) => char >= 0x2DE0 && char <= 0x2DFF,\r\n    // 'Supplemental Punctuation': (char) => char >= 0x2E00 && char <= 0x2E7F,\r\n    'CJK Radicals Supplement': (char) => char >= 0x2E80 && char <= 0x2EFF,\r\n    'Kangxi Radicals': (char) => char >= 0x2F00 && char <= 0x2FDF,\r\n    'Ideographic Description Characters': (char) => char >= 0x2FF0 && char <= 0x2FFF,\r\n    'CJK Symbols and Punctuation': (char) => char >= 0x3000 && char <= 0x303F,\r\n    'Hiragana': (char) => char >= 0x3040 && char <= 0x309F,\r\n    'Katakana': (char) => char >= 0x30A0 && char <= 0x30FF,\r\n    'Bopomofo': (char) => char >= 0x3100 && char <= 0x312F,\r\n    'Hangul Compatibility Jamo': (char) => char >= 0x3130 && char <= 0x318F,\r\n    'Kanbun': (char) => char >= 0x3190 && char <= 0x319F,\r\n    'Bopomofo Extended': (char) => char >= 0x31A0 && char <= 0x31BF,\r\n    'CJK Strokes': (char) => char >= 0x31C0 && char <= 0x31EF,\r\n    'Katakana Phonetic Extensions': (char) => char >= 0x31F0 && char <= 0x31FF,\r\n    'Enclosed CJK Letters and Months': (char) => char >= 0x3200 && char <= 0x32FF,\r\n    'CJK Compatibility': (char) => char >= 0x3300 && char <= 0x33FF,\r\n    'CJK Unified Ideographs Extension A': (char) => char >= 0x3400 && char <= 0x4DBF,\r\n    'Yijing Hexagram Symbols': (char) => char >= 0x4DC0 && char <= 0x4DFF,\r\n    'CJK Unified Ideographs': (char) => char >= 0x4E00 && char <= 0x9FFF,\r\n    'Yi Syllables': (char) => char >= 0xA000 && char <= 0xA48F,\r\n    'Yi Radicals': (char) => char >= 0xA490 && char <= 0xA4CF,\r\n    // 'Lisu': (char) => char >= 0xA4D0 && char <= 0xA4FF,\r\n    // 'Vai': (char) => char >= 0xA500 && char <= 0xA63F,\r\n    // 'Cyrillic Extended-B': (char) => char >= 0xA640 && char <= 0xA69F,\r\n    // 'Bamum': (char) => char >= 0xA6A0 && char <= 0xA6FF,\r\n    // 'Modifier Tone Letters': (char) => char >= 0xA700 && char <= 0xA71F,\r\n    // 'Latin Extended-D': (char) => char >= 0xA720 && char <= 0xA7FF,\r\n    // 'Syloti Nagri': (char) => char >= 0xA800 && char <= 0xA82F,\r\n    // 'Common Indic Number Forms': (char) => char >= 0xA830 && char <= 0xA83F,\r\n    // 'Phags-pa': (char) => char >= 0xA840 && char <= 0xA87F,\r\n    // 'Saurashtra': (char) => char >= 0xA880 && char <= 0xA8DF,\r\n    // 'Devanagari Extended': (char) => char >= 0xA8E0 && char <= 0xA8FF,\r\n    // 'Kayah Li': (char) => char >= 0xA900 && char <= 0xA92F,\r\n    // 'Rejang': (char) => char >= 0xA930 && char <= 0xA95F,\r\n    'Hangul Jamo Extended-A': (char) => char >= 0xA960 && char <= 0xA97F,\r\n    // 'Javanese': (char) => char >= 0xA980 && char <= 0xA9DF,\r\n    // 'Myanmar Extended-B': (char) => char >= 0xA9E0 && char <= 0xA9FF,\r\n    // 'Cham': (char) => char >= 0xAA00 && char <= 0xAA5F,\r\n    // 'Myanmar Extended-A': (char) => char >= 0xAA60 && char <= 0xAA7F,\r\n    // 'Tai Viet': (char) => char >= 0xAA80 && char <= 0xAADF,\r\n    // 'Meetei Mayek Extensions': (char) => char >= 0xAAE0 && char <= 0xAAFF,\r\n    // 'Ethiopic Extended-A': (char) => char >= 0xAB00 && char <= 0xAB2F,\r\n    // 'Latin Extended-E': (char) => char >= 0xAB30 && char <= 0xAB6F,\r\n    // 'Cherokee Supplement': (char) => char >= 0xAB70 && char <= 0xABBF,\r\n    // 'Meetei Mayek': (char) => char >= 0xABC0 && char <= 0xABFF,\r\n    'Hangul Syllables': (char) => char >= 0xAC00 && char <= 0xD7AF,\r\n    'Hangul Jamo Extended-B': (char) => char >= 0xD7B0 && char <= 0xD7FF,\r\n    // 'High Surrogates': (char) => char >= 0xD800 && char <= 0xDB7F,\r\n    // 'High Private Use Surrogates': (char) => char >= 0xDB80 && char <= 0xDBFF,\r\n    // 'Low Surrogates': (char) => char >= 0xDC00 && char <= 0xDFFF,\r\n    'Private Use Area': (char) => char >= 0xE000 && char <= 0xF8FF,\r\n    'CJK Compatibility Ideographs': (char) => char >= 0xF900 && char <= 0xFAFF,\r\n    // 'Alphabetic Presentation Forms': (char) => char >= 0xFB00 && char <= 0xFB4F,\r\n    'Arabic Presentation Forms-A': (char) => char >= 0xFB50 && char <= 0xFDFF,\r\n    // 'Variation Selectors': (char) => char >= 0xFE00 && char <= 0xFE0F,\r\n    'Vertical Forms': (char) => char >= 0xFE10 && char <= 0xFE1F,\r\n    // 'Combining Half Marks': (char) => char >= 0xFE20 && char <= 0xFE2F,\r\n    'CJK Compatibility Forms': (char) => char >= 0xFE30 && char <= 0xFE4F,\r\n    'Small Form Variants': (char) => char >= 0xFE50 && char <= 0xFE6F,\r\n    'Arabic Presentation Forms-B': (char) => char >= 0xFE70 && char <= 0xFEFF,\r\n    'Halfwidth and Fullwidth Forms': (char) => char >= 0xFF00 && char <= 0xFFEF\r\n    // 'Specials': (char) => char >= 0xFFF0 && char <= 0xFFFF,\r\n    // 'Linear B Syllabary': (char) => char >= 0x10000 && char <= 0x1007F,\r\n    // 'Linear B Ideograms': (char) => char >= 0x10080 && char <= 0x100FF,\r\n    // 'Aegean Numbers': (char) => char >= 0x10100 && char <= 0x1013F,\r\n    // 'Ancient Greek Numbers': (char) => char >= 0x10140 && char <= 0x1018F,\r\n    // 'Ancient Symbols': (char) => char >= 0x10190 && char <= 0x101CF,\r\n    // 'Phaistos Disc': (char) => char >= 0x101D0 && char <= 0x101FF,\r\n    // 'Lycian': (char) => char >= 0x10280 && char <= 0x1029F,\r\n    // 'Carian': (char) => char >= 0x102A0 && char <= 0x102DF,\r\n    // 'Coptic Epact Numbers': (char) => char >= 0x102E0 && char <= 0x102FF,\r\n    // 'Old Italic': (char) => char >= 0x10300 && char <= 0x1032F,\r\n    // 'Gothic': (char) => char >= 0x10330 && char <= 0x1034F,\r\n    // 'Old Permic': (char) => char >= 0x10350 && char <= 0x1037F,\r\n    // 'Ugaritic': (char) => char >= 0x10380 && char <= 0x1039F,\r\n    // 'Old Persian': (char) => char >= 0x103A0 && char <= 0x103DF,\r\n    // 'Deseret': (char) => char >= 0x10400 && char <= 0x1044F,\r\n    // 'Shavian': (char) => char >= 0x10450 && char <= 0x1047F,\r\n    // 'Osmanya': (char) => char >= 0x10480 && char <= 0x104AF,\r\n    // 'Osage': (char) => char >= 0x104B0 && char <= 0x104FF,\r\n    // 'Elbasan': (char) => char >= 0x10500 && char <= 0x1052F,\r\n    // 'Caucasian Albanian': (char) => char >= 0x10530 && char <= 0x1056F,\r\n    // 'Linear A': (char) => char >= 0x10600 && char <= 0x1077F,\r\n    // 'Cypriot Syllabary': (char) => char >= 0x10800 && char <= 0x1083F,\r\n    // 'Imperial Aramaic': (char) => char >= 0x10840 && char <= 0x1085F,\r\n    // 'Palmyrene': (char) => char >= 0x10860 && char <= 0x1087F,\r\n    // 'Nabataean': (char) => char >= 0x10880 && char <= 0x108AF,\r\n    // 'Hatran': (char) => char >= 0x108E0 && char <= 0x108FF,\r\n    // 'Phoenician': (char) => char >= 0x10900 && char <= 0x1091F,\r\n    // 'Lydian': (char) => char >= 0x10920 && char <= 0x1093F,\r\n    // 'Meroitic Hieroglyphs': (char) => char >= 0x10980 && char <= 0x1099F,\r\n    // 'Meroitic Cursive': (char) => char >= 0x109A0 && char <= 0x109FF,\r\n    // 'Kharoshthi': (char) => char >= 0x10A00 && char <= 0x10A5F,\r\n    // 'Old South Arabian': (char) => char >= 0x10A60 && char <= 0x10A7F,\r\n    // 'Old North Arabian': (char) => char >= 0x10A80 && char <= 0x10A9F,\r\n    // 'Manichaean': (char) => char >= 0x10AC0 && char <= 0x10AFF,\r\n    // 'Avestan': (char) => char >= 0x10B00 && char <= 0x10B3F,\r\n    // 'Inscriptional Parthian': (char) => char >= 0x10B40 && char <= 0x10B5F,\r\n    // 'Inscriptional Pahlavi': (char) => char >= 0x10B60 && char <= 0x10B7F,\r\n    // 'Psalter Pahlavi': (char) => char >= 0x10B80 && char <= 0x10BAF,\r\n    // 'Old Turkic': (char) => char >= 0x10C00 && char <= 0x10C4F,\r\n    // 'Old Hungarian': (char) => char >= 0x10C80 && char <= 0x10CFF,\r\n    // 'Rumi Numeral Symbols': (char) => char >= 0x10E60 && char <= 0x10E7F,\r\n    // 'Brahmi': (char) => char >= 0x11000 && char <= 0x1107F,\r\n    // 'Kaithi': (char) => char >= 0x11080 && char <= 0x110CF,\r\n    // 'Sora Sompeng': (char) => char >= 0x110D0 && char <= 0x110FF,\r\n    // 'Chakma': (char) => char >= 0x11100 && char <= 0x1114F,\r\n    // 'Mahajani': (char) => char >= 0x11150 && char <= 0x1117F,\r\n    // 'Sharada': (char) => char >= 0x11180 && char <= 0x111DF,\r\n    // 'Sinhala Archaic Numbers': (char) => char >= 0x111E0 && char <= 0x111FF,\r\n    // 'Khojki': (char) => char >= 0x11200 && char <= 0x1124F,\r\n    // 'Multani': (char) => char >= 0x11280 && char <= 0x112AF,\r\n    // 'Khudawadi': (char) => char >= 0x112B0 && char <= 0x112FF,\r\n    // 'Grantha': (char) => char >= 0x11300 && char <= 0x1137F,\r\n    // 'Newa': (char) => char >= 0x11400 && char <= 0x1147F,\r\n    // 'Tirhuta': (char) => char >= 0x11480 && char <= 0x114DF,\r\n    // 'Siddham': (char) => char >= 0x11580 && char <= 0x115FF,\r\n    // 'Modi': (char) => char >= 0x11600 && char <= 0x1165F,\r\n    // 'Mongolian Supplement': (char) => char >= 0x11660 && char <= 0x1167F,\r\n    // 'Takri': (char) => char >= 0x11680 && char <= 0x116CF,\r\n    // 'Ahom': (char) => char >= 0x11700 && char <= 0x1173F,\r\n    // 'Warang Citi': (char) => char >= 0x118A0 && char <= 0x118FF,\r\n    // 'Zanabazar Square': (char) => char >= 0x11A00 && char <= 0x11A4F,\r\n    // 'Soyombo': (char) => char >= 0x11A50 && char <= 0x11AAF,\r\n    // 'Pau Cin Hau': (char) => char >= 0x11AC0 && char <= 0x11AFF,\r\n    // 'Bhaiksuki': (char) => char >= 0x11C00 && char <= 0x11C6F,\r\n    // 'Marchen': (char) => char >= 0x11C70 && char <= 0x11CBF,\r\n    // 'Masaram Gondi': (char) => char >= 0x11D00 && char <= 0x11D5F,\r\n    // 'Cuneiform': (char) => char >= 0x12000 && char <= 0x123FF,\r\n    // 'Cuneiform Numbers and Punctuation': (char) => char >= 0x12400 && char <= 0x1247F,\r\n    // 'Early Dynastic Cuneiform': (char) => char >= 0x12480 && char <= 0x1254F,\r\n    // 'Egyptian Hieroglyphs': (char) => char >= 0x13000 && char <= 0x1342F,\r\n    // 'Anatolian Hieroglyphs': (char) => char >= 0x14400 && char <= 0x1467F,\r\n    // 'Bamum Supplement': (char) => char >= 0x16800 && char <= 0x16A3F,\r\n    // 'Mro': (char) => char >= 0x16A40 && char <= 0x16A6F,\r\n    // 'Bassa Vah': (char) => char >= 0x16AD0 && char <= 0x16AFF,\r\n    // 'Pahawh Hmong': (char) => char >= 0x16B00 && char <= 0x16B8F,\r\n    // 'Miao': (char) => char >= 0x16F00 && char <= 0x16F9F,\r\n    // 'Ideographic Symbols and Punctuation': (char) => char >= 0x16FE0 && char <= 0x16FFF,\r\n    // 'Tangut': (char) => char >= 0x17000 && char <= 0x187FF,\r\n    // 'Tangut Components': (char) => char >= 0x18800 && char <= 0x18AFF,\r\n    // 'Kana Supplement': (char) => char >= 0x1B000 && char <= 0x1B0FF,\r\n    // 'Kana Extended-A': (char) => char >= 0x1B100 && char <= 0x1B12F,\r\n    // 'Nushu': (char) => char >= 0x1B170 && char <= 0x1B2FF,\r\n    // 'Duployan': (char) => char >= 0x1BC00 && char <= 0x1BC9F,\r\n    // 'Shorthand Format Controls': (char) => char >= 0x1BCA0 && char <= 0x1BCAF,\r\n    // 'Byzantine Musical Symbols': (char) => char >= 0x1D000 && char <= 0x1D0FF,\r\n    // 'Musical Symbols': (char) => char >= 0x1D100 && char <= 0x1D1FF,\r\n    // 'Ancient Greek Musical Notation': (char) => char >= 0x1D200 && char <= 0x1D24F,\r\n    // 'Tai Xuan Jing Symbols': (char) => char >= 0x1D300 && char <= 0x1D35F,\r\n    // 'Counting Rod Numerals': (char) => char >= 0x1D360 && char <= 0x1D37F,\r\n    // 'Mathematical Alphanumeric Symbols': (char) => char >= 0x1D400 && char <= 0x1D7FF,\r\n    // 'Sutton SignWriting': (char) => char >= 0x1D800 && char <= 0x1DAAF,\r\n    // 'Glagolitic Supplement': (char) => char >= 0x1E000 && char <= 0x1E02F,\r\n    // 'Mende Kikakui': (char) => char >= 0x1E800 && char <= 0x1E8DF,\r\n    // 'Adlam': (char) => char >= 0x1E900 && char <= 0x1E95F,\r\n    // 'Arabic Mathematical Alphabetic Symbols': (char) => char >= 0x1EE00 && char <= 0x1EEFF,\r\n    // 'Mahjong Tiles': (char) => char >= 0x1F000 && char <= 0x1F02F,\r\n    // 'Domino Tiles': (char) => char >= 0x1F030 && char <= 0x1F09F,\r\n    // 'Playing Cards': (char) => char >= 0x1F0A0 && char <= 0x1F0FF,\r\n    // 'Enclosed Alphanumeric Supplement': (char) => char >= 0x1F100 && char <= 0x1F1FF,\r\n    // 'Enclosed Ideographic Supplement': (char) => char >= 0x1F200 && char <= 0x1F2FF,\r\n    // 'Miscellaneous Symbols and Pictographs': (char) => char >= 0x1F300 && char <= 0x1F5FF,\r\n    // 'Emoticons': (char) => char >= 0x1F600 && char <= 0x1F64F,\r\n    // 'Ornamental Dingbats': (char) => char >= 0x1F650 && char <= 0x1F67F,\r\n    // 'Transport and Map Symbols': (char) => char >= 0x1F680 && char <= 0x1F6FF,\r\n    // 'Alchemical Symbols': (char) => char >= 0x1F700 && char <= 0x1F77F,\r\n    // 'Geometric Shapes Extended': (char) => char >= 0x1F780 && char <= 0x1F7FF,\r\n    // 'Supplemental Arrows-C': (char) => char >= 0x1F800 && char <= 0x1F8FF,\r\n    // 'Supplemental Symbols and Pictographs': (char) => char >= 0x1F900 && char <= 0x1F9FF,\r\n    // 'CJK Unified Ideographs Extension B': (char) => char >= 0x20000 && char <= 0x2A6DF,\r\n    // 'CJK Unified Ideographs Extension C': (char) => char >= 0x2A700 && char <= 0x2B73F,\r\n    // 'CJK Unified Ideographs Extension D': (char) => char >= 0x2B740 && char <= 0x2B81F,\r\n    // 'CJK Unified Ideographs Extension E': (char) => char >= 0x2B820 && char <= 0x2CEAF,\r\n    // 'CJK Unified Ideographs Extension F': (char) => char >= 0x2CEB0 && char <= 0x2EBEF,\r\n    // 'CJK Compatibility Ideographs Supplement': (char) => char >= 0x2F800 && char <= 0x2FA1F,\r\n    // 'Tags': (char) => char >= 0xE0000 && char <= 0xE007F,\r\n    // 'Variation Selectors Supplement': (char) => char >= 0xE0100 && char <= 0xE01EF,\r\n    // 'Supplementary Private Use Area-A': (char) => char >= 0xF0000 && char <= 0xFFFFF,\r\n    // 'Supplementary Private Use Area-B': (char) => char >= 0x100000 && char <= 0x10FFFF,\r\n};\r\n\r\nmodule.exports = unicodeBlockLookup;\r\n","// @flow\r\n\r\n/* eslint-disable new-cap */\r\n\r\nconst isChar = require('./is_char_in_unicode_block');\r\n\r\nmodule.exports.allowsIdeographicBreaking = function(chars: string) {\r\n    for (const char of chars) {\r\n        if (!exports.charAllowsIdeographicBreaking(char.charCodeAt(0))) return false;\r\n    }\r\n    return true;\r\n};\r\n\r\nmodule.exports.allowsVerticalWritingMode = function(chars: string) {\r\n    for (const char of chars) {\r\n        if (exports.charHasUprightVerticalOrientation(char.charCodeAt(0))) return true;\r\n    }\r\n    return false;\r\n};\r\n\r\nmodule.exports.allowsLetterSpacing = function(chars: string) {\r\n    for (const char of chars) {\r\n        if (!exports.charAllowsLetterSpacing(char.charCodeAt(0))) return false;\r\n    }\r\n    return true;\r\n};\r\n\r\nmodule.exports.charAllowsLetterSpacing = function(char: number) {\r\n    if (isChar['Arabic'](char)) return false;\r\n    if (isChar['Arabic Supplement'](char)) return false;\r\n    if (isChar['Arabic Extended-A'](char)) return false;\r\n    if (isChar['Arabic Presentation Forms-A'](char)) return false;\r\n    if (isChar['Arabic Presentation Forms-B'](char)) return false;\r\n\r\n    return true;\r\n};\r\n\r\nmodule.exports.charAllowsIdeographicBreaking = function(char: number) {\r\n    // Return early for characters outside all ideographic ranges.\r\n    if (char < 0x2E80) return false;\r\n\r\n    if (isChar['Bopomofo Extended'](char)) return true;\r\n    if (isChar['Bopomofo'](char)) return true;\r\n    if (isChar['CJK Compatibility Forms'](char)) return true;\r\n    if (isChar['CJK Compatibility Ideographs'](char)) return true;\r\n    if (isChar['CJK Compatibility'](char)) return true;\r\n    if (isChar['CJK Radicals Supplement'](char)) return true;\r\n    if (isChar['CJK Strokes'](char)) return true;\r\n    if (isChar['CJK Symbols and Punctuation'](char)) return true;\r\n    if (isChar['CJK Unified Ideographs Extension A'](char)) return true;\r\n    if (isChar['CJK Unified Ideographs'](char)) return true;\r\n    if (isChar['Enclosed CJK Letters and Months'](char)) return true;\r\n    if (isChar['Halfwidth and Fullwidth Forms'](char)) return true;\r\n    if (isChar['Hiragana'](char)) return true;\r\n    if (isChar['Ideographic Description Characters'](char)) return true;\r\n    if (isChar['Kangxi Radicals'](char)) return true;\r\n    if (isChar['Katakana Phonetic Extensions'](char)) return true;\r\n    if (isChar['Katakana'](char)) return true;\r\n    if (isChar['Vertical Forms'](char)) return true;\r\n    if (isChar['Yi Radicals'](char)) return true;\r\n    if (isChar['Yi Syllables'](char)) return true;\r\n\r\n    return false;\r\n};\r\n\r\n// The following logic comes from\r\n// <http://www.unicode.org/Public/vertical/revision-17/VerticalOrientation-17.txt>.\r\n// The data file denotes with “U” or “Tu” any codepoint that may be drawn\r\n// upright in vertical text but does not distinguish between upright and\r\n// “neutral” characters.\r\n\r\n// Blocks in the Unicode supplementary planes are excluded from this module due\r\n// to <https://github.com/mapbox/mapbox-gl/issues/29>.\r\n\r\n/**\r\n * Returns true if the given Unicode codepoint identifies a character with\r\n * upright orientation.\r\n *\r\n * A character has upright orientation if it is drawn upright (unrotated)\r\n * whether the line is oriented horizontally or vertically, even if both\r\n * adjacent characters can be rotated. For example, a Chinese character is\r\n * always drawn upright. An uprightly oriented character causes an adjacent\r\n * “neutral” character to be drawn upright as well.\r\n */\r\nexports.charHasUprightVerticalOrientation = function(char: number) {\r\n    if (char === 0x02EA /* modifier letter yin departing tone mark */ ||\r\n        char === 0x02EB /* modifier letter yang departing tone mark */) {\r\n        return true;\r\n    }\r\n\r\n    // Return early for characters outside all ranges whose characters remain\r\n    // upright in vertical writing mode.\r\n    if (char < 0x1100) return false;\r\n\r\n    if (isChar['Bopomofo Extended'](char)) return true;\r\n    if (isChar['Bopomofo'](char)) return true;\r\n    if (isChar['CJK Compatibility Forms'](char)) {\r\n        if (!(char >= 0xFE49 /* dashed overline */ && char <= 0xFE4F /* wavy low line */)) {\r\n            return true;\r\n        }\r\n    }\r\n    if (isChar['CJK Compatibility Ideographs'](char)) return true;\r\n    if (isChar['CJK Compatibility'](char)) return true;\r\n    if (isChar['CJK Radicals Supplement'](char)) return true;\r\n    if (isChar['CJK Strokes'](char)) return true;\r\n    if (isChar['CJK Symbols and Punctuation'](char)) {\r\n        if (!(char >= 0x3008 /* left angle bracket */ && char <= 0x3011 /* right black lenticular bracket */) &&\r\n            !(char >= 0x3014 /* left tortoise shell bracket */ && char <= 0x301F /* low double prime quotation mark */) &&\r\n            char !== 0x3030 /* wavy dash */) {\r\n            return true;\r\n        }\r\n    }\r\n    if (isChar['CJK Unified Ideographs Extension A'](char)) return true;\r\n    if (isChar['CJK Unified Ideographs'](char)) return true;\r\n    if (isChar['Enclosed CJK Letters and Months'](char)) return true;\r\n    if (isChar['Hangul Compatibility Jamo'](char)) return true;\r\n    if (isChar['Hangul Jamo Extended-A'](char)) return true;\r\n    if (isChar['Hangul Jamo Extended-B'](char)) return true;\r\n    if (isChar['Hangul Jamo'](char)) return true;\r\n    if (isChar['Hangul Syllables'](char)) return true;\r\n    if (isChar['Hiragana'](char)) return true;\r\n    if (isChar['Ideographic Description Characters'](char)) return true;\r\n    if (isChar['Kanbun'](char)) return true;\r\n    if (isChar['Kangxi Radicals'](char)) return true;\r\n    if (isChar['Katakana Phonetic Extensions'](char)) return true;\r\n    if (isChar['Katakana'](char)) {\r\n        if (char !== 0x30FC /* katakana-hiragana prolonged sound mark */) {\r\n            return true;\r\n        }\r\n    }\r\n    if (isChar['Halfwidth and Fullwidth Forms'](char)) {\r\n        if (char !== 0xFF08 /* fullwidth left parenthesis */ &&\r\n            char !== 0xFF09 /* fullwidth right parenthesis */ &&\r\n            char !== 0xFF0D /* fullwidth hyphen-minus */ &&\r\n            !(char >= 0xFF1A /* fullwidth colon */ && char <= 0xFF1E /* fullwidth greater-than sign */) &&\r\n            char !== 0xFF3B /* fullwidth left square bracket */ &&\r\n            char !== 0xFF3D /* fullwidth right square bracket */ &&\r\n            char !== 0xFF3F /* fullwidth low line */ &&\r\n            !(char >= 0xFF5B /* fullwidth left curly bracket */ && char <= 0xFFDF) &&\r\n            char !== 0xFFE3 /* fullwidth macron */ &&\r\n            !(char >= 0xFFE8 /* halfwidth forms light vertical */ && char <= 0xFFEF)) {\r\n            return true;\r\n        }\r\n    }\r\n    if (isChar['Small Form Variants'](char)) {\r\n        if (!(char >= 0xFE58 /* small em dash */ && char <= 0xFE5E /* small right tortoise shell bracket */) &&\r\n            !(char >= 0xFE63 /* small hyphen-minus */ && char <= 0xFE66 /* small equals sign */)) {\r\n            return true;\r\n        }\r\n    }\r\n    if (isChar['Unified Canadian Aboriginal Syllabics'](char)) return true;\r\n    if (isChar['Unified Canadian Aboriginal Syllabics Extended'](char)) return true;\r\n    if (isChar['Vertical Forms'](char)) return true;\r\n    if (isChar['Yijing Hexagram Symbols'](char)) return true;\r\n    if (isChar['Yi Syllables'](char)) return true;\r\n    if (isChar['Yi Radicals'](char)) return true;\r\n\r\n    return false;\r\n};\r\n\r\n/**\r\n * Returns true if the given Unicode codepoint identifies a character with\r\n * neutral orientation.\r\n *\r\n * A character has neutral orientation if it may be drawn rotated or unrotated\r\n * when the line is oriented vertically, depending on the orientation of the\r\n * adjacent characters. For example, along a verticlly oriented line, the vulgar\r\n * fraction ½ is drawn upright among Chinese characters but rotated among Latin\r\n * letters. A neutrally oriented character does not influence whether an\r\n * adjacent character is drawn upright or rotated.\r\n */\r\nexports.charHasNeutralVerticalOrientation = function(char: number) {\r\n    if (isChar['Latin-1 Supplement'](char)) {\r\n        if (char === 0x00A7 /* section sign */ ||\r\n            char === 0x00A9 /* copyright sign */ ||\r\n            char === 0x00AE /* registered sign */ ||\r\n            char === 0x00B1 /* plus-minus sign */ ||\r\n            char === 0x00BC /* vulgar fraction one quarter */ ||\r\n            char === 0x00BD /* vulgar fraction one half */ ||\r\n            char === 0x00BE /* vulgar fraction three quarters */ ||\r\n            char === 0x00D7 /* multiplication sign */ ||\r\n            char === 0x00F7 /* division sign */) {\r\n            return true;\r\n        }\r\n    }\r\n    if (isChar['General Punctuation'](char)) {\r\n        if (char === 0x2016 /* double vertical line */ ||\r\n            char === 0x2020 /* dagger */ ||\r\n            char === 0x2021 /* double dagger */ ||\r\n            char === 0x2030 /* per mille sign */ ||\r\n            char === 0x2031 /* per ten thousand sign */ ||\r\n            char === 0x203B /* reference mark */ ||\r\n            char === 0x203C /* double exclamation mark */ ||\r\n            char === 0x2042 /* asterism */ ||\r\n            char === 0x2047 /* double question mark */ ||\r\n            char === 0x2048 /* question exclamation mark */ ||\r\n            char === 0x2049 /* exclamation question mark */ ||\r\n            char === 0x2051 /* two asterisks aligned vertically */) {\r\n            return true;\r\n        }\r\n    }\r\n    if (isChar['Letterlike Symbols'](char)) return true;\r\n    if (isChar['Number Forms'](char)) return true;\r\n    if (isChar['Miscellaneous Technical'](char)) {\r\n        if ((char >= 0x2300 /* diameter sign */ && char <= 0x2307 /* wavy line */) ||\r\n            (char >= 0x230C /* bottom right crop */ && char <= 0x231F /* bottom right corner */) ||\r\n            (char >= 0x2324 /* up arrowhead between two horizontal bars */ && char <= 0x2328 /* keyboard */) ||\r\n            char === 0x232B /* erase to the left */ ||\r\n            (char >= 0x237D /* shouldered open box */ && char <= 0x239A /* clear screen symbol */) ||\r\n            (char >= 0x23BE /* dentistry symbol light vertical and top right */ && char <= 0x23CD /* square foot */) ||\r\n            char === 0x23CF /* eject symbol */ ||\r\n            (char >= 0x23D1 /* metrical breve */ && char <= 0x23DB /* fuse */) ||\r\n            (char >= 0x23E2 /* white trapezium */ && char <= 0x23FF)) {\r\n            return true;\r\n        }\r\n    }\r\n    if (isChar['Control Pictures'](char) && char !== 0x2423 /* open box */) return true;\r\n    if (isChar['Optical Character Recognition'](char)) return true;\r\n    if (isChar['Enclosed Alphanumerics'](char)) return true;\r\n    if (isChar['Geometric Shapes'](char)) return true;\r\n    if (isChar['Miscellaneous Symbols'](char)) {\r\n        if (!(char >= 0x261A /* black left pointing index */ && char <= 0x261F /* white down pointing index */)) {\r\n            return true;\r\n        }\r\n    }\r\n    if (isChar['Miscellaneous Symbols and Arrows'](char)) {\r\n        if ((char >= 0x2B12 /* square with top half black */ && char <= 0x2B2F /* white vertical ellipse */) ||\r\n            (char >= 0x2B50 /* white medium star */ && char <= 0x2B59 /* heavy circled saltire */) ||\r\n            (char >= 0x2BB8 /* upwards white arrow from bar with horizontal bar */ && char <= 0x2BEB)) {\r\n            return true;\r\n        }\r\n    }\r\n    if (isChar['CJK Symbols and Punctuation'](char)) return true;\r\n    if (isChar['Katakana'](char)) return true;\r\n    if (isChar['Private Use Area'](char)) return true;\r\n    if (isChar['CJK Compatibility Forms'](char)) return true;\r\n    if (isChar['Small Form Variants'](char)) return true;\r\n    if (isChar['Halfwidth and Fullwidth Forms'](char)) return true;\r\n\r\n    if (char === 0x221E /* infinity */ ||\r\n        char === 0x2234 /* therefore */ ||\r\n        char === 0x2235 /* because */ ||\r\n        (char >= 0x2700 /* black safety scissors */ && char <= 0x2767 /* rotated floral heart bullet */) ||\r\n        (char >= 0x2776 /* dingbat negative circled digit one */ && char <= 0x2793 /* dingbat negative circled sans-serif number ten */) ||\r\n        char === 0xFFFC /* object replacement character */ ||\r\n        char === 0xFFFD /* replacement character */) {\r\n        return true;\r\n    }\r\n\r\n    return false;\r\n};\r\n\r\n/**\r\n * Returns true if the given Unicode codepoint identifies a character with\r\n * rotated orientation.\r\n *\r\n * A character has rotated orientation if it is drawn rotated when the line is\r\n * oriented vertically, even if both adjacent characters are upright. For\r\n * example, a Latin letter is drawn rotated along a vertical line. A rotated\r\n * character causes an adjacent “neutral” character to be drawn rotated as well.\r\n */\r\nexports.charHasRotatedVerticalOrientation = function(char: number) {\r\n    return !(exports.charHasUprightVerticalOrientation(char) ||\r\n             exports.charHasNeutralVerticalOrientation(char));\r\n};\r\n","// @flow\r\n\r\n// Note: all \"sizes\" are measured in bytes\r\n\r\nconst assert = require('assert');\r\n\r\nimport type {Transferable} from '../types/transferable';\r\n\r\nconst viewTypes = {\r\n    'Int8': Int8Array,\r\n    'Uint8': Uint8Array,\r\n    'Int16': Int16Array,\r\n    'Uint16': Uint16Array,\r\n    'Int32': Int32Array,\r\n    'Uint32': Uint32Array,\r\n    'Float32': Float32Array\r\n};\r\n\r\nexport type ViewType = $Keys<typeof viewTypes>;\r\n\r\n/**\r\n * @private\r\n */\r\nclass Struct {\r\n    _pos1: number;\r\n    _pos2: number;\r\n    _pos4: number;\r\n    _pos8: number;\r\n    +_structArray: StructArray;\r\n\r\n    // The following properties are defined on the prototype of sub classes.\r\n    size: number;\r\n\r\n    /**\r\n     * @param {StructArray} structArray The StructArray the struct is stored in\r\n     * @param {number} index The index of the struct in the StructArray.\r\n     * @private\r\n     */\r\n    constructor(structArray: StructArray, index: number) {\r\n        (this: any)._structArray = structArray;\r\n        this._pos1 = index * this.size;\r\n        this._pos2 = this._pos1 / 2;\r\n        this._pos4 = this._pos1 / 4;\r\n        this._pos8 = this._pos1 / 8;\r\n    }\r\n}\r\n\r\nconst DEFAULT_CAPACITY = 128;\r\nconst RESIZE_MULTIPLIER = 5;\r\n\r\nexport type StructArrayMember = {\r\n    name: string,\r\n    type: ViewType,\r\n    components: number,\r\n    offset: number\r\n};\r\n\r\nexport type StructArrayLayout = {\r\n    members: Array<StructArrayMember>,\r\n    size: number,\r\n    alignment: ?number\r\n}\r\n\r\nexport type SerializedStructArray = {\r\n    length: number,\r\n    arrayBuffer: ArrayBuffer\r\n};\r\n\r\n/**\r\n * `StructArray` provides an abstraction over `ArrayBuffer` and `TypedArray`\r\n * making it behave like an array of typed structs.\r\n *\r\n * Conceptually, a StructArray is comprised of elements, i.e., instances of its\r\n * associated struct type. Each particular struct type, together with an\r\n * alignment size, determines the memory layout of a StructArray whose elements\r\n * are of that type.  Thus, for each such layout that we need, we have\r\n * a corrseponding StructArrayLayout class, inheriting from StructArray and\r\n * implementing `emplaceBack()` and `_refreshViews()`.\r\n *\r\n * In some cases, where we need to access particular elements of a StructArray,\r\n * we implement a more specific subclass that inherits from one of the\r\n * StructArrayLayouts and adds a `get(i): T` accessor that returns a structured\r\n * object whose properties are proxies into the underlying memory space for the\r\n * i-th element.  This affords the convience of working with (seemingly) plain\r\n * Javascript objects without the overhead of serializing/deserializing them\r\n * into ArrayBuffers for efficient web worker transfer.\r\n *\r\n * @private\r\n */\r\nclass StructArray {\r\n    capacity: number;\r\n    length: number;\r\n    isTransferred: boolean;\r\n    arrayBuffer: ArrayBuffer;\r\n    uint8: Uint8Array;\r\n\r\n    // The following properties are defined on the prototype.\r\n    members: Array<StructArrayMember>;\r\n    bytesPerElement: number;\r\n    +emplaceBack: Function;\r\n\r\n    constructor() {\r\n        this.isTransferred = false;\r\n        this.capacity = -1;\r\n        this.resize(0);\r\n    }\r\n\r\n    /**\r\n     * Serialize a StructArray instance.  Serializes both the raw data and the\r\n     * metadata needed to reconstruct the StructArray base class during\r\n     * deserialization.\r\n     */\r\n    static serialize(array: StructArray, transferables?: Array<Transferable>): SerializedStructArray {\r\n        assert(!array.isTransferred);\r\n\r\n        array._trim();\r\n\r\n        if (transferables) {\r\n            array.isTransferred = true;\r\n            transferables.push(array.arrayBuffer);\r\n        }\r\n\r\n        return {\r\n            length: array.length,\r\n            arrayBuffer: array.arrayBuffer,\r\n        };\r\n    }\r\n\r\n    static deserialize(input: SerializedStructArray) {\r\n        const structArray = Object.create(this.prototype);\r\n        structArray.arrayBuffer = input.arrayBuffer;\r\n        structArray.length = input.length;\r\n        structArray.capacity = input.arrayBuffer.byteLength / structArray.bytesPerElement;\r\n        structArray._refreshViews();\r\n        return structArray;\r\n    }\r\n\r\n    /**\r\n     * Resize the array to discard unused capacity.\r\n     */\r\n    _trim() {\r\n        if (this.length !== this.capacity) {\r\n            this.capacity = this.length;\r\n            this.arrayBuffer = this.arrayBuffer.slice(0, this.length * this.bytesPerElement);\r\n            this._refreshViews();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Resets the the length of the array to 0 without de-allocating capcacity.\r\n     */\r\n    clear() {\r\n        this.length = 0;\r\n    }\r\n\r\n    /**\r\n     * Resize the array.\r\n     * If `n` is greater than the current length then additional elements with undefined values are added.\r\n     * If `n` is less than the current length then the array will be reduced to the first `n` elements.\r\n     * @param {number} n The new size of the array.\r\n     */\r\n    resize(n: number) {\r\n        assert(!this.isTransferred);\r\n        this.reserve(n);\r\n        this.length = n;\r\n    }\r\n\r\n    /**\r\n     * Indicate a planned increase in size, so that any necessary allocation may\r\n     * be done once, ahead of time.\r\n     * @param {number} n The expected size of the array.\r\n     */\r\n    reserve(n: number) {\r\n        if (n > this.capacity) {\r\n            this.capacity = Math.max(n, Math.floor(this.capacity * RESIZE_MULTIPLIER), DEFAULT_CAPACITY);\r\n            this.arrayBuffer = new ArrayBuffer(this.capacity * this.bytesPerElement);\r\n\r\n            const oldUint8Array = this.uint8;\r\n            this._refreshViews();\r\n            if (oldUint8Array) this.uint8.set(oldUint8Array);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Create TypedArray views for the current ArrayBuffer.\r\n     */\r\n    _refreshViews() {\r\n        throw new Error('_refreshViews() must be implemented by each concrete StructArray layout');\r\n    }\r\n}\r\n\r\n/**\r\n * Given a list of member fields, create a full StructArrayLayout, in\r\n * particular calculating the correct byte offset for each field.  This data\r\n * is used at build time to generate StructArrayLayout_*#emplaceBack() and\r\n * other accessors, and at runtime for binding vertex buffer attributes.\r\n *\r\n * @private\r\n */\r\nfunction createLayout(\r\n    members: Array<{ name: string, type: ViewType, +components?: number, }>,\r\n    alignment: number = 1\r\n): StructArrayLayout {\r\n\r\n    let offset = 0;\r\n    let maxSize = 0;\r\n    const layoutMembers = members.map((member) => {\r\n        assert(member.name.length);\r\n        const typeSize = sizeOf(member.type);\r\n        const memberOffset = offset = align(offset, Math.max(alignment, typeSize));\r\n        const components = member.components || 1;\r\n\r\n        maxSize = Math.max(maxSize, typeSize);\r\n        offset += typeSize * components;\r\n\r\n        return {\r\n            name: member.name,\r\n            type: member.type,\r\n            components: components,\r\n            offset: memberOffset,\r\n        };\r\n    });\r\n\r\n    const size = align(offset, Math.max(maxSize, alignment));\r\n\r\n    return {\r\n        members: layoutMembers,\r\n        size,\r\n        alignment\r\n    };\r\n}\r\n\r\nfunction sizeOf(type: ViewType): number {\r\n    return viewTypes[type].BYTES_PER_ELEMENT;\r\n}\r\n\r\nfunction align(offset: number, size: number): number {\r\n    return Math.ceil(offset / size) * size;\r\n}\r\n\r\nmodule.exports.StructArray = StructArray;\r\nmodule.exports.Struct = Struct;\r\nmodule.exports.viewTypes = viewTypes;\r\nmodule.exports.createLayout = createLayout;\r\n","// @flow\r\n\r\nmodule.exports = resolveTokens;\r\n\r\n/**\r\n * Replace tokens in a string template with values in an object\r\n *\r\n * @param properties a key/value relationship between tokens and replacements\r\n * @param text the template string\r\n * @returns the template with tokens replaced\r\n * @private\r\n */\r\nfunction resolveTokens(properties: {+[string]: mixed}, text: string): string {\r\n    return text.replace(/{([^{}]+)}/g, (match, key: string) => {\r\n        return key in properties ? String(properties[key]) : '';\r\n    }).replace(/FORMAT_NUMBER\\(([^\\)]+)\\)/g, (match, key) => formatNumber(key));\r\n}\r\n\r\n/*\r\nAfter tokens have been resolved, anything of the form FORMAT_NUMBER(...) will be passed\r\nthrough this function, which renders numbers in a short form:\r\n   123 => 0K\r\n   123456 => 123K\r\n   123456789 => 123.45M\r\n   1234567890 => 1,234M\r\n   123456789000 => 123,456M\r\n   1234567890000 => HUGE_NUM\r\n\r\n   (12000,null,2.2) => 26K  i.e. the third argument is an optional scaling factor\r\n\r\n   the second argument is currently unused, in future it may allow customizing of\r\n   the formatting in some way. \r\n*/\r\nfunction formatNumber(arg){\r\n\targ = arg.split(\",\"); //arg is a string, which may contain multiple arguments\r\n\tlet value = parseFloat(arg[0]); \r\n\tif(arg[2]){\r\n\t\tvalue = value*parseFloat(arg[2]);\r\n\t}\r\n\tif(value<1e3){\r\n\t\treturn Math.round(value);\r\n\t} else if (value<1e5){\r\n\t\treturn (value/1e3).toFixed(1) + 'K';\r\n\t} else if (value<1e6){\r\n\t\treturn Math.round(value/1e3) + 'K';\r\n\t} else if(value<1e9){\r\n\t\treturn (value/1e6).toFixed(2) + 'M';\r\n\t} else if(value<1e12){\r\n\t\tvalue = Math.round(value/1e6).toFixed(0);\r\n\t\treturn value.slice(0,-3) + ',' + value.slice(-4,-1) + 'M';\r\n\t} else {\r\n\t\treturn 'HUGE_NUM';\r\n\t}\r\n}","// @flow\r\n\r\nconst UnitBezier = require('@mapbox/unitbezier');\r\nconst Coordinate = require('../geo/coordinate');\r\nconst Point = require('@mapbox/point-geometry');\r\n\r\nimport type {Callback} from '../types/callback';\r\n\r\n/**\r\n * @module util\r\n * @private\r\n */\r\n\r\n/**\r\n * Given a value `t` that varies between 0 and 1, return\r\n * an interpolation function that eases between 0 and 1 in a pleasing\r\n * cubic in-out fashion.\r\n *\r\n * @private\r\n */\r\nexports.easeCubicInOut = function(t: number): number {\r\n    if (t <= 0) return 0;\r\n    if (t >= 1) return 1;\r\n    const t2 = t * t,\r\n        t3 = t2 * t;\r\n    return 4 * (t < 0.5 ? t3 : 3 * (t - t2) + t3 - 0.75);\r\n};\r\n\r\n/**\r\n * Given given (x, y), (x1, y1) control points for a bezier curve,\r\n * return a function that interpolates along that curve.\r\n *\r\n * @param p1x control point 1 x coordinate\r\n * @param p1y control point 1 y coordinate\r\n * @param p2x control point 2 x coordinate\r\n * @param p2y control point 2 y coordinate\r\n * @private\r\n */\r\nexports.bezier = function(p1x: number, p1y: number, p2x: number, p2y: number): (t: number) => number {\r\n    const bezier = new UnitBezier(p1x, p1y, p2x, p2y);\r\n    return function(t: number) {\r\n        return bezier.solve(t);\r\n    };\r\n};\r\n\r\n/**\r\n * A default bezier-curve powered easing function with\r\n * control points (0.25, 0.1) and (0.25, 1)\r\n *\r\n * @private\r\n */\r\nexports.ease = exports.bezier(0.25, 0.1, 0.25, 1);\r\n\r\n/**\r\n * constrain n to the given range via min + max\r\n *\r\n * @param n value\r\n * @param min the minimum value to be returned\r\n * @param max the maximum value to be returned\r\n * @returns the clamped value\r\n * @private\r\n */\r\nexports.clamp = function (n: number, min: number, max: number): number {\r\n    return Math.min(max, Math.max(min, n));\r\n};\r\n\r\n/**\r\n * constrain n to the given range, excluding the minimum, via modular arithmetic\r\n *\r\n * @param n value\r\n * @param min the minimum value to be returned, exclusive\r\n * @param max the maximum value to be returned, inclusive\r\n * @returns constrained number\r\n * @private\r\n */\r\nexports.wrap = function (n: number, min: number, max: number): number {\r\n    const d = max - min;\r\n    const w = ((n - min) % d + d) % d + min;\r\n    return (w === min) ? max : w;\r\n};\r\n\r\n/*\r\n * Call an asynchronous function on an array of arguments,\r\n * calling `callback` with the completed results of all calls.\r\n *\r\n * @param array input to each call of the async function.\r\n * @param fn an async function with signature (data, callback)\r\n * @param callback a callback run after all async work is done.\r\n * called with an array, containing the results of each async call.\r\n * @private\r\n */\r\nexports.asyncAll = function<Item, Result> (\r\n    array: Array<Item>,\r\n    fn: (item: Item, fnCallback: Callback<Result>) => void,\r\n    callback: Callback<Array<Result>>\r\n) {\r\n    if (!array.length) { return callback(null, []); }\r\n    let remaining = array.length;\r\n    const results = new Array(array.length);\r\n    let error = null;\r\n    array.forEach((item, i) => {\r\n        fn(item, (err, result) => {\r\n            if (err) error = err;\r\n            results[i] = ((result: any): Result); // https://github.com/facebook/flow/issues/2123\r\n            if (--remaining === 0) callback(error, results);\r\n        });\r\n    });\r\n};\r\n\r\n/*\r\n * Polyfill for Object.values. Not fully spec compliant, but we don't\r\n * need it to be.\r\n *\r\n * @private\r\n */\r\nexports.values = function<T>(obj: {[key: string]: T}): Array<T> {\r\n    const result = [];\r\n    for (const k in obj) {\r\n        result.push(obj[k]);\r\n    }\r\n    return result;\r\n};\r\n\r\n/*\r\n * Compute the difference between the keys in one object and the keys\r\n * in another object.\r\n *\r\n * @returns keys difference\r\n * @private\r\n */\r\nexports.keysDifference = function<S, T>(obj: {[key: string]: S}, other: {[key: string]: T}): Array<string> {\r\n    const difference = [];\r\n    for (const i in obj) {\r\n        if (!(i in other)) {\r\n            difference.push(i);\r\n        }\r\n    }\r\n    return difference;\r\n};\r\n\r\n/**\r\n * Given a destination object and optionally many source objects,\r\n * copy all properties from the source objects into the destination.\r\n * The last source object given overrides properties from previous\r\n * source objects.\r\n *\r\n * @param dest destination object\r\n * @param sources sources from which properties are pulled\r\n * @private\r\n */\r\nexports.extend = function (dest: Object, ...sources: Array<?Object>): Object {\r\n    for (const src of sources) {\r\n        for (const k in src) {\r\n            dest[k] = src[k];\r\n        }\r\n    }\r\n    return dest;\r\n};\r\n\r\n/**\r\n * Given an object and a number of properties as strings, return version\r\n * of that object with only those properties.\r\n *\r\n * @param src the object\r\n * @param properties an array of property names chosen\r\n * to appear on the resulting object.\r\n * @returns object with limited properties.\r\n * @example\r\n * var foo = { name: 'Charlie', age: 10 };\r\n * var justName = pick(foo, ['name']);\r\n * // justName = { name: 'Charlie' }\r\n * @private\r\n */\r\nexports.pick = function (src: Object, properties: Array<string>): Object {\r\n    const result = {};\r\n    for (let i = 0; i < properties.length; i++) {\r\n        const k = properties[i];\r\n        if (k in src) {\r\n            result[k] = src[k];\r\n        }\r\n    }\r\n    return result;\r\n};\r\n\r\nlet id = 1;\r\n\r\n/**\r\n * Return a unique numeric id, starting at 1 and incrementing with\r\n * each call.\r\n *\r\n * @returns unique numeric id.\r\n * @private\r\n */\r\nexports.uniqueId = function (): number {\r\n    return id++;\r\n};\r\n\r\n/**\r\n * Given an array of member function names as strings, replace all of them\r\n * with bound versions that will always refer to `context` as `this`. This\r\n * is useful for classes where otherwise event bindings would reassign\r\n * `this` to the evented object or some other value: this lets you ensure\r\n * the `this` value always.\r\n *\r\n * @param fns list of member function names\r\n * @param context the context value\r\n * @example\r\n * function MyClass() {\r\n *   bindAll(['ontimer'], this);\r\n *   this.name = 'Tom';\r\n * }\r\n * MyClass.prototype.ontimer = function() {\r\n *   alert(this.name);\r\n * };\r\n * var myClass = new MyClass();\r\n * setTimeout(myClass.ontimer, 100);\r\n * @private\r\n */\r\nexports.bindAll = function(fns: Array<string>, context: Object): void {\r\n    fns.forEach((fn) => {\r\n        if (!context[fn]) { return; }\r\n        context[fn] = context[fn].bind(context);\r\n    });\r\n};\r\n\r\n/**\r\n * Given a list of coordinates, get their center as a coordinate.\r\n *\r\n * @returns centerpoint\r\n * @private\r\n */\r\nexports.getCoordinatesCenter = function(coords: Array<Coordinate>): Coordinate {\r\n    let minX = Infinity;\r\n    let minY = Infinity;\r\n    let maxX = -Infinity;\r\n    let maxY = -Infinity;\r\n\r\n    for (let i = 0; i < coords.length; i++) {\r\n        minX = Math.min(minX, coords[i].column);\r\n        minY = Math.min(minY, coords[i].row);\r\n        maxX = Math.max(maxX, coords[i].column);\r\n        maxY = Math.max(maxY, coords[i].row);\r\n    }\r\n\r\n    const dx = maxX - minX;\r\n    const dy = maxY - minY;\r\n    const dMax = Math.max(dx, dy);\r\n    const zoom = Math.max(0, Math.floor(-Math.log(dMax) / Math.LN2));\r\n    return new Coordinate((minX + maxX) / 2, (minY + maxY) / 2, 0)\r\n        .zoomTo(zoom);\r\n};\r\n\r\n/**\r\n * Determine if a string ends with a particular substring\r\n *\r\n * @private\r\n */\r\nexports.endsWith = function(string: string, suffix: string): boolean {\r\n    return string.indexOf(suffix, string.length - suffix.length) !== -1;\r\n};\r\n\r\n/**\r\n * Create an object by mapping all the values of an existing object while\r\n * preserving their keys.\r\n *\r\n * @private\r\n */\r\nexports.mapObject = function(input: Object, iterator: Function, context?: Object): Object {\r\n    const output = {};\r\n    for (const key in input) {\r\n        output[key] = iterator.call(context || this, input[key], key, input);\r\n    }\r\n    return output;\r\n};\r\n\r\n/**\r\n * Create an object by filtering out values of an existing object.\r\n *\r\n * @private\r\n */\r\nexports.filterObject = function(input: Object, iterator: Function, context?: Object): Object {\r\n    const output = {};\r\n    for (const key in input) {\r\n        if (iterator.call(context || this, input[key], key, input)) {\r\n            output[key] = input[key];\r\n        }\r\n    }\r\n    return output;\r\n};\r\n\r\nexports.deepEqual = require('../style-spec/util/deep_equal');\r\n\r\n/**\r\n * Deeply clones two objects.\r\n *\r\n * @private\r\n */\r\nexports.clone = function<T>(input: T): T {\r\n    if (Array.isArray(input)) {\r\n        return input.map(exports.clone);\r\n    } else if (typeof input === 'object' && input) {\r\n        return ((exports.mapObject(input, exports.clone): any): T);\r\n    } else {\r\n        return input;\r\n    }\r\n};\r\n\r\n/**\r\n * Check if two arrays have at least one common element.\r\n *\r\n * @private\r\n */\r\nexports.arraysIntersect = function<T>(a: Array<T>, b: Array<T>): boolean {\r\n    for (let l = 0; l < a.length; l++) {\r\n        if (b.indexOf(a[l]) >= 0) return true;\r\n    }\r\n    return false;\r\n};\r\n\r\n/**\r\n * Print a warning message to the console and ensure duplicate warning messages\r\n * are not printed.\r\n *\r\n * @private\r\n */\r\nconst warnOnceHistory: {[key: string]: boolean} = {};\r\nexports.warnOnce = function(message: string): void {\r\n    if (!warnOnceHistory[message]) {\r\n        // console isn't defined in some WebWorkers, see #2558\r\n        if (typeof console !== \"undefined\") console.warn(message);\r\n        warnOnceHistory[message] = true;\r\n    }\r\n};\r\n\r\n/**\r\n * Indicates if the provided Points are in a counter clockwise (true) or clockwise (false) order\r\n *\r\n * @returns true for a counter clockwise set of points\r\n */\r\n// http://bryceboe.com/2006/10/23/line-segment-intersection-algorithm/\r\nexports.isCounterClockwise = function(a: Point, b: Point, c: Point): boolean {\r\n    return (c.y - a.y) * (b.x - a.x) > (b.y - a.y) * (c.x - a.x);\r\n};\r\n\r\n/**\r\n * Returns the signed area for the polygon ring.  Postive areas are exterior rings and\r\n * have a clockwise winding.  Negative areas are interior rings and have a counter clockwise\r\n * ordering.\r\n *\r\n * @param ring Exterior or interior ring\r\n */\r\nexports.calculateSignedArea = function(ring: Array<Point>): number {\r\n    let sum = 0;\r\n    for (let i = 0, len = ring.length, j = len - 1, p1, p2; i < len; j = i++) {\r\n        p1 = ring[i];\r\n        p2 = ring[j];\r\n        sum += (p2.x - p1.x) * (p1.y + p2.y);\r\n    }\r\n    return sum;\r\n};\r\n\r\n/**\r\n * Detects closed polygons, first + last point are equal\r\n *\r\n * @param points array of points\r\n * @return true if the points are a closed polygon\r\n */\r\nexports.isClosedPolygon = function(points: Array<Point>): boolean {\r\n    // If it is 2 points that are the same then it is a point\r\n    // If it is 3 points with start and end the same then it is a line\r\n    if (points.length < 4)\r\n        return false;\r\n\r\n    const p1 = points[0];\r\n    const p2 = points[points.length - 1];\r\n\r\n    if (Math.abs(p1.x - p2.x) > 0 ||\r\n        Math.abs(p1.y - p2.y) > 0) {\r\n        return false;\r\n    }\r\n\r\n    // polygon simplification can produce polygons with zero area and more than 3 points\r\n    return (Math.abs(exports.calculateSignedArea(points)) > 0.01);\r\n};\r\n\r\n/**\r\n * Converts spherical coordinates to cartesian coordinates.\r\n *\r\n * @param spherical Spherical coordinates, in [radial, azimuthal, polar]\r\n * @return cartesian coordinates in [x, y, z]\r\n */\r\n\r\nexports.sphericalToCartesian = function([r, azimuthal, polar]: [number, number, number]): {x: number, y: number, z: number} {\r\n    // We abstract \"north\"/\"up\" (compass-wise) to be 0° when really this is 90° (π/2):\r\n    // correct for that here\r\n    azimuthal += 90;\r\n\r\n    // Convert azimuthal and polar angles to radians\r\n    azimuthal *= Math.PI / 180;\r\n    polar *= Math.PI / 180;\r\n\r\n    return {\r\n        x: r * Math.cos(azimuthal) * Math.sin(polar),\r\n        y: r * Math.sin(azimuthal) * Math.sin(polar),\r\n        z: r * Math.cos(polar)\r\n    };\r\n};\r\n\r\n/**\r\n * Parses data from 'Cache-Control' headers.\r\n *\r\n * @param cacheControl Value of 'Cache-Control' header\r\n * @return object containing parsed header info.\r\n */\r\n\r\nexports.parseCacheControl = function(cacheControl: string): Object {\r\n    // Taken from [Wreck](https://github.com/hapijs/wreck)\r\n    const re = /(?:^|(?:\\s*\\,\\s*))([^\\x00-\\x20\\(\\)<>@\\,;\\:\\\\\"\\/\\[\\]\\?\\=\\{\\}\\x7F]+)(?:\\=(?:([^\\x00-\\x20\\(\\)<>@\\,;\\:\\\\\"\\/\\[\\]\\?\\=\\{\\}\\x7F]+)|(?:\\\"((?:[^\"\\\\]|\\\\.)*)\\\")))?/g;\r\n\r\n    const header = {};\r\n    cacheControl.replace(re, ($0, $1, $2, $3) => {\r\n        const value = $2 || $3;\r\n        header[$1] = value ? value.toLowerCase() : true;\r\n        return '';\r\n    });\r\n\r\n    if (header['max-age']) {\r\n        const maxAge = parseInt(header['max-age'], 10);\r\n        if (isNaN(maxAge)) delete header['max-age'];\r\n        else header['max-age'] = maxAge;\r\n    }\r\n\r\n    return header;\r\n};\r\n","// @flow\r\n\r\nclass Feature {\r\n    type: 'Feature';\r\n    _geometry: ?GeoJSONGeometry;\r\n    properties: {};\r\n    id: number | string | void;\r\n\r\n    _vectorTileFeature: VectorTileFeature;\r\n\r\n    constructor(vectorTileFeature: VectorTileFeature, z: number, x: number, y: number) {\r\n        this.type = 'Feature';\r\n\r\n        this._vectorTileFeature = vectorTileFeature;\r\n        (vectorTileFeature: any)._z = z;\r\n        (vectorTileFeature: any)._x = x;\r\n        (vectorTileFeature: any)._y = y;\r\n\r\n        this.properties = vectorTileFeature.properties;\r\n\r\n        if (vectorTileFeature.id != null) {\r\n            this.id = vectorTileFeature.id;\r\n        }\r\n    }\r\n\r\n    get geometry(): ?GeoJSONGeometry {\r\n        if (this._geometry === undefined) {\r\n            this._geometry = this._vectorTileFeature.toGeoJSON(\r\n                (this._vectorTileFeature: any)._x,\r\n                (this._vectorTileFeature: any)._y,\r\n                (this._vectorTileFeature: any)._z).geometry;\r\n        }\r\n        return this._geometry;\r\n    }\r\n\r\n    set geometry(g: ?GeoJSONGeometry) {\r\n        this._geometry = g;\r\n    }\r\n\r\n    toJSON() {\r\n        const json = {\r\n            geometry: this.geometry\r\n        };\r\n        for (const i in this) {\r\n            if (i === '_geometry' || i === '_vectorTileFeature') continue;\r\n            json[i] = (this: any)[i];\r\n        }\r\n        return json;\r\n    }\r\n}\r\n\r\nmodule.exports = Feature;\r\n","// @flow\r\n\r\nconst scriptDetection = require('./script_detection');\r\n\r\nmodule.exports = function verticalizePunctuation(input: string) {\r\n    let output = '';\r\n\r\n    for (let i = 0; i < input.length; i++) {\r\n        const nextCharCode = input.charCodeAt(i + 1) || null;\r\n        const prevCharCode = input.charCodeAt(i - 1) || null;\r\n\r\n        const canReplacePunctuation = (\r\n            (!nextCharCode || !scriptDetection.charHasRotatedVerticalOrientation(nextCharCode) || module.exports.lookup[input[i + 1]]) &&\r\n            (!prevCharCode || !scriptDetection.charHasRotatedVerticalOrientation(prevCharCode) || module.exports.lookup[input[i - 1]])\r\n        );\r\n\r\n        if (canReplacePunctuation && module.exports.lookup[input[i]]) {\r\n            output += module.exports.lookup[input[i]];\r\n        } else {\r\n            output += input[i];\r\n        }\r\n    }\r\n\r\n    return output;\r\n};\r\n\r\nmodule.exports.lookup = {\r\n    '!': '︕',\r\n    '#': '＃',\r\n    '$': '＄',\r\n    '%': '％',\r\n    '&': '＆',\r\n    '(': '︵',\r\n    ')': '︶',\r\n    '*': '＊',\r\n    '+': '＋',\r\n    ',': '︐',\r\n    '-': '︲',\r\n    '.': '・',\r\n    '/': '／',\r\n    ':': '︓',\r\n    ';': '︔',\r\n    '<': '︿',\r\n    '=': '＝',\r\n    '>': '﹀',\r\n    '?': '︖',\r\n    '@': '＠',\r\n    '[': '﹇',\r\n    '\\\\': '＼',\r\n    ']': '﹈',\r\n    '^': '＾',\r\n    '_': '︳',\r\n    '`': '｀',\r\n    '{': '︷',\r\n    '|': '―',\r\n    '}': '︸',\r\n    '~': '～',\r\n    '¢': '￠',\r\n    '£': '￡',\r\n    '¥': '￥',\r\n    '¦': '￤',\r\n    '¬': '￢',\r\n    '¯': '￣',\r\n    '–': '︲',\r\n    '—': '︱',\r\n    '‘': '﹃',\r\n    '’': '﹄',\r\n    '“': '﹁',\r\n    '”': '﹂',\r\n    '…': '︙',\r\n    '‧': '・',\r\n    '₩': '￦',\r\n    '、': '︑',\r\n    '。': '︒',\r\n    '〈': '︿',\r\n    '〉': '﹀',\r\n    '《': '︽',\r\n    '》': '︾',\r\n    '「': '﹁',\r\n    '」': '﹂',\r\n    '『': '﹃',\r\n    '』': '﹄',\r\n    '【': '︻',\r\n    '】': '︼',\r\n    '〔': '︹',\r\n    '〕': '︺',\r\n    '〖': '︗',\r\n    '〗': '︘',\r\n    '！': '︕',\r\n    '（': '︵',\r\n    '）': '︶',\r\n    '，': '︐',\r\n    '－': '︲',\r\n    '．': '・',\r\n    '：': '︓',\r\n    '；': '︔',\r\n    '＜': '︿',\r\n    '＞': '﹀',\r\n    '？': '︖',\r\n    '［': '﹇',\r\n    '］': '﹈',\r\n    '＿': '︳',\r\n    '｛': '︷',\r\n    '｜': '―',\r\n    '｝': '︸',\r\n    '｟': '︵',\r\n    '｠': '︶',\r\n    '｡': '︒',\r\n    '｢': '﹁',\r\n    '｣': '﹂'\r\n};\r\n","// @flow\r\n\r\nconst assert = require('assert');\r\n\r\nconst Grid = require('grid-index');\r\nconst Color = require('../style-spec/util/color');\r\nconst {\r\n    StylePropertyFunction,\r\n    StyleExpression,\r\n    StyleExpressionWithErrorHandling,\r\n    ZoomDependentExpression,\r\n    ZoomConstantExpression\r\n} = require('../style-spec/expression');\r\nconst {CompoundExpression} = require('../style-spec/expression/compound_expression');\r\nconst expressions = require('../style-spec/expression/definitions');\r\nconst {ImageData} = require('./window');\r\n\r\nimport type {Transferable} from '../types/transferable';\r\n\r\nexport type Serialized =\r\n    | null\r\n    | void\r\n    | boolean\r\n    | number\r\n    | string\r\n    | Boolean\r\n    | Number\r\n    | String\r\n    | Date\r\n    | RegExp\r\n    | ArrayBuffer\r\n    | $ArrayBufferView\r\n    | ImageData\r\n    | Array<Serialized>\r\n    | {| name: string, properties: {+[string]: Serialized} |};\r\n\r\ntype Registry = {\r\n    [string]: {\r\n        klass: Class<any>,\r\n        omit: $ReadOnlyArray<string>,\r\n        shallow: $ReadOnlyArray<string>\r\n    }\r\n};\r\n\r\ntype RegisterOptions<T> = {\r\n    omit?: $ReadOnlyArray<$Keys<T>>,\r\n    shallow?: $ReadOnlyArray<$Keys<T>>\r\n}\r\n\r\nconst registry: Registry = {};\r\n\r\n/**\r\n * Register the given class as serializable.\r\n *\r\n * @param options\r\n * @param options.omit List of properties to omit from serialization (e.g., cached/computed properties)\r\n * @param options.shallow List of properties that should be serialized by a simple shallow copy, rather than by a recursive call to serialize().\r\n *\r\n * @private\r\n */\r\nfunction register<T: any>(name: string, klass: Class<T>, options: RegisterOptions<T> = {}) {\r\n    assert(!registry[name], `${name} is already registered.`);\r\n    (Object.defineProperty: any)(klass, '_classRegistryKey', {\r\n        value: name,\r\n        writeable: false\r\n    });\r\n    registry[name] = {\r\n        klass,\r\n        omit: options.omit || [],\r\n        shallow: options.shallow || []\r\n    };\r\n}\r\n\r\nregister('Object', Object);\r\n\r\nGrid.serialize = function serializeGrid(grid: Grid, transferables?: Array<Transferable>): Serialized {\r\n    const ab = grid.toArrayBuffer();\r\n    if (transferables) {\r\n        transferables.push(ab);\r\n    }\r\n    return ab;\r\n};\r\n\r\nGrid.deserialize = function deserializeGrid(serialized: ArrayBuffer): Grid {\r\n    return new Grid(serialized);\r\n};\r\nregister('Grid', Grid);\r\n\r\nregister('Color', Color);\r\n\r\nregister('StylePropertyFunction', StylePropertyFunction);\r\nregister('StyleExpression', StyleExpression, {omit: ['_evaluator']});\r\nregister(\r\n    'StyleExpressionWithErrorHandling',\r\n    StyleExpressionWithErrorHandling,\r\n    {omit: ['_evaluator']}\r\n);\r\nregister('ZoomDependentExpression', ZoomDependentExpression);\r\nregister('ZoomConstantExpression', ZoomConstantExpression);\r\nregister('CompoundExpression', CompoundExpression, {omit: ['_evaluate']});\r\nfor (const name in expressions) {\r\n    if ((expressions[name]: any)._classRegistryKey) continue;\r\n    register(`Expression_${name}`, expressions[name]);\r\n}\r\n\r\n/**\r\n * Serialize the given object for transfer to or from a web worker.\r\n *\r\n * For non-builtin types, recursively serialize each property (possibly\r\n * omitting certain properties - see register()), and package the result along\r\n * with the constructor's `name` so that the appropriate constructor can be\r\n * looked up in `deserialize()`.\r\n *\r\n * If a `transferables` array is provided, add any transferable objects (i.e.,\r\n * any ArrayBuffers or ArrayBuffer views) to the list. (If a copy is needed,\r\n * this should happen in the client code, before using serialize().)\r\n */\r\nfunction serialize(input: mixed, transferables?: Array<Transferable>): Serialized {\r\n    if (input === null ||\r\n        input === undefined ||\r\n        typeof input === 'boolean' ||\r\n        typeof input === 'number' ||\r\n        typeof input === 'string' ||\r\n        input instanceof Boolean ||\r\n        input instanceof Number ||\r\n        input instanceof String ||\r\n        input instanceof Date ||\r\n        input instanceof RegExp) {\r\n        return input;\r\n    }\r\n\r\n    if (input instanceof ArrayBuffer) {\r\n        if (transferables) {\r\n            transferables.push(input);\r\n        }\r\n        return input;\r\n    }\r\n\r\n    if (ArrayBuffer.isView(input)) {\r\n        const view: $ArrayBufferView = (input: any);\r\n        if (transferables) {\r\n            transferables.push(view.buffer);\r\n        }\r\n        return view;\r\n    }\r\n\r\n    if (input instanceof ImageData) {\r\n        if (transferables) {\r\n            transferables.push(input.data.buffer);\r\n        }\r\n        return input;\r\n    }\r\n\r\n    if (Array.isArray(input)) {\r\n        const serialized = [];\r\n        for (const item of input) {\r\n            serialized.push(serialize(item, transferables));\r\n        }\r\n        return serialized;\r\n    }\r\n\r\n    if (typeof input === 'object') {\r\n        const klass = (input.constructor: any);\r\n        const name = klass._classRegistryKey;\r\n        if (!name) {\r\n            throw new Error(`can't serialize object of unregistered class`);\r\n        }\r\n        assert(registry[name]);\r\n\r\n        const properties: {[string]: Serialized} = {};\r\n\r\n        if (klass.serialize) {\r\n            // (Temporary workaround) allow a class to provide static\r\n            // `serialize()` and `deserialize()` methods to bypass the generic\r\n            // approach.\r\n            // This temporary workaround lets us use the generic serialization\r\n            // approach for objects whose members include instances of dynamic\r\n            // StructArray types. Once we refactor StructArray to be static,\r\n            // we can remove this complexity.\r\n            properties._serialized = (klass.serialize: typeof serialize)(input, transferables);\r\n        } else {\r\n            for (const key in input) {\r\n                // any cast due to https://github.com/facebook/flow/issues/5393\r\n                if (!(input: any).hasOwnProperty(key)) continue;\r\n                if (registry[name].omit.indexOf(key) >= 0) continue;\r\n                const property = (input: any)[key];\r\n                properties[key] = registry[name].shallow.indexOf(key) >= 0 ?\r\n                    property :\r\n                    serialize(property, transferables);\r\n            }\r\n        }\r\n\r\n        return {name, properties};\r\n    }\r\n\r\n    throw new Error(`can't serialize object of type ${typeof input}`);\r\n}\r\n\r\nfunction deserialize(input: Serialized): mixed {\r\n    if (input === null ||\r\n        input === undefined ||\r\n        typeof input === 'boolean' ||\r\n        typeof input === 'number' ||\r\n        typeof input === 'string' ||\r\n        input instanceof Boolean ||\r\n        input instanceof Number ||\r\n        input instanceof String ||\r\n        input instanceof Date ||\r\n        input instanceof RegExp ||\r\n        input instanceof ArrayBuffer ||\r\n        ArrayBuffer.isView(input) ||\r\n        input instanceof ImageData) {\r\n        return input;\r\n    }\r\n\r\n    if (Array.isArray(input)) {\r\n        return input.map((i) => deserialize(i));\r\n    }\r\n\r\n    if (typeof input === 'object') {\r\n        const {name, properties} = (input: any);\r\n        if (!name) {\r\n            throw new Error(`can't deserialize object of anonymous class`);\r\n        }\r\n\r\n        const {klass} = registry[name];\r\n        if (!klass) {\r\n            throw new Error(`can't deserialize unregistered class ${name}`);\r\n        }\r\n\r\n        if (klass.deserialize) {\r\n            return (klass.deserialize: typeof deserialize)(properties._serialized);\r\n        }\r\n\r\n        const result = Object.create(klass.prototype);\r\n\r\n        for (const key of Object.keys(properties)) {\r\n            result[key] = registry[name].shallow.indexOf(key) >= 0 ?\r\n                properties[key] : deserialize(properties[key]);\r\n        }\r\n\r\n        return result;\r\n    }\r\n\r\n    throw new Error(`can't deserialize object of type ${typeof input}`);\r\n}\r\n\r\nmodule.exports = {\r\n    register,\r\n    serialize,\r\n    deserialize\r\n};\r\n","// (c) Dean McNamee <dean@gmail.com>, 2012.\n//\n// https://github.com/deanm/css-color-parser-js\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to\n// deal in the Software without restriction, including without limitation the\n// rights to use, copy, modify, merge, publish, distribute, sublicense, and/or\n// sell copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n//\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n// FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS\n// IN THE SOFTWARE.\n\n// http://www.w3.org/TR/css3-color/\nvar kCSSColorTable = {\n  \"transparent\": [0,0,0,0], \"aliceblue\": [240,248,255,1],\n  \"antiquewhite\": [250,235,215,1], \"aqua\": [0,255,255,1],\n  \"aquamarine\": [127,255,212,1], \"azure\": [240,255,255,1],\n  \"beige\": [245,245,220,1], \"bisque\": [255,228,196,1],\n  \"black\": [0,0,0,1], \"blanchedalmond\": [255,235,205,1],\n  \"blue\": [0,0,255,1], \"blueviolet\": [138,43,226,1],\n  \"brown\": [165,42,42,1], \"burlywood\": [222,184,135,1],\n  \"cadetblue\": [95,158,160,1], \"chartreuse\": [127,255,0,1],\n  \"chocolate\": [210,105,30,1], \"coral\": [255,127,80,1],\n  \"cornflowerblue\": [100,149,237,1], \"cornsilk\": [255,248,220,1],\n  \"crimson\": [220,20,60,1], \"cyan\": [0,255,255,1],\n  \"darkblue\": [0,0,139,1], \"darkcyan\": [0,139,139,1],\n  \"darkgoldenrod\": [184,134,11,1], \"darkgray\": [169,169,169,1],\n  \"darkgreen\": [0,100,0,1], \"darkgrey\": [169,169,169,1],\n  \"darkkhaki\": [189,183,107,1], \"darkmagenta\": [139,0,139,1],\n  \"darkolivegreen\": [85,107,47,1], \"darkorange\": [255,140,0,1],\n  \"darkorchid\": [153,50,204,1], \"darkred\": [139,0,0,1],\n  \"darksalmon\": [233,150,122,1], \"darkseagreen\": [143,188,143,1],\n  \"darkslateblue\": [72,61,139,1], \"darkslategray\": [47,79,79,1],\n  \"darkslategrey\": [47,79,79,1], \"darkturquoise\": [0,206,209,1],\n  \"darkviolet\": [148,0,211,1], \"deeppink\": [255,20,147,1],\n  \"deepskyblue\": [0,191,255,1], \"dimgray\": [105,105,105,1],\n  \"dimgrey\": [105,105,105,1], \"dodgerblue\": [30,144,255,1],\n  \"firebrick\": [178,34,34,1], \"floralwhite\": [255,250,240,1],\n  \"forestgreen\": [34,139,34,1], \"fuchsia\": [255,0,255,1],\n  \"gainsboro\": [220,220,220,1], \"ghostwhite\": [248,248,255,1],\n  \"gold\": [255,215,0,1], \"goldenrod\": [218,165,32,1],\n  \"gray\": [128,128,128,1], \"green\": [0,128,0,1],\n  \"greenyellow\": [173,255,47,1], \"grey\": [128,128,128,1],\n  \"honeydew\": [240,255,240,1], \"hotpink\": [255,105,180,1],\n  \"indianred\": [205,92,92,1], \"indigo\": [75,0,130,1],\n  \"ivory\": [255,255,240,1], \"khaki\": [240,230,140,1],\n  \"lavender\": [230,230,250,1], \"lavenderblush\": [255,240,245,1],\n  \"lawngreen\": [124,252,0,1], \"lemonchiffon\": [255,250,205,1],\n  \"lightblue\": [173,216,230,1], \"lightcoral\": [240,128,128,1],\n  \"lightcyan\": [224,255,255,1], \"lightgoldenrodyellow\": [250,250,210,1],\n  \"lightgray\": [211,211,211,1], \"lightgreen\": [144,238,144,1],\n  \"lightgrey\": [211,211,211,1], \"lightpink\": [255,182,193,1],\n  \"lightsalmon\": [255,160,122,1], \"lightseagreen\": [32,178,170,1],\n  \"lightskyblue\": [135,206,250,1], \"lightslategray\": [119,136,153,1],\n  \"lightslategrey\": [119,136,153,1], \"lightsteelblue\": [176,196,222,1],\n  \"lightyellow\": [255,255,224,1], \"lime\": [0,255,0,1],\n  \"limegreen\": [50,205,50,1], \"linen\": [250,240,230,1],\n  \"magenta\": [255,0,255,1], \"maroon\": [128,0,0,1],\n  \"mediumaquamarine\": [102,205,170,1], \"mediumblue\": [0,0,205,1],\n  \"mediumorchid\": [186,85,211,1], \"mediumpurple\": [147,112,219,1],\n  \"mediumseagreen\": [60,179,113,1], \"mediumslateblue\": [123,104,238,1],\n  \"mediumspringgreen\": [0,250,154,1], \"mediumturquoise\": [72,209,204,1],\n  \"mediumvioletred\": [199,21,133,1], \"midnightblue\": [25,25,112,1],\n  \"mintcream\": [245,255,250,1], \"mistyrose\": [255,228,225,1],\n  \"moccasin\": [255,228,181,1], \"navajowhite\": [255,222,173,1],\n  \"navy\": [0,0,128,1], \"oldlace\": [253,245,230,1],\n  \"olive\": [128,128,0,1], \"olivedrab\": [107,142,35,1],\n  \"orange\": [255,165,0,1], \"orangered\": [255,69,0,1],\n  \"orchid\": [218,112,214,1], \"palegoldenrod\": [238,232,170,1],\n  \"palegreen\": [152,251,152,1], \"paleturquoise\": [175,238,238,1],\n  \"palevioletred\": [219,112,147,1], \"papayawhip\": [255,239,213,1],\n  \"peachpuff\": [255,218,185,1], \"peru\": [205,133,63,1],\n  \"pink\": [255,192,203,1], \"plum\": [221,160,221,1],\n  \"powderblue\": [176,224,230,1], \"purple\": [128,0,128,1],\n  \"rebeccapurple\": [102,51,153,1],\n  \"red\": [255,0,0,1], \"rosybrown\": [188,143,143,1],\n  \"royalblue\": [65,105,225,1], \"saddlebrown\": [139,69,19,1],\n  \"salmon\": [250,128,114,1], \"sandybrown\": [244,164,96,1],\n  \"seagreen\": [46,139,87,1], \"seashell\": [255,245,238,1],\n  \"sienna\": [160,82,45,1], \"silver\": [192,192,192,1],\n  \"skyblue\": [135,206,235,1], \"slateblue\": [106,90,205,1],\n  \"slategray\": [112,128,144,1], \"slategrey\": [112,128,144,1],\n  \"snow\": [255,250,250,1], \"springgreen\": [0,255,127,1],\n  \"steelblue\": [70,130,180,1], \"tan\": [210,180,140,1],\n  \"teal\": [0,128,128,1], \"thistle\": [216,191,216,1],\n  \"tomato\": [255,99,71,1], \"turquoise\": [64,224,208,1],\n  \"violet\": [238,130,238,1], \"wheat\": [245,222,179,1],\n  \"white\": [255,255,255,1], \"whitesmoke\": [245,245,245,1],\n  \"yellow\": [255,255,0,1], \"yellowgreen\": [154,205,50,1]}\n\nfunction clamp_css_byte(i) {  // Clamp to integer 0 .. 255.\n  i = Math.round(i);  // Seems to be what Chrome does (vs truncation).\n  return i < 0 ? 0 : i > 255 ? 255 : i;\n}\n\nfunction clamp_css_float(f) {  // Clamp to float 0.0 .. 1.0.\n  return f < 0 ? 0 : f > 1 ? 1 : f;\n}\n\nfunction parse_css_int(str) {  // int or percentage.\n  if (str[str.length - 1] === '%')\n    return clamp_css_byte(parseFloat(str) / 100 * 255);\n  return clamp_css_byte(parseInt(str));\n}\n\nfunction parse_css_float(str) {  // float or percentage.\n  if (str[str.length - 1] === '%')\n    return clamp_css_float(parseFloat(str) / 100);\n  return clamp_css_float(parseFloat(str));\n}\n\nfunction css_hue_to_rgb(m1, m2, h) {\n  if (h < 0) h += 1;\n  else if (h > 1) h -= 1;\n\n  if (h * 6 < 1) return m1 + (m2 - m1) * h * 6;\n  if (h * 2 < 1) return m2;\n  if (h * 3 < 2) return m1 + (m2 - m1) * (2/3 - h) * 6;\n  return m1;\n}\n\nfunction parseCSSColor(css_str) {\n  // Remove all whitespace, not compliant, but should just be more accepting.\n  var str = css_str.replace(/ /g, '').toLowerCase();\n\n  // Color keywords (and transparent) lookup.\n  if (str in kCSSColorTable) return kCSSColorTable[str].slice();  // dup.\n\n  // #abc and #abc123 syntax.\n  if (str[0] === '#') {\n    if (str.length === 4) {\n      var iv = parseInt(str.substr(1), 16);  // TODO(deanm): Stricter parsing.\n      if (!(iv >= 0 && iv <= 0xfff)) return null;  // Covers NaN.\n      return [((iv & 0xf00) >> 4) | ((iv & 0xf00) >> 8),\n              (iv & 0xf0) | ((iv & 0xf0) >> 4),\n              (iv & 0xf) | ((iv & 0xf) << 4),\n              1];\n    } else if (str.length === 7) {\n      var iv = parseInt(str.substr(1), 16);  // TODO(deanm): Stricter parsing.\n      if (!(iv >= 0 && iv <= 0xffffff)) return null;  // Covers NaN.\n      return [(iv & 0xff0000) >> 16,\n              (iv & 0xff00) >> 8,\n              iv & 0xff,\n              1];\n    }\n\n    return null;\n  }\n\n  var op = str.indexOf('('), ep = str.indexOf(')');\n  if (op !== -1 && ep + 1 === str.length) {\n    var fname = str.substr(0, op);\n    var params = str.substr(op+1, ep-(op+1)).split(',');\n    var alpha = 1;  // To allow case fallthrough.\n    switch (fname) {\n      case 'rgba':\n        if (params.length !== 4) return null;\n        alpha = parse_css_float(params.pop());\n        // Fall through.\n      case 'rgb':\n        if (params.length !== 3) return null;\n        return [parse_css_int(params[0]),\n                parse_css_int(params[1]),\n                parse_css_int(params[2]),\n                alpha];\n      case 'hsla':\n        if (params.length !== 4) return null;\n        alpha = parse_css_float(params.pop());\n        // Fall through.\n      case 'hsl':\n        if (params.length !== 3) return null;\n        var h = (((parseFloat(params[0]) % 360) + 360) % 360) / 360;  // 0 .. 1\n        // NOTE(deanm): According to the CSS spec s/l should only be\n        // percentages, but we don't bother and let float or percentage.\n        var s = parse_css_float(params[1]);\n        var l = parse_css_float(params[2]);\n        var m2 = l <= 0.5 ? l * (s + 1) : l + s - l * s;\n        var m1 = l * 2 - m2;\n        return [clamp_css_byte(css_hue_to_rgb(m1, m2, h+1/3) * 255),\n                clamp_css_byte(css_hue_to_rgb(m1, m2, h) * 255),\n                clamp_css_byte(css_hue_to_rgb(m1, m2, h-1/3) * 255),\n                alpha];\n      default:\n        return null;\n    }\n  }\n\n  return null;\n}\n\ntry { exports.parseCSSColor = parseCSSColor } catch(e) { }\n","'use strict';\n\nmodule.exports = earcut;\nmodule.exports.default = earcut;\n\nfunction earcut(data, holeIndices, dim) {\n\n    dim = dim || 2;\n\n    var hasHoles = holeIndices && holeIndices.length,\n        outerLen = hasHoles ? holeIndices[0] * dim : data.length,\n        outerNode = linkedList(data, 0, outerLen, dim, true),\n        triangles = [];\n\n    if (!outerNode || outerNode.next === outerNode.prev) return triangles;\n\n    var minX, minY, maxX, maxY, x, y, invSize;\n\n    if (hasHoles) outerNode = eliminateHoles(data, holeIndices, outerNode, dim);\n\n    // if the shape is not too simple, we'll use z-order curve hash later; calculate polygon bbox\n    if (data.length > 80 * dim) {\n        minX = maxX = data[0];\n        minY = maxY = data[1];\n\n        for (var i = dim; i < outerLen; i += dim) {\n            x = data[i];\n            y = data[i + 1];\n            if (x < minX) minX = x;\n            if (y < minY) minY = y;\n            if (x > maxX) maxX = x;\n            if (y > maxY) maxY = y;\n        }\n\n        // minX, minY and invSize are later used to transform coords into integers for z-order calculation\n        invSize = Math.max(maxX - minX, maxY - minY);\n        invSize = invSize !== 0 ? 1 / invSize : 0;\n    }\n\n    earcutLinked(outerNode, triangles, dim, minX, minY, invSize);\n\n    return triangles;\n}\n\n// create a circular doubly linked list from polygon points in the specified winding order\nfunction linkedList(data, start, end, dim, clockwise) {\n    var i, last;\n\n    if (clockwise === (signedArea(data, start, end, dim) > 0)) {\n        for (i = start; i < end; i += dim) last = insertNode(i, data[i], data[i + 1], last);\n    } else {\n        for (i = end - dim; i >= start; i -= dim) last = insertNode(i, data[i], data[i + 1], last);\n    }\n\n    if (last && equals(last, last.next)) {\n        removeNode(last);\n        last = last.next;\n    }\n\n    return last;\n}\n\n// eliminate colinear or duplicate points\nfunction filterPoints(start, end) {\n    if (!start) return start;\n    if (!end) end = start;\n\n    var p = start,\n        again;\n    do {\n        again = false;\n\n        if (!p.steiner && (equals(p, p.next) || area(p.prev, p, p.next) === 0)) {\n            removeNode(p);\n            p = end = p.prev;\n            if (p === p.next) break;\n            again = true;\n\n        } else {\n            p = p.next;\n        }\n    } while (again || p !== end);\n\n    return end;\n}\n\n// main ear slicing loop which triangulates a polygon (given as a linked list)\nfunction earcutLinked(ear, triangles, dim, minX, minY, invSize, pass) {\n    if (!ear) return;\n\n    // interlink polygon nodes in z-order\n    if (!pass && invSize) indexCurve(ear, minX, minY, invSize);\n\n    var stop = ear,\n        prev, next;\n\n    // iterate through ears, slicing them one by one\n    while (ear.prev !== ear.next) {\n        prev = ear.prev;\n        next = ear.next;\n\n        if (invSize ? isEarHashed(ear, minX, minY, invSize) : isEar(ear)) {\n            // cut off the triangle\n            triangles.push(prev.i / dim);\n            triangles.push(ear.i / dim);\n            triangles.push(next.i / dim);\n\n            removeNode(ear);\n\n            // skipping the next vertex leads to less sliver triangles\n            ear = next.next;\n            stop = next.next;\n\n            continue;\n        }\n\n        ear = next;\n\n        // if we looped through the whole remaining polygon and can't find any more ears\n        if (ear === stop) {\n            // try filtering points and slicing again\n            if (!pass) {\n                earcutLinked(filterPoints(ear), triangles, dim, minX, minY, invSize, 1);\n\n            // if this didn't work, try curing all small self-intersections locally\n            } else if (pass === 1) {\n                ear = cureLocalIntersections(ear, triangles, dim);\n                earcutLinked(ear, triangles, dim, minX, minY, invSize, 2);\n\n            // as a last resort, try splitting the remaining polygon into two\n            } else if (pass === 2) {\n                splitEarcut(ear, triangles, dim, minX, minY, invSize);\n            }\n\n            break;\n        }\n    }\n}\n\n// check whether a polygon node forms a valid ear with adjacent nodes\nfunction isEar(ear) {\n    var a = ear.prev,\n        b = ear,\n        c = ear.next;\n\n    if (area(a, b, c) >= 0) return false; // reflex, can't be an ear\n\n    // now make sure we don't have other points inside the potential ear\n    var p = ear.next.next;\n\n    while (p !== ear.prev) {\n        if (pointInTriangle(a.x, a.y, b.x, b.y, c.x, c.y, p.x, p.y) &&\n            area(p.prev, p, p.next) >= 0) return false;\n        p = p.next;\n    }\n\n    return true;\n}\n\nfunction isEarHashed(ear, minX, minY, invSize) {\n    var a = ear.prev,\n        b = ear,\n        c = ear.next;\n\n    if (area(a, b, c) >= 0) return false; // reflex, can't be an ear\n\n    // triangle bbox; min & max are calculated like this for speed\n    var minTX = a.x < b.x ? (a.x < c.x ? a.x : c.x) : (b.x < c.x ? b.x : c.x),\n        minTY = a.y < b.y ? (a.y < c.y ? a.y : c.y) : (b.y < c.y ? b.y : c.y),\n        maxTX = a.x > b.x ? (a.x > c.x ? a.x : c.x) : (b.x > c.x ? b.x : c.x),\n        maxTY = a.y > b.y ? (a.y > c.y ? a.y : c.y) : (b.y > c.y ? b.y : c.y);\n\n    // z-order range for the current triangle bbox;\n    var minZ = zOrder(minTX, minTY, minX, minY, invSize),\n        maxZ = zOrder(maxTX, maxTY, minX, minY, invSize);\n\n    var p = ear.prevZ,\n        n = ear.nextZ;\n\n    // look for points inside the triangle in both directions\n    while (p && p.z >= minZ && n && n.z <= maxZ) {\n        if (p !== ear.prev && p !== ear.next &&\n            pointInTriangle(a.x, a.y, b.x, b.y, c.x, c.y, p.x, p.y) &&\n            area(p.prev, p, p.next) >= 0) return false;\n        p = p.prevZ;\n\n        if (n !== ear.prev && n !== ear.next &&\n            pointInTriangle(a.x, a.y, b.x, b.y, c.x, c.y, n.x, n.y) &&\n            area(n.prev, n, n.next) >= 0) return false;\n        n = n.nextZ;\n    }\n\n    // look for remaining points in decreasing z-order\n    while (p && p.z >= minZ) {\n        if (p !== ear.prev && p !== ear.next &&\n            pointInTriangle(a.x, a.y, b.x, b.y, c.x, c.y, p.x, p.y) &&\n            area(p.prev, p, p.next) >= 0) return false;\n        p = p.prevZ;\n    }\n\n    // look for remaining points in increasing z-order\n    while (n && n.z <= maxZ) {\n        if (n !== ear.prev && n !== ear.next &&\n            pointInTriangle(a.x, a.y, b.x, b.y, c.x, c.y, n.x, n.y) &&\n            area(n.prev, n, n.next) >= 0) return false;\n        n = n.nextZ;\n    }\n\n    return true;\n}\n\n// go through all polygon nodes and cure small local self-intersections\nfunction cureLocalIntersections(start, triangles, dim) {\n    var p = start;\n    do {\n        var a = p.prev,\n            b = p.next.next;\n\n        if (!equals(a, b) && intersects(a, p, p.next, b) && locallyInside(a, b) && locallyInside(b, a)) {\n\n            triangles.push(a.i / dim);\n            triangles.push(p.i / dim);\n            triangles.push(b.i / dim);\n\n            // remove two nodes involved\n            removeNode(p);\n            removeNode(p.next);\n\n            p = start = b;\n        }\n        p = p.next;\n    } while (p !== start);\n\n    return p;\n}\n\n// try splitting polygon into two and triangulate them independently\nfunction splitEarcut(start, triangles, dim, minX, minY, invSize) {\n    // look for a valid diagonal that divides the polygon into two\n    var a = start;\n    do {\n        var b = a.next.next;\n        while (b !== a.prev) {\n            if (a.i !== b.i && isValidDiagonal(a, b)) {\n                // split the polygon in two by the diagonal\n                var c = splitPolygon(a, b);\n\n                // filter colinear points around the cuts\n                a = filterPoints(a, a.next);\n                c = filterPoints(c, c.next);\n\n                // run earcut on each half\n                earcutLinked(a, triangles, dim, minX, minY, invSize);\n                earcutLinked(c, triangles, dim, minX, minY, invSize);\n                return;\n            }\n            b = b.next;\n        }\n        a = a.next;\n    } while (a !== start);\n}\n\n// link every hole into the outer loop, producing a single-ring polygon without holes\nfunction eliminateHoles(data, holeIndices, outerNode, dim) {\n    var queue = [],\n        i, len, start, end, list;\n\n    for (i = 0, len = holeIndices.length; i < len; i++) {\n        start = holeIndices[i] * dim;\n        end = i < len - 1 ? holeIndices[i + 1] * dim : data.length;\n        list = linkedList(data, start, end, dim, false);\n        if (list === list.next) list.steiner = true;\n        queue.push(getLeftmost(list));\n    }\n\n    queue.sort(compareX);\n\n    // process holes from left to right\n    for (i = 0; i < queue.length; i++) {\n        eliminateHole(queue[i], outerNode);\n        outerNode = filterPoints(outerNode, outerNode.next);\n    }\n\n    return outerNode;\n}\n\nfunction compareX(a, b) {\n    return a.x - b.x;\n}\n\n// find a bridge between vertices that connects hole with an outer ring and and link it\nfunction eliminateHole(hole, outerNode) {\n    outerNode = findHoleBridge(hole, outerNode);\n    if (outerNode) {\n        var b = splitPolygon(outerNode, hole);\n        filterPoints(b, b.next);\n    }\n}\n\n// David Eberly's algorithm for finding a bridge between hole and outer polygon\nfunction findHoleBridge(hole, outerNode) {\n    var p = outerNode,\n        hx = hole.x,\n        hy = hole.y,\n        qx = -Infinity,\n        m;\n\n    // find a segment intersected by a ray from the hole's leftmost point to the left;\n    // segment's endpoint with lesser x will be potential connection point\n    do {\n        if (hy <= p.y && hy >= p.next.y && p.next.y !== p.y) {\n            var x = p.x + (hy - p.y) * (p.next.x - p.x) / (p.next.y - p.y);\n            if (x <= hx && x > qx) {\n                qx = x;\n                if (x === hx) {\n                    if (hy === p.y) return p;\n                    if (hy === p.next.y) return p.next;\n                }\n                m = p.x < p.next.x ? p : p.next;\n            }\n        }\n        p = p.next;\n    } while (p !== outerNode);\n\n    if (!m) return null;\n\n    if (hx === qx) return m.prev; // hole touches outer segment; pick lower endpoint\n\n    // look for points inside the triangle of hole point, segment intersection and endpoint;\n    // if there are no points found, we have a valid connection;\n    // otherwise choose the point of the minimum angle with the ray as connection point\n\n    var stop = m,\n        mx = m.x,\n        my = m.y,\n        tanMin = Infinity,\n        tan;\n\n    p = m.next;\n\n    while (p !== stop) {\n        if (hx >= p.x && p.x >= mx && hx !== p.x &&\n                pointInTriangle(hy < my ? hx : qx, hy, mx, my, hy < my ? qx : hx, hy, p.x, p.y)) {\n\n            tan = Math.abs(hy - p.y) / (hx - p.x); // tangential\n\n            if ((tan < tanMin || (tan === tanMin && p.x > m.x)) && locallyInside(p, hole)) {\n                m = p;\n                tanMin = tan;\n            }\n        }\n\n        p = p.next;\n    }\n\n    return m;\n}\n\n// interlink polygon nodes in z-order\nfunction indexCurve(start, minX, minY, invSize) {\n    var p = start;\n    do {\n        if (p.z === null) p.z = zOrder(p.x, p.y, minX, minY, invSize);\n        p.prevZ = p.prev;\n        p.nextZ = p.next;\n        p = p.next;\n    } while (p !== start);\n\n    p.prevZ.nextZ = null;\n    p.prevZ = null;\n\n    sortLinked(p);\n}\n\n// Simon Tatham's linked list merge sort algorithm\n// http://www.chiark.greenend.org.uk/~sgtatham/algorithms/listsort.html\nfunction sortLinked(list) {\n    var i, p, q, e, tail, numMerges, pSize, qSize,\n        inSize = 1;\n\n    do {\n        p = list;\n        list = null;\n        tail = null;\n        numMerges = 0;\n\n        while (p) {\n            numMerges++;\n            q = p;\n            pSize = 0;\n            for (i = 0; i < inSize; i++) {\n                pSize++;\n                q = q.nextZ;\n                if (!q) break;\n            }\n            qSize = inSize;\n\n            while (pSize > 0 || (qSize > 0 && q)) {\n\n                if (pSize !== 0 && (qSize === 0 || !q || p.z <= q.z)) {\n                    e = p;\n                    p = p.nextZ;\n                    pSize--;\n                } else {\n                    e = q;\n                    q = q.nextZ;\n                    qSize--;\n                }\n\n                if (tail) tail.nextZ = e;\n                else list = e;\n\n                e.prevZ = tail;\n                tail = e;\n            }\n\n            p = q;\n        }\n\n        tail.nextZ = null;\n        inSize *= 2;\n\n    } while (numMerges > 1);\n\n    return list;\n}\n\n// z-order of a point given coords and inverse of the longer side of data bbox\nfunction zOrder(x, y, minX, minY, invSize) {\n    // coords are transformed into non-negative 15-bit integer range\n    x = 32767 * (x - minX) * invSize;\n    y = 32767 * (y - minY) * invSize;\n\n    x = (x | (x << 8)) & 0x00FF00FF;\n    x = (x | (x << 4)) & 0x0F0F0F0F;\n    x = (x | (x << 2)) & 0x33333333;\n    x = (x | (x << 1)) & 0x55555555;\n\n    y = (y | (y << 8)) & 0x00FF00FF;\n    y = (y | (y << 4)) & 0x0F0F0F0F;\n    y = (y | (y << 2)) & 0x33333333;\n    y = (y | (y << 1)) & 0x55555555;\n\n    return x | (y << 1);\n}\n\n// find the leftmost node of a polygon ring\nfunction getLeftmost(start) {\n    var p = start,\n        leftmost = start;\n    do {\n        if (p.x < leftmost.x || (p.x === leftmost.x && p.y < leftmost.y)) leftmost = p;\n        p = p.next;\n    } while (p !== start);\n\n    return leftmost;\n}\n\n// check if a point lies within a convex triangle\nfunction pointInTriangle(ax, ay, bx, by, cx, cy, px, py) {\n    return (cx - px) * (ay - py) - (ax - px) * (cy - py) >= 0 &&\n           (ax - px) * (by - py) - (bx - px) * (ay - py) >= 0 &&\n           (bx - px) * (cy - py) - (cx - px) * (by - py) >= 0;\n}\n\n// check if a diagonal between two polygon nodes is valid (lies in polygon interior)\nfunction isValidDiagonal(a, b) {\n    return a.next.i !== b.i && a.prev.i !== b.i && !intersectsPolygon(a, b) &&\n           locallyInside(a, b) && locallyInside(b, a) && middleInside(a, b);\n}\n\n// signed area of a triangle\nfunction area(p, q, r) {\n    return (q.y - p.y) * (r.x - q.x) - (q.x - p.x) * (r.y - q.y);\n}\n\n// check if two points are equal\nfunction equals(p1, p2) {\n    return p1.x === p2.x && p1.y === p2.y;\n}\n\n// check if two segments intersect\nfunction intersects(p1, q1, p2, q2) {\n    if ((equals(p1, q1) && equals(p2, q2)) ||\n        (equals(p1, q2) && equals(p2, q1))) return true;\n    return area(p1, q1, p2) > 0 !== area(p1, q1, q2) > 0 &&\n           area(p2, q2, p1) > 0 !== area(p2, q2, q1) > 0;\n}\n\n// check if a polygon diagonal intersects any polygon segments\nfunction intersectsPolygon(a, b) {\n    var p = a;\n    do {\n        if (p.i !== a.i && p.next.i !== a.i && p.i !== b.i && p.next.i !== b.i &&\n                intersects(p, p.next, a, b)) return true;\n        p = p.next;\n    } while (p !== a);\n\n    return false;\n}\n\n// check if a polygon diagonal is locally inside the polygon\nfunction locallyInside(a, b) {\n    return area(a.prev, a, a.next) < 0 ?\n        area(a, b, a.next) >= 0 && area(a, a.prev, b) >= 0 :\n        area(a, b, a.prev) < 0 || area(a, a.next, b) < 0;\n}\n\n// check if the middle point of a polygon diagonal is inside the polygon\nfunction middleInside(a, b) {\n    var p = a,\n        inside = false,\n        px = (a.x + b.x) / 2,\n        py = (a.y + b.y) / 2;\n    do {\n        if (((p.y > py) !== (p.next.y > py)) && p.next.y !== p.y &&\n                (px < (p.next.x - p.x) * (py - p.y) / (p.next.y - p.y) + p.x))\n            inside = !inside;\n        p = p.next;\n    } while (p !== a);\n\n    return inside;\n}\n\n// link two polygon vertices with a bridge; if the vertices belong to the same ring, it splits polygon into two;\n// if one belongs to the outer ring and another to a hole, it merges it into a single ring\nfunction splitPolygon(a, b) {\n    var a2 = new Node(a.i, a.x, a.y),\n        b2 = new Node(b.i, b.x, b.y),\n        an = a.next,\n        bp = b.prev;\n\n    a.next = b;\n    b.prev = a;\n\n    a2.next = an;\n    an.prev = a2;\n\n    b2.next = a2;\n    a2.prev = b2;\n\n    bp.next = b2;\n    b2.prev = bp;\n\n    return b2;\n}\n\n// create a node and optionally link it with previous one (in a circular doubly linked list)\nfunction insertNode(i, x, y, last) {\n    var p = new Node(i, x, y);\n\n    if (!last) {\n        p.prev = p;\n        p.next = p;\n\n    } else {\n        p.next = last.next;\n        p.prev = last;\n        last.next.prev = p;\n        last.next = p;\n    }\n    return p;\n}\n\nfunction removeNode(p) {\n    p.next.prev = p.prev;\n    p.prev.next = p.next;\n\n    if (p.prevZ) p.prevZ.nextZ = p.nextZ;\n    if (p.nextZ) p.nextZ.prevZ = p.prevZ;\n}\n\nfunction Node(i, x, y) {\n    // vertex index in coordinates array\n    this.i = i;\n\n    // vertex coordinates\n    this.x = x;\n    this.y = y;\n\n    // previous and next vertex nodes in a polygon ring\n    this.prev = null;\n    this.next = null;\n\n    // z-order curve value\n    this.z = null;\n\n    // previous and next nodes in z-order\n    this.prevZ = null;\n    this.nextZ = null;\n\n    // indicates whether this is a steiner point\n    this.steiner = false;\n}\n\n// return a percentage difference between the polygon area and its triangulation area;\n// used to verify correctness of triangulation\nearcut.deviation = function (data, holeIndices, dim, triangles) {\n    var hasHoles = holeIndices && holeIndices.length;\n    var outerLen = hasHoles ? holeIndices[0] * dim : data.length;\n\n    var polygonArea = Math.abs(signedArea(data, 0, outerLen, dim));\n    if (hasHoles) {\n        for (var i = 0, len = holeIndices.length; i < len; i++) {\n            var start = holeIndices[i] * dim;\n            var end = i < len - 1 ? holeIndices[i + 1] * dim : data.length;\n            polygonArea -= Math.abs(signedArea(data, start, end, dim));\n        }\n    }\n\n    var trianglesArea = 0;\n    for (i = 0; i < triangles.length; i += 3) {\n        var a = triangles[i] * dim;\n        var b = triangles[i + 1] * dim;\n        var c = triangles[i + 2] * dim;\n        trianglesArea += Math.abs(\n            (data[a] - data[c]) * (data[b + 1] - data[a + 1]) -\n            (data[a] - data[b]) * (data[c + 1] - data[a + 1]));\n    }\n\n    return polygonArea === 0 && trianglesArea === 0 ? 0 :\n        Math.abs((trianglesArea - polygonArea) / polygonArea);\n};\n\nfunction signedArea(data, start, end, dim) {\n    var sum = 0;\n    for (var i = start, j = end - dim; i < end; i += dim) {\n        sum += (data[j] - data[i]) * (data[i + 1] + data[j + 1]);\n        j = i;\n    }\n    return sum;\n}\n\n// turn a polygon in a multi-dimensional array form (e.g. as in GeoJSON) into a form Earcut accepts\nearcut.flatten = function (data) {\n    var dim = data[0][0].length,\n        result = {vertices: [], holes: [], dimensions: dim},\n        holeIndex = 0;\n\n    for (var i = 0; i < data.length; i++) {\n        for (var j = 0; j < data[i].length; j++) {\n            for (var d = 0; d < dim; d++) result.vertices.push(data[i][j][d]);\n        }\n        if (i > 0) {\n            holeIndex += data[i - 1].length;\n            result.holes.push(holeIndex);\n        }\n    }\n    return result;\n};\n","var geojsonArea = require('@mapbox/geojson-area');\n\nmodule.exports = rewind;\n\nfunction rewind(gj, outer) {\n    switch ((gj && gj.type) || null) {\n        case 'FeatureCollection':\n            gj.features = gj.features.map(curryOuter(rewind, outer));\n            return gj;\n        case 'Feature':\n            gj.geometry = rewind(gj.geometry, outer);\n            return gj;\n        case 'Polygon':\n        case 'MultiPolygon':\n            return correct(gj, outer);\n        default:\n            return gj;\n    }\n}\n\nfunction curryOuter(a, b) {\n    return function(_) { return a(_, b); };\n}\n\nfunction correct(_, outer) {\n    if (_.type === 'Polygon') {\n        _.coordinates = correctRings(_.coordinates, outer);\n    } else if (_.type === 'MultiPolygon') {\n        _.coordinates = _.coordinates.map(curryOuter(correctRings, outer));\n    }\n    return _;\n}\n\nfunction correctRings(_, outer) {\n    outer = !!outer;\n    _[0] = wind(_[0], outer);\n    for (var i = 1; i < _.length; i++) {\n        _[i] = wind(_[i], !outer);\n    }\n    return _;\n}\n\nfunction wind(_, dir) {\n    return cw(_) === dir ? _ : _.reverse();\n}\n\nfunction cw(_) {\n    return geojsonArea.ring(_) >= 0;\n}\n","\n// calculate simplification data using optimized Douglas-Peucker algorithm\n\nexport default function simplify(coords, first, last, sqTolerance) {\n    var maxSqDist = sqTolerance;\n    var mid = (last - first) >> 1;\n    var minPosToMid = last - first;\n    var index;\n\n    var ax = coords[first];\n    var ay = coords[first + 1];\n    var bx = coords[last];\n    var by = coords[last + 1];\n\n    for (var i = first + 3; i < last; i += 3) {\n        var d = getSqSegDist(coords[i], coords[i + 1], ax, ay, bx, by);\n\n        if (d > maxSqDist) {\n            index = i;\n            maxSqDist = d;\n\n        } else if (d === maxSqDist) {\n            // a workaround to ensure we choose a pivot close to the middle of the list,\n            // reducing recursion depth, for certain degenerate inputs\n            // https://github.com/mapbox/geojson-vt/issues/104\n            var posToMid = Math.abs(i - mid);\n            if (posToMid < minPosToMid) {\n                index = i;\n                minPosToMid = posToMid;\n            }\n        }\n    }\n\n    if (maxSqDist > sqTolerance) {\n        if (index - first > 3) simplify(coords, first, index, sqTolerance);\n        coords[index + 2] = maxSqDist;\n        if (last - index > 3) simplify(coords, index, last, sqTolerance);\n    }\n}\n\n// square distance from a point to a segment\nfunction getSqSegDist(px, py, x, y, bx, by) {\n\n    var dx = bx - x;\n    var dy = by - y;\n\n    if (dx !== 0 || dy !== 0) {\n\n        var t = ((px - x) * dx + (py - y) * dy) / (dx * dx + dy * dy);\n\n        if (t > 1) {\n            x = bx;\n            y = by;\n\n        } else if (t > 0) {\n            x += dx * t;\n            y += dy * t;\n        }\n    }\n\n    dx = px - x;\n    dy = py - y;\n\n    return dx * dx + dy * dy;\n}\n","\nexport default function createFeature(id, type, geom, tags) {\n    var feature = {\n        id: typeof id === 'undefined' ? null : id,\n        type: type,\n        geometry: geom,\n        tags: tags,\n        minX: Infinity,\n        minY: Infinity,\n        maxX: -Infinity,\n        maxY: -Infinity\n    };\n    calcBBox(feature);\n    return feature;\n}\n\nfunction calcBBox(feature) {\n    var geom = feature.geometry;\n    var type = feature.type;\n\n    if (type === 'Point' || type === 'MultiPoint' || type === 'LineString') {\n        calcLineBBox(feature, geom);\n\n    } else if (type === 'Polygon' || type === 'MultiLineString') {\n        for (var i = 0; i < geom.length; i++) {\n            calcLineBBox(feature, geom[i]);\n        }\n\n    } else if (type === 'MultiPolygon') {\n        for (i = 0; i < geom.length; i++) {\n            for (var j = 0; j < geom[i].length; j++) {\n                calcLineBBox(feature, geom[i][j]);\n            }\n        }\n    }\n}\n\nfunction calcLineBBox(feature, geom) {\n    for (var i = 0; i < geom.length; i += 3) {\n        feature.minX = Math.min(feature.minX, geom[i]);\n        feature.minY = Math.min(feature.minY, geom[i + 1]);\n        feature.maxX = Math.max(feature.maxX, geom[i]);\n        feature.maxY = Math.max(feature.maxY, geom[i + 1]);\n    }\n}\n","\nimport simplify from './simplify';\nimport createFeature from './feature';\n\n// converts GeoJSON feature into an intermediate projected JSON vector format with simplification data\n\nexport default function convert(data, options) {\n    var features = [];\n    if (data.type === 'FeatureCollection') {\n        for (var i = 0; i < data.features.length; i++) {\n            convertFeature(features, data.features[i], options, i);\n        }\n\n    } else if (data.type === 'Feature') {\n        convertFeature(features, data, options);\n\n    } else {\n        // single geometry or a geometry collection\n        convertFeature(features, {geometry: data}, options);\n    }\n\n    return features;\n}\n\nfunction convertFeature(features, geojson, options, index) {\n    if (!geojson.geometry) return;\n\n    var coords = geojson.geometry.coordinates;\n    var type = geojson.geometry.type;\n    var tolerance = Math.pow(options.tolerance / ((1 << options.maxZoom) * options.extent), 2);\n    var geometry = [];\n    var id = geojson.id;\n    if (options.promoteId) {\n        id = geojson.properties[options.promoteId];\n    } else if (options.generateId) {\n        id = index || 0;\n    }\n    if (type === 'Point') {\n        convertPoint(coords, geometry);\n\n    } else if (type === 'MultiPoint') {\n        for (var i = 0; i < coords.length; i++) {\n            convertPoint(coords[i], geometry);\n        }\n\n    } else if (type === 'LineString') {\n        convertLine(coords, geometry, tolerance, false);\n\n    } else if (type === 'MultiLineString') {\n        if (options.lineMetrics) {\n            // explode into linestrings to be able to track metrics\n            for (i = 0; i < coords.length; i++) {\n                geometry = [];\n                convertLine(coords[i], geometry, tolerance, false);\n                features.push(createFeature(id, 'LineString', geometry, geojson.properties));\n            }\n            return;\n        } else {\n            convertLines(coords, geometry, tolerance, false);\n        }\n\n    } else if (type === 'Polygon') {\n        convertLines(coords, geometry, tolerance, true);\n\n    } else if (type === 'MultiPolygon') {\n        for (i = 0; i < coords.length; i++) {\n            var polygon = [];\n            convertLines(coords[i], polygon, tolerance, true);\n            geometry.push(polygon);\n        }\n    } else if (type === 'GeometryCollection') {\n        for (i = 0; i < geojson.geometry.geometries.length; i++) {\n            convertFeature(features, {\n                id: id,\n                geometry: geojson.geometry.geometries[i],\n                properties: geojson.properties\n            }, options, index);\n        }\n        return;\n    } else {\n        throw new Error('Input data is not a valid GeoJSON object.');\n    }\n\n    features.push(createFeature(id, type, geometry, geojson.properties));\n}\n\nfunction convertPoint(coords, out) {\n    out.push(projectX(coords[0]));\n    out.push(projectY(coords[1]));\n    out.push(0);\n}\n\nfunction convertLine(ring, out, tolerance, isPolygon) {\n    var x0, y0;\n    var size = 0;\n\n    for (var j = 0; j < ring.length; j++) {\n        var x = projectX(ring[j][0]);\n        var y = projectY(ring[j][1]);\n\n        out.push(x);\n        out.push(y);\n        out.push(0);\n\n        if (j > 0) {\n            if (isPolygon) {\n                size += (x0 * y - x * y0) / 2; // area\n            } else {\n                size += Math.sqrt(Math.pow(x - x0, 2) + Math.pow(y - y0, 2)); // length\n            }\n        }\n        x0 = x;\n        y0 = y;\n    }\n\n    var last = out.length - 3;\n    out[2] = 1;\n    simplify(out, 0, last, tolerance);\n    out[last + 2] = 1;\n\n    out.size = Math.abs(size);\n    out.start = 0;\n    out.end = out.size;\n}\n\nfunction convertLines(rings, out, tolerance, isPolygon) {\n    for (var i = 0; i < rings.length; i++) {\n        var geom = [];\n        convertLine(rings[i], geom, tolerance, isPolygon);\n        out.push(geom);\n    }\n}\n\nfunction projectX(x) {\n    return x / 360 + 0.5;\n}\n\nfunction projectY(y) {\n    var sin = Math.sin(y * Math.PI / 180);\n    var y2 = 0.5 - 0.25 * Math.log((1 + sin) / (1 - sin)) / Math.PI;\n    return y2 < 0 ? 0 : y2 > 1 ? 1 : y2;\n}\n","\nimport createFeature from './feature';\n\n/* clip features between two axis-parallel lines:\n *     |        |\n *  ___|___     |     /\n * /   |   \\____|____/\n *     |        |\n */\n\nexport default function clip(features, scale, k1, k2, axis, minAll, maxAll, options) {\n\n    k1 /= scale;\n    k2 /= scale;\n\n    if (minAll >= k1 && maxAll < k2) return features; // trivial accept\n    else if (maxAll < k1 || minAll >= k2) return null; // trivial reject\n\n    var clipped = [];\n\n    for (var i = 0; i < features.length; i++) {\n\n        var feature = features[i];\n        var geometry = feature.geometry;\n        var type = feature.type;\n\n        var min = axis === 0 ? feature.minX : feature.minY;\n        var max = axis === 0 ? feature.maxX : feature.maxY;\n\n        if (min >= k1 && max < k2) { // trivial accept\n            clipped.push(feature);\n            continue;\n        } else if (max < k1 || min >= k2) { // trivial reject\n            continue;\n        }\n\n        var newGeometry = [];\n\n        if (type === 'Point' || type === 'MultiPoint') {\n            clipPoints(geometry, newGeometry, k1, k2, axis);\n\n        } else if (type === 'LineString') {\n            clipLine(geometry, newGeometry, k1, k2, axis, false, options.lineMetrics);\n\n        } else if (type === 'MultiLineString') {\n            clipLines(geometry, newGeometry, k1, k2, axis, false);\n\n        } else if (type === 'Polygon') {\n            clipLines(geometry, newGeometry, k1, k2, axis, true);\n\n        } else if (type === 'MultiPolygon') {\n            for (var j = 0; j < geometry.length; j++) {\n                var polygon = [];\n                clipLines(geometry[j], polygon, k1, k2, axis, true);\n                if (polygon.length) {\n                    newGeometry.push(polygon);\n                }\n            }\n        }\n\n        if (newGeometry.length) {\n            if (options.lineMetrics && type === 'LineString') {\n                for (j = 0; j < newGeometry.length; j++) {\n                    clipped.push(createFeature(feature.id, type, newGeometry[j], feature.tags));\n                }\n                continue;\n            }\n\n            if (type === 'LineString' || type === 'MultiLineString') {\n                if (newGeometry.length === 1) {\n                    type = 'LineString';\n                    newGeometry = newGeometry[0];\n                } else {\n                    type = 'MultiLineString';\n                }\n            }\n            if (type === 'Point' || type === 'MultiPoint') {\n                type = newGeometry.length === 3 ? 'Point' : 'MultiPoint';\n            }\n\n            clipped.push(createFeature(feature.id, type, newGeometry, feature.tags));\n        }\n    }\n\n    return clipped.length ? clipped : null;\n}\n\nfunction clipPoints(geom, newGeom, k1, k2, axis) {\n    for (var i = 0; i < geom.length; i += 3) {\n        var a = geom[i + axis];\n\n        if (a >= k1 && a <= k2) {\n            newGeom.push(geom[i]);\n            newGeom.push(geom[i + 1]);\n            newGeom.push(geom[i + 2]);\n        }\n    }\n}\n\nfunction clipLine(geom, newGeom, k1, k2, axis, isPolygon, trackMetrics) {\n\n    var slice = newSlice(geom);\n    var intersect = axis === 0 ? intersectX : intersectY;\n    var len = geom.start;\n    var segLen, t;\n\n    for (var i = 0; i < geom.length - 3; i += 3) {\n        var ax = geom[i];\n        var ay = geom[i + 1];\n        var az = geom[i + 2];\n        var bx = geom[i + 3];\n        var by = geom[i + 4];\n        var a = axis === 0 ? ax : ay;\n        var b = axis === 0 ? bx : by;\n        var exited = false;\n\n        if (trackMetrics) segLen = Math.sqrt(Math.pow(ax - bx, 2) + Math.pow(ay - by, 2));\n\n        if (a < k1) {\n            // ---|-->  | (line enters the clip region from the left)\n            if (b > k1) {\n                t = intersect(slice, ax, ay, bx, by, k1);\n                if (trackMetrics) slice.start = len + segLen * t;\n            }\n        } else if (a > k2) {\n            // |  <--|--- (line enters the clip region from the right)\n            if (b < k2) {\n                t = intersect(slice, ax, ay, bx, by, k2);\n                if (trackMetrics) slice.start = len + segLen * t;\n            }\n        } else {\n            addPoint(slice, ax, ay, az);\n        }\n        if (b < k1 && a >= k1) {\n            // <--|---  | or <--|-----|--- (line exits the clip region on the left)\n            t = intersect(slice, ax, ay, bx, by, k1);\n            exited = true;\n        }\n        if (b > k2 && a <= k2) {\n            // |  ---|--> or ---|-----|--> (line exits the clip region on the right)\n            t = intersect(slice, ax, ay, bx, by, k2);\n            exited = true;\n        }\n\n        if (!isPolygon && exited) {\n            if (trackMetrics) slice.end = len + segLen * t;\n            newGeom.push(slice);\n            slice = newSlice(geom);\n        }\n\n        if (trackMetrics) len += segLen;\n    }\n\n    // add the last point\n    var last = geom.length - 3;\n    ax = geom[last];\n    ay = geom[last + 1];\n    az = geom[last + 2];\n    a = axis === 0 ? ax : ay;\n    if (a >= k1 && a <= k2) addPoint(slice, ax, ay, az);\n\n    // close the polygon if its endpoints are not the same after clipping\n    last = slice.length - 3;\n    if (isPolygon && last >= 3 && (slice[last] !== slice[0] || slice[last + 1] !== slice[1])) {\n        addPoint(slice, slice[0], slice[1], slice[2]);\n    }\n\n    // add the final slice\n    if (slice.length) {\n        newGeom.push(slice);\n    }\n}\n\nfunction newSlice(line) {\n    var slice = [];\n    slice.size = line.size;\n    slice.start = line.start;\n    slice.end = line.end;\n    return slice;\n}\n\nfunction clipLines(geom, newGeom, k1, k2, axis, isPolygon) {\n    for (var i = 0; i < geom.length; i++) {\n        clipLine(geom[i], newGeom, k1, k2, axis, isPolygon, false);\n    }\n}\n\nfunction addPoint(out, x, y, z) {\n    out.push(x);\n    out.push(y);\n    out.push(z);\n}\n\nfunction intersectX(out, ax, ay, bx, by, x) {\n    var t = (x - ax) / (bx - ax);\n    out.push(x);\n    out.push(ay + (by - ay) * t);\n    out.push(1);\n    return t;\n}\n\nfunction intersectY(out, ax, ay, bx, by, y) {\n    var t = (y - ay) / (by - ay);\n    out.push(ax + (bx - ax) * t);\n    out.push(y);\n    out.push(1);\n    return t;\n}\n","\nimport clip from './clip';\nimport createFeature from './feature';\n\nexport default function wrap(features, options) {\n    var buffer = options.buffer / options.extent;\n    var merged = features;\n    var left  = clip(features, 1, -1 - buffer, buffer,     0, -1, 2, options); // left world copy\n    var right = clip(features, 1,  1 - buffer, 2 + buffer, 0, -1, 2, options); // right world copy\n\n    if (left || right) {\n        merged = clip(features, 1, -buffer, 1 + buffer, 0, -1, 2, options) || []; // center world copy\n\n        if (left) merged = shiftFeatureCoords(left, 1).concat(merged); // merge left into center\n        if (right) merged = merged.concat(shiftFeatureCoords(right, -1)); // merge right into center\n    }\n\n    return merged;\n}\n\nfunction shiftFeatureCoords(features, offset) {\n    var newFeatures = [];\n\n    for (var i = 0; i < features.length; i++) {\n        var feature = features[i],\n            type = feature.type;\n\n        var newGeometry;\n\n        if (type === 'Point' || type === 'MultiPoint' || type === 'LineString') {\n            newGeometry = shiftCoords(feature.geometry, offset);\n\n        } else if (type === 'MultiLineString' || type === 'Polygon') {\n            newGeometry = [];\n            for (var j = 0; j < feature.geometry.length; j++) {\n                newGeometry.push(shiftCoords(feature.geometry[j], offset));\n            }\n        } else if (type === 'MultiPolygon') {\n            newGeometry = [];\n            for (j = 0; j < feature.geometry.length; j++) {\n                var newPolygon = [];\n                for (var k = 0; k < feature.geometry[j].length; k++) {\n                    newPolygon.push(shiftCoords(feature.geometry[j][k], offset));\n                }\n                newGeometry.push(newPolygon);\n            }\n        }\n\n        newFeatures.push(createFeature(feature.id, type, newGeometry, feature.tags));\n    }\n\n    return newFeatures;\n}\n\nfunction shiftCoords(points, offset) {\n    var newPoints = [];\n    newPoints.size = points.size;\n\n    if (points.start !== undefined) {\n        newPoints.start = points.start;\n        newPoints.end = points.end;\n    }\n\n    for (var i = 0; i < points.length; i += 3) {\n        newPoints.push(points[i] + offset, points[i + 1], points[i + 2]);\n    }\n    return newPoints;\n}\n","\n// Transforms the coordinates of each feature in the given tile from\n// mercator-projected space into (extent x extent) tile space.\nexport default function transformTile(tile, extent) {\n    if (tile.transformed) return tile;\n\n    var z2 = 1 << tile.z,\n        tx = tile.x,\n        ty = tile.y,\n        i, j, k;\n\n    for (i = 0; i < tile.features.length; i++) {\n        var feature = tile.features[i],\n            geom = feature.geometry,\n            type = feature.type;\n\n        feature.geometry = [];\n\n        if (type === 1) {\n            for (j = 0; j < geom.length; j += 2) {\n                feature.geometry.push(transformPoint(geom[j], geom[j + 1], extent, z2, tx, ty));\n            }\n        } else {\n            for (j = 0; j < geom.length; j++) {\n                var ring = [];\n                for (k = 0; k < geom[j].length; k += 2) {\n                    ring.push(transformPoint(geom[j][k], geom[j][k + 1], extent, z2, tx, ty));\n                }\n                feature.geometry.push(ring);\n            }\n        }\n    }\n\n    tile.transformed = true;\n\n    return tile;\n}\n\nfunction transformPoint(x, y, extent, z2, tx, ty) {\n    return [\n        Math.round(extent * (x * z2 - tx)),\n        Math.round(extent * (y * z2 - ty))];\n}\n","\nexport default function createTile(features, z, tx, ty, options) {\n    var tolerance = z === options.maxZoom ? 0 : options.tolerance / ((1 << z) * options.extent);\n    var tile = {\n        features: [],\n        numPoints: 0,\n        numSimplified: 0,\n        numFeatures: 0,\n        source: null,\n        x: tx,\n        y: ty,\n        z: z,\n        transformed: false,\n        minX: 2,\n        minY: 1,\n        maxX: -1,\n        maxY: 0\n    };\n    for (var i = 0; i < features.length; i++) {\n        tile.numFeatures++;\n        addFeature(tile, features[i], tolerance, options);\n\n        var minX = features[i].minX;\n        var minY = features[i].minY;\n        var maxX = features[i].maxX;\n        var maxY = features[i].maxY;\n\n        if (minX < tile.minX) tile.minX = minX;\n        if (minY < tile.minY) tile.minY = minY;\n        if (maxX > tile.maxX) tile.maxX = maxX;\n        if (maxY > tile.maxY) tile.maxY = maxY;\n    }\n    return tile;\n}\n\nfunction addFeature(tile, feature, tolerance, options) {\n\n    var geom = feature.geometry,\n        type = feature.type,\n        simplified = [];\n\n    if (type === 'Point' || type === 'MultiPoint') {\n        for (var i = 0; i < geom.length; i += 3) {\n            simplified.push(geom[i]);\n            simplified.push(geom[i + 1]);\n            tile.numPoints++;\n            tile.numSimplified++;\n        }\n\n    } else if (type === 'LineString') {\n        addLine(simplified, geom, tile, tolerance, false, false);\n\n    } else if (type === 'MultiLineString' || type === 'Polygon') {\n        for (i = 0; i < geom.length; i++) {\n            addLine(simplified, geom[i], tile, tolerance, type === 'Polygon', i === 0);\n        }\n\n    } else if (type === 'MultiPolygon') {\n\n        for (var k = 0; k < geom.length; k++) {\n            var polygon = geom[k];\n            for (i = 0; i < polygon.length; i++) {\n                addLine(simplified, polygon[i], tile, tolerance, true, i === 0);\n            }\n        }\n    }\n\n    if (simplified.length) {\n        var tags = feature.tags || null;\n        if (type === 'LineString' && options.lineMetrics) {\n            tags = {};\n            for (var key in feature.tags) tags[key] = feature.tags[key];\n            tags['mapbox_clip_start'] = geom.start / geom.size;\n            tags['mapbox_clip_end'] = geom.end / geom.size;\n        }\n        var tileFeature = {\n            geometry: simplified,\n            type: type === 'Polygon' || type === 'MultiPolygon' ? 3 :\n                type === 'LineString' || type === 'MultiLineString' ? 2 : 1,\n            tags: tags\n        };\n        if (feature.id !== null) {\n            tileFeature.id = feature.id;\n        }\n        tile.features.push(tileFeature);\n    }\n}\n\nfunction addLine(result, geom, tile, tolerance, isPolygon, isOuter) {\n    var sqTolerance = tolerance * tolerance;\n\n    if (tolerance > 0 && (geom.size < (isPolygon ? sqTolerance : tolerance))) {\n        tile.numPoints += geom.length / 3;\n        return;\n    }\n\n    var ring = [];\n\n    for (var i = 0; i < geom.length; i += 3) {\n        if (tolerance === 0 || geom[i + 2] > sqTolerance) {\n            tile.numSimplified++;\n            ring.push(geom[i]);\n            ring.push(geom[i + 1]);\n        }\n        tile.numPoints++;\n    }\n\n    if (isPolygon) rewind(ring, isOuter);\n\n    result.push(ring);\n}\n\nfunction rewind(ring, clockwise) {\n    var area = 0;\n    for (var i = 0, len = ring.length, j = len - 2; i < len; j = i, i += 2) {\n        area += (ring[i] - ring[j]) * (ring[i + 1] + ring[j + 1]);\n    }\n    if (area > 0 === clockwise) {\n        for (i = 0, len = ring.length; i < len / 2; i += 2) {\n            var x = ring[i];\n            var y = ring[i + 1];\n            ring[i] = ring[len - 2 - i];\n            ring[i + 1] = ring[len - 1 - i];\n            ring[len - 2 - i] = x;\n            ring[len - 1 - i] = y;\n        }\n    }\n}\n","\nimport convert from './convert';     // GeoJSON conversion and preprocessing\nimport clip from './clip';           // stripe clipping algorithm\nimport wrap from './wrap';           // date line processing\nimport transform from './transform'; // coordinate transformation\nimport createTile from './tile';     // final simplified tile generation\n\nexport default function geojsonvt(data, options) {\n    return new GeoJSONVT(data, options);\n}\n\nfunction GeoJSONVT(data, options) {\n    options = this.options = extend(Object.create(this.options), options);\n\n    var debug = options.debug;\n\n    if (debug) console.time('preprocess data');\n\n    if (options.maxZoom < 0 || options.maxZoom > 24) throw new Error('maxZoom should be in the 0-24 range');\n    if (options.promoteId && options.generateId) throw new Error('promoteId and generateId cannot be used together.');\n\n    var features = convert(data, options);\n\n    this.tiles = {};\n    this.tileCoords = [];\n\n    if (debug) {\n        console.timeEnd('preprocess data');\n        console.log('index: maxZoom: %d, maxPoints: %d', options.indexMaxZoom, options.indexMaxPoints);\n        console.time('generate tiles');\n        this.stats = {};\n        this.total = 0;\n    }\n\n    features = wrap(features, options);\n\n    // start slicing from the top tile down\n    if (features.length) this.splitTile(features, 0, 0, 0);\n\n    if (debug) {\n        if (features.length) console.log('features: %d, points: %d', this.tiles[0].numFeatures, this.tiles[0].numPoints);\n        console.timeEnd('generate tiles');\n        console.log('tiles generated:', this.total, JSON.stringify(this.stats));\n    }\n}\n\nGeoJSONVT.prototype.options = {\n    maxZoom: 14,            // max zoom to preserve detail on\n    indexMaxZoom: 5,        // max zoom in the tile index\n    indexMaxPoints: 100000, // max number of points per tile in the tile index\n    tolerance: 3,           // simplification tolerance (higher means simpler)\n    extent: 4096,           // tile extent\n    buffer: 64,             // tile buffer on each side\n    lineMetrics: false,     // whether to calculate line metrics\n    promoteId: null,        // name of a feature property to be promoted to feature.id\n    generateId: false,      // whether to generate feature ids. Cannot be used with promoteId\n    debug: 0                // logging level (0, 1 or 2)\n};\n\nGeoJSONVT.prototype.splitTile = function (features, z, x, y, cz, cx, cy) {\n\n    var stack = [features, z, x, y],\n        options = this.options,\n        debug = options.debug;\n\n    // avoid recursion by using a processing queue\n    while (stack.length) {\n        y = stack.pop();\n        x = stack.pop();\n        z = stack.pop();\n        features = stack.pop();\n\n        var z2 = 1 << z,\n            id = toID(z, x, y),\n            tile = this.tiles[id];\n\n        if (!tile) {\n            if (debug > 1) console.time('creation');\n\n            tile = this.tiles[id] = createTile(features, z, x, y, options);\n            this.tileCoords.push({z: z, x: x, y: y});\n\n            if (debug) {\n                if (debug > 1) {\n                    console.log('tile z%d-%d-%d (features: %d, points: %d, simplified: %d)',\n                        z, x, y, tile.numFeatures, tile.numPoints, tile.numSimplified);\n                    console.timeEnd('creation');\n                }\n                var key = 'z' + z;\n                this.stats[key] = (this.stats[key] || 0) + 1;\n                this.total++;\n            }\n        }\n\n        // save reference to original geometry in tile so that we can drill down later if we stop now\n        tile.source = features;\n\n        // if it's the first-pass tiling\n        if (!cz) {\n            // stop tiling if we reached max zoom, or if the tile is too simple\n            if (z === options.indexMaxZoom || tile.numPoints <= options.indexMaxPoints) continue;\n\n        // if a drilldown to a specific tile\n        } else {\n            // stop tiling if we reached base zoom or our target tile zoom\n            if (z === options.maxZoom || z === cz) continue;\n\n            // stop tiling if it's not an ancestor of the target tile\n            var m = 1 << (cz - z);\n            if (x !== Math.floor(cx / m) || y !== Math.floor(cy / m)) continue;\n        }\n\n        // if we slice further down, no need to keep source geometry\n        tile.source = null;\n\n        if (features.length === 0) continue;\n\n        if (debug > 1) console.time('clipping');\n\n        // values we'll use for clipping\n        var k1 = 0.5 * options.buffer / options.extent,\n            k2 = 0.5 - k1,\n            k3 = 0.5 + k1,\n            k4 = 1 + k1,\n            tl, bl, tr, br, left, right;\n\n        tl = bl = tr = br = null;\n\n        left  = clip(features, z2, x - k1, x + k3, 0, tile.minX, tile.maxX, options);\n        right = clip(features, z2, x + k2, x + k4, 0, tile.minX, tile.maxX, options);\n        features = null;\n\n        if (left) {\n            tl = clip(left, z2, y - k1, y + k3, 1, tile.minY, tile.maxY, options);\n            bl = clip(left, z2, y + k2, y + k4, 1, tile.minY, tile.maxY, options);\n            left = null;\n        }\n\n        if (right) {\n            tr = clip(right, z2, y - k1, y + k3, 1, tile.minY, tile.maxY, options);\n            br = clip(right, z2, y + k2, y + k4, 1, tile.minY, tile.maxY, options);\n            right = null;\n        }\n\n        if (debug > 1) console.timeEnd('clipping');\n\n        stack.push(tl || [], z + 1, x * 2,     y * 2);\n        stack.push(bl || [], z + 1, x * 2,     y * 2 + 1);\n        stack.push(tr || [], z + 1, x * 2 + 1, y * 2);\n        stack.push(br || [], z + 1, x * 2 + 1, y * 2 + 1);\n    }\n};\n\nGeoJSONVT.prototype.getTile = function (z, x, y) {\n    var options = this.options,\n        extent = options.extent,\n        debug = options.debug;\n\n    if (z < 0 || z > 24) return null;\n\n    var z2 = 1 << z;\n    x = ((x % z2) + z2) % z2; // wrap tile x coordinate\n\n    var id = toID(z, x, y);\n    if (this.tiles[id]) return transform(this.tiles[id], extent);\n\n    if (debug > 1) console.log('drilling down to z%d-%d-%d', z, x, y);\n\n    var z0 = z,\n        x0 = x,\n        y0 = y,\n        parent;\n\n    while (!parent && z0 > 0) {\n        z0--;\n        x0 = Math.floor(x0 / 2);\n        y0 = Math.floor(y0 / 2);\n        parent = this.tiles[toID(z0, x0, y0)];\n    }\n\n    if (!parent || !parent.source) return null;\n\n    // if we found a parent tile containing the original geometry, we can drill down from it\n    if (debug > 1) console.log('found parent tile z%d-%d-%d', z0, x0, y0);\n\n    if (debug > 1) console.time('drilling down');\n    this.splitTile(parent.source, z0, x0, y0, z, x, y);\n    if (debug > 1) console.timeEnd('drilling down');\n\n    return this.tiles[id] ? transform(this.tiles[id], extent) : null;\n};\n\nfunction toID(z, x, y) {\n    return (((1 << z) * y + x) * 32) + z;\n}\n\nfunction extend(dest, src) {\n    for (var i in src) dest[i] = src[i];\n    return dest;\n}\n","'use strict';\n\nmodule.exports = GridIndex;\n\nvar NUM_PARAMS = 3;\n\nfunction GridIndex(extent, n, padding) {\n    var cells = this.cells = [];\n\n    if (extent instanceof ArrayBuffer) {\n        this.arrayBuffer = extent;\n        var array = new Int32Array(this.arrayBuffer);\n        extent = array[0];\n        n = array[1];\n        padding = array[2];\n\n        this.d = n + 2 * padding;\n        for (var k = 0; k < this.d * this.d; k++) {\n            var start = array[NUM_PARAMS + k];\n            var end = array[NUM_PARAMS + k + 1];\n            cells.push(start === end ?\n                    null :\n                    array.subarray(start, end));\n        }\n        var keysOffset = array[NUM_PARAMS + cells.length];\n        var bboxesOffset = array[NUM_PARAMS + cells.length + 1];\n        this.keys = array.subarray(keysOffset, bboxesOffset);\n        this.bboxes = array.subarray(bboxesOffset);\n\n        this.insert = this._insertReadonly;\n\n    } else {\n        this.d = n + 2 * padding;\n        for (var i = 0; i < this.d * this.d; i++) {\n            cells.push([]);\n        }\n        this.keys = [];\n        this.bboxes = [];\n    }\n\n    this.n = n;\n    this.extent = extent;\n    this.padding = padding;\n    this.scale = n / extent;\n    this.uid = 0;\n\n    var p = (padding / n) * extent;\n    this.min = -p;\n    this.max = extent + p;\n}\n\n\nGridIndex.prototype.insert = function(key, x1, y1, x2, y2) {\n    this._forEachCell(x1, y1, x2, y2, this._insertCell, this.uid++);\n    this.keys.push(key);\n    this.bboxes.push(x1);\n    this.bboxes.push(y1);\n    this.bboxes.push(x2);\n    this.bboxes.push(y2);\n};\n\nGridIndex.prototype._insertReadonly = function() {\n    throw 'Cannot insert into a GridIndex created from an ArrayBuffer.';\n};\n\nGridIndex.prototype._insertCell = function(x1, y1, x2, y2, cellIndex, uid) {\n    this.cells[cellIndex].push(uid);\n};\n\nGridIndex.prototype.query = function(x1, y1, x2, y2, intersectionTest) {\n    var min = this.min;\n    var max = this.max;\n    if (x1 <= min && y1 <= min && max <= x2 && max <= y2 && !intersectionTest) {\n        // We use `Array#slice` because `this.keys` may be a `Int32Array` and\n        // some browsers (Safari and IE) do not support `TypedArray#slice`\n        // https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/TypedArray/slice#Browser_compatibility\n        return Array.prototype.slice.call(this.keys);\n\n    } else {\n        var result = [];\n        var seenUids = {};\n        this._forEachCell(x1, y1, x2, y2, this._queryCell, result, seenUids, intersectionTest);\n        return result;\n    }\n};\n\nGridIndex.prototype._queryCell = function(x1, y1, x2, y2, cellIndex, result, seenUids, intersectionTest) {\n    var cell = this.cells[cellIndex];\n    if (cell !== null) {\n        var keys = this.keys;\n        var bboxes = this.bboxes;\n        for (var u = 0; u < cell.length; u++) {\n            var uid = cell[u];\n            if (seenUids[uid] === undefined) {\n                var offset = uid * 4;\n                if (intersectionTest ?\n                    intersectionTest(bboxes[offset + 0], bboxes[offset + 1], bboxes[offset + 2], bboxes[offset + 3]) :\n                    ((x1 <= bboxes[offset + 2]) &&\n                    (y1 <= bboxes[offset + 3]) &&\n                    (x2 >= bboxes[offset + 0]) &&\n                    (y2 >= bboxes[offset + 1]))) {\n                    seenUids[uid] = true;\n                    result.push(keys[uid]);\n                } else {\n                    seenUids[uid] = false;\n                }\n            }\n        }\n    }\n};\n\nGridIndex.prototype._forEachCell = function(x1, y1, x2, y2, fn, arg1, arg2, intersectionTest) {\n    var cx1 = this._convertToCellCoord(x1);\n    var cy1 = this._convertToCellCoord(y1);\n    var cx2 = this._convertToCellCoord(x2);\n    var cy2 = this._convertToCellCoord(y2);\n    for (var x = cx1; x <= cx2; x++) {\n        for (var y = cy1; y <= cy2; y++) {\n            var cellIndex = this.d * y + x;\n            if (intersectionTest && !intersectionTest(\n                        this._convertFromCellCoord(x),\n                        this._convertFromCellCoord(y),\n                        this._convertFromCellCoord(x + 1),\n                        this._convertFromCellCoord(y + 1))) continue;\n            if (fn.call(this, x1, y1, x2, y2, cellIndex, arg1, arg2, intersectionTest)) return;\n        }\n    }\n};\n\nGridIndex.prototype._convertFromCellCoord = function(x) {\n    return (x - this.padding) / this.scale;\n};\n\nGridIndex.prototype._convertToCellCoord = function(x) {\n    return Math.max(0, Math.min(this.d - 1, Math.floor(x * this.scale) + this.padding));\n};\n\nGridIndex.prototype.toArrayBuffer = function() {\n    if (this.arrayBuffer) return this.arrayBuffer;\n\n    var cells = this.cells;\n\n    var metadataLength = NUM_PARAMS + this.cells.length + 1 + 1;\n    var totalCellLength = 0;\n    for (var i = 0; i < this.cells.length; i++) {\n        totalCellLength += this.cells[i].length;\n    }\n\n    var array = new Int32Array(metadataLength + totalCellLength + this.keys.length + this.bboxes.length);\n    array[0] = this.extent;\n    array[1] = this.n;\n    array[2] = this.padding;\n\n    var offset = metadataLength;\n    for (var k = 0; k < cells.length; k++) {\n        var cell = cells[k];\n        array[NUM_PARAMS + k] = offset;\n        array.set(cell, offset);\n        offset += cell.length;\n    }\n\n    array[NUM_PARAMS + cells.length] = offset;\n    array.set(this.keys, offset);\n    offset += this.keys.length;\n\n    array[NUM_PARAMS + cells.length + 1] = offset;\n    array.set(this.bboxes, offset);\n    offset += this.bboxes.length;\n\n    return array.buffer;\n};\n","exports.read = function (buffer, offset, isLE, mLen, nBytes) {\n  var e, m\n  var eLen = (nBytes * 8) - mLen - 1\n  var eMax = (1 << eLen) - 1\n  var eBias = eMax >> 1\n  var nBits = -7\n  var i = isLE ? (nBytes - 1) : 0\n  var d = isLE ? -1 : 1\n  var s = buffer[offset + i]\n\n  i += d\n\n  e = s & ((1 << (-nBits)) - 1)\n  s >>= (-nBits)\n  nBits += eLen\n  for (; nBits > 0; e = (e * 256) + buffer[offset + i], i += d, nBits -= 8) {}\n\n  m = e & ((1 << (-nBits)) - 1)\n  e >>= (-nBits)\n  nBits += mLen\n  for (; nBits > 0; m = (m * 256) + buffer[offset + i], i += d, nBits -= 8) {}\n\n  if (e === 0) {\n    e = 1 - eBias\n  } else if (e === eMax) {\n    return m ? NaN : ((s ? -1 : 1) * Infinity)\n  } else {\n    m = m + Math.pow(2, mLen)\n    e = e - eBias\n  }\n  return (s ? -1 : 1) * m * Math.pow(2, e - mLen)\n}\n\nexports.write = function (buffer, value, offset, isLE, mLen, nBytes) {\n  var e, m, c\n  var eLen = (nBytes * 8) - mLen - 1\n  var eMax = (1 << eLen) - 1\n  var eBias = eMax >> 1\n  var rt = (mLen === 23 ? Math.pow(2, -24) - Math.pow(2, -77) : 0)\n  var i = isLE ? 0 : (nBytes - 1)\n  var d = isLE ? 1 : -1\n  var s = value < 0 || (value === 0 && 1 / value < 0) ? 1 : 0\n\n  value = Math.abs(value)\n\n  if (isNaN(value) || value === Infinity) {\n    m = isNaN(value) ? 1 : 0\n    e = eMax\n  } else {\n    e = Math.floor(Math.log(value) / Math.LN2)\n    if (value * (c = Math.pow(2, -e)) < 1) {\n      e--\n      c *= 2\n    }\n    if (e + eBias >= 1) {\n      value += rt / c\n    } else {\n      value += rt * Math.pow(2, 1 - eBias)\n    }\n    if (value * c >= 2) {\n      e++\n      c /= 2\n    }\n\n    if (e + eBias >= eMax) {\n      m = 0\n      e = eMax\n    } else if (e + eBias >= 1) {\n      m = ((value * c) - 1) * Math.pow(2, mLen)\n      e = e + eBias\n    } else {\n      m = value * Math.pow(2, eBias - 1) * Math.pow(2, mLen)\n      e = 0\n    }\n  }\n\n  for (; mLen >= 8; buffer[offset + i] = m & 0xff, i += d, m /= 256, mLen -= 8) {}\n\n  e = (e << mLen) | m\n  eLen += mLen\n  for (; eLen > 0; buffer[offset + i] = e & 0xff, i += d, e /= 256, eLen -= 8) {}\n\n  buffer[offset + i - d] |= s * 128\n}\n","'use strict';\n\nvar sort = require('./sort');\nvar range = require('./range');\nvar within = require('./within');\n\nmodule.exports = kdbush;\n\nfunction kdbush(points, getX, getY, nodeSize, ArrayType) {\n    return new KDBush(points, getX, getY, nodeSize, ArrayType);\n}\n\nfunction KDBush(points, getX, getY, nodeSize, ArrayType) {\n    getX = getX || defaultGetX;\n    getY = getY || defaultGetY;\n    ArrayType = ArrayType || Array;\n\n    this.nodeSize = nodeSize || 64;\n    this.points = points;\n\n    this.ids = new ArrayType(points.length);\n    this.coords = new ArrayType(points.length * 2);\n\n    for (var i = 0; i < points.length; i++) {\n        this.ids[i] = i;\n        this.coords[2 * i] = getX(points[i]);\n        this.coords[2 * i + 1] = getY(points[i]);\n    }\n\n    sort(this.ids, this.coords, this.nodeSize, 0, this.ids.length - 1, 0);\n}\n\nKDBush.prototype = {\n    range: function (minX, minY, maxX, maxY) {\n        return range(this.ids, this.coords, minX, minY, maxX, maxY, this.nodeSize);\n    },\n\n    within: function (x, y, r) {\n        return within(this.ids, this.coords, x, y, r, this.nodeSize);\n    }\n};\n\nfunction defaultGetX(p) { return p[0]; }\nfunction defaultGetY(p) { return p[1]; }\n","'use strict';\n\nmodule.exports = range;\n\nfunction range(ids, coords, minX, minY, maxX, maxY, nodeSize) {\n    var stack = [0, ids.length - 1, 0];\n    var result = [];\n    var x, y;\n\n    while (stack.length) {\n        var axis = stack.pop();\n        var right = stack.pop();\n        var left = stack.pop();\n\n        if (right - left <= nodeSize) {\n            for (var i = left; i <= right; i++) {\n                x = coords[2 * i];\n                y = coords[2 * i + 1];\n                if (x >= minX && x <= maxX && y >= minY && y <= maxY) result.push(ids[i]);\n            }\n            continue;\n        }\n\n        var m = Math.floor((left + right) / 2);\n\n        x = coords[2 * m];\n        y = coords[2 * m + 1];\n\n        if (x >= minX && x <= maxX && y >= minY && y <= maxY) result.push(ids[m]);\n\n        var nextAxis = (axis + 1) % 2;\n\n        if (axis === 0 ? minX <= x : minY <= y) {\n            stack.push(left);\n            stack.push(m - 1);\n            stack.push(nextAxis);\n        }\n        if (axis === 0 ? maxX >= x : maxY >= y) {\n            stack.push(m + 1);\n            stack.push(right);\n            stack.push(nextAxis);\n        }\n    }\n\n    return result;\n}\n","'use strict';\n\nmodule.exports = sortKD;\n\nfunction sortKD(ids, coords, nodeSize, left, right, depth) {\n    if (right - left <= nodeSize) return;\n\n    var m = Math.floor((left + right) / 2);\n\n    select(ids, coords, m, left, right, depth % 2);\n\n    sortKD(ids, coords, nodeSize, left, m - 1, depth + 1);\n    sortKD(ids, coords, nodeSize, m + 1, right, depth + 1);\n}\n\nfunction select(ids, coords, k, left, right, inc) {\n\n    while (right > left) {\n        if (right - left > 600) {\n            var n = right - left + 1;\n            var m = k - left + 1;\n            var z = Math.log(n);\n            var s = 0.5 * Math.exp(2 * z / 3);\n            var sd = 0.5 * Math.sqrt(z * s * (n - s) / n) * (m - n / 2 < 0 ? -1 : 1);\n            var newLeft = Math.max(left, Math.floor(k - m * s / n + sd));\n            var newRight = Math.min(right, Math.floor(k + (n - m) * s / n + sd));\n            select(ids, coords, k, newLeft, newRight, inc);\n        }\n\n        var t = coords[2 * k + inc];\n        var i = left;\n        var j = right;\n\n        swapItem(ids, coords, left, k);\n        if (coords[2 * right + inc] > t) swapItem(ids, coords, left, right);\n\n        while (i < j) {\n            swapItem(ids, coords, i, j);\n            i++;\n            j--;\n            while (coords[2 * i + inc] < t) i++;\n            while (coords[2 * j + inc] > t) j--;\n        }\n\n        if (coords[2 * left + inc] === t) swapItem(ids, coords, left, j);\n        else {\n            j++;\n            swapItem(ids, coords, j, right);\n        }\n\n        if (j <= k) left = j + 1;\n        if (k <= j) right = j - 1;\n    }\n}\n\nfunction swapItem(ids, coords, i, j) {\n    swap(ids, i, j);\n    swap(coords, 2 * i, 2 * j);\n    swap(coords, 2 * i + 1, 2 * j + 1);\n}\n\nfunction swap(arr, i, j) {\n    var tmp = arr[i];\n    arr[i] = arr[j];\n    arr[j] = tmp;\n}\n","'use strict';\n\nmodule.exports = within;\n\nfunction within(ids, coords, qx, qy, r, nodeSize) {\n    var stack = [0, ids.length - 1, 0];\n    var result = [];\n    var r2 = r * r;\n\n    while (stack.length) {\n        var axis = stack.pop();\n        var right = stack.pop();\n        var left = stack.pop();\n\n        if (right - left <= nodeSize) {\n            for (var i = left; i <= right; i++) {\n                if (sqDist(coords[2 * i], coords[2 * i + 1], qx, qy) <= r2) result.push(ids[i]);\n            }\n            continue;\n        }\n\n        var m = Math.floor((left + right) / 2);\n\n        var x = coords[2 * m];\n        var y = coords[2 * m + 1];\n\n        if (sqDist(x, y, qx, qy) <= r2) result.push(ids[m]);\n\n        var nextAxis = (axis + 1) % 2;\n\n        if (axis === 0 ? qx - r <= x : qy - r <= y) {\n            stack.push(left);\n            stack.push(m - 1);\n            stack.push(nextAxis);\n        }\n        if (axis === 0 ? qx + r >= x : qy + r >= y) {\n            stack.push(m + 1);\n            stack.push(right);\n            stack.push(nextAxis);\n        }\n    }\n\n    return result;\n}\n\nfunction sqDist(ax, ay, bx, by) {\n    var dx = ax - bx;\n    var dy = ay - by;\n    return dx * dx + dy * dy;\n}\n","/*\nobject-assign\n(c) Sindre Sorhus\n@license MIT\n*/\n\n'use strict';\n/* eslint-disable no-unused-vars */\nvar getOwnPropertySymbols = Object.getOwnPropertySymbols;\nvar hasOwnProperty = Object.prototype.hasOwnProperty;\nvar propIsEnumerable = Object.prototype.propertyIsEnumerable;\n\nfunction toObject(val) {\n\tif (val === null || val === undefined) {\n\t\tthrow new TypeError('Object.assign cannot be called with null or undefined');\n\t}\n\n\treturn Object(val);\n}\n\nfunction shouldUseNative() {\n\ttry {\n\t\tif (!Object.assign) {\n\t\t\treturn false;\n\t\t}\n\n\t\t// Detect buggy property enumeration order in older V8 versions.\n\n\t\t// https://bugs.chromium.org/p/v8/issues/detail?id=4118\n\t\tvar test1 = new String('abc');  // eslint-disable-line no-new-wrappers\n\t\ttest1[5] = 'de';\n\t\tif (Object.getOwnPropertyNames(test1)[0] === '5') {\n\t\t\treturn false;\n\t\t}\n\n\t\t// https://bugs.chromium.org/p/v8/issues/detail?id=3056\n\t\tvar test2 = {};\n\t\tfor (var i = 0; i < 10; i++) {\n\t\t\ttest2['_' + String.fromCharCode(i)] = i;\n\t\t}\n\t\tvar order2 = Object.getOwnPropertyNames(test2).map(function (n) {\n\t\t\treturn test2[n];\n\t\t});\n\t\tif (order2.join('') !== '0123456789') {\n\t\t\treturn false;\n\t\t}\n\n\t\t// https://bugs.chromium.org/p/v8/issues/detail?id=3056\n\t\tvar test3 = {};\n\t\t'abcdefghijklmnopqrst'.split('').forEach(function (letter) {\n\t\t\ttest3[letter] = letter;\n\t\t});\n\t\tif (Object.keys(Object.assign({}, test3)).join('') !==\n\t\t\t\t'abcdefghijklmnopqrst') {\n\t\t\treturn false;\n\t\t}\n\n\t\treturn true;\n\t} catch (err) {\n\t\t// We don't expect any of the above to throw, but better to be safe.\n\t\treturn false;\n\t}\n}\n\nmodule.exports = shouldUseNative() ? Object.assign : function (target, source) {\n\tvar from;\n\tvar to = toObject(target);\n\tvar symbols;\n\n\tfor (var s = 1; s < arguments.length; s++) {\n\t\tfrom = Object(arguments[s]);\n\n\t\tfor (var key in from) {\n\t\t\tif (hasOwnProperty.call(from, key)) {\n\t\t\t\tto[key] = from[key];\n\t\t\t}\n\t\t}\n\n\t\tif (getOwnPropertySymbols) {\n\t\t\tsymbols = getOwnPropertySymbols(from);\n\t\t\tfor (var i = 0; i < symbols.length; i++) {\n\t\t\t\tif (propIsEnumerable.call(from, symbols[i])) {\n\t\t\t\t\tto[symbols[i]] = from[symbols[i]];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\treturn to;\n};\n","'use strict';\n\nmodule.exports = Pbf;\n\nvar ieee754 = require('ieee754');\n\nfunction Pbf(buf) {\n    this.buf = ArrayBuffer.isView && ArrayBuffer.isView(buf) ? buf : new Uint8Array(buf || 0);\n    this.pos = 0;\n    this.type = 0;\n    this.length = this.buf.length;\n}\n\nPbf.Varint  = 0; // varint: int32, int64, uint32, uint64, sint32, sint64, bool, enum\nPbf.Fixed64 = 1; // 64-bit: double, fixed64, sfixed64\nPbf.Bytes   = 2; // length-delimited: string, bytes, embedded messages, packed repeated fields\nPbf.Fixed32 = 5; // 32-bit: float, fixed32, sfixed32\n\nvar SHIFT_LEFT_32 = (1 << 16) * (1 << 16),\n    SHIFT_RIGHT_32 = 1 / SHIFT_LEFT_32;\n\nPbf.prototype = {\n\n    destroy: function() {\n        this.buf = null;\n    },\n\n    // === READING =================================================================\n\n    readFields: function(readField, result, end) {\n        end = end || this.length;\n\n        while (this.pos < end) {\n            var val = this.readVarint(),\n                tag = val >> 3,\n                startPos = this.pos;\n\n            this.type = val & 0x7;\n            readField(tag, result, this);\n\n            if (this.pos === startPos) this.skip(val);\n        }\n        return result;\n    },\n\n    readMessage: function(readField, result) {\n        return this.readFields(readField, result, this.readVarint() + this.pos);\n    },\n\n    readFixed32: function() {\n        var val = readUInt32(this.buf, this.pos);\n        this.pos += 4;\n        return val;\n    },\n\n    readSFixed32: function() {\n        var val = readInt32(this.buf, this.pos);\n        this.pos += 4;\n        return val;\n    },\n\n    // 64-bit int handling is based on github.com/dpw/node-buffer-more-ints (MIT-licensed)\n\n    readFixed64: function() {\n        var val = readUInt32(this.buf, this.pos) + readUInt32(this.buf, this.pos + 4) * SHIFT_LEFT_32;\n        this.pos += 8;\n        return val;\n    },\n\n    readSFixed64: function() {\n        var val = readUInt32(this.buf, this.pos) + readInt32(this.buf, this.pos + 4) * SHIFT_LEFT_32;\n        this.pos += 8;\n        return val;\n    },\n\n    readFloat: function() {\n        var val = ieee754.read(this.buf, this.pos, true, 23, 4);\n        this.pos += 4;\n        return val;\n    },\n\n    readDouble: function() {\n        var val = ieee754.read(this.buf, this.pos, true, 52, 8);\n        this.pos += 8;\n        return val;\n    },\n\n    readVarint: function(isSigned) {\n        var buf = this.buf,\n            val, b;\n\n        b = buf[this.pos++]; val  =  b & 0x7f;        if (b < 0x80) return val;\n        b = buf[this.pos++]; val |= (b & 0x7f) << 7;  if (b < 0x80) return val;\n        b = buf[this.pos++]; val |= (b & 0x7f) << 14; if (b < 0x80) return val;\n        b = buf[this.pos++]; val |= (b & 0x7f) << 21; if (b < 0x80) return val;\n        b = buf[this.pos];   val |= (b & 0x0f) << 28;\n\n        return readVarintRemainder(val, isSigned, this);\n    },\n\n    readVarint64: function() { // for compatibility with v2.0.1\n        return this.readVarint(true);\n    },\n\n    readSVarint: function() {\n        var num = this.readVarint();\n        return num % 2 === 1 ? (num + 1) / -2 : num / 2; // zigzag encoding\n    },\n\n    readBoolean: function() {\n        return Boolean(this.readVarint());\n    },\n\n    readString: function() {\n        var end = this.readVarint() + this.pos,\n            str = readUtf8(this.buf, this.pos, end);\n        this.pos = end;\n        return str;\n    },\n\n    readBytes: function() {\n        var end = this.readVarint() + this.pos,\n            buffer = this.buf.subarray(this.pos, end);\n        this.pos = end;\n        return buffer;\n    },\n\n    // verbose for performance reasons; doesn't affect gzipped size\n\n    readPackedVarint: function(arr, isSigned) {\n        if (this.type !== Pbf.Bytes) return arr.push(this.readVarint(isSigned));\n        var end = readPackedEnd(this);\n        arr = arr || [];\n        while (this.pos < end) arr.push(this.readVarint(isSigned));\n        return arr;\n    },\n    readPackedSVarint: function(arr) {\n        if (this.type !== Pbf.Bytes) return arr.push(this.readSVarint());\n        var end = readPackedEnd(this);\n        arr = arr || [];\n        while (this.pos < end) arr.push(this.readSVarint());\n        return arr;\n    },\n    readPackedBoolean: function(arr) {\n        if (this.type !== Pbf.Bytes) return arr.push(this.readBoolean());\n        var end = readPackedEnd(this);\n        arr = arr || [];\n        while (this.pos < end) arr.push(this.readBoolean());\n        return arr;\n    },\n    readPackedFloat: function(arr) {\n        if (this.type !== Pbf.Bytes) return arr.push(this.readFloat());\n        var end = readPackedEnd(this);\n        arr = arr || [];\n        while (this.pos < end) arr.push(this.readFloat());\n        return arr;\n    },\n    readPackedDouble: function(arr) {\n        if (this.type !== Pbf.Bytes) return arr.push(this.readDouble());\n        var end = readPackedEnd(this);\n        arr = arr || [];\n        while (this.pos < end) arr.push(this.readDouble());\n        return arr;\n    },\n    readPackedFixed32: function(arr) {\n        if (this.type !== Pbf.Bytes) return arr.push(this.readFixed32());\n        var end = readPackedEnd(this);\n        arr = arr || [];\n        while (this.pos < end) arr.push(this.readFixed32());\n        return arr;\n    },\n    readPackedSFixed32: function(arr) {\n        if (this.type !== Pbf.Bytes) return arr.push(this.readSFixed32());\n        var end = readPackedEnd(this);\n        arr = arr || [];\n        while (this.pos < end) arr.push(this.readSFixed32());\n        return arr;\n    },\n    readPackedFixed64: function(arr) {\n        if (this.type !== Pbf.Bytes) return arr.push(this.readFixed64());\n        var end = readPackedEnd(this);\n        arr = arr || [];\n        while (this.pos < end) arr.push(this.readFixed64());\n        return arr;\n    },\n    readPackedSFixed64: function(arr) {\n        if (this.type !== Pbf.Bytes) return arr.push(this.readSFixed64());\n        var end = readPackedEnd(this);\n        arr = arr || [];\n        while (this.pos < end) arr.push(this.readSFixed64());\n        return arr;\n    },\n\n    skip: function(val) {\n        var type = val & 0x7;\n        if (type === Pbf.Varint) while (this.buf[this.pos++] > 0x7f) {}\n        else if (type === Pbf.Bytes) this.pos = this.readVarint() + this.pos;\n        else if (type === Pbf.Fixed32) this.pos += 4;\n        else if (type === Pbf.Fixed64) this.pos += 8;\n        else throw new Error('Unimplemented type: ' + type);\n    },\n\n    // === WRITING =================================================================\n\n    writeTag: function(tag, type) {\n        this.writeVarint((tag << 3) | type);\n    },\n\n    realloc: function(min) {\n        var length = this.length || 16;\n\n        while (length < this.pos + min) length *= 2;\n\n        if (length !== this.length) {\n            var buf = new Uint8Array(length);\n            buf.set(this.buf);\n            this.buf = buf;\n            this.length = length;\n        }\n    },\n\n    finish: function() {\n        this.length = this.pos;\n        this.pos = 0;\n        return this.buf.subarray(0, this.length);\n    },\n\n    writeFixed32: function(val) {\n        this.realloc(4);\n        writeInt32(this.buf, val, this.pos);\n        this.pos += 4;\n    },\n\n    writeSFixed32: function(val) {\n        this.realloc(4);\n        writeInt32(this.buf, val, this.pos);\n        this.pos += 4;\n    },\n\n    writeFixed64: function(val) {\n        this.realloc(8);\n        writeInt32(this.buf, val & -1, this.pos);\n        writeInt32(this.buf, Math.floor(val * SHIFT_RIGHT_32), this.pos + 4);\n        this.pos += 8;\n    },\n\n    writeSFixed64: function(val) {\n        this.realloc(8);\n        writeInt32(this.buf, val & -1, this.pos);\n        writeInt32(this.buf, Math.floor(val * SHIFT_RIGHT_32), this.pos + 4);\n        this.pos += 8;\n    },\n\n    writeVarint: function(val) {\n        val = +val || 0;\n\n        if (val > 0xfffffff || val < 0) {\n            writeBigVarint(val, this);\n            return;\n        }\n\n        this.realloc(4);\n\n        this.buf[this.pos++] =           val & 0x7f  | (val > 0x7f ? 0x80 : 0); if (val <= 0x7f) return;\n        this.buf[this.pos++] = ((val >>>= 7) & 0x7f) | (val > 0x7f ? 0x80 : 0); if (val <= 0x7f) return;\n        this.buf[this.pos++] = ((val >>>= 7) & 0x7f) | (val > 0x7f ? 0x80 : 0); if (val <= 0x7f) return;\n        this.buf[this.pos++] =   (val >>> 7) & 0x7f;\n    },\n\n    writeSVarint: function(val) {\n        this.writeVarint(val < 0 ? -val * 2 - 1 : val * 2);\n    },\n\n    writeBoolean: function(val) {\n        this.writeVarint(Boolean(val));\n    },\n\n    writeString: function(str) {\n        str = String(str);\n        this.realloc(str.length * 4);\n\n        this.pos++; // reserve 1 byte for short string length\n\n        var startPos = this.pos;\n        // write the string directly to the buffer and see how much was written\n        this.pos = writeUtf8(this.buf, str, this.pos);\n        var len = this.pos - startPos;\n\n        if (len >= 0x80) makeRoomForExtraLength(startPos, len, this);\n\n        // finally, write the message length in the reserved place and restore the position\n        this.pos = startPos - 1;\n        this.writeVarint(len);\n        this.pos += len;\n    },\n\n    writeFloat: function(val) {\n        this.realloc(4);\n        ieee754.write(this.buf, val, this.pos, true, 23, 4);\n        this.pos += 4;\n    },\n\n    writeDouble: function(val) {\n        this.realloc(8);\n        ieee754.write(this.buf, val, this.pos, true, 52, 8);\n        this.pos += 8;\n    },\n\n    writeBytes: function(buffer) {\n        var len = buffer.length;\n        this.writeVarint(len);\n        this.realloc(len);\n        for (var i = 0; i < len; i++) this.buf[this.pos++] = buffer[i];\n    },\n\n    writeRawMessage: function(fn, obj) {\n        this.pos++; // reserve 1 byte for short message length\n\n        // write the message directly to the buffer and see how much was written\n        var startPos = this.pos;\n        fn(obj, this);\n        var len = this.pos - startPos;\n\n        if (len >= 0x80) makeRoomForExtraLength(startPos, len, this);\n\n        // finally, write the message length in the reserved place and restore the position\n        this.pos = startPos - 1;\n        this.writeVarint(len);\n        this.pos += len;\n    },\n\n    writeMessage: function(tag, fn, obj) {\n        this.writeTag(tag, Pbf.Bytes);\n        this.writeRawMessage(fn, obj);\n    },\n\n    writePackedVarint:   function(tag, arr) { if (arr.length) this.writeMessage(tag, writePackedVarint, arr);   },\n    writePackedSVarint:  function(tag, arr) { if (arr.length) this.writeMessage(tag, writePackedSVarint, arr);  },\n    writePackedBoolean:  function(tag, arr) { if (arr.length) this.writeMessage(tag, writePackedBoolean, arr);  },\n    writePackedFloat:    function(tag, arr) { if (arr.length) this.writeMessage(tag, writePackedFloat, arr);    },\n    writePackedDouble:   function(tag, arr) { if (arr.length) this.writeMessage(tag, writePackedDouble, arr);   },\n    writePackedFixed32:  function(tag, arr) { if (arr.length) this.writeMessage(tag, writePackedFixed32, arr);  },\n    writePackedSFixed32: function(tag, arr) { if (arr.length) this.writeMessage(tag, writePackedSFixed32, arr); },\n    writePackedFixed64:  function(tag, arr) { if (arr.length) this.writeMessage(tag, writePackedFixed64, arr);  },\n    writePackedSFixed64: function(tag, arr) { if (arr.length) this.writeMessage(tag, writePackedSFixed64, arr); },\n\n    writeBytesField: function(tag, buffer) {\n        this.writeTag(tag, Pbf.Bytes);\n        this.writeBytes(buffer);\n    },\n    writeFixed32Field: function(tag, val) {\n        this.writeTag(tag, Pbf.Fixed32);\n        this.writeFixed32(val);\n    },\n    writeSFixed32Field: function(tag, val) {\n        this.writeTag(tag, Pbf.Fixed32);\n        this.writeSFixed32(val);\n    },\n    writeFixed64Field: function(tag, val) {\n        this.writeTag(tag, Pbf.Fixed64);\n        this.writeFixed64(val);\n    },\n    writeSFixed64Field: function(tag, val) {\n        this.writeTag(tag, Pbf.Fixed64);\n        this.writeSFixed64(val);\n    },\n    writeVarintField: function(tag, val) {\n        this.writeTag(tag, Pbf.Varint);\n        this.writeVarint(val);\n    },\n    writeSVarintField: function(tag, val) {\n        this.writeTag(tag, Pbf.Varint);\n        this.writeSVarint(val);\n    },\n    writeStringField: function(tag, str) {\n        this.writeTag(tag, Pbf.Bytes);\n        this.writeString(str);\n    },\n    writeFloatField: function(tag, val) {\n        this.writeTag(tag, Pbf.Fixed32);\n        this.writeFloat(val);\n    },\n    writeDoubleField: function(tag, val) {\n        this.writeTag(tag, Pbf.Fixed64);\n        this.writeDouble(val);\n    },\n    writeBooleanField: function(tag, val) {\n        this.writeVarintField(tag, Boolean(val));\n    }\n};\n\nfunction readVarintRemainder(l, s, p) {\n    var buf = p.buf,\n        h, b;\n\n    b = buf[p.pos++]; h  = (b & 0x70) >> 4;  if (b < 0x80) return toNum(l, h, s);\n    b = buf[p.pos++]; h |= (b & 0x7f) << 3;  if (b < 0x80) return toNum(l, h, s);\n    b = buf[p.pos++]; h |= (b & 0x7f) << 10; if (b < 0x80) return toNum(l, h, s);\n    b = buf[p.pos++]; h |= (b & 0x7f) << 17; if (b < 0x80) return toNum(l, h, s);\n    b = buf[p.pos++]; h |= (b & 0x7f) << 24; if (b < 0x80) return toNum(l, h, s);\n    b = buf[p.pos++]; h |= (b & 0x01) << 31; if (b < 0x80) return toNum(l, h, s);\n\n    throw new Error('Expected varint not more than 10 bytes');\n}\n\nfunction readPackedEnd(pbf) {\n    return pbf.type === Pbf.Bytes ?\n        pbf.readVarint() + pbf.pos : pbf.pos + 1;\n}\n\nfunction toNum(low, high, isSigned) {\n    if (isSigned) {\n        return high * 0x100000000 + (low >>> 0);\n    }\n\n    return ((high >>> 0) * 0x100000000) + (low >>> 0);\n}\n\nfunction writeBigVarint(val, pbf) {\n    var low, high;\n\n    if (val >= 0) {\n        low  = (val % 0x100000000) | 0;\n        high = (val / 0x100000000) | 0;\n    } else {\n        low  = ~(-val % 0x100000000);\n        high = ~(-val / 0x100000000);\n\n        if (low ^ 0xffffffff) {\n            low = (low + 1) | 0;\n        } else {\n            low = 0;\n            high = (high + 1) | 0;\n        }\n    }\n\n    if (val >= 0x10000000000000000 || val < -0x10000000000000000) {\n        throw new Error('Given varint doesn\\'t fit into 10 bytes');\n    }\n\n    pbf.realloc(10);\n\n    writeBigVarintLow(low, high, pbf);\n    writeBigVarintHigh(high, pbf);\n}\n\nfunction writeBigVarintLow(low, high, pbf) {\n    pbf.buf[pbf.pos++] = low & 0x7f | 0x80; low >>>= 7;\n    pbf.buf[pbf.pos++] = low & 0x7f | 0x80; low >>>= 7;\n    pbf.buf[pbf.pos++] = low & 0x7f | 0x80; low >>>= 7;\n    pbf.buf[pbf.pos++] = low & 0x7f | 0x80; low >>>= 7;\n    pbf.buf[pbf.pos]   = low & 0x7f;\n}\n\nfunction writeBigVarintHigh(high, pbf) {\n    var lsb = (high & 0x07) << 4;\n\n    pbf.buf[pbf.pos++] |= lsb         | ((high >>>= 3) ? 0x80 : 0); if (!high) return;\n    pbf.buf[pbf.pos++]  = high & 0x7f | ((high >>>= 7) ? 0x80 : 0); if (!high) return;\n    pbf.buf[pbf.pos++]  = high & 0x7f | ((high >>>= 7) ? 0x80 : 0); if (!high) return;\n    pbf.buf[pbf.pos++]  = high & 0x7f | ((high >>>= 7) ? 0x80 : 0); if (!high) return;\n    pbf.buf[pbf.pos++]  = high & 0x7f | ((high >>>= 7) ? 0x80 : 0); if (!high) return;\n    pbf.buf[pbf.pos++]  = high & 0x7f;\n}\n\nfunction makeRoomForExtraLength(startPos, len, pbf) {\n    var extraLen =\n        len <= 0x3fff ? 1 :\n        len <= 0x1fffff ? 2 :\n        len <= 0xfffffff ? 3 : Math.floor(Math.log(len) / (Math.LN2 * 7));\n\n    // if 1 byte isn't enough for encoding message length, shift the data to the right\n    pbf.realloc(extraLen);\n    for (var i = pbf.pos - 1; i >= startPos; i--) pbf.buf[i + extraLen] = pbf.buf[i];\n}\n\nfunction writePackedVarint(arr, pbf)   { for (var i = 0; i < arr.length; i++) pbf.writeVarint(arr[i]);   }\nfunction writePackedSVarint(arr, pbf)  { for (var i = 0; i < arr.length; i++) pbf.writeSVarint(arr[i]);  }\nfunction writePackedFloat(arr, pbf)    { for (var i = 0; i < arr.length; i++) pbf.writeFloat(arr[i]);    }\nfunction writePackedDouble(arr, pbf)   { for (var i = 0; i < arr.length; i++) pbf.writeDouble(arr[i]);   }\nfunction writePackedBoolean(arr, pbf)  { for (var i = 0; i < arr.length; i++) pbf.writeBoolean(arr[i]);  }\nfunction writePackedFixed32(arr, pbf)  { for (var i = 0; i < arr.length; i++) pbf.writeFixed32(arr[i]);  }\nfunction writePackedSFixed32(arr, pbf) { for (var i = 0; i < arr.length; i++) pbf.writeSFixed32(arr[i]); }\nfunction writePackedFixed64(arr, pbf)  { for (var i = 0; i < arr.length; i++) pbf.writeFixed64(arr[i]);  }\nfunction writePackedSFixed64(arr, pbf) { for (var i = 0; i < arr.length; i++) pbf.writeSFixed64(arr[i]); }\n\n// Buffer code below from https://github.com/feross/buffer, MIT-licensed\n\nfunction readUInt32(buf, pos) {\n    return ((buf[pos]) |\n        (buf[pos + 1] << 8) |\n        (buf[pos + 2] << 16)) +\n        (buf[pos + 3] * 0x1000000);\n}\n\nfunction writeInt32(buf, val, pos) {\n    buf[pos] = val;\n    buf[pos + 1] = (val >>> 8);\n    buf[pos + 2] = (val >>> 16);\n    buf[pos + 3] = (val >>> 24);\n}\n\nfunction readInt32(buf, pos) {\n    return ((buf[pos]) |\n        (buf[pos + 1] << 8) |\n        (buf[pos + 2] << 16)) +\n        (buf[pos + 3] << 24);\n}\n\nfunction readUtf8(buf, pos, end) {\n    var str = '';\n    var i = pos;\n\n    while (i < end) {\n        var b0 = buf[i];\n        var c = null; // codepoint\n        var bytesPerSequence =\n            b0 > 0xEF ? 4 :\n            b0 > 0xDF ? 3 :\n            b0 > 0xBF ? 2 : 1;\n\n        if (i + bytesPerSequence > end) break;\n\n        var b1, b2, b3;\n\n        if (bytesPerSequence === 1) {\n            if (b0 < 0x80) {\n                c = b0;\n            }\n        } else if (bytesPerSequence === 2) {\n            b1 = buf[i + 1];\n            if ((b1 & 0xC0) === 0x80) {\n                c = (b0 & 0x1F) << 0x6 | (b1 & 0x3F);\n                if (c <= 0x7F) {\n                    c = null;\n                }\n            }\n        } else if (bytesPerSequence === 3) {\n            b1 = buf[i + 1];\n            b2 = buf[i + 2];\n            if ((b1 & 0xC0) === 0x80 && (b2 & 0xC0) === 0x80) {\n                c = (b0 & 0xF) << 0xC | (b1 & 0x3F) << 0x6 | (b2 & 0x3F);\n                if (c <= 0x7FF || (c >= 0xD800 && c <= 0xDFFF)) {\n                    c = null;\n                }\n            }\n        } else if (bytesPerSequence === 4) {\n            b1 = buf[i + 1];\n            b2 = buf[i + 2];\n            b3 = buf[i + 3];\n            if ((b1 & 0xC0) === 0x80 && (b2 & 0xC0) === 0x80 && (b3 & 0xC0) === 0x80) {\n                c = (b0 & 0xF) << 0x12 | (b1 & 0x3F) << 0xC | (b2 & 0x3F) << 0x6 | (b3 & 0x3F);\n                if (c <= 0xFFFF || c >= 0x110000) {\n                    c = null;\n                }\n            }\n        }\n\n        if (c === null) {\n            c = 0xFFFD;\n            bytesPerSequence = 1;\n\n        } else if (c > 0xFFFF) {\n            c -= 0x10000;\n            str += String.fromCharCode(c >>> 10 & 0x3FF | 0xD800);\n            c = 0xDC00 | c & 0x3FF;\n        }\n\n        str += String.fromCharCode(c);\n        i += bytesPerSequence;\n    }\n\n    return str;\n}\n\nfunction writeUtf8(buf, str, pos) {\n    for (var i = 0, c, lead; i < str.length; i++) {\n        c = str.charCodeAt(i); // code point\n\n        if (c > 0xD7FF && c < 0xE000) {\n            if (lead) {\n                if (c < 0xDC00) {\n                    buf[pos++] = 0xEF;\n                    buf[pos++] = 0xBF;\n                    buf[pos++] = 0xBD;\n                    lead = c;\n                    continue;\n                } else {\n                    c = lead - 0xD800 << 10 | c - 0xDC00 | 0x10000;\n                    lead = null;\n                }\n            } else {\n                if (c > 0xDBFF || (i + 1 === str.length)) {\n                    buf[pos++] = 0xEF;\n                    buf[pos++] = 0xBF;\n                    buf[pos++] = 0xBD;\n                } else {\n                    lead = c;\n                }\n                continue;\n            }\n        } else if (lead) {\n            buf[pos++] = 0xEF;\n            buf[pos++] = 0xBF;\n            buf[pos++] = 0xBD;\n            lead = null;\n        }\n\n        if (c < 0x80) {\n            buf[pos++] = c;\n        } else {\n            if (c < 0x800) {\n                buf[pos++] = c >> 0x6 | 0xC0;\n            } else {\n                if (c < 0x10000) {\n                    buf[pos++] = c >> 0xC | 0xE0;\n                } else {\n                    buf[pos++] = c >> 0x12 | 0xF0;\n                    buf[pos++] = c >> 0xC & 0x3F | 0x80;\n                }\n                buf[pos++] = c >> 0x6 & 0x3F | 0x80;\n            }\n            buf[pos++] = c & 0x3F | 0x80;\n        }\n    }\n    return pos;\n}\n","(function (global, factory) {\n\ttypeof exports === 'object' && typeof module !== 'undefined' ? module.exports = factory() :\n\ttypeof define === 'function' && define.amd ? define(factory) :\n\t(global.quickselect = factory());\n}(this, (function () { 'use strict';\n\nfunction quickselect(arr, k, left, right, compare) {\n    quickselectStep(arr, k, left || 0, right || (arr.length - 1), compare || defaultCompare);\n}\n\nfunction quickselectStep(arr, k, left, right, compare) {\n\n    while (right > left) {\n        if (right - left > 600) {\n            var n = right - left + 1;\n            var m = k - left + 1;\n            var z = Math.log(n);\n            var s = 0.5 * Math.exp(2 * z / 3);\n            var sd = 0.5 * Math.sqrt(z * s * (n - s) / n) * (m - n / 2 < 0 ? -1 : 1);\n            var newLeft = Math.max(left, Math.floor(k - m * s / n + sd));\n            var newRight = Math.min(right, Math.floor(k + (n - m) * s / n + sd));\n            quickselectStep(arr, k, newLeft, newRight, compare);\n        }\n\n        var t = arr[k];\n        var i = left;\n        var j = right;\n\n        swap(arr, left, k);\n        if (compare(arr[right], t) > 0) swap(arr, left, right);\n\n        while (i < j) {\n            swap(arr, i, j);\n            i++;\n            j--;\n            while (compare(arr[i], t) < 0) i++;\n            while (compare(arr[j], t) > 0) j--;\n        }\n\n        if (compare(arr[left], t) === 0) swap(arr, left, j);\n        else {\n            j++;\n            swap(arr, j, right);\n        }\n\n        if (j <= k) left = j + 1;\n        if (k <= j) right = j - 1;\n    }\n}\n\nfunction swap(arr, i, j) {\n    var tmp = arr[i];\n    arr[i] = arr[j];\n    arr[j] = tmp;\n}\n\nfunction defaultCompare(a, b) {\n    return a < b ? -1 : a > b ? 1 : 0;\n}\n\nreturn quickselect;\n\n})));\n","'use strict';\n\nvar kdbush = require('kdbush');\n\nmodule.exports = supercluster;\n\nfunction supercluster(options) {\n    return new SuperCluster(options);\n}\n\nfunction SuperCluster(options) {\n    this.options = extend(Object.create(this.options), options);\n    this.trees = new Array(this.options.maxZoom + 1);\n}\n\nSuperCluster.prototype = {\n    options: {\n        minZoom: 0,   // min zoom to generate clusters on\n        maxZoom: 16,  // max zoom level to cluster the points on\n        radius: 40,   // cluster radius in pixels\n        extent: 512,  // tile extent (radius is calculated relative to it)\n        nodeSize: 64, // size of the KD-tree leaf node, affects performance\n        log: false,   // whether to log timing info\n\n        // a reduce function for calculating custom cluster properties\n        reduce: null, // function (accumulated, props) { accumulated.sum += props.sum; }\n\n        // initial properties of a cluster (before running the reducer)\n        initial: function () { return {}; }, // function () { return {sum: 0}; },\n\n        // properties to use for individual points when running the reducer\n        map: function (props) { return props; } // function (props) { return {sum: props.my_value}; },\n    },\n\n    load: function (points) {\n        var log = this.options.log;\n\n        if (log) console.time('total time');\n\n        var timerId = 'prepare ' + points.length + ' points';\n        if (log) console.time(timerId);\n\n        this.points = points;\n\n        // generate a cluster object for each point\n        var clusters = points.map(createPointCluster);\n        if (log) console.timeEnd(timerId);\n\n        // cluster points on max zoom, then cluster the results on previous zoom, etc.;\n        // results in a cluster hierarchy across zoom levels\n        for (var z = this.options.maxZoom; z >= this.options.minZoom; z--) {\n            var now = +Date.now();\n\n            // index input points into a KD-tree\n            this.trees[z + 1] = kdbush(clusters, getX, getY, this.options.nodeSize, Float32Array);\n\n            clusters = this._cluster(clusters, z); // create a new set of clusters for the zoom\n\n            if (log) console.log('z%d: %d clusters in %dms', z, clusters.length, +Date.now() - now);\n        }\n\n        // index top-level clusters\n        this.trees[this.options.minZoom] = kdbush(clusters, getX, getY, this.options.nodeSize, Float32Array);\n\n        if (log) console.timeEnd('total time');\n\n        return this;\n    },\n\n    getClusters: function (bbox, zoom) {\n        var tree = this.trees[this._limitZoom(zoom)];\n        var ids = tree.range(lngX(bbox[0]), latY(bbox[3]), lngX(bbox[2]), latY(bbox[1]));\n        var clusters = [];\n        for (var i = 0; i < ids.length; i++) {\n            var c = tree.points[ids[i]];\n            clusters.push(c.numPoints ? getClusterJSON(c) : this.points[c.id]);\n        }\n        return clusters;\n    },\n\n    getChildren: function (clusterId, clusterZoom) {\n        var origin = this.trees[clusterZoom + 1].points[clusterId];\n        var r = this.options.radius / (this.options.extent * Math.pow(2, clusterZoom));\n        var points = this.trees[clusterZoom + 1].within(origin.x, origin.y, r);\n        var children = [];\n        for (var i = 0; i < points.length; i++) {\n            var c = this.trees[clusterZoom + 1].points[points[i]];\n            if (c.parentId === clusterId) {\n                children.push(c.numPoints ? getClusterJSON(c) : this.points[c.id]);\n            }\n        }\n        return children;\n    },\n\n    getLeaves: function (clusterId, clusterZoom, limit, offset) {\n        limit = limit || 10;\n        offset = offset || 0;\n\n        var leaves = [];\n        this._appendLeaves(leaves, clusterId, clusterZoom, limit, offset, 0);\n\n        return leaves;\n    },\n\n    getTile: function (z, x, y) {\n        var tree = this.trees[this._limitZoom(z)];\n        var z2 = Math.pow(2, z);\n        var extent = this.options.extent;\n        var r = this.options.radius;\n        var p = r / extent;\n        var top = (y - p) / z2;\n        var bottom = (y + 1 + p) / z2;\n\n        var tile = {\n            features: []\n        };\n\n        this._addTileFeatures(\n            tree.range((x - p) / z2, top, (x + 1 + p) / z2, bottom),\n            tree.points, x, y, z2, tile);\n\n        if (x === 0) {\n            this._addTileFeatures(\n                tree.range(1 - p / z2, top, 1, bottom),\n                tree.points, z2, y, z2, tile);\n        }\n        if (x === z2 - 1) {\n            this._addTileFeatures(\n                tree.range(0, top, p / z2, bottom),\n                tree.points, -1, y, z2, tile);\n        }\n\n        return tile.features.length ? tile : null;\n    },\n\n    getClusterExpansionZoom: function (clusterId, clusterZoom) {\n        while (clusterZoom < this.options.maxZoom) {\n            var children = this.getChildren(clusterId, clusterZoom);\n            clusterZoom++;\n            if (children.length !== 1) break;\n            clusterId = children[0].properties.cluster_id;\n        }\n        return clusterZoom;\n    },\n\n    _appendLeaves: function (result, clusterId, clusterZoom, limit, offset, skipped) {\n        var children = this.getChildren(clusterId, clusterZoom);\n\n        for (var i = 0; i < children.length; i++) {\n            var props = children[i].properties;\n\n            if (props.cluster) {\n                if (skipped + props.point_count <= offset) {\n                    // skip the whole cluster\n                    skipped += props.point_count;\n                } else {\n                    // enter the cluster\n                    skipped = this._appendLeaves(\n                        result, props.cluster_id, clusterZoom + 1, limit, offset, skipped);\n                    // exit the cluster\n                }\n            } else if (skipped < offset) {\n                // skip a single point\n                skipped++;\n            } else {\n                // add a single point\n                result.push(children[i]);\n            }\n            if (result.length === limit) break;\n        }\n\n        return skipped;\n    },\n\n    _addTileFeatures: function (ids, points, x, y, z2, tile) {\n        for (var i = 0; i < ids.length; i++) {\n            var c = points[ids[i]];\n            tile.features.push({\n                type: 1,\n                geometry: [[\n                    Math.round(this.options.extent * (c.x * z2 - x)),\n                    Math.round(this.options.extent * (c.y * z2 - y))\n                ]],\n                tags: c.numPoints ? getClusterProperties(c) : this.points[c.id].properties\n            });\n        }\n    },\n\n    _limitZoom: function (z) {\n        return Math.max(this.options.minZoom, Math.min(z, this.options.maxZoom + 1));\n    },\n\n    _cluster: function (points, zoom) {\n        var clusters = [];\n        var r = this.options.radius / (this.options.extent * Math.pow(2, zoom));\n\n        // loop through each point\n        for (var i = 0; i < points.length; i++) {\n            var p = points[i];\n            // if we've already visited the point at this zoom level, skip it\n            if (p.zoom <= zoom) continue;\n            p.zoom = zoom;\n\n            // find all nearby points\n            var tree = this.trees[zoom + 1];\n            var neighborIds = tree.within(p.x, p.y, r);\n\n            var numPoints = p.numPoints || 1;\n            var wx = p.x * numPoints;\n            var wy = p.y * numPoints;\n\n            var clusterProperties = null;\n\n            if (this.options.reduce) {\n                clusterProperties = this.options.initial();\n                this._accumulate(clusterProperties, p);\n            }\n\n            for (var j = 0; j < neighborIds.length; j++) {\n                var b = tree.points[neighborIds[j]];\n                // filter out neighbors that are too far or already processed\n                if (zoom < b.zoom) {\n                    var numPoints2 = b.numPoints || 1;\n                    b.zoom = zoom; // save the zoom (so it doesn't get processed twice)\n                    wx += b.x * numPoints2; // accumulate coordinates for calculating weighted center\n                    wy += b.y * numPoints2;\n                    numPoints += numPoints2;\n                    b.parentId = i;\n\n                    if (this.options.reduce) {\n                        this._accumulate(clusterProperties, b);\n                    }\n                }\n            }\n\n            if (numPoints === 1) {\n                clusters.push(p);\n            } else {\n                p.parentId = i;\n                clusters.push(createCluster(wx / numPoints, wy / numPoints, numPoints, i, clusterProperties));\n            }\n        }\n\n        return clusters;\n    },\n\n    _accumulate: function (clusterProperties, point) {\n        var properties = point.numPoints ?\n            point.properties :\n            this.options.map(this.points[point.id].properties);\n\n        this.options.reduce(clusterProperties, properties);\n    }\n};\n\nfunction createCluster(x, y, numPoints, id, properties) {\n    return {\n        x: x, // weighted cluster center\n        y: y,\n        zoom: Infinity, // the last zoom the cluster was processed at\n        id: id, // index of the first child of the cluster in the zoom level tree\n        properties: properties,\n        parentId: -1, // parent cluster id\n        numPoints: numPoints\n    };\n}\n\nfunction createPointCluster(p, id) {\n    var coords = p.geometry.coordinates;\n    return {\n        x: lngX(coords[0]), // projected point coordinates\n        y: latY(coords[1]),\n        zoom: Infinity, // the last zoom the point was processed at\n        id: id, // index of the source feature in the original input array\n        parentId: -1 // parent cluster id\n    };\n}\n\nfunction getClusterJSON(cluster) {\n    return {\n        type: 'Feature',\n        properties: getClusterProperties(cluster),\n        geometry: {\n            type: 'Point',\n            coordinates: [xLng(cluster.x), yLat(cluster.y)]\n        }\n    };\n}\n\nfunction getClusterProperties(cluster) {\n    var count = cluster.numPoints;\n    var abbrev = count >= 10000 ? Math.round(count / 1000) + 'k' :\n                 count >= 1000 ? (Math.round(count / 100) / 10) + 'k' : count;\n    return extend(extend({}, cluster.properties), {\n        cluster: true,\n        cluster_id: cluster.id,\n        point_count: count,\n        point_count_abbreviated: abbrev\n    });\n}\n\n// longitude/latitude to spherical mercator in [0..1] range\nfunction lngX(lng) {\n    return lng / 360 + 0.5;\n}\nfunction latY(lat) {\n    var sin = Math.sin(lat * Math.PI / 180),\n        y = (0.5 - 0.25 * Math.log((1 + sin) / (1 - sin)) / Math.PI);\n    return y < 0 ? 0 :\n           y > 1 ? 1 : y;\n}\n\n// spherical mercator to longitude/latitude\nfunction xLng(x) {\n    return (x - 0.5) * 360;\n}\nfunction yLat(y) {\n    var y2 = (180 - y * 360) * Math.PI / 180;\n    return 360 * Math.atan(Math.exp(y2)) / Math.PI - 90;\n}\n\nfunction extend(dest, src) {\n    for (var id in src) dest[id] = src[id];\n    return dest;\n}\n\nfunction getX(p) {\n    return p.x;\n}\nfunction getY(p) {\n    return p.y;\n}\n","'use strict';\n\nmodule.exports = TinyQueue;\nmodule.exports.default = TinyQueue;\n\nfunction TinyQueue(data, compare) {\n    if (!(this instanceof TinyQueue)) return new TinyQueue(data, compare);\n\n    this.data = data || [];\n    this.length = this.data.length;\n    this.compare = compare || defaultCompare;\n\n    if (this.length > 0) {\n        for (var i = (this.length >> 1) - 1; i >= 0; i--) this._down(i);\n    }\n}\n\nfunction defaultCompare(a, b) {\n    return a < b ? -1 : a > b ? 1 : 0;\n}\n\nTinyQueue.prototype = {\n\n    push: function (item) {\n        this.data.push(item);\n        this.length++;\n        this._up(this.length - 1);\n    },\n\n    pop: function () {\n        if (this.length === 0) return undefined;\n\n        var top = this.data[0];\n        this.length--;\n\n        if (this.length > 0) {\n            this.data[0] = this.data[this.length];\n            this._down(0);\n        }\n        this.data.pop();\n\n        return top;\n    },\n\n    peek: function () {\n        return this.data[0];\n    },\n\n    _up: function (pos) {\n        var data = this.data;\n        var compare = this.compare;\n        var item = data[pos];\n\n        while (pos > 0) {\n            var parent = (pos - 1) >> 1;\n            var current = data[parent];\n            if (compare(item, current) >= 0) break;\n            data[pos] = current;\n            pos = parent;\n        }\n\n        data[pos] = item;\n    },\n\n    _down: function (pos) {\n        var data = this.data;\n        var compare = this.compare;\n        var halfLength = this.length >> 1;\n        var item = data[pos];\n\n        while (pos < halfLength) {\n            var left = (pos << 1) + 1;\n            var right = left + 1;\n            var best = data[left];\n\n            if (right < this.length && compare(data[right], best) < 0) {\n                left = right;\n                best = data[right];\n            }\n            if (compare(best, item) >= 0) break;\n\n            data[pos] = best;\n            pos = left;\n        }\n\n        data[pos] = item;\n    }\n};\n","var Pbf = require('pbf')\nvar GeoJSONWrapper = require('./lib/geojson_wrapper')\n\nmodule.exports = fromVectorTileJs\nmodule.exports.fromVectorTileJs = fromVectorTileJs\nmodule.exports.fromGeojsonVt = fromGeojsonVt\nmodule.exports.GeoJSONWrapper = GeoJSONWrapper\n\n/**\n * Serialize a vector-tile-js-created tile to pbf\n *\n * @param {Object} tile\n * @return {Buffer} uncompressed, pbf-serialized tile data\n */\nfunction fromVectorTileJs (tile) {\n  var out = new Pbf()\n  writeTile(tile, out)\n  return out.finish()\n}\n\n/**\n * Serialized a geojson-vt-created tile to pbf.\n *\n * @param {Object} layers - An object mapping layer names to geojson-vt-created vector tile objects\n * @param {Object} [options] - An object specifying the vector-tile specification version and extent that were used to create `layers`.\n * @param {Number} [options.version=1] - Version of vector-tile spec used\n * @param {Number} [options.extent=4096] - Extent of the vector tile\n * @return {Buffer} uncompressed, pbf-serialized tile data\n */\nfunction fromGeojsonVt (layers, options) {\n  options = options || {}\n  var l = {}\n  for (var k in layers) {\n    l[k] = new GeoJSONWrapper(layers[k].features, options)\n    l[k].name = k\n    l[k].version = options.version\n    l[k].extent = options.extent\n  }\n  return fromVectorTileJs({layers: l})\n}\n\nfunction writeTile (tile, pbf) {\n  for (var key in tile.layers) {\n    pbf.writeMessage(3, writeLayer, tile.layers[key])\n  }\n}\n\nfunction writeLayer (layer, pbf) {\n  pbf.writeVarintField(15, layer.version || 1)\n  pbf.writeStringField(1, layer.name || '')\n  pbf.writeVarintField(5, layer.extent || 4096)\n\n  var i\n  var context = {\n    keys: [],\n    values: [],\n    keycache: {},\n    valuecache: {}\n  }\n\n  for (i = 0; i < layer.length; i++) {\n    context.feature = layer.feature(i)\n    pbf.writeMessage(2, writeFeature, context)\n  }\n\n  var keys = context.keys\n  for (i = 0; i < keys.length; i++) {\n    pbf.writeStringField(3, keys[i])\n  }\n\n  var values = context.values\n  for (i = 0; i < values.length; i++) {\n    pbf.writeMessage(4, writeValue, values[i])\n  }\n}\n\nfunction writeFeature (context, pbf) {\n  var feature = context.feature\n\n  if (feature.id !== undefined) {\n    pbf.writeVarintField(1, feature.id)\n  }\n\n  pbf.writeMessage(2, writeProperties, context)\n  pbf.writeVarintField(3, feature.type)\n  pbf.writeMessage(4, writeGeometry, feature)\n}\n\nfunction writeProperties (context, pbf) {\n  var feature = context.feature\n  var keys = context.keys\n  var values = context.values\n  var keycache = context.keycache\n  var valuecache = context.valuecache\n\n  for (var key in feature.properties) {\n    var keyIndex = keycache[key]\n    if (typeof keyIndex === 'undefined') {\n      keys.push(key)\n      keyIndex = keys.length - 1\n      keycache[key] = keyIndex\n    }\n    pbf.writeVarint(keyIndex)\n\n    var value = feature.properties[key]\n    var type = typeof value\n    if (type !== 'string' && type !== 'boolean' && type !== 'number') {\n      value = JSON.stringify(value)\n    }\n    var valueKey = type + ':' + value\n    var valueIndex = valuecache[valueKey]\n    if (typeof valueIndex === 'undefined') {\n      values.push(value)\n      valueIndex = values.length - 1\n      valuecache[valueKey] = valueIndex\n    }\n    pbf.writeVarint(valueIndex)\n  }\n}\n\nfunction command (cmd, length) {\n  return (length << 3) + (cmd & 0x7)\n}\n\nfunction zigzag (num) {\n  return (num << 1) ^ (num >> 31)\n}\n\nfunction writeGeometry (feature, pbf) {\n  var geometry = feature.loadGeometry()\n  var type = feature.type\n  var x = 0\n  var y = 0\n  var rings = geometry.length\n  for (var r = 0; r < rings; r++) {\n    var ring = geometry[r]\n    var count = 1\n    if (type === 1) {\n      count = ring.length\n    }\n    pbf.writeVarint(command(1, count)) // moveto\n    // do not write polygon closing path as lineto\n    var lineCount = type === 3 ? ring.length - 1 : ring.length\n    for (var i = 0; i < lineCount; i++) {\n      if (i === 1 && type !== 1) {\n        pbf.writeVarint(command(2, lineCount - 1)) // lineto\n      }\n      var dx = ring[i].x - x\n      var dy = ring[i].y - y\n      pbf.writeVarint(zigzag(dx))\n      pbf.writeVarint(zigzag(dy))\n      x += dx\n      y += dy\n    }\n    if (type === 3) {\n      pbf.writeVarint(command(7, 1)) // closepath\n    }\n  }\n}\n\nfunction writeValue (value, pbf) {\n  var type = typeof value\n  if (type === 'string') {\n    pbf.writeStringField(1, value)\n  } else if (type === 'boolean') {\n    pbf.writeBooleanField(7, value)\n  } else if (type === 'number') {\n    if (value % 1 !== 0) {\n      pbf.writeDoubleField(3, value)\n    } else if (value < 0) {\n      pbf.writeSVarintField(6, value)\n    } else {\n      pbf.writeVarintField(5, value)\n    }\n  }\n}\n","'use strict'\n\nvar Point = require('@mapbox/point-geometry')\nvar VectorTileFeature = require('@mapbox/vector-tile').VectorTileFeature\n\nmodule.exports = GeoJSONWrapper\n\n// conform to vectortile api\nfunction GeoJSONWrapper (features, options) {\n  this.options = options || {}\n  this.features = features\n  this.length = features.length\n}\n\nGeoJSONWrapper.prototype.feature = function (i) {\n  return new FeatureWrapper(this.features[i], this.options.extent)\n}\n\nfunction FeatureWrapper (feature, extent) {\n  this.id = typeof feature.id === 'number' ? feature.id : undefined\n  this.type = feature.type\n  this.rawGeometry = feature.type === 1 ? [feature.geometry] : feature.geometry\n  this.properties = feature.tags\n  this.extent = extent || 4096\n}\n\nFeatureWrapper.prototype.loadGeometry = function () {\n  var rings = this.rawGeometry\n  this.geometry = []\n\n  for (var i = 0; i < rings.length; i++) {\n    var ring = rings[i]\n    var newRing = []\n    for (var j = 0; j < ring.length; j++) {\n      newRing.push(new Point(ring[j][0], ring[j][1]))\n    }\n    this.geometry.push(newRing)\n  }\n  return this.geometry\n}\n\nFeatureWrapper.prototype.bbox = function () {\n  if (!this.geometry) this.loadGeometry()\n\n  var rings = this.geometry\n  var x1 = Infinity\n  var x2 = -Infinity\n  var y1 = Infinity\n  var y2 = -Infinity\n\n  for (var i = 0; i < rings.length; i++) {\n    var ring = rings[i]\n\n    for (var j = 0; j < ring.length; j++) {\n      var coord = ring[j]\n\n      x1 = Math.min(x1, coord.x)\n      x2 = Math.max(x2, coord.x)\n      y1 = Math.min(y1, coord.y)\n      y2 = Math.max(y2, coord.y)\n    }\n  }\n\n  return [x1, y1, x2, y2]\n}\n\nFeatureWrapper.prototype.toGeoJSON = VectorTileFeature.prototype.toGeoJSON\n","module.exports.RADIUS = 6378137;\nmodule.exports.FLATTENING = 1/298.257223563;\nmodule.exports.POLAR_RADIUS = 6356752.3142;\n","export { getURL, getTileBBox, getMercCoords };\n\n\n/**\n * getURL\n *\n * @param    {String}  baseUrl  Base url of the WMS server\n * @param    {String}  layer    Layer name\n * @param    {Number}  x        Tile coordinate x\n * @param    {Number}  y        Tile coordinate y\n * @param    {Number}  z        Tile zoom\n * @param    {Object}  [options]\n * @param    {String}  [options.format='image/png']\n * @param    {String}  [options.service='WMS']\n * @param    {String}  [options.version='1.1.1']\n * @param    {String}  [options.request='GetMap']\n * @param    {String}  [options.srs='EPSG:3857']\n * @param    {Number}  [options.width='256']\n * @param    {Number}  [options.height='256']\n * @returns  {String}  url\n * @example\n * var baseUrl = 'http://geodata.state.nj.us/imagerywms/Natural2015';\n * var layer = 'Natural2015';\n * var url = whoots.getURL(baseUrl, layer, 154308, 197167, 19);\n */\nfunction getURL(baseUrl, layer, x, y, z, options) {\n    options = options || {};\n\n    var url = baseUrl + '?' + [\n        'bbox='    + getTileBBox(x, y, z),\n        'format='  + (options.format || 'image/png'),\n        'service=' + (options.service || 'WMS'),\n        'version=' + (options.version || '1.1.1'),\n        'request=' + (options.request || 'GetMap'),\n        'srs='     + (options.srs || 'EPSG:3857'),\n        'width='   + (options.width || 256),\n        'height='  + (options.height || 256),\n        'layers='  + layer\n    ].join('&');\n\n    return url;\n}\n\n\n/**\n * getTileBBox\n *\n * @param    {Number}  x  Tile coordinate x\n * @param    {Number}  y  Tile coordinate y\n * @param    {Number}  z  Tile zoom\n * @returns  {String}  String of the bounding box\n */\nfunction getTileBBox(x, y, z) {\n    // for Google/OSM tile scheme we need to alter the y\n    y = (Math.pow(2, z) - y - 1);\n\n    var min = getMercCoords(x * 256, y * 256, z),\n        max = getMercCoords((x + 1) * 256, (y + 1) * 256, z);\n\n    return min[0] + ',' + min[1] + ',' + max[0] + ',' + max[1];\n}\n\n\n/**\n * getMercCoords\n *\n * @param    {Number}  x  Pixel coordinate x\n * @param    {Number}  y  Pixel coordinate y\n * @param    {Number}  z  Tile zoom\n * @returns  {Array}   [x, y]\n */\nfunction getMercCoords(x, y, z) {\n    var resolution = (2 * Math.PI * 6378137 / 256) / Math.pow(2, z),\n        merc_x = (x * resolution - 2 * Math.PI  * 6378137 / 2.0),\n        merc_y = (y * resolution - 2 * Math.PI  * 6378137 / 2.0);\n\n    return [merc_x, merc_y];\n}\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// define getter functions for harmony exports\n__webpack_require__.d = function(exports, definition) {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.g = (function() {\n\tif (typeof globalThis === 'object') return globalThis;\n\ttry {\n\t\treturn this || new Function('return this')();\n\t} catch (e) {\n\t\tif (typeof window === 'object') return window;\n\t}\n})();","__webpack_require__.o = function(obj, prop) { return Object.prototype.hasOwnProperty.call(obj, prop); }","// define __esModule on exports\n__webpack_require__.r = function(exports) {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","// @flow\r\n\r\nconst Actor = require('../util/actor');\r\nconst StyleLayerIndex = require('../style/style_layer_index');\r\n\r\nconst VectorTileWorkerSource = require('./vector_tile_worker_source');\r\nconst RasterDEMTileWorkerSource = require('./raster_dem_tile_worker_source');\r\nconst GeoJSONWorkerSource = require('./geojson_worker_source');\r\nconst assert = require('assert');\r\n\r\nconst globalRTLTextPlugin = require('./rtl_text_plugin');\r\n\r\nimport type {\r\n    WorkerSource,\r\n    WorkerTileParameters,\r\n    WorkerDEMTileParameters,\r\n    WorkerTileCallback,\r\n    WorkerDEMTileCallback,\r\n    TileParameters\r\n} from '../source/worker_source';\r\n\r\nimport type {WorkerGlobalScopeInterface} from '../util/web_worker';\r\nimport type {Callback} from '../types/callback';\r\n\r\n/**\r\n * @private\r\n */\r\nclass Worker {\r\n    self: WorkerGlobalScopeInterface;\r\n    actor: Actor;\r\n    layerIndexes: { [string]: StyleLayerIndex };\r\n    workerSourceTypes: { [string]: Class<WorkerSource> };\r\n    workerSources: { [string]: { [string]: WorkerSource } };\r\n    demWorkerSources: { [string]: RasterDEMTileWorkerSource };\r\n\r\n    constructor(self: WorkerGlobalScopeInterface) {\r\n        this.self = self;\r\n        this.actor = new Actor(self, this);\r\n\r\n        this.layerIndexes = {};\r\n\r\n        this.workerSourceTypes = {\r\n            vector: VectorTileWorkerSource,\r\n            geojson: GeoJSONWorkerSource\r\n        };\r\n\r\n        // [mapId][sourceType] => worker source instance\r\n        this.workerSources = {};\r\n        this.demWorkerSources = {};\r\n\r\n        this.self.registerWorkerSource = (name: string, WorkerSource: Class<WorkerSource>) => {\r\n            if (this.workerSourceTypes[name]) {\r\n                throw new Error(`Worker source with name \"${name}\" already registered.`);\r\n            }\r\n            this.workerSourceTypes[name] = WorkerSource;\r\n        };\r\n\r\n        this.self.registerRTLTextPlugin = (rtlTextPlugin: {applyArabicShaping: Function, processBidirectionalText: Function}) => {\r\n            if (globalRTLTextPlugin.applyArabicShaping || globalRTLTextPlugin.processBidirectionalText) {\r\n                throw new Error('RTL text plugin already registered.');\r\n            }\r\n            globalRTLTextPlugin['applyArabicShaping'] = rtlTextPlugin.applyArabicShaping;\r\n            globalRTLTextPlugin['processBidirectionalText'] = rtlTextPlugin.processBidirectionalText;\r\n        };\r\n    }\r\n\r\n    setLayers(mapId: string, layers: Array<LayerSpecification>, callback: WorkerTileCallback) {\r\n        this.getLayerIndex(mapId).replace(layers);\r\n        callback();\r\n    }\r\n\r\n    updateLayers(mapId: string, params: {layers: Array<LayerSpecification>, removedIds: Array<string>}, callback: WorkerTileCallback) {\r\n        this.getLayerIndex(mapId).update(params.layers, params.removedIds);\r\n        callback();\r\n    }\r\n\r\n    loadTile(mapId: string, params: WorkerTileParameters & {type: string}, callback: WorkerTileCallback) {\r\n        assert(params.type);\r\n        this.getWorkerSource(mapId, params.type).loadTile(params, callback);\r\n    }\r\n\r\n    loadDEMTile(mapId: string, params: WorkerDEMTileParameters, callback: WorkerDEMTileCallback) {\r\n        this.getDEMWorkerSource(mapId).loadTile(params, callback);\r\n    }\r\n\r\n    reloadTile(mapId: string, params: WorkerTileParameters & {type: string}, callback: WorkerTileCallback) {\r\n        assert(params.type);\r\n        this.getWorkerSource(mapId, params.type).reloadTile(params, callback);\r\n    }\r\n\r\n    abortTile(mapId: string, params: TileParameters & {type: string}, callback: WorkerTileCallback) {\r\n        assert(params.type);\r\n        this.getWorkerSource(mapId, params.type).abortTile(params, callback);\r\n    }\r\n\r\n    removeTile(mapId: string, params: TileParameters & {type: string}, callback: WorkerTileCallback) {\r\n        assert(params.type);\r\n        this.getWorkerSource(mapId, params.type).removeTile(params, callback);\r\n    }\r\n\r\n    removeDEMTile(mapId: string, params: TileParameters) {\r\n        this.getDEMWorkerSource(mapId).removeTile(params);\r\n    }\r\n\r\n    removeSource(mapId: string, params: {source: string} & {type: string}, callback: WorkerTileCallback) {\r\n        assert(params.type);\r\n        const worker = this.getWorkerSource(mapId, params.type);\r\n        if (worker.removeSource !== undefined) {\r\n            worker.removeSource(params, callback);\r\n        } else {\r\n            callback();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Load a {@link WorkerSource} script at params.url.  The script is run\r\n     * (using importScripts) with `registerWorkerSource` in scope, which is a\r\n     * function taking `(name, workerSourceObject)`.\r\n     *  @private\r\n     */\r\n    loadWorkerSource(map: string, params: { url: string }, callback: Callback<void>) {\r\n        try {\r\n            this.self.importScripts(params.url);\r\n            callback();\r\n        } catch (e) {\r\n            callback(e);\r\n        }\r\n    }\r\n\r\n    loadRTLTextPlugin(map: string, pluginURL: string, callback: Callback<void>) {\r\n        try {\r\n            if (!globalRTLTextPlugin.applyArabicShaping && !globalRTLTextPlugin.processBidirectionalText) {\r\n                this.self.importScripts(pluginURL);\r\n                if (!globalRTLTextPlugin.applyArabicShaping || !globalRTLTextPlugin.processBidirectionalText) {\r\n                    callback(new Error(`RTL Text Plugin failed to import scripts from ${pluginURL}`));\r\n                }\r\n            }\r\n        } catch (e) {\r\n            callback(e);\r\n        }\r\n    }\r\n\r\n    getLayerIndex(mapId: string) {\r\n        let layerIndexes = this.layerIndexes[mapId];\r\n        if (!layerIndexes) {\r\n            layerIndexes = this.layerIndexes[mapId] = new StyleLayerIndex();\r\n        }\r\n        return layerIndexes;\r\n    }\r\n\r\n    getWorkerSource(mapId: string, type: string) {\r\n        if (!this.workerSources[mapId])\r\n            this.workerSources[mapId] = {};\r\n        if (!this.workerSources[mapId][type]) {\r\n            // use a wrapped actor so that we can attach a target mapId param\r\n            // to any messages invoked by the WorkerSource\r\n            const actor = {\r\n                send: (type, data, callback) => {\r\n                    this.actor.send(type, data, callback, mapId);\r\n                }\r\n            };\r\n\r\n            this.workerSources[mapId][type] = new (this.workerSourceTypes[type]: any)((actor: any), this.getLayerIndex(mapId));\r\n        }\r\n\r\n        return this.workerSources[mapId][type];\r\n    }\r\n\r\n    getDEMWorkerSource(mapId: string) {\r\n        if (!this.demWorkerSources[mapId]) {\r\n            this.demWorkerSources[mapId] = new RasterDEMTileWorkerSource();\r\n        }\r\n\r\n        return this.demWorkerSources[mapId];\r\n    }\r\n}\r\n\r\nconst w = new Worker(self);\r\n"],"names":["wgs84","polygonArea","coords","area","length","Math","abs","ringArea","i","p1","p2","lowerIndex","middleIndex","upperIndex","coordsLength","rad","sin","RADIUS","_","PI","module","exports","geometry","type","coordinates","geometries","ring","Point","x","y","this","prototype","clone","add","p","_add","sub","_sub","multByPoint","_multByPoint","divByPoint","_divByPoint","mult","k","_mult","div","_div","rotate","a","_rotate","rotateAround","_rotateAround","matMult","m","_matMult","unit","_unit","perp","_perp","round","_round","mag","sqrt","equals","other","dist","distSqr","dx","dy","angle","atan2","angleTo","b","angleWith","angleWithSep","cos","convert","Array","isArray","ShelfPack$1","w","h","options","autoResize","shelves","freebins","stats","bins","maxId","Shelf","free","Bin","id","maxw","maxh","refcount","pack","concat","allocation","results","width","height","packOne","inPlace","push","shrink","bin","shelf","waste","h1","h2","w1","w2","best","freebin","Infinity","getBin","ref","max","allocFreebin","allocShelf","resize","index","splice","alloc","j","unref","clear","factory","UnitBezier","p1x","p1y","p2x","p2y","cx","bx","ax","cy","by","ay","sampleCurveX","t","sampleCurveY","sampleCurveDerivativeX","solveCurveX","epsilon","t0","t1","t2","x2","d2","solve","VectorTile","VectorTileFeature","VectorTileLayer","readTile","tag","layers","pbf","layer","readVarint","pos","name","end","readFields","extent","keys","values","properties","_pbf","_geometry","_keys","_values","readFeature","feature","key","value","readTag","signedArea","sum","len","types","loadGeometry","line","cmd","lines","cmdLen","readSVarint","Error","bbox","x1","y1","y2","toGeoJSON","z","size","pow","x0","y0","project","atan","exp","points","rings","polygon","ccw","polygons","undefined","classifyRings","result","version","_features","readLayer","readString","readFloat","readDouble","readVarint64","readBoolean","readValueMessage","objectAssign","compare","min","isBuffer","g","Buffer","_isBuffer","util","hasOwn","Object","hasOwnProperty","pSlice","slice","functionsHaveNames","pToString","obj","toString","call","isView","arrbuf","ArrayBuffer","DataView","buffer","assert","ok","regex","getName","func","isFunction","match","truncate","s","n","inspect","something","rawname","fail","actual","expected","message","operator","stackStartFunction","AssertionError","_deepEqual","strict","memos","isDate","getTime","isRegExp","source","global","multiline","lastIndex","ignoreCase","Float32Array","Float64Array","Uint8Array","actualIndex","indexOf","actualVisitedObjects","isPrimitive","getPrototypeOf","aIsArgs","isArguments","bIsArgs","ka","objectKeys","kb","sort","objEquiv","object","expectedException","test","e","isPrototypeOf","_throws","shouldThrow","block","TypeError","error","_tryBlock","userProvidedMessage","isUnexpectedException","isError","generatedMessage","self","getMessage","captureStackTrace","err","stack","out","fn_name","idx","next_line","substring","inherits","equal","notEqual","deepEqual","deepStrictEqual","notDeepEqual","notDeepStrictEqual","strictEqual","notStrictEqual","throws","doesNotThrow","ifError","create","ctor","superCtor","super_","constructor","enumerable","writable","configurable","TempCtor","arg","copy","fill","readUInt8","formatRegExp","format","f","isString","objects","arguments","join","args","str","String","replace","Number","JSON","stringify","isNull","isObject","deprecate","fn","msg","isUndefined","process","apply","noDeprecation","warned","throwDeprecation","traceDeprecation","console","trace","debugEnviron","debugs","opts","ctx","seen","stylize","stylizeNoColor","depth","colors","isBoolean","showHidden","_extend","customInspect","stylizeWithColor","formatValue","styleType","style","styles","recurseTimes","ret","primitive","simple","isNumber","formatPrimitive","visibleKeys","array","hash","forEach","val","arrayToHash","getOwnPropertyNames","formatError","RegExp","Date","output","base","braces","toUTCString","l","formatProperty","formatArray","map","pop","reduce","prev","cur","reduceToSingleString","desc","getOwnPropertyDescriptor","get","set","split","substr","ar","re","objectToString","d","o","pad","debuglog","env","NODE_DEBUG","toUpperCase","pid","isNullOrUndefined","isSymbol","months","timestamp","time","getHours","getMinutes","getSeconds","getDate","getMonth","prop","log","origin","require","StructArray","Struct","register","StructArrayLayout2i4","uint8","arrayBuffer","int16","Int16Array","v0","v1","o2","bytesPerElement","StructArrayLayout4i8","v2","v3","StructArrayLayout2i4i12","v4","v5","StructArrayLayout4i4ub12","v6","v7","o1","StructArrayLayout4i4ui16","uint16","Uint16Array","StructArrayLayout3f12","float32","o4","StructArrayLayout1ul4","uint32","Uint32Array","StructArrayLayout6i1ul2ui2i24","v8","v9","v10","StructArrayLayout2i2i2i12","StructArrayLayout2ub4","StructArrayLayout2i2ui3ul3ui2f2ub40","v11","v12","v13","StructArrayLayout1f4","StructArrayLayout3i6","StructArrayLayout1ul2ui8","StructArrayLayout3ui6","StructArrayLayout2ui4","StructArrayLayout2f8","StructArrayLayout4f16","CollisionBoxStruct","_structArray","_pos2","_pos4","anchorPointX","anchorPointY","CollisionBoxArray","isTransferred","PlacedSymbolStruct","_pos1","PlacedSymbolArray","GlyphOffsetStruct","GlyphOffsetArray","SymbolLineVertexStruct","SymbolLineVertexArray","FeatureIndexStruct","FeatureIndexArray","PosArray","RasterBoundsArray","CircleLayoutArray","FillLayoutArray","FillExtrusionLayoutArray","HeatmapLayoutArray","LineLayoutArray","SymbolLayoutArray","SymbolDynamicLayoutArray","SymbolOpacityArray","CollisionBoxLayoutArray","CollisionCircleLayoutArray","CollisionVertexArray","TriangleIndexArray","LineIndexArray","createLayout","components","layoutAttributes","SegmentVector","ProgramConfigurationSet","EXTENT","addCircleVertex","layoutVertexArray","extrudeX","extrudeY","emplaceBack","CircleBucket","zoom","overscaling","layerIds","indexArray","segments","programConfigurations","features","sourceLayerIndex","_featureFilter","addFeature","featureIndex","insert","context","layoutVertexBuffer","createVertexBuffer","indexBuffer","createIndexBuffer","upload","destroy","point","segment","prepareSegment","vertexLength","primitiveLength","populatePaintArrays","omit","earcut","FillBucket","indexArray2","segments2","indexBuffer2","numVertices","triangleSegment","triangleIndex","flattened","holeIndices","lineSegment","lineIndex","indices","MAX_VERTEX_ARRAY_LENGTH","FACTOR","addVertex","vertexArray","nx","ny","nz","floor","FillExtrusionBucket","every","edgeDistance","isBoundaryEdge","bottomRight","HeatmapBucket","vectorTileFeatureTypes","COS_HALF_SHARP_CORNER","MAX_LINE_DISTANCE","LINE_DISTANCE_BUFFER_BITS","addLineVertex","extrude","up","dir","linesofar","LineBucket","layout","evaluate","cap","miterLimit","roundLimit","addLine","vertices","isPolygon","first","sharpCornerOffset","firstVertex","distance","currentVertex","offsetA","offsetB","beginCap","endCap","startOfLine","prevVertex","nextVertex","prevNormal","nextNormal","e1","e2","e3","joinNormal","cosHalfAngle","miterLength","isSharpCorner","prevSegmentLength","newPrevVertex","addCurrentVertex","middleVertex","currentJoin","direction","bevelLength","lineTurnsLeft","offset","approxFractionalJoinNormal","addPieSliceVertex","nextSegmentLength","newCurrentVertex","normal","endLeft","endRight","symbolAttributes","symbolLayoutAttributes","dynamicLayoutAttributes","placementOpacityAttributes","collisionVertexAttributes","collisionBox","collisionBoxLayout","collisionCircleLayout","placement","glyphOffset","lineVertex","transformText","mergeLines","scriptDetection","verticalizePunctuation","getSizeData","shaderOpacityAttributes","anchorX","anchorY","ox","oy","tx","ty","sizeVertex","addDynamicAttributes","dynamicLayoutVertexArray","SymbolBuffers","opacityVertexArray","placedSymbolArray","dynamicIndexBuffer","members","dynamicLayoutVertexBuffer","opacityVertexBuffer","itemSize","CollisionBuffers","LayoutArray","IndexArray","collisionVertexArray","collisionVertexBuffer","SymbolBucket","collisionBoxArray","pixelRatio","unevaluatedLayoutValues","_unevaluatedLayout","textSizeData","iconSizeData","sortFeaturesByY","text","property","icon","collisionCircle","glyphOffsetArray","lineVertexArray","textFont","textField","iconImage","hasText","kind","hasIcon","icons","iconDependencies","stacks","glyphDependencies","globalProperties","getValueAndResolveTokens","symbolFeature","fontStack","textAlongLine","allowsVerticalWritingMode","charCodeAt","verticalChar","lookup","charAt","symbolInstances","anchor","lineStartIndex","sumForwardLength","sumBackwardLength","tileUnitDistanceFromAnchor","vertex","lineLength","arrays","quads","lineOffset","alongLine","writingMode","labelAnchor","glyphOffsetArrayStart","vertexStartIndex","symbol","tl","tr","bl","br","tex","boxAnchorPoint","symbolInstance","isCircle","_addCollisionDebugVertex","textCollisionFeature","boxStartIndex","textBoxStartIndex","boxEndIndex","textBoxEndIndex","iconCollisionFeature","iconBoxStartIndex","iconBoxEndIndex","box","radius","addCollisionDebugVertices","anchorPoint","textStartIndex","textEndIndex","iconStartIndex","iconEndIndex","collisionArrays","textBox","textCircles","signedDistanceFromAnchor","iconBox","sortedAngle","symbolInstanceIndexes","aIndex","bIndex","placedTextSymbolIndices","placedTextSymbolIndex","placedSymbol","endIndex","numGlyphs","vertexIndex","placedIcon","updateData","shallow","MAX_GLYPHS","RGBAImage","Level","dim","border","data","RangeError","stride","Int32Array","_idx","DEMData","uid","scale","level","loaded","pixels","borderTile","_xMin","_xMax","_yMin","_yMax","xMin","clamp","xMax","yMin","yMax","featureFilter","Grid","DictionaryCoder","vt","Protobuf","GeoJSONFeature","arraysIntersect","OverscaledTileID","FeatureIndex","tileID","grid","featureIndexArray","canonical","bucketIndex","r","styleLayers","vtLayers","rawTileData","sourceLayerCoder","params","pixelsToTileUnits","tileSize","filter","queryGeometry","additionalRadius","minX","minY","maxX","maxY","matching","query","topDownFeatureComparator","filterMatching","bearing","matchingSymbols","collisionIndex","queryRenderedSymbols","sourceID","bucketInstanceIds","filterLayerIDs","previousIndex","layerIDs","bucketLayerIDs","sourceLayerName","decode","overscaledZ","layerID","styleLayer","queryIntersectsFeature","geojsonFeature","serialize","layerResult","bounds","bits","warnOnce","packUint8ToFloat","PossiblyEvaluatedPropertyValue","packColor","color","ConstantBinder","statistics","program","globals","currentValue","constantOr","gl","uniform4f","uniforms","uniform1f","SourceExpressionBinder","expression","PaintVertexArray","paintVertexAttributes","paintVertexArray","paintArray","start","reserve","paintVertexBuffer","CompositeExpressionBinder","useIntegerZoom","minColor","maxColor","currentZoom","interpolationFactor","ProgramConfiguration","binders","cacheKey","_buffers","populatePaintArray","defines","setUniforms","buffers","binder","filterProperties","paint","specification","paintAttributeName","createDynamic","layerId","vertexOffset","primitiveOffset","vaos","Coordinate","column","row","_zoomTo","c","zoomTo","ShelfPack","AlphaImage","makeGlyphAtlas","image","positions","glyphs","stackPositions","src","bitmap","rect","metrics","imagePosition","textureRect","padding","displaySize","makeImageAtlas","images","ajax","rewind","GeoJSONWrapper","vtpbf","supercluster","geojsonvt","loadGeoJSONTile","callback","_geoJSONIndexes","geoJSONTile","getTile","geojsonWrapper","byteOffset","byteLength","vectorTile","rawData","GeoJSONWorkerSource","actor","layerIndex","loadGeoJSON","cluster","superclusterOptions","load","geojsonVtOptions","loadTile","request","getJSON","parse","FeatureWrapper","_feature","tags","isNaN","parseInt","newRing","RasterDEMTileWorkerSource","loading","dem","loadFromImage","rawImageData","Evented","window","pluginRequested","pluginBlobURL","evented","registerForPluginAvailability","errorCallback","once","createBlobURL","response","URL","createObjectURL","Blob","clearRTLTextPlugin","setRTLTextPlugin","pluginURL","getArrayBuffer","url","fire","applyArabicShaping","processBidirectionalText","WhooTS","CanonicalTileID","calculateKey","urls","scheme","getTileBBox","quadkey","mask","getQuadkey","UnwrappedTileID","wrap","posMatrix","targetZ","zDifference","parent","sourceMaxZoom","rhs","WorkerTile","loadVectorTile","xhr","cacheControl","expires","abort","VectorTileWorkerSource","loadVectorData","workerTile","extend","vtSource","showCollisionBoxes","status","reloadCallback","done","bind","performSymbolLayout","EvaluationParameters","glyphMap","imageMap","buckets","layerFamilies","familiesBySource","sourceLayerId","sourceLayer","encode","family","minzoom","maxzoom","visibility","recalculateLayers","createBucket","populate","mapObject","send","maybePrepare","glyphAtlas","imageAtlas","bucket","isEmpty","glyphAtlasImage","iconAtlasImage","parameters","recalculate","__line__","ParsingContext","CompoundExpression","_evaluate","op","definition","definitions","availableOverloads","overloads","signature","parsedArgs","parsed","signatureContext","registry","path","scope","checkSubtype","errors","signatures","actualTypes","varargs","ValueType","StringType","NumberType","BooleanType","typeOf","RuntimeError","string","number","boolean","ArrayAssertion","input","itemType","N","possibleOutputs","ObjectType","Assertion","At","expectedType","Case","branches","otherwise","outputType","Coalesce","omitTypeAnnotations","needsAnnotation","some","ColorType","Color","validateRGBA","Coercion","parseColor","num","isComparableType","makeComparison","lhs","Comparison","Equals","NotEquals","ErrorType","Let","Var","Literal","Match","Step","Interpolate","expressions","rgba","alpha","has","v","lt","gt","lteq","gteq","Boolean","geometryType","heatmapDensity","LN2","E","log10","log2","tan","asin","acos","binarySearch","toLowerCase","interpolate","findStopLessThanOrEqualTo","interpolation","stops","labels","outputs","label","lower","upper","exponentialInterpolation","controlPoints","rest","labelKey","valueKey","stopCount","outputLower","outputUpper","lowerValue","upperValue","difference","progress","bindings","pushScope","popScope","isValue","inputType","cases","labelContext","MAX_SAFE_INTEGER","unshift","Scope","geometryTypes","EvaluationContext","_parseColorCache","cached","ParsingError","isConstant","success","StyleExpression","_evaluator","StyleExpressionWithErrorHandling","propertySpec","spec","_warningHistory","_defaultValue","default","_enumValues","warn","isExpression","createExpression","parser","getExpectedType","handleErrors","ZoomConstantExpression","_styleExpression","ZoomDependentExpression","zoomCurve","zoomStops","_interpolationType","createPropertyExpression","isFeatureConstant","isZoomConstant","isGlobalPropertyConstant","findZoomCurve","createFunction","StylePropertyFunction","_parameters","_specification","serialized","eachChild","child","childResult","normalizePropertyExpression","constant","enum","startsWith","part","expr","Expr","ec","literalArgs","currentIndex","NullType","valueMemberTypes","mixed","isExpressionFilter","convertFilter","compiled","filterSpec","filters","convertComparisonOp","convertNegation","convertInOp","convertHasOp","colorSpaces","getType","identityFunction","coalesce","evaluateCategoricalFunction","hashedStops","keyType","evaluateIntervalFunction","evaluateExponentialFunction","interp","colorSpace","colorspace","reverse","forward","evaluatedLower","evaluatedUpper","evaluateIdentityFunction","innerFun","categoricalKeyType","isColor","zoomAndFeatureDependent","featureDependent","zoomDependent","function","stop","featureFunctions","featureFunctionStops","refProperties","getKey","groups","group","parseCSSColor","rgb","black","white","transparent","interpolateNumber","Xn","Zn","deg2rad","rad2deg","xyz2lab","lab2xyz","xyz2rgb","rgb2xyz","rgbToLab","rgbColor","labToRgb","labColor","interpolateHue","lab","from","to","hcl","hclColor","inputs","unbundle","valueOf","deep","deepUnbundle","validateFunction","validateExpression","validateObject","VALIDATORS","valueSpec","styleSpec","validate","ValidationError","arraySpec","validateArrayElement","arrayElementValidator","arrayElementSpec","$version","arrayIndex","constants","expressionContext","propertyKey","validateEnum","validateNonExpressionFilter","filter_operator","geometry_type","validateArray","validateNumber","stopKeyType","previousStopDomainValue","previousStopDomainZoom","functionValueSpec","functionType","stopDomainValues","isZoomFunction","isPropertyFunction","isZoomAndPropertyFunction","objectElementValidators","validateFunctionStop","objectKey","validateStopDomainValue","reportValue","isFinite","validateString","validateFilter","validatePaintProperty","validateLayoutProperty","validateSpec","otherLayer","sources","sourceType","layerType","validateProperty","light","lightSpec","rootType","transitionMatch","transition","minimum","maximum","elementSpecs","elementValidators","elementSpecKey","elementSpec","validateElement","required","propertyType","layerSpec","tokenMatch","tokens","exec","source_geojson","source_video","source_image","source_canvas","validateConstants","latestStyleSpec","validateGlyphsURL","validateStyleMin","$root","sortErrors","wrapCleanErrors","inner","paintProperty","layoutProperty","ZoomHistory","now","fadeDuration","zoomHistory","lastIntegerZoomTime","readFontstacks","readMessage","readFontstack","readGlyph","left","top","advance","glyph","readBytes","GLYPH_PBF_BORDER","easeCubicInOut","PropertyValue","possiblyEvaluate","TransitionablePropertyValue","prior","TransitioningPropertyValue","Transitionable","_properties","defaultTransitionablePropertyValues","getValue","getTransition","Transitioning","transitioned","untransitioned","begin","delay","duration","finalValue","isDataDriven","defaultTransitioningPropertyValues","PossiblyEvaluated","Layout","defaultPropertyValues","defaultPossiblyEvaluatedValues","DataConstantProperty","DataDrivenProperty","CrossFadedProperty","_calculate","mid","fraction","crossFadingFactor","lastIntegerZoom","fromScale","toScale","HeatmapColorProperty","Properties","defaultPropertyValue","defaultTransitionablePropertyValue","getMaximumPaintValue","translateDistance","translate","translateAnchor","pt","translated","translatedRing","validateStyle","TRANSITION_SUFFIX","StyleLayer","metadata","_transitionablePaint","setPaintProperty","setLayoutProperty","_transitioningPaint","_validate","setValue","endsWith","setTransition","hasTransition","filterObject","emitErrors","sprite","subclasses","BackgroundStyleLayer","multiPolygonIntersectsBufferedMultiPoint","CircleStyleLayer","circleBucket","translatedPolygon","stroke","multiPolygonIntersectsMultiPolygon","FillExtrusionStyleLayer","viewportFrame","FillStyleLayer","HeatmapStyleLayer","_updateColorRamp","colorRampData","pxColor","colorRamp","colorRampTexture","heatmapFbo","HillshadeStyleLayer","multiPolygonIntersectsBufferedMultiLine","LineFloorwidthProperty","lineFloorwidthProperty","LineStyleLayer","lineBucket","getLineWidth","halfWidth","newRings","zero","aToB","bToC","offsetLine","lineWidth","lineGapWidth","RasterStyleLayer","resolveTokens","SymbolStyleLayer","unevaluated","groupByLayout","StyleLayerIndex","layerConfigs","_layerConfigs","_layers","update","removedIds","layerConfig","sourceId","sourceGroup","sourceLayerFamilies","emitter","floorZ","lastZoom","lastFloorZoom","Anchor","labelLength","windowSize","maxAngle","anchorDistance","recentCorners","recentAngleDelta","current","next","angleDelta","shift","clippedLines","clippedLine","p0","CollisionFeature","shaped","boxScale","alignLine","bottom","right","_addLineCollisionCircles","boxSize","step","nBoxes","overscalingPaddingFactor","nPitchPaddingBoxes","firstBoxOffset","labelStartDistance","paddingStartDistance","segmentLength","boxOffset","boxDistanceToAnchor","segmentBoxDistance","paddedAnchorDistance","checkMaxAngle","resample","spacing","angleWindowSize","isLineContinued","placeAtMiddle","tileExtent","halfLabelLength","markedDistance","anchors","segmentDist","shapedText","shapedIcon","glyphSize","leftIndex","rightIndex","mergedFeatures","mergedIndex","mergeFromRight","leftKey","rightKey","geom","mergeFromLeft","onRight","OpacityState","opacity","targetOpacity","getIconQuads","iconWidth","iconHeight","textLeft","textRight","textTop","textWidth","textHeight","padT","padR","padB","padL","offsetY","offsetX","matrix","getGlyphQuads","shaping","textRotate","textOffset","positionedGlyphs","positionedGlyph","rectBuffer","halfAdvance","builtInOffset","vertical","center","verticalRotation","xOffsetCorrection","rtlTextPlugin","WritingMode","horizontal","horizontalOnly","shapeText","maxWidth","lineHeight","textAnchor","textJustify","verticalHeight","logicalInput","trim","determineLineBreaks","lineBreakPoints","lineBreak","breakLines","maxLineLength","justify","codePoint","charHasUprightVerticalOrientation","justifyLine","getAnchorAlignment","horizontalAlign","verticalAlign","lineCount","shiftX","shiftY","align","shapeLines","shapeIcon","iconOffset","iconAnchor","whitespace","breakable","calculateBadness","targetWidth","penalty","isLastBreak","raggedness","calculatePenalty","nextCodePoint","evaluateBreak","breakIndex","breakX","potentialBreaks","bestPriorBreak","bestBreakBadness","potentialBreak","breakBadness","badness","priorBreak","leastBadBreaks","lastLineBreak","potentialLineBreaks","totalWidth","ceil","determineAverageLineWidth","currentX","charAllowsIdeographicBreaking","lastAdvance","lineIndent","getAnchors","clipLine","findPoleOfInaccessibility","shapedTextOrientations","glyphPositionMap","sizes","layoutTextSize","layoutIconSize","textMaxSize","fontScale","textBoxScale","tilePixelRatio","textMaxBoxScale","iconBoxScale","symbolMinDistance","textPadding","iconPadding","textMaxAngle","iconAlongLine","textRepeatDistance","addSymbolAtAnchor","lineArray","addToLineVertexArray","numIconVertices","numGlyphVertices","numVerticalGlyphVertices","addTextVertices","iconQuads","sizeData","compositeIconSizes","addSymbols","textOpacityState","iconOpacityState","isDuplicate","crossTileID","addSymbol","anchorIsTooClose","poi","glyphQuads","compositeTextSizes","repeatDistance","compareText","otherAnchors","glyphPositions","imagePositions","createArrays","iconsNeedLinear","zoomRange","oneEm","keepUpright","fontstack","spacingIfAllowed","allowsLetterSpacing","sdfIcons","sdf","generateCollisionDebugBuffers","tileZoom","layoutSize","levels","propertyValue","sizeRange","evaluateSizeForFeature","partiallyEvaluatedSize","lowerSize","upperSize","uSizeT","uSize","evaluateSizeForZoom","transform","toLocaleUpperCase","toLocaleLowerCase","deserialize","Actor","target","mapId","callbacks","callbackID","bindAll","addEventListener","receive","targetMapId","postMessage","sourceMapId","getWorkerSource","removeEventListener","ResourceType","Unknown","Style","Source","Tile","Glyphs","SpriteImage","SpriteJSON","Image","freeze","AJAXError","makeRequest","requestParameters","XMLHttpRequest","open","headers","setRequestHeader","withCredentials","credentials","onerror","statusText","onload","responseType","getResponseHeader","getImage","imgData","img","webkitURL","revokeObjectURL","blob","getVideo","video","document","createElement","onloadstart","href","protocol","location","host","crossOrigin","appendChild","quickselect","calculateSignedArea","compareAreas","maxRings","strings","_stringToNumber","_numberToString","_addEventListener","listener","listenerList","_removeEventListener","_listeners","_oneTimeListeners","listens","_eventedParent","_eventedParentData","Queue","distToSegmentSquared","compareMax","Cell","inside","minDistSq","pointToPolygonDist","SQRT2","getCentroidCell","polygonRings","precision","debug","outerRing","cellSize","cellQueue","bestCell","numProbes","cell","createImage","channels","resizeImage","newImage","copyImage","srcImg","dstImg","srcPt","dstPt","srcData","dstData","srcOffset","dstOffset","isCounterClockwise","lineIntersectsBufferedLine","lineA","lineB","lineIntersectsLine","pointIntersectsBufferedLine","a0","a1","lineSegmentIntersectsLineSegment","b0","b1","radiusSquared","l2","multiPolygonContainsPoint","polygonContainsPoint","multiPolygon","multiPolygonA","multiPolygonB","multiLine","polygonIntersectsPolygon","polygonA","polygonB","char","isChar","allowsIdeographicBreaking","chars","charAllowsLetterSpacing","charHasNeutralVerticalOrientation","charHasRotatedVerticalOrientation","viewTypes","Int8Array","structArray","_pos8","capacity","_refreshViews","oldUint8Array","transferables","_trim","sizeOf","BYTES_PER_ELEMENT","alignment","maxSize","layoutMembers","member","typeSize","memberOffset","parseFloat","toFixed","formatNumber","t3","bezier","ease","asyncAll","remaining","item","keysDifference","dest","pick","uniqueId","fns","getCoordinatesCenter","dMax","suffix","iterator","warnOnceHistory","isClosedPolygon","sphericalToCartesian","azimuthal","polar","parseCacheControl","header","$0","$1","$2","$3","maxAge","Feature","vectorTileFeature","_vectorTileFeature","_z","_x","_y","json","nextCharCode","prevCharCode","ImageData","klass","defineProperty","writeable","ab","toArrayBuffer","_classRegistryKey","view","_serialized","kCSSColorTable","clamp_css_byte","clamp_css_float","parse_css_int","parse_css_float","css_hue_to_rgb","m1","m2","css_str","iv","ep","fname","invSize","hasHoles","outerLen","outerNode","linkedList","triangles","list","queue","steiner","getLeftmost","compareX","eliminateHole","filterPoints","eliminateHoles","earcutLinked","clockwise","last","insertNode","removeNode","again","ear","pass","zOrder","prevZ","nextZ","q","tail","numMerges","pSize","qSize","inSize","sortLinked","indexCurve","isEarHashed","isEar","cureLocalIntersections","splitEarcut","pointInTriangle","minTX","minTY","maxTX","maxTY","minZ","maxZ","intersects","locallyInside","isValidDiagonal","splitPolygon","hole","hx","hy","qx","mx","my","tanMin","findHoleBridge","leftmost","px","py","intersectsPolygon","middleInside","q1","q2","a2","Node","b2","an","bp","deviation","trianglesArea","flatten","holes","dimensions","holeIndex","geojsonArea","curryOuter","correctRings","outer","wind","cw","gj","correct","simplify","sqTolerance","maxSqDist","minPosToMid","getSqSegDist","posToMid","createFeature","calcLineBBox","calcBBox","convertFeature","geojson","tolerance","maxZoom","promoteId","generateId","convertPoint","convertLine","lineMetrics","convertLines","projectX","projectY","clip","k1","k2","axis","minAll","maxAll","clipped","newGeometry","clipPoints","clipLines","newGeom","trackMetrics","segLen","newSlice","intersect","intersectX","intersectY","az","exited","addPoint","shiftFeatureCoords","newFeatures","shiftCoords","newPolygon","newPoints","transformTile","tile","transformed","z2","transformPoint","createTile","numPoints","numSimplified","numFeatures","simplified","tileFeature","isOuter","GeoJSONVT","tiles","tileCoords","timeEnd","indexMaxZoom","indexMaxPoints","total","merged","splitTile","toID","cz","k3","k4","z0","GridIndex","cells","subarray","keysOffset","bboxesOffset","bboxes","_insertReadonly","_forEachCell","_insertCell","cellIndex","intersectionTest","_queryCell","seenUids","u","arg1","arg2","cx1","_convertToCellCoord","cy1","cx2","cy2","_convertFromCellCoord","metadataLength","totalCellLength","read","isLE","mLen","nBytes","eLen","eMax","eBias","nBits","NaN","write","rt","range","within","KDBush","getX","getY","nodeSize","ArrayType","defaultGetX","defaultGetY","ids","nextAxis","select","inc","sd","swapItem","swap","arr","tmp","sortKD","sqDist","qy","r2","getOwnPropertySymbols","propIsEnumerable","propertyIsEnumerable","toObject","assign","test1","test2","fromCharCode","test3","letter","shouldUseNative","symbols","Pbf","ieee754","buf","Varint","Fixed64","Bytes","Fixed32","SHIFT_LEFT_32","SHIFT_RIGHT_32","readPackedEnd","toNum","low","high","isSigned","makeRoomForExtraLength","startPos","extraLen","realloc","writePackedVarint","writeVarint","writePackedSVarint","writeSVarint","writePackedFloat","writeFloat","writePackedDouble","writeDouble","writePackedBoolean","writeBoolean","writePackedFixed32","writeFixed32","writePackedSFixed32","writeSFixed32","writePackedFixed64","writeFixed64","writePackedSFixed64","writeSFixed64","readUInt32","writeInt32","readInt32","readField","skip","readFixed32","readSFixed32","readFixed64","readSFixed64","readVarintRemainder","b3","bytesPerSequence","readUtf8","readPackedVarint","readPackedSVarint","readPackedBoolean","readPackedFloat","readPackedDouble","readPackedFixed32","readPackedSFixed32","readPackedFixed64","readPackedSFixed64","writeTag","finish","writeBigVarintLow","lsb","writeBigVarintHigh","writeBigVarint","writeString","lead","writeUtf8","writeBytes","writeRawMessage","writeMessage","writeBytesField","writeFixed32Field","writeSFixed32Field","writeFixed64Field","writeSFixed64Field","writeVarintField","writeSVarintField","writeStringField","writeFloatField","writeDoubleField","writeBooleanField","quickselectStep","defaultCompare","kdbush","SuperCluster","trees","createCluster","parentId","createPointCluster","lngX","latY","getClusterJSON","getClusterProperties","count","abbrev","cluster_id","point_count","point_count_abbreviated","lng","lat","minZoom","initial","props","timerId","clusters","_cluster","getClusters","tree","_limitZoom","getChildren","clusterId","clusterZoom","children","getLeaves","limit","leaves","_appendLeaves","_addTileFeatures","getClusterExpansionZoom","skipped","neighborIds","wx","wy","clusterProperties","_accumulate","numPoints2","TinyQueue","_down","_up","peek","halfLength","fromVectorTileJs","writeLayer","writeTile","keycache","valuecache","writeFeature","writeValue","writeProperties","writeGeometry","keyIndex","valueIndex","command","zigzag","fromGeojsonVt","rawGeometry","coord","FLATTENING","POLAR_RADIUS","getURL","baseUrl","service","srs","getMercCoords","resolution","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","__webpack_modules__","globalThis","Function","Symbol","toStringTag","globalRTLTextPlugin","Worker","layerIndexes","workerSourceTypes","vector","workerSources","demWorkerSources","registerWorkerSource","WorkerSource","registerRTLTextPlugin","getLayerIndex","getDEMWorkerSource","reloadTile","abortTile","removeTile","worker","removeSource","importScripts"],"sourceRoot":""}